<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>source.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>source.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 3.4% of total for source files.">679 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/source.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">source.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/source.html">source</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/source.f90.html#src">source.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>Add source's contribution to the residual</p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~source.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilesourcef90EfferentGraph" width="641pt" height="422pt"
 viewBox="0.00 0.00 641.00 422.44" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~source.f90~~EfferentGraph" class="graph" transform="scale(.7649 .7649) rotate(0) translate(4 548.2659)">
<title>sourcefile~~source.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-548.2659 834,-548.2659 834,4 -4,4"/>
<!-- sourcefile~source.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~source.f90</title>
<polygon fill="none" stroke="#000000" points="830,-281.8682 767,-281.8682 767,-257.8682 830,-257.8682 830,-281.8682"/>
<text text-anchor="middle" x="798.5" y="-267.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">source.f90</text>
</g>
<!-- sourcefile~global_sa.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~global_sa.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/global_sa.f90.html" xlink:title="global_sa.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="719,-461.8682 643,-461.8682 643,-437.8682 719,-437.8682 719,-461.8682"/>
<text text-anchor="middle" x="681" y="-447.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sa.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~global_sa.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~global_sa.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M796.043,-282.2059C789.8374,-310.522 771.0889,-381.0237 731,-423.8682 728.0294,-427.0429 724.5836,-429.8989 720.917,-432.4512"/>
<polygon fill="#ff0000" stroke="#ff0000" points="718.7809,-429.6551 712.0806,-437.8622 722.4365,-435.6247 718.7809,-429.6551"/>
</g>
<!-- sourcefile~cc.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~cc.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/cc.f90.html" xlink:title="CC.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="427.5,-381.8682 373.5,-381.8682 373.5,-357.8682 427.5,-357.8682 427.5,-381.8682"/>
<text text-anchor="middle" x="400.5" y="-367.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">CC.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~cc.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~cc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M791.103,-281.9263C774.4106,-308.2855 731.3236,-371.7246 681,-409.8682"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M681,-409.8682C634.7774,-444.9034 608.3727,-413.7094 550.5,-409.8682"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550.5,-409.8682C510.8756,-407.2382 467.1731,-394.3848 437.2133,-383.9476"/>
<polygon fill="#ff0000" stroke="#ff0000" points="438.2002,-380.5837 427.6056,-380.519 435.8475,-387.1765 438.2002,-380.5837"/>
</g>
<!-- sourcefile~dump_solution.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~dump_solution.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/dump_solution.f90.html" xlink:title="dump_solution.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="731,-281.8682 631,-281.8682 631,-257.8682 731,-257.8682 731,-281.8682"/>
<text text-anchor="middle" x="681" y="-267.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dump_solution.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~dump_solution.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~dump_solution.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M766.7028,-269.8682C758.8868,-269.8682 750.2583,-269.8682 741.5765,-269.8682"/>
<polygon fill="#ff0000" stroke="#ff0000" points="741.4059,-266.3683 731.4059,-269.8682 741.4058,-273.3683 741.4059,-266.3683"/>
</g>
<!-- sourcefile~global_kkl.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~global_kkl.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/global_kkl.f90.html" xlink:title="global_kkl.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="720,-61.8682 642,-61.8682 642,-37.8682 720,-37.8682 720,-61.8682"/>
<text text-anchor="middle" x="681" y="-47.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_kkl.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~global_kkl.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~global_kkl.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M797.3351,-257.4033C793.6184,-224.0838 779.2882,-131.7018 731,-75.8682 728.2279,-72.6629 724.9626,-69.798 721.4503,-67.25"/>
<polygon fill="#ff0000" stroke="#ff0000" points="723.2474,-64.2455 712.9225,-61.8689 719.5118,-70.1654 723.2474,-64.2455"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="282.5,-340.8682 228.5,-340.8682 228.5,-316.8682 282.5,-316.8682 282.5,-340.8682"/>
<text text-anchor="middle" x="255.5" y="-326.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550.5,-409.8682C452.7946,-403.3832 421.681,-427.8188 331,-390.8682 308.2053,-381.5798 286.9916,-362.8976 272.8919,-348.4572"/>
<polygon fill="#ff0000" stroke="#ff0000" points="275.2308,-345.8357 265.8257,-340.9577 270.1361,-350.6361 275.2308,-345.8357"/>
</g>
<!-- sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~global_vars.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/global_vars.f90.html" xlink:title="global_vars.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="180,-263.8682 95,-263.8682 95,-239.8682 180,-239.8682 180,-263.8682"/>
<text text-anchor="middle" x="137.5" y="-249.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_vars.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550.5,-527.8682C456.9906,-556.9266 421.9742,-545.091 331,-508.8682 291.1792,-493.0129 291.8472,-471.5831 255.5,-448.8682"/>
</g>
<!-- sourcefile~global_sst.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~global_sst.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/global_sst.f90.html" xlink:title="global_sst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="295,-183.8682 216,-183.8682 216,-159.8682 295,-159.8682 295,-183.8682"/>
<text text-anchor="middle" x="255.5" y="-169.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550.5,-89.8682C451.4327,-77.5148 338.9489,-127.4212 286.0542,-154.8844"/>
<polygon fill="#ff0000" stroke="#ff0000" points="284.0921,-151.9626 276.8878,-159.7311 287.3641,-158.1509 284.0921,-151.9626"/>
</g>
<!-- sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~string.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/string.f90.html" xlink:title="string.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="284,-103.8682 227,-103.8682 227,-79.8682 284,-79.8682 284,-103.8682"/>
<text text-anchor="middle" x="255.5" y="-89.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">string.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M789.8214,-257.7406C761.0093,-218.9728 663.899,-99.9927 550.5,-89.8682"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550.5,-89.8682C462.4505,-61.2818 351.6751,-74.0596 294.1591,-84.0414"/>
<polygon fill="#ff0000" stroke="#ff0000" points="293.2775,-80.6439 284.0569,-85.8621 294.5192,-87.5329 293.2775,-80.6439"/>
</g>
<!-- sourcefile~layout.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~layout.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/layout.f90.html" xlink:title="layout.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="430,-499.8682 371,-499.8682 371,-475.8682 430,-475.8682 430,-499.8682"/>
<text text-anchor="middle" x="400.5" y="-485.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">layout.f90</text>
</a>
</g>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~layout.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~layout.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M681,-409.8682C662.0546,-424.2282 650.27,-414.9469 631,-428.8682 585.0308,-462.0778 604.6556,-511.0391 550.5,-527.8682"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550.5,-527.8682C539.8895,-531.1655 480.7085,-513.6175 439.9334,-500.7112"/>
<polygon fill="#ff0000" stroke="#ff0000" points="440.8509,-497.3302 430.2603,-497.6277 438.7249,-503.9996 440.8509,-497.3302"/>
</g>
<!-- sourcefile~cc.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~cc.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M373.2266,-362.1564C350.4421,-355.7139 317.7352,-346.4657 292.5751,-339.3515"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="293.2262,-335.8984 282.6511,-336.5454 291.3215,-342.6343 293.2262,-335.8984"/>
</g>
<!-- sourcefile~cc.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~cc.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M385.7561,-382.0847C353.9585,-407.7519 279.8432,-463.7353 255.5,-448.8682"/>
<path fill="none" stroke="#ffaa00" stroke-dasharray="5,2" d="M255.5,-448.8682C189.4584,-408.5344 155.7271,-316.1103 143.2766,-273.7749"/>
<polygon fill="#ffaa00" stroke="#ffaa00" points="146.5823,-272.6014 140.5017,-263.9252 139.8446,-274.4997 146.5823,-272.6014"/>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M630.9826,-281.323C574.9912,-293.9693 481.4844,-314.5614 400.5,-329.8682"/>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M676.8679,-282.1564C666.8548,-310.3682 638.8419,-380.6657 595,-423.8682 578.9944,-439.6403 569.8268,-436.4047 550.5,-447.8682"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M550.5,-447.8682C522.3082,-464.5899 283.4736,-465.9525 255.5,-448.8682"/>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M550.5,-127.8682C497.3581,-87.6143 465.0094,-144.6901 400.5,-127.8682"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M400.5,-127.8682C364.4654,-118.4716 323.2426,-108.2917 293.9849,-101.1626"/>
<polygon fill="#aaff00" stroke="#aaff00" points="294.707,-97.7363 284.1632,-98.7745 293.0531,-104.5381 294.707,-97.7363"/>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~layout.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~layout.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M550.5,-447.8682C516.4488,-468.0654 472.0871,-478.2542 440.4588,-483.2703"/>
<polygon fill="#aaff00" stroke="#aaff00" points="439.6342,-479.8541 430.2542,-484.7801 440.6588,-486.7788 439.6342,-479.8541"/>
</g>
<!-- sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~global.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/global.f90.html" xlink:title="global.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="59,-263.8682 0,-263.8682 0,-239.8682 59,-239.8682 59,-263.8682"/>
<text text-anchor="middle" x="29.5" y="-249.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M672.3714,-257.8673C653.008,-231.5892 603.6125,-168.0999 550.5,-127.8682"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M550.5,-127.8682C532.5878,-114.3001 521.5108,-120.1272 506,-103.8682 480.4779,-77.115 501.2946,-48.5598 470,-28.8682 388.8489,22.1949 336.664,-.8256 255.5,-51.8682"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M255.5,-51.8682C238.3595,-61.1262 230.1798,-57.5101 216,-70.8682 163.7934,-120.0496 205.0085,-187.6413 137.5,-211.8682"/>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M137.5,-211.8682C114.696,-220.0519 89.2834,-229.45 68.8405,-237.0794"/>
<polygon fill="#aaff00" stroke="#aaff00" points="67.3785,-233.8894 59.2373,-240.6697 69.8298,-240.4461 67.3785,-233.8894"/>
</g>
<!-- sourcefile~write_output.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~write_output.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/write_output.f90.html" xlink:title="write_output.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="595,-221.8682 506,-221.8682 506,-197.8682 595,-197.8682 595,-221.8682"/>
<text text-anchor="middle" x="550.5" y="-207.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~write_output.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~write_output.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M654.5914,-257.7263C634.8688,-248.6584 607.7024,-236.1682 586.0683,-226.2214"/>
<polygon fill="#aaff00" stroke="#aaff00" points="587.4171,-222.9894 576.8693,-221.992 584.493,-229.3494 587.4171,-222.9894"/>
</g>
<!-- sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ffa9" stroke-dasharray="5,2" d="M237.0625,-316.8369C217.6927,-304.1973 187.0176,-284.1805 164.8322,-269.7036"/>
<polygon fill="#00ffa9" stroke="#00ffa9" points="166.4849,-266.6028 156.1975,-264.0691 162.6595,-272.4651 166.4849,-266.6028"/>
</g>
<!-- sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#00a9ff" stroke-dasharray="5,2" d="M94.8155,-251.8682C86.4413,-251.8682 77.6869,-251.8682 69.4077,-251.8682"/>
<polygon fill="#00a9ff" stroke="#00a9ff" points="69.2393,-248.3683 59.2392,-251.8682 69.2392,-255.3683 69.2393,-248.3683"/>
</g>
<!-- sourcefile~layout.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~layout.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M386.049,-475.7264C371.5515,-463.2828 348.8707,-443.0877 331,-423.8682 308.3586,-399.5179 284.9378,-369.0835 270.3045,-349.3223"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="272.9733,-347.0433 264.2338,-341.0541 267.3309,-351.1862 272.9733,-347.0433"/>
</g>
<!-- sourcefile~layout.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~layout.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M370.7851,-484.8581C340.0329,-480.6503 291.5407,-470.8794 255.5,-448.8682"/>
</g>
<!-- sourcefile~layout.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~layout.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#ff00aa" stroke-dasharray="5,2" d="M370.7767,-489.9885C332.6247,-491.3889 265.4615,-489.3024 216,-462.8682 131.0157,-417.4492 66.3434,-316.8976 41.0806,-273.028"/>
<polygon fill="#ff00aa" stroke="#ff00aa" points="43.9999,-271.0798 36.0332,-264.0954 37.9055,-274.5235 43.9999,-271.0798"/>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M544.302,-221.8739C532.6892,-243.151 505.5809,-287.4362 470,-310.8682 443.2561,-328.4805 431.9653,-323.921 400.5,-329.8682"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M400.5,-329.8682C364.3696,-336.6971 322.2655,-335.408 292.7661,-333.0413"/>
<polygon fill="#00ffff" stroke="#00ffff" points="292.7721,-329.5282 282.5026,-332.1336 292.1554,-336.501 292.7721,-329.5282"/>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M510.6946,-221.8689C497.8196,-225.314 483.4053,-228.7168 470,-230.8682 372.0157,-246.5932 256.0211,-250.6729 190.1687,-251.6536"/>
<polygon fill="#00ffff" stroke="#00ffff" points="189.9942,-248.1554 180.0407,-251.7856 190.0856,-255.1548 189.9942,-248.1554"/>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M538.2137,-197.6494C523.299,-183.4735 496.8015,-160.3295 470,-146.8682 441.3842,-132.4957 431.4862,-135.9483 400.5,-127.8682"/>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M543.5367,-197.5424C531.3275,-177.0565 504.0849,-136.0626 470,-113.8682 386.8401,-59.7185 337.6361,3.8221 255.5,-51.8682"/>
</g>
<!-- sourcefile~write_output_tec_node.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~write_output_tec_node.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/write_output_tec_node.f90.html" xlink:title="write_output_tec_node.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="470,-179.8682 331,-179.8682 331,-155.8682 470,-155.8682 470,-179.8682"/>
<text text-anchor="middle" x="400.5" y="-165.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output_tec_node.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec_node.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec_node.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M507.516,-197.8327C490.5696,-193.0877 470.9385,-187.591 453.1527,-182.6109"/>
<polygon fill="#00ffff" stroke="#00ffff" points="454.0636,-179.2315 443.4903,-179.9055 452.1762,-185.9722 454.0636,-179.2315"/>
</g>
<!-- sourcefile~write_output_vtk.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~write_output_vtk.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/write_output_vtk.f90.html" xlink:title="write_output_vtk.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="455,-221.8682 346,-221.8682 346,-197.8682 455,-197.8682 455,-221.8682"/>
<text text-anchor="middle" x="400.5" y="-207.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output_vtk.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_vtk.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_vtk.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M505.9012,-209.8682C493.1699,-209.8682 479.0319,-209.8682 465.3526,-209.8682"/>
<polygon fill="#00ffff" stroke="#00ffff" points="465.0123,-206.3683 455.0123,-209.8682 465.0122,-213.3683 465.0123,-206.3683"/>
</g>
<!-- sourcefile~write_output_tec.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~write_output_tec.f90</title>
<g id="a_sourcefile~~source.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/write_output_tec.f90.html" xlink:title="write_output_tec.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="455,-301.8682 346,-301.8682 346,-277.8682 455,-277.8682 455,-301.8682"/>
<text text-anchor="middle" x="400.5" y="-287.4682" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output_tec.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M534.8382,-221.9865C519.0914,-233.774 493.8027,-251.6445 470,-263.8682 462.749,-267.5919 454.8366,-271.0632 447.0328,-274.1794"/>
<polygon fill="#00ffff" stroke="#00ffff" points="445.698,-270.9427 437.6194,-277.7975 448.2094,-277.4767 445.698,-270.9427"/>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M343.2312,-179.9333C338.7579,-182.3845 334.5918,-185.3298 331,-188.8682 293.4507,-225.8591 326.4697,-259.5843 295,-301.8682 292.6133,-305.0751 289.728,-308.0304 286.616,-310.7154"/>
<polygon fill="#ff0000" stroke="#ff0000" points="284.4184,-307.9893 278.5678,-316.8223 288.6498,-313.5657 284.4184,-307.9893"/>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M255.5,-131.8682C236.5313,-136.3062 229.7694,-137.0874 216,-150.8682 189.8659,-177.0238 204.7849,-198.4306 180,-225.8682 177.3365,-228.8168 174.2604,-231.5443 171.0055,-234.0353"/>
<polygon fill="#ff0000" stroke="#ff0000" points="168.9572,-231.1959 162.6797,-239.7307 172.9095,-236.9734 168.9572,-231.1959"/>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M330.9729,-169.7862C322.3873,-170.023 313.746,-170.2614 305.5317,-170.488"/>
<polygon fill="#ff0000" stroke="#ff0000" points="305.2913,-166.9932 295.3917,-170.7677 305.4844,-173.9905 305.2913,-166.9932"/>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M363.3901,-155.7788C352.7167,-151.8253 341.2068,-147.0914 331,-141.8682 313.8816,-133.1081 311.0312,-128.4879 295,-117.8682 290.9362,-115.1761 286.6326,-112.3342 282.419,-109.5568"/>
<polygon fill="#ff0000" stroke="#ff0000" points="284.2793,-106.591 274.0024,-104.0149 280.4297,-112.4375 284.2793,-106.591"/>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M367.1093,-155.8298C331.2075,-143.5567 276.4623,-126.9637 255.5,-131.8682"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M255.5,-131.8682C193.8051,-146.3026 197.137,-190.4661 137.5,-211.8682"/>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M385.9874,-221.9136C371.8315,-233.7273 349.7527,-252.3241 331,-268.8682 314.7237,-283.2276 312.0025,-288.3765 295,-301.8682 291.1365,-304.9339 286.9403,-308.03 282.7736,-310.9774"/>
<polygon fill="#00ff00" stroke="#00ff00" points="280.6276,-308.2056 274.3783,-316.7612 284.5989,-313.9701 280.6276,-308.2056"/>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M255.5,-211.8682C226.0953,-214.5468 194.4999,-225.7412 171.4099,-235.6085"/>
<polygon fill="#00ff00" stroke="#00ff00" points="169.8047,-232.491 162.0661,-239.7274 172.6283,-238.8963 169.8047,-232.491"/>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M354.6211,-197.8448C338.818,-193.7032 321.0552,-189.0482 304.9778,-184.8348"/>
<polygon fill="#00ff00" stroke="#00ff00" points="305.7784,-181.4265 295.2177,-182.277 304.0038,-188.1978 305.7784,-181.4265"/>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M345.897,-198.1767C340.5351,-195.6561 335.4441,-192.5923 331,-188.8682 303.8825,-166.1439 318.5666,-144.257 295,-117.8682 292.5015,-115.0705 289.6368,-112.4433 286.616,-110.0149"/>
<polygon fill="#00ff00" stroke="#00ff00" points="288.5535,-107.0966 278.4001,-104.0702 284.45,-112.7678 288.5535,-107.0966"/>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M345.6568,-208.637C318.4844,-208.5323 285.2105,-209.1617 255.5,-211.8682"/>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M255.5,-211.8682C203.2718,-216.6259 186.862,-194.1535 137.5,-211.8682"/>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M355.8121,-301.8877C335.498,-307.3515 311.7503,-313.7388 292.4616,-318.9268"/>
<polygon fill="#0000ff" stroke="#0000ff" points="291.2873,-315.6182 282.5396,-321.5955 293.1055,-322.3779 291.2873,-315.6182"/>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M255.5,-287.8682C230.9865,-282.1687 204.1161,-274.1168 182.2169,-267.0728"/>
<polygon fill="#0000ff" stroke="#0000ff" points="183.1235,-263.6872 172.5312,-263.9194 180.9564,-270.3433 183.1235,-263.6872"/>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M385.9874,-277.8228C371.8315,-266.009 349.7527,-247.4122 331,-230.8682 314.7237,-216.5088 312.1196,-211.2109 295,-197.8682 291.4061,-195.0672 287.514,-192.2587 283.6218,-189.5775"/>
<polygon fill="#0000ff" stroke="#0000ff" points="285.4768,-186.6076 275.2171,-183.9639 281.5889,-192.4286 285.4768,-186.6076"/>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M381.0775,-277.8489C365.4737,-267.2615 344.075,-250.4946 331,-230.8682 301.7766,-187.0018 326.8376,-159.8758 295,-117.8682 292.9668,-115.1856 290.5717,-112.6953 287.9828,-110.4046"/>
<polygon fill="#0000ff" stroke="#0000ff" points="289.8695,-107.441 279.8025,-104.1384 285.6127,-112.998 289.8695,-107.441"/>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~source.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M345.7825,-294.5799C318.345,-295.5697 284.8037,-294.6815 255.5,-287.8682"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M255.5,-287.8682C194.74,-273.7411 196.2143,-190.7972 137.5,-211.8682"/>
</g>
</g>
</svg>
</div><script>var pansourcefilesourcef90EfferentGraph = svgPanZoom('#sourcefilesourcef90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~source.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilesourcef90AfferentGraph" width="528pt" height="112pt"
 viewBox="0.00 0.00 528.00 112.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~source.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 108)">
<title>sourcefile~~source.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-108 524,-108 524,4 -4,4"/>
<!-- sourcefile~source.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~source.f90</title>
<polygon fill="none" stroke="#000000" points="63,-64 0,-64 0,-40 63,-40 63,-64"/>
<text text-anchor="middle" x="31.5" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">source.f90</text>
</g>
<!-- sourcefile~create_and_erase.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~create_and_erase.f90</title>
<g id="a_sourcefile~~source.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/create_and_erase.f90.html" xlink:title="create_and_erase.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="217,-104 99,-104 99,-80 217,-80 217,-104"/>
<text text-anchor="middle" x="158" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">create_and_erase.f90</text>
</a>
</g>
</g>
<!-- sourcefile~create_and_erase.f90&#45;&gt;sourcefile~source.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~create_and_erase.f90&#45;&gt;sourcefile~source.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M120.0458,-79.9987C105.121,-75.2794 87.9465,-69.8487 72.7188,-65.0336"/>
<polygon fill="#ff0000" stroke="#ff0000" points="73.6264,-61.6498 63.0364,-61.972 71.5159,-68.3241 73.6264,-61.6498"/>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~source.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="312,-44 253,-44 253,-20 312,-20 312,-44"/>
<text text-anchor="middle" x="282.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~source.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~source.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M252.7213,-34.3728C208.1352,-37.9255 123.8644,-44.6403 73.1842,-48.6786"/>
<polygon fill="#ff0000" stroke="#ff0000" points="72.9022,-45.1898 63.2118,-49.4732 73.4582,-52.1677 72.9022,-45.1898"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~source.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="190,-24 126,-24 126,0 190,0 190,-24"/>
<text text-anchor="middle" x="158" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M252.9952,-27.2603C237.2465,-24.7304 217.5888,-21.5725 200.2481,-18.7868"/>
<polygon fill="#0000ff" stroke="#0000ff" points="200.7815,-15.3277 190.3529,-17.1973 199.6712,-22.2391 200.7815,-15.3277"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~source.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~source.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M125.7514,-22.1972C109.7193,-27.2666 90.1567,-33.4524 73.0178,-38.8719"/>
<polygon fill="#ff0000" stroke="#ff0000" points="71.7311,-35.6078 63.2516,-41.96 73.8416,-42.2821 71.7311,-35.6078"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~source.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="520,-44 466,-44 466,-20 520,-20 520,-44"/>
<text text-anchor="middle" x="493" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M465.7124,-32.5275C454.6304,-32.7172 441.7042,-32.9071 430,-33 393.5567,-33.2892 384.4434,-33.2782 348,-33 339.6723,-32.9364 330.7495,-32.8274 322.2535,-32.7041"/>
<polygon fill="#00ff00" stroke="#00ff00" points="322.2233,-29.2034 312.1706,-32.5488 322.1154,-36.2025 322.2233,-29.2034"/>
</g>
<!-- sourcefile~start_finish.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~start_finish.f90</title>
<g id="a_sourcefile~~source.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/start_finish.f90.html" xlink:title="start_finish.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="430,-24 348,-24 348,0 430,0 430,-24"/>
<text text-anchor="middle" x="389" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_finish.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M465.9467,-26.7974C457.9882,-25.267 449.0079,-23.54 440.0646,-21.8201"/>
<polygon fill="#00ffff" stroke="#00ffff" points="440.5205,-18.3437 430.0394,-19.8922 439.1985,-25.2178 440.5205,-18.3437"/>
</g>
<!-- sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~source.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M347.8243,-19.7325C339.3352,-21.3267 330.4138,-23.0021 321.9863,-24.5847"/>
<polygon fill="#00ff00" stroke="#00ff00" points="321.1959,-21.1719 312.0137,-26.4575 322.4879,-28.0516 321.1959,-21.1719"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/source.html">source</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/source.f90.html#src">source.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; Add source&#39;s contribution to the residual</span>
<a name="ln-2"></a><span class="k">module </span><span class="n">source</span>
<a name="ln-3"></a>  <span class="c">!&lt; Add source&#39;s contribution to the residual</span>
<a name="ln-4"></a>  <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-5"></a>  <span class="c">!170609  - jatinder Pal Singh Sandhu</span>
<a name="ln-6"></a>  <span class="c">! AIM: to add source term residue to already calculate residuals</span>
<a name="ln-7"></a>  <span class="c">!      if requires</span>
<a name="ln-8"></a>  <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-9"></a><span class="cp">#include &quot;debug.h&quot;</span>
<a name="ln-10"></a><span class="cp">#include &quot;error.h&quot;</span>
<a name="ln-11"></a>  <span class="k">use </span><span class="n">dump_solution</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">checkpoint</span>
<a name="ln-12"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">turbulence</span>
<a name="ln-13"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">transition</span>
<a name="ln-14"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">process_id</span>
<a name="ln-15"></a>  <span class="k">use </span><span class="n">utils</span>      <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dmsg</span>
<a name="ln-16"></a>  <span class="k">use </span><span class="n">utils</span>      <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">turbulence_read_error</span>
<a name="ln-17"></a>  <span class="c">!--- variable required for sst source calculation ---!</span>
<a name="ln-18"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k1</span>
<a name="ln-19"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k2</span>
<a name="ln-20"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w1</span>
<a name="ln-21"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w2</span>
<a name="ln-22"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">beta1</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">beta2</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">bstar</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">a1</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">gama1</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">gama2</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">beta</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">gama</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">sst_F1</span>
<a name="ln-33"></a>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">free_stream_tu</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">Reynolds_number</span>
<a name="ln-36"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">intermittency</span>
<a name="ln-37"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">vel_mag</span>
<a name="ln-38"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>  <span class="n">qp</span>
<a name="ln-39"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">imx</span>
<a name="ln-40"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">jmx</span>
<a name="ln-41"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">kmx</span>
<a name="ln-42"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">n_var</span>
<a name="ln-43"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">volume</span>
<a name="ln-44"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">density</span>
<a name="ln-45"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">x_speed</span>
<a name="ln-46"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">pressure</span>
<a name="ln-47"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">tk</span>
<a name="ln-48"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">tw</span>
<a name="ln-49"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">tk_inf</span>
<a name="ln-50"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">tw_inf</span>
<a name="ln-51"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">free_stream_tu</span>
<a name="ln-52"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">mu</span>
<a name="ln-53"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">sst_mu</span>
<a name="ln-54"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">dist</span>
<a name="ln-55"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradu_x</span>
<a name="ln-56"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradu_y</span>
<a name="ln-57"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradu_z</span>
<a name="ln-58"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradv_x</span>
<a name="ln-59"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradv_y</span>
<a name="ln-60"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradv_z</span>
<a name="ln-61"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradw_x</span>
<a name="ln-62"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradw_y</span>
<a name="ln-63"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradw_z</span>
<a name="ln-64"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtk_x</span>
<a name="ln-65"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtk_y</span>
<a name="ln-66"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtk_z</span>
<a name="ln-67"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtw_x</span>
<a name="ln-68"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtw_y</span>
<a name="ln-69"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtw_z</span>
<a name="ln-70"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtgm_x</span>
<a name="ln-71"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtgm_y</span>
<a name="ln-72"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">gradtgm_z</span>
<a name="ln-73"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">residue</span>
<a name="ln-74"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span>   <span class="n">TKE_residue</span>
<a name="ln-75"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">omega_residue</span>
<a name="ln-76"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">xn</span>
<a name="ln-77"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">yn</span>
<a name="ln-78"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">zn</span>
<a name="ln-79"></a>
<a name="ln-80"></a>  <span class="c">!--- variables required for kkl source calculation ---!</span>
<a name="ln-81"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">zeta1</span>
<a name="ln-82"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">zeta2</span>
<a name="ln-83"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">zeta3</span>
<a name="ln-84"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_phi</span>
<a name="ln-85"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cmu</span>
<a name="ln-86"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kappa</span>
<a name="ln-87"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">c11</span>
<a name="ln-88"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">c12</span>
<a name="ln-89"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cd1</span>
<a name="ln-90"></a>
<a name="ln-91"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cphi1</span>
<a name="ln-92"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cphi2</span>
<a name="ln-93"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">fphi</span>
<a name="ln-94"></a>  <span class="k">use </span><span class="n">global_kkl</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">eta</span>
<a name="ln-95"></a>
<a name="ln-96"></a>  <span class="c">!variables required by sa source term calculation</span>
<a name="ln-97"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">tv</span>
<a name="ln-98"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cb1</span>
<a name="ln-99"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cb2</span>
<a name="ln-100"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cw1</span>
<a name="ln-101"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cw2</span>
<a name="ln-102"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cw3</span>
<a name="ln-103"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cv1</span>
<a name="ln-104"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_sa</span>
<a name="ln-105"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kappa_sa</span>
<a name="ln-106"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cv1_3</span>
<a name="ln-107"></a>  <span class="k">use </span><span class="n">global_sa</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cw3_6</span>
<a name="ln-108"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_x</span>
<a name="ln-109"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_y</span>
<a name="ln-110"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_z</span>
<a name="ln-111"></a>
<a name="ln-112"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xnx</span><span class="p">,</span> <span class="n">xny</span><span class="p">,</span> <span class="n">xnz</span> <span class="c">!face unit normal x</span>
<a name="ln-113"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ynx</span><span class="p">,</span> <span class="n">yny</span><span class="p">,</span> <span class="n">ynz</span> <span class="c">!face unit normal y</span>
<a name="ln-114"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">znx</span><span class="p">,</span> <span class="n">zny</span><span class="p">,</span> <span class="n">znz</span> <span class="c">!face unit normal z</span>
<a name="ln-115"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xA</span><span class="p">,</span> <span class="n">yA</span><span class="p">,</span> <span class="n">zA</span>    <span class="c">!face area</span>
<a name="ln-116"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">tkl</span>
<a name="ln-117"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">mu_t</span>
<a name="ln-118"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">KL_residue</span>
<a name="ln-119"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span><span class="n">only</span> <span class="p">:</span> <span class="n">tv_residue</span>
<a name="ln-120"></a>
<a name="ln-121"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">DCCVnX</span>
<a name="ln-122"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">DCCVnY</span>
<a name="ln-123"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">DCCVnZ</span>
<a name="ln-124"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">CCnormalX</span>
<a name="ln-125"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">CCnormalY</span>
<a name="ln-126"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">CCnormalZ</span>
<a name="ln-127"></a>
<a name="ln-128"></a>  <span class="k">use </span><span class="n">CC</span>         <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">find_DCCVn</span>
<a name="ln-129"></a>    <span class="k">use </span><span class="n">utils</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">alloc</span><span class="p">,</span> <span class="n">dealloc</span><span class="p">,</span> <span class="n">dmsg</span>
<a name="ln-130"></a>    <span class="k">use </span><span class="n">layout</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">process_id</span>
<a name="ln-131"></a>    <span class="k">use </span><span class="n">string</span>
<a name="ln-132"></a>
<a name="ln-133"></a>  <span class="k">implicit none</span>
<a name="ln-134"></a><span class="k">  private</span>
<a name="ln-135"></a>
<a name="ln-136"></a><span class="k">  public</span> <span class="kd">::</span> <span class="n">add_source_term_residue</span>
<a name="ln-137"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">Setup_source</span>
<a name="ln-138"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">destroy_source</span>
<a name="ln-139"></a>
<a name="ln-140"></a>  <span class="k">contains</span>
<a name="ln-141"></a>
<a name="ln-142"></a><span class="k">    </span>
<a name="ln-143"></a><span class="k">    subroutine </span><span class="n">add_source_term_residue</span><span class="p">()</span>
<a name="ln-144"></a>      <span class="c">!&lt; Call to add different source terms to the residual of different equations.</span>
<a name="ln-145"></a>
<a name="ln-146"></a>      <span class="k">implicit none</span>
<a name="ln-147"></a>
<a name="ln-148"></a><span class="k">      call </span><span class="n">dmsg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;add_source_term_residue&#39;</span><span class="p">)</span>
<a name="ln-149"></a>
<a name="ln-150"></a>      <span class="k">select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-151"></a>
<a name="ln-152"></a>        <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-153"></a>          <span class="c">!do nothing</span>
<a name="ln-154"></a>          <span class="k">continue</span>
<a name="ln-155"></a>
<a name="ln-156"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">)</span>
<a name="ln-157"></a>          <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-158"></a>            <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-159"></a>              <span class="k">call </span><span class="n">add_sa_source</span><span class="p">()</span>
<a name="ln-160"></a>            <span class="k">case</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">)</span>
<a name="ln-161"></a>              <span class="k">call </span><span class="n">add_saBC_source</span><span class="p">()</span>
<a name="ln-162"></a>            <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-163"></a>              <span class="n">Fatal_error</span>
<a name="ln-164"></a>          <span class="k">end select</span>
<a name="ln-165"></a>
<a name="ln-166"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-167"></a>          <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-168"></a>            <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-169"></a>              <span class="k">call </span><span class="n">add_sst_source</span><span class="p">()</span>
<a name="ln-170"></a>            <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-171"></a>              <span class="k">call </span><span class="n">add_sst_source_lctm2015</span><span class="p">()</span>
<a name="ln-172"></a>            <span class="k">case</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">)</span>
<a name="ln-173"></a>              <span class="k">call </span><span class="n">add_sst_bc_source</span><span class="p">()</span>
<a name="ln-174"></a>            <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-175"></a>              <span class="n">Fatal_error</span>
<a name="ln-176"></a>          <span class="k">end select</span>
<a name="ln-177"></a>
<a name="ln-178"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-179"></a>          <span class="k">call </span><span class="n">add_kkl_source</span><span class="p">()</span>
<a name="ln-180"></a>
<a name="ln-181"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-182"></a>          <span class="n">Fatal_error</span>
<a name="ln-183"></a>
<a name="ln-184"></a>      <span class="k">end select</span>
<a name="ln-185"></a>
<a name="ln-186"></a><span class="k">    end subroutine </span><span class="n">add_source_term_residue</span>
<a name="ln-187"></a>
<a name="ln-188"></a>
<a name="ln-189"></a>    <span class="k">subroutine </span><span class="n">Setup_source</span><span class="p">()</span>
<a name="ln-190"></a>      <span class="c">!&lt; Allcoate memory to the required by the variable</span>
<a name="ln-191"></a>        <span class="k">implicit none</span>
<a name="ln-192"></a>        <span class="c">!nothing</span>
<a name="ln-193"></a>    <span class="k">end subroutine </span><span class="n">Setup_source</span>
<a name="ln-194"></a>
<a name="ln-195"></a>
<a name="ln-196"></a>    <span class="k">subroutine </span><span class="n">destroy_source</span><span class="p">()</span>
<a name="ln-197"></a>      <span class="c">!&lt; deallocate memory before stoping the solver</span>
<a name="ln-198"></a>        <span class="k">implicit none</span>
<a name="ln-199"></a>        <span class="c">!nothing</span>
<a name="ln-200"></a>    <span class="k">end subroutine </span><span class="n">destroy_source</span>
<a name="ln-201"></a>
<a name="ln-202"></a>    <span class="k">subroutine </span><span class="n">add_sst_source</span><span class="p">()</span>
<a name="ln-203"></a>      <span class="c">!&lt; Add residual due to source terms of the SST turbulence model</span>
<a name="ln-204"></a>      <span class="k">implicit none</span>
<a name="ln-205"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-206"></a>
<a name="ln-207"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD</span>
<a name="ln-208"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">F1</span>
<a name="ln-209"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vort</span>
<a name="ln-210"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_k</span>
<a name="ln-211"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_w</span>
<a name="ln-212"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_k</span>
<a name="ln-213"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_w</span>
<a name="ln-214"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_k</span>
<a name="ln-215"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_w</span>
<a name="ln-216"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">lamda</span>
<a name="ln-217"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">limiter</span>
<a name="ln-218"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">divergence</span>
<a name="ln-219"></a>      
<a name="ln-220"></a>      <span class="k">if</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-221"></a><span class="k">        </span><span class="n">limiter</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-222"></a>        <span class="n">gama1</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">/</span><span class="mf">9.0</span>
<a name="ln-223"></a>        <span class="n">gama2</span> <span class="o">=</span> <span class="mf">0.44</span>
<a name="ln-224"></a>      <span class="k">else </span>
<a name="ln-225"></a><span class="k">        </span><span class="n">limiter</span> <span class="o">=</span> <span class="mi">20</span>
<a name="ln-226"></a>      <span class="k">end if</span>
<a name="ln-227"></a>
<a name="ln-228"></a>
<a name="ln-229"></a><span class="k">      do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-230"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-231"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-232"></a>
<a name="ln-233"></a>            <span class="c">! __ vorticity __</span>
<a name="ln-234"></a>            <span class="n">vort</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span>     <span class="p">((</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-235"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-236"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-237"></a>                             <span class="p">)&amp;</span>
<a name="ln-238"></a>                       <span class="p">)</span>
<a name="ln-239"></a>
<a name="ln-240"></a>            <span class="n">CD</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-241"></a>                                          <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-242"></a>                                          <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-243"></a>                                           <span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-244"></a>            <span class="n">CD</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">CD</span><span class="p">,</span> <span class="mi">1</span><span class="mf">0.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">limiter</span><span class="p">))</span>
<a name="ln-245"></a>            <span class="n">F1</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-246"></a>
<a name="ln-247"></a>
<a name="ln-248"></a>            <span class="n">sigma_k</span>     <span class="o">=</span>    <span class="n">sigma_k1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>    <span class="n">sigma_k2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-249"></a>            <span class="n">sigma_w</span>     <span class="o">=</span>    <span class="n">sigma_w1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>    <span class="n">sigma_w1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-250"></a>            <span class="n">gama</span>        <span class="o">=</span>       <span class="n">gama1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>       <span class="n">gama2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-251"></a>            <span class="n">beta</span>        <span class="o">=</span>       <span class="n">beta1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>       <span class="n">beta2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-252"></a>
<a name="ln-253"></a>
<a name="ln-254"></a>
<a name="ln-255"></a>            <span class="c">! ____ Dissipation term ___</span>
<a name="ln-256"></a>            <span class="n">D_k</span> <span class="o">=</span> <span class="n">bstar</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-257"></a>            <span class="n">D_w</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-258"></a>
<a name="ln-259"></a>            <span class="c">! ____ PRODUCTION term____ </span>
<a name="ln-260"></a>            <span class="n">divergence</span> <span class="o">=</span> <span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-261"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vort</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span><span class="p">((</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">divergence</span><span class="p">)</span>
<a name="ln-262"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P_k</span><span class="p">,</span><span class="n">limiter</span><span class="o">*</span><span class="n">D_k</span><span class="p">)</span>
<a name="ln-263"></a>            <span class="n">P_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gama</span><span class="o">/</span><span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">P_k</span>
<a name="ln-264"></a>
<a name="ln-265"></a>            <span class="c">! ____ cross diffusion term ___</span>
<a name="ln-266"></a>            <span class="n">lamda</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span><span class="o">*</span><span class="n">CD</span>
<a name="ln-267"></a>
<a name="ln-268"></a>            <span class="n">S_k</span> <span class="o">=</span> <span class="n">P_k</span> <span class="o">-</span> <span class="n">D_k</span>           <span class="c">!Source term TKE</span>
<a name="ln-269"></a>            <span class="n">S_w</span> <span class="o">=</span> <span class="n">P_w</span> <span class="o">-</span> <span class="n">D_w</span>  <span class="o">+</span><span class="n">lamda</span>   <span class="c">!source term omega</span>
<a name="ln-270"></a>
<a name="ln-271"></a>            <span class="n">S_k</span> <span class="o">=</span> <span class="n">S_k</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-272"></a>            <span class="n">S_w</span> <span class="o">=</span> <span class="n">S_w</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-273"></a>
<a name="ln-274"></a>            <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_k</span>
<a name="ln-275"></a>            <span class="n">omega_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">omega_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_w</span>
<a name="ln-276"></a>
<a name="ln-277"></a>          <span class="k">end do</span>
<a name="ln-278"></a><span class="k">        end do</span>
<a name="ln-279"></a><span class="k">      end do</span>
<a name="ln-280"></a>
<a name="ln-281"></a><span class="k">    end subroutine </span><span class="n">add_sst_source</span>
<a name="ln-282"></a>
<a name="ln-283"></a>
<a name="ln-284"></a>    <span class="k">subroutine </span><span class="n">add_sst_source_lctm2015</span><span class="p">()</span>
<a name="ln-285"></a>      <span class="c">!&lt; Add residual due to source terms of the LCTM2015 transition model</span>
<a name="ln-286"></a>      <span class="k">implicit none</span>
<a name="ln-287"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-288"></a>
<a name="ln-289"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD</span>
<a name="ln-290"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">F1</span>
<a name="ln-291"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vort</span>
<a name="ln-292"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_K</span>
<a name="ln-293"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_w</span>
<a name="ln-294"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_gm</span>
<a name="ln-295"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_k</span>
<a name="ln-296"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_w</span>
<a name="ln-297"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_gm</span>
<a name="ln-298"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_k</span>
<a name="ln-299"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_w</span>
<a name="ln-300"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_gm</span>
<a name="ln-301"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">lamda</span>
<a name="ln-302"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fonset1</span>
<a name="ln-303"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fonset2</span>
<a name="ln-304"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fonset3</span>
<a name="ln-305"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fonset</span>
<a name="ln-306"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Rev</span>
<a name="ln-307"></a>      <span class="kt">Real</span> <span class="kd">::</span> <span class="n">RT</span>
<a name="ln-308"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fturb</span>
<a name="ln-309"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Re_theta</span>
<a name="ln-310"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">TuL</span>
<a name="ln-311"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradtk</span>
<a name="ln-312"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">strain</span>
<a name="ln-313"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">intermittency</span>
<a name="ln-314"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Pk_lim</span>
<a name="ln-315"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fon_lim</span>
<a name="ln-316"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dudx</span>
<a name="ln-317"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dudy</span>
<a name="ln-318"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dudz</span>
<a name="ln-319"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">duds</span>
<a name="ln-320"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">velmag</span>
<a name="ln-321"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span>
<a name="ln-322"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">lamd</span>
<a name="ln-323"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Fpg</span>
<a name="ln-324"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">divergence</span>
<a name="ln-325"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dvdy</span>
<a name="ln-326"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">limiter</span>
<a name="ln-327"></a>
<a name="ln-328"></a>      <span class="k">if</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-329"></a><span class="k">        </span><span class="n">limiter</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-330"></a>        <span class="n">gama1</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">/</span><span class="mf">9.0</span>
<a name="ln-331"></a>        <span class="n">gama2</span> <span class="o">=</span> <span class="mf">0.44</span>
<a name="ln-332"></a>      <span class="k">else </span>
<a name="ln-333"></a><span class="k">        </span><span class="n">limiter</span> <span class="o">=</span> <span class="mi">20</span>
<a name="ln-334"></a>      <span class="k">end if</span>
<a name="ln-335"></a>
<a name="ln-336"></a>      <span class="c">!for pressure gradient calculation</span>
<a name="ln-337"></a>      <span class="k">call </span><span class="n">find_DCCVn</span><span class="p">()</span>
<a name="ln-338"></a>
<a name="ln-339"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-340"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-341"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-342"></a>
<a name="ln-343"></a>            <span class="n">intermittency</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">n_var</span><span class="p">)</span>
<a name="ln-344"></a>
<a name="ln-345"></a>            <span class="c">! __ vorticity __</span>
<a name="ln-346"></a>            <span class="n">vort</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span>     <span class="p">((</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-347"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-348"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-349"></a>                             <span class="p">)&amp;</span>
<a name="ln-350"></a>                       <span class="p">)</span>
<a name="ln-351"></a>
<a name="ln-352"></a>            <span class="n">strain</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span>     <span class="p">(((</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-353"></a>                              <span class="o">+</span> <span class="p">((</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-354"></a>                              <span class="o">+</span> <span class="p">((</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-355"></a>                              <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-356"></a>                              <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-357"></a>                              <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-358"></a>                               <span class="p">)&amp;</span>
<a name="ln-359"></a>                         <span class="p">)</span>
<a name="ln-360"></a>
<a name="ln-361"></a>            <span class="n">CD</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-362"></a>                                          <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-363"></a>                                          <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-364"></a>                                           <span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-365"></a>            <span class="n">CD</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">CD</span><span class="p">,</span> <span class="mi">1</span><span class="mf">0.0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">limiter</span><span class="p">))</span>
<a name="ln-366"></a>            <span class="n">F1</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-367"></a>
<a name="ln-368"></a>
<a name="ln-369"></a>            <span class="n">sigma_k</span>     <span class="o">=</span>    <span class="n">sigma_k1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>    <span class="n">sigma_k2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-370"></a>            <span class="n">sigma_w</span>     <span class="o">=</span>    <span class="n">sigma_w1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>    <span class="n">sigma_w1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-371"></a>            <span class="n">gama</span>        <span class="o">=</span>       <span class="n">gama1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>       <span class="n">gama2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-372"></a>            <span class="n">beta</span>        <span class="o">=</span>       <span class="n">beta1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>       <span class="n">beta2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-373"></a>
<a name="ln-374"></a>
<a name="ln-375"></a>
<a name="ln-376"></a>            <span class="c">! ____ Dissipation term ___</span>
<a name="ln-377"></a>            <span class="n">D_k</span> <span class="o">=</span> <span class="n">bstar</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-378"></a>            <span class="n">D_w</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-379"></a>
<a name="ln-380"></a>            <span class="c">! ____ PRODUCTION term____ </span>
<a name="ln-381"></a>            <span class="n">divergence</span> <span class="o">=</span> <span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-382"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vort</span><span class="o">*</span><span class="n">strain</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">divergence</span><span class="p">)</span>
<a name="ln-383"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P_k</span><span class="p">,</span> <span class="n">limiter</span><span class="o">*</span><span class="n">D_k</span><span class="p">)</span>
<a name="ln-384"></a>            <span class="n">P_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gama</span><span class="o">/</span><span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">P_k</span>
<a name="ln-385"></a>
<a name="ln-386"></a>            <span class="c">! ____ cross diffusion term ___</span>
<a name="ln-387"></a>            <span class="n">lamda</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span><span class="o">*</span><span class="n">CD</span>
<a name="ln-388"></a>
<a name="ln-389"></a>            <span class="c">! ____Transition modeling  ____</span>
<a name="ln-390"></a>              <span class="c">! --pressure gradient </span>
<a name="ln-391"></a><span class="c">!            u = qp(i,j,k,2)</span>
<a name="ln-392"></a><span class="c">!            v = qp(i,j,k,3)</span>
<a name="ln-393"></a><span class="c">!            w = qp(i,j,k,4)</span>
<a name="ln-394"></a><span class="c">!            velmag = sqrt((u**2) + (v**2) + (w**2))</span>
<a name="ln-395"></a><span class="c">!            dudx = 0.5*((2.0*u*gradu_x(i,j,k)) + (2.0*v*gradv_x(i,j,k)) + (2.0*w*gradw_x(i,j,k)))/velmag</span>
<a name="ln-396"></a><span class="c">!            dudy = 0.5*((2.0*u*gradu_y(i,j,k)) + (2.0*v*gradv_y(i,j,k)) + (2.0*w*gradw_y(i,j,k)))/velmag</span>
<a name="ln-397"></a><span class="c">!            dudz = 0.5*((2.0*u*gradu_z(i,j,k)) + (2.0*v*gradv_z(i,j,k)) + (2.0*w*gradw_z(i,j,k)))/velmag</span>
<a name="ln-398"></a><span class="c">!            duds = (((u/velmag)*dudx) + ((v/velmag)*dudy) + ((w/velmag)*dudz))</span>
<a name="ln-399"></a><span class="c">!            !lamd =(-7.57e-3)*(duds*dist(i,j,k)*dist(i,j,k)*density(i,j,k)/mu(i,j,k)) + 0.0128</span>
<a name="ln-400"></a><span class="c">!            lamd =(+7.57e-3)*(duds*dist(i,j,k)*dist(i,j,k)*density(i,j,k)/mu(i,j,k)) + 0.0128</span>
<a name="ln-401"></a>            <span class="n">dvdy</span> <span class="o">=</span> <span class="n">DCCVnX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">CCnormalX</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-402"></a>                 <span class="o">+</span> <span class="n">DCCVnY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">CCnormalY</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-403"></a>                 <span class="o">+</span> <span class="n">DCCVnZ</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">CCnormalZ</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-404"></a>            <span class="n">lamd</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">7.57e-3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dvdy</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.0128</span>
<a name="ln-405"></a>            <span class="n">lamd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">lamd</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
<a name="ln-406"></a>            <span class="k">if</span><span class="p">(</span><span class="n">lamd</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-407"></a><span class="k">                </span><span class="n">Fpg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mi">1</span><span class="mf">4.68</span><span class="o">*</span><span class="n">lamd</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a name="ln-408"></a>            <span class="k">else</span>
<a name="ln-409"></a><span class="k">                </span><span class="n">Fpg</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">7.34</span><span class="o">*</span><span class="n">lamd</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<a name="ln-410"></a>            <span class="k">end if</span>
<a name="ln-411"></a><span class="k">            </span><span class="n">Fpg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Fpg</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a name="ln-412"></a>              <span class="c">! --gradient</span>
<a name="ln-413"></a>            <span class="n">TuL</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="mf">0.0</span><span class="o">*</span><span class="nb">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span><span class="mi">10</span><span class="mf">0.0</span><span class="p">)</span>
<a name="ln-414"></a>            <span class="n">Re_theta</span> <span class="o">=</span> <span class="mi">10</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mi">100</span><span class="mf">0.0</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">TuL</span><span class="o">*</span><span class="n">Fpg</span><span class="p">)</span>
<a name="ln-415"></a>            <span class="c">!Re_theta = 100.0 + 1000.0*exp(-TuL)</span>
<a name="ln-416"></a>            <span class="n">Rev</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">strain</span><span class="o">/</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-417"></a>            <span class="n">RT</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-418"></a>            <span class="n">Fturb</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">Rt</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-419"></a>            <span class="n">Fonset1</span> <span class="o">=</span> <span class="n">Rev</span><span class="o">/</span><span class="p">(</span><span class="mf">2.2</span><span class="o">*</span><span class="n">Re_theta</span><span class="p">)</span>
<a name="ln-420"></a>            <span class="n">Fonset2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Fonset1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
<a name="ln-421"></a>            <span class="n">Fonset3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">RT</span><span class="o">/</span><span class="mf">3.5</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a name="ln-422"></a>            <span class="n">Fonset</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Fonset2</span> <span class="o">-</span> <span class="n">Fonset3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a name="ln-423"></a>            <span class="n">P_gm</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">strain</span><span class="o">*</span><span class="n">intermittency</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">intermittency</span><span class="p">)</span><span class="o">*</span><span class="n">Fonset</span>
<a name="ln-424"></a>            <span class="n">D_gm</span> <span class="o">=</span> <span class="mf">0.06</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">vort</span><span class="o">*</span><span class="n">intermittency</span><span class="o">*</span><span class="n">Fturb</span><span class="o">*</span><span class="p">((</span><span class="mi">5</span><span class="mf">0.0</span><span class="o">*</span><span class="n">intermittency</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
<a name="ln-425"></a>
<a name="ln-426"></a>            <span class="n">Fon_lim</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">Rev</span><span class="o">/</span><span class="p">(</span><span class="mf">2.2</span><span class="o">*</span><span class="mi">110</span><span class="mf">0.0</span><span class="p">))</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">3.0</span><span class="p">)</span>
<a name="ln-427"></a>            <span class="n">Pk_lim</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">intermittency</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">intermittency</span><span class="p">)</span><span class="o">*</span><span class="n">Fon_lim</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">strain</span><span class="o">*</span><span class="n">vort</span>
<a name="ln-428"></a>            <span class="n">S_k</span> <span class="o">=</span> <span class="n">intermittency</span><span class="o">*</span><span class="n">P_k</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">intermittency</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span><span class="o">*</span><span class="n">D_k</span>  <span class="o">+</span>  <span class="n">Pk_lim</span>      <span class="c">!Source term gm</span>
<a name="ln-429"></a>            <span class="n">S_W</span> <span class="o">=</span> <span class="n">P_w</span> <span class="o">-</span> <span class="n">D_w</span>  <span class="o">+</span> <span class="n">lamda</span>        <span class="c">!Source term gm</span>
<a name="ln-430"></a>            <span class="n">S_gm</span> <span class="o">=</span> <span class="n">P_gm</span> <span class="o">-</span> <span class="n">D_gm</span>           <span class="c">!Source term gm</span>
<a name="ln-431"></a>
<a name="ln-432"></a>            <span class="n">S_k</span> <span class="o">=</span> <span class="n">S_k</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-433"></a>            <span class="n">S_w</span> <span class="o">=</span> <span class="n">S_w</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-434"></a>            <span class="n">S_gm</span><span class="o">=</span> <span class="n">S_gm</span><span class="o">*</span> <span class="n">Volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-435"></a>
<a name="ln-436"></a>            <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_k</span>
<a name="ln-437"></a>            <span class="n">omega_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">omega_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_w</span>
<a name="ln-438"></a>            <span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">n_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">n_var</span><span class="p">)</span> <span class="o">-</span><span class="n">S_gm</span>
<a name="ln-439"></a>
<a name="ln-440"></a>          <span class="k">end do</span>
<a name="ln-441"></a><span class="k">        end do</span>
<a name="ln-442"></a><span class="k">      end do</span>
<a name="ln-443"></a>
<a name="ln-444"></a><span class="k">    end subroutine </span><span class="n">add_sst_source_lctm2015</span>
<a name="ln-445"></a>
<a name="ln-446"></a>
<a name="ln-447"></a>    <span class="c">! SST-BC model</span>
<a name="ln-448"></a>    <span class="k">subroutine </span><span class="n">add_sst_bc_source</span><span class="p">()</span>
<a name="ln-449"></a>      <span class="c">!&lt; Add residual due to source terms of the SST-BC transition model</span>
<a name="ln-450"></a>      <span class="k">implicit none</span>
<a name="ln-451"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-452"></a>
<a name="ln-453"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD</span>
<a name="ln-454"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">F1</span>
<a name="ln-455"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vort</span>
<a name="ln-456"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_k</span>
<a name="ln-457"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_w</span>
<a name="ln-458"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_k</span>
<a name="ln-459"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_w</span>
<a name="ln-460"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_k</span>
<a name="ln-461"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_w</span>
<a name="ln-462"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">lamda</span>
<a name="ln-463"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">TuL</span>
<a name="ln-464"></a>      <span class="c">!--------BC model -----</span>
<a name="ln-465"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">chi_1</span><span class="o">=</span><span class="mf">0.002</span>
<a name="ln-466"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">chi_2</span><span class="o">=</span><span class="mf">5.0</span>
<a name="ln-467"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu_BC</span>
<a name="ln-468"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu_cr</span>
<a name="ln-469"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu_t</span>
<a name="ln-470"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">re_v</span>
<a name="ln-471"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">re_theta</span>
<a name="ln-472"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">re_theta_t</span>
<a name="ln-473"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term1</span>
<a name="ln-474"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term2</span>
<a name="ln-475"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term_exponential</span>
<a name="ln-476"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gamma_BC</span>
<a name="ln-477"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vmag</span>
<a name="ln-478"></a>
<a name="ln-479"></a>
<a name="ln-480"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-481"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-482"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-483"></a>
<a name="ln-484"></a>            <span class="c">! __ vorticity __</span>
<a name="ln-485"></a>            <span class="n">vort</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span>     <span class="p">((</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-486"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-487"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-488"></a>                             <span class="p">)&amp;</span>
<a name="ln-489"></a>                       <span class="p">)</span>
<a name="ln-490"></a>
<a name="ln-491"></a>            <span class="n">CD</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-492"></a>                                          <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-493"></a>                                          <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-494"></a>                                           <span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-495"></a>            <span class="c">!CD = max(CD, 1e-20)</span>
<a name="ln-496"></a>            <span class="n">F1</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-497"></a>
<a name="ln-498"></a>
<a name="ln-499"></a>            <span class="n">sigma_k</span>     <span class="o">=</span>    <span class="n">sigma_k1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>    <span class="n">sigma_k2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-500"></a>            <span class="n">sigma_w</span>     <span class="o">=</span>    <span class="n">sigma_w1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>    <span class="n">sigma_w1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-501"></a>            <span class="n">gama</span>        <span class="o">=</span>       <span class="n">gama1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>       <span class="n">gama2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-502"></a>            <span class="n">beta</span>        <span class="o">=</span>       <span class="n">beta1</span><span class="o">*</span><span class="n">F1</span>  <span class="o">+</span>       <span class="n">beta2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-503"></a>
<a name="ln-504"></a>
<a name="ln-505"></a>
<a name="ln-506"></a>            <span class="c">! ____ Dissipation term ___</span>
<a name="ln-507"></a>            <span class="n">D_k</span> <span class="o">=</span> <span class="n">bstar</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-508"></a>            <span class="n">D_w</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-509"></a>
<a name="ln-510"></a>            <span class="c">! ____ PRODUCTION term____ </span>
<a name="ln-511"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vort</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-512"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P_k</span><span class="p">,</span><span class="mi">2</span><span class="mf">0.0</span><span class="o">*</span><span class="n">D_k</span><span class="p">)</span>
<a name="ln-513"></a>            <span class="n">P_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gama</span><span class="o">/</span><span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">P_k</span>
<a name="ln-514"></a>
<a name="ln-515"></a>            <span class="c">! ____ cross diffusion term ___</span>
<a name="ln-516"></a>            <span class="n">lamda</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span><span class="o">*</span><span class="n">CD</span>
<a name="ln-517"></a>
<a name="ln-518"></a>            <span class="c">! ____Transition modeling  ____</span>
<a name="ln-519"></a>            <span class="c">!------ BC model ---</span>
<a name="ln-520"></a>            <span class="n">vmag</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">SUM</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-521"></a>            <span class="n">chi_1</span> <span class="o">=</span> <span class="mf">0.002</span>
<a name="ln-522"></a>            <span class="n">chi_2</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-523"></a>
<a name="ln-524"></a>            <span class="n">nu_t</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-525"></a>            <span class="n">nu_cr</span> <span class="o">=</span> <span class="n">chi_2</span><span class="o">/</span><span class="n">Reynolds_number</span>
<a name="ln-526"></a>            <span class="n">nu_bc</span> <span class="o">=</span> <span class="n">nu_t</span><span class="o">/</span><span class="p">(</span><span class="n">vmag</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-527"></a>
<a name="ln-528"></a>            <span class="c">!TuL = min(100.0*sqrt(2.0*tk(i,j,k)/3.0)/(tw(i,j,k)*dist(i,j,k)),100.0)</span>
<a name="ln-529"></a>            <span class="n">TuL</span> <span class="o">=</span> <span class="n">free_stream_tu</span> <span class="c">!local turbulence intensity might not work for BC model</span>
<a name="ln-530"></a>            <span class="n">re_v</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">vort</span><span class="o">/</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-531"></a>            <span class="n">re_theta</span> <span class="o">=</span> <span class="n">re_v</span><span class="o">/</span><span class="mf">2.193</span>
<a name="ln-532"></a>            <span class="n">re_theta_t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">80</span><span class="mf">3.73</span><span class="o">*</span><span class="p">((</span><span class="n">TuL</span> <span class="o">+</span> <span class="mf">0.6067</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.027</span><span class="p">)))</span>
<a name="ln-533"></a>            <span class="c">!re_theta_t = 100.0 + 1000.0*exp(-TuL)</span>
<a name="ln-534"></a>            <span class="c">!re_theta_t = 163.0 + exp(6.91 - TuL)</span>
<a name="ln-535"></a>
<a name="ln-536"></a>            <span class="n">term1</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">re_theta</span><span class="o">-</span><span class="n">re_theta_t</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">chi_1</span><span class="o">*</span><span class="n">re_theta_t</span><span class="p">))</span>
<a name="ln-537"></a>            <span class="n">term2</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nu_BC</span><span class="o">-</span><span class="n">nu_cr</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span><span class="o">/</span><span class="n">nu_cr</span><span class="p">)</span>
<a name="ln-538"></a>            <span class="n">term_exponential</span> <span class="o">=</span> <span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span><span class="p">)</span>
<a name="ln-539"></a>            <span class="n">gamma_BC</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">term_exponential</span><span class="p">)</span>
<a name="ln-540"></a>
<a name="ln-541"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">gamma_BC</span><span class="o">*</span><span class="n">P_k</span>
<a name="ln-542"></a>
<a name="ln-543"></a>            <span class="n">S_k</span> <span class="o">=</span> <span class="n">P_k</span> <span class="o">-</span> <span class="n">D_k</span>           <span class="c">!Source term TKE</span>
<a name="ln-544"></a>            <span class="n">S_w</span> <span class="o">=</span> <span class="n">P_w</span> <span class="o">-</span> <span class="n">D_w</span>  <span class="o">+</span><span class="n">lamda</span>   <span class="c">!source term omega</span>
<a name="ln-545"></a>
<a name="ln-546"></a>            <span class="n">S_k</span> <span class="o">=</span> <span class="n">S_k</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-547"></a>            <span class="n">S_w</span> <span class="o">=</span> <span class="n">S_w</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-548"></a>
<a name="ln-549"></a>            <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_k</span>
<a name="ln-550"></a>            <span class="n">omega_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">omega_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_w</span>
<a name="ln-551"></a>
<a name="ln-552"></a>          <span class="k">end do</span>
<a name="ln-553"></a><span class="k">        end do</span>
<a name="ln-554"></a><span class="k">      end do</span>
<a name="ln-555"></a>
<a name="ln-556"></a><span class="k">    end subroutine </span><span class="n">add_sst_bc_source</span>
<a name="ln-557"></a>
<a name="ln-558"></a>
<a name="ln-559"></a>    <span class="k">subroutine </span><span class="n">add_kkl_source</span><span class="p">()</span>
<a name="ln-560"></a>      <span class="c">!&lt; Add residual due to source terms of the k-kL turbulence model</span>
<a name="ln-561"></a>      <span class="k">implicit none</span>
<a name="ln-562"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-563"></a>
<a name="ln-564"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau11</span>
<a name="ln-565"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau12</span>
<a name="ln-566"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau13</span>
<a name="ln-567"></a>
<a name="ln-568"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau21</span>
<a name="ln-569"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau22</span>
<a name="ln-570"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau23</span>
<a name="ln-571"></a>
<a name="ln-572"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau31</span>
<a name="ln-573"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau32</span>
<a name="ln-574"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau33</span>
<a name="ln-575"></a>
<a name="ln-576"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S11</span>
<a name="ln-577"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S12</span>
<a name="ln-578"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S13</span>
<a name="ln-579"></a>
<a name="ln-580"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S21</span>
<a name="ln-581"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S22</span>
<a name="ln-582"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S23</span>
<a name="ln-583"></a>
<a name="ln-584"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S31</span>
<a name="ln-585"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S32</span>
<a name="ln-586"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S33</span>
<a name="ln-587"></a>
<a name="ln-588"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delv</span>
<a name="ln-589"></a>
<a name="ln-590"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2udx2</span>
<a name="ln-591"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2udy2</span>
<a name="ln-592"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2udz2</span>
<a name="ln-593"></a>
<a name="ln-594"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2vdx2</span>
<a name="ln-595"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2vdy2</span>
<a name="ln-596"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2vdz2</span>
<a name="ln-597"></a>
<a name="ln-598"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2wdx2</span>
<a name="ln-599"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2wdy2</span>
<a name="ln-600"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d2wdz2</span>
<a name="ln-601"></a>
<a name="ln-602"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Lvk</span>
<a name="ln-603"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fp</span>
<a name="ln-604"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ud</span>
<a name="ln-605"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">udd</span>
<a name="ln-606"></a>
<a name="ln-607"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_k</span>
<a name="ln-608"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_kl</span>
<a name="ln-609"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_k</span>
<a name="ln-610"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_kl</span>
<a name="ln-611"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_k</span>
<a name="ln-612"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_kl</span>
<a name="ln-613"></a>
<a name="ln-614"></a>      <span class="c">!change for transition modeling</span>
<a name="ln-615"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vort</span>
<a name="ln-616"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Rev</span>
<a name="ln-617"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Rev1</span>
<a name="ln-618"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ReThc</span>
<a name="ln-619"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tu</span>
<a name="ln-620"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term1</span>
<a name="ln-621"></a>
<a name="ln-622"></a>
<a name="ln-623"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-624"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-625"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-626"></a>
<a name="ln-627"></a>            <span class="n">S11</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-628"></a>            <span class="n">S12</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-629"></a>            <span class="n">S13</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-630"></a>
<a name="ln-631"></a>            <span class="n">S21</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-632"></a>            <span class="n">S22</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-633"></a>            <span class="n">S23</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-634"></a>
<a name="ln-635"></a>            <span class="n">S31</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-636"></a>            <span class="n">S32</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-637"></a>            <span class="n">S33</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-638"></a>
<a name="ln-639"></a>            <span class="n">delv</span> <span class="o">=</span> <span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-640"></a>
<a name="ln-641"></a>            <span class="n">Tau11</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S11</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">delv</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-642"></a>            <span class="n">Tau12</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
<a name="ln-643"></a>            <span class="n">Tau13</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S13</span><span class="p">)</span>
<a name="ln-644"></a>            <span class="n">Tau21</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S21</span><span class="p">)</span>
<a name="ln-645"></a>            <span class="n">Tau22</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S22</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">delv</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-646"></a>            <span class="n">Tau23</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S23</span><span class="p">)</span>
<a name="ln-647"></a>            <span class="n">Tau31</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S31</span><span class="p">)</span>
<a name="ln-648"></a>            <span class="n">Tau32</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S32</span><span class="p">)</span>
<a name="ln-649"></a>            <span class="n">Tau33</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S33</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">delv</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-650"></a>
<a name="ln-651"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-652"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">P_k</span> <span class="o">+</span> <span class="n">Tau11</span><span class="o">*</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tau12</span><span class="o">*</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tau13</span><span class="o">*</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-653"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">P_k</span> <span class="o">+</span> <span class="n">Tau21</span><span class="o">*</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tau22</span><span class="o">*</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tau23</span><span class="o">*</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-654"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="n">P_k</span> <span class="o">+</span> <span class="n">Tau31</span><span class="o">*</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tau32</span><span class="o">*</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tau33</span><span class="o">*</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-655"></a>            <span class="n">D_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmu</span><span class="o">**</span><span class="mf">0.75</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mf">1.e-20</span><span class="p">)</span>
<a name="ln-656"></a>            <span class="n">P_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P_k</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">D_k</span><span class="p">)</span>
<a name="ln-657"></a>
<a name="ln-658"></a>            <span class="c">! calculation of Lvk</span>
<a name="ln-659"></a>            <span class="c">! first get second order gradients </span>
<a name="ln-660"></a>            <span class="n">d2udx2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-661"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-662"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-663"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-664"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-665"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-666"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-667"></a>
<a name="ln-668"></a>            <span class="n">d2udy2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-669"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-670"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-671"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-672"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-673"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-674"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-675"></a>
<a name="ln-676"></a>            <span class="n">d2udz2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-677"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-678"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-679"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-680"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-681"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-682"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-683"></a>
<a name="ln-684"></a>            <span class="c">! gradient of v component</span>
<a name="ln-685"></a>            <span class="n">d2vdx2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-686"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-687"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-688"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-689"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-690"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-691"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-692"></a>
<a name="ln-693"></a>            <span class="n">d2vdy2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-694"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-695"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-696"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-697"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-698"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-699"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-700"></a>
<a name="ln-701"></a>            <span class="n">d2vdz2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-702"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-703"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-704"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-705"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-706"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-707"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-708"></a>
<a name="ln-709"></a>
<a name="ln-710"></a>            <span class="c">!gradients of w components</span>
<a name="ln-711"></a>            <span class="n">d2wdx2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-712"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-713"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-714"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-715"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-716"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-717"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-718"></a>
<a name="ln-719"></a>            <span class="n">d2wdy2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-720"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-721"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-722"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-723"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-724"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-725"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-726"></a>
<a name="ln-727"></a>            <span class="n">d2wdz2</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-728"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-729"></a>                     <span class="o">-</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-730"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-731"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">*</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-732"></a>                     <span class="o">+</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-733"></a>                    <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-734"></a>
<a name="ln-735"></a>            <span class="n">udd</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">d2udx2</span><span class="o">+</span><span class="n">d2udy2</span><span class="o">+</span><span class="n">d2udz2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                      <span class="o">+</span> <span class="p">(</span><span class="n">d2vdx2</span><span class="o">+</span><span class="n">d2vdy2</span><span class="o">+</span><span class="n">d2vdz2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-737"></a>                      <span class="o">+</span> <span class="p">(</span><span class="n">d2wdx2</span><span class="o">+</span><span class="n">d2wdy2</span><span class="o">+</span><span class="n">d2wdz2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<a name="ln-738"></a>
<a name="ln-739"></a>            <span class="n">ud</span>  <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s11</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s12</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s13</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-740"></a>                         <span class="o">+</span><span class="n">s21</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s22</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s23</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-741"></a>                         <span class="o">+</span><span class="n">s31</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s32</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">s33</span><span class="o">**</span><span class="mi">2</span> <span class="p">))</span>
<a name="ln-742"></a>
<a name="ln-743"></a>            <span class="n">Lvk</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">ud</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">udd</span><span class="p">,</span><span class="mf">1.e-20</span><span class="p">))</span>
<a name="ln-744"></a>
<a name="ln-745"></a>            <span class="n">fp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">P_k</span><span class="o">/</span><span class="n">D_k</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span><span class="mf">1.0</span><span class="p">)</span>
<a name="ln-746"></a>            <span class="c">! Lvk limiter</span>
<a name="ln-747"></a>            <span class="n">Lvk</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Lvk</span><span class="p">,</span> <span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">((</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">c11</span><span class="p">),</span><span class="mf">1.e-20</span><span class="p">))</span>
<a name="ln-748"></a>            <span class="n">Lvk</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Lvk</span><span class="p">,</span> <span class="n">c12</span><span class="o">*</span><span class="n">kappa</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fp</span><span class="p">)</span>
<a name="ln-749"></a>
<a name="ln-750"></a>            <span class="n">eta</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="nb">sqrt</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-751"></a>            <span class="n">fphi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cd1</span><span class="o">*</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-752"></a>            <span class="n">cphi2</span> <span class="o">=</span> <span class="n">zeta3</span>
<a name="ln-753"></a>            <span class="n">cphi1</span> <span class="o">=</span> <span class="p">(</span><span class="n">zeta1</span> <span class="o">-</span> <span class="n">zeta2</span><span class="o">*</span><span class="p">((</span><span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Lvk</span><span class="p">,</span><span class="mf">1.e-20</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-754"></a>
<a name="ln-755"></a>            <span class="n">P_kl</span> <span class="o">=</span> <span class="n">cphi1</span><span class="o">*</span><span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">P_k</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mf">1.e-20</span><span class="p">)</span>
<a name="ln-756"></a>            <span class="n">D_kl</span> <span class="o">=</span> <span class="n">cphi2</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="p">)</span>
<a name="ln-757"></a>
<a name="ln-758"></a>
<a name="ln-759"></a>            <span class="n">S_k</span>  <span class="o">=</span> <span class="n">P_k</span>  <span class="o">-</span> <span class="n">D_k</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c">!Source term TKE</span>
<a name="ln-760"></a>            <span class="n">S_kl</span> <span class="o">=</span> <span class="n">P_kl</span> <span class="o">-</span> <span class="n">D_kl</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fphi</span><span class="o">/</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c">!source term KL</span>
<a name="ln-761"></a>
<a name="ln-762"></a>            <span class="n">S_k</span>  <span class="o">=</span> <span class="n">S_k</span>  <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-763"></a>            <span class="n">S_kl</span> <span class="o">=</span> <span class="n">S_kl</span> <span class="o">*</span> <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-764"></a>
<a name="ln-765"></a>            <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">TKE_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_k</span>
<a name="ln-766"></a>            <span class="n">KL_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>    <span class="o">=</span> <span class="n">KL_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_kl</span>
<a name="ln-767"></a>
<a name="ln-768"></a>          <span class="k">end do</span>
<a name="ln-769"></a><span class="k">        end do</span>
<a name="ln-770"></a><span class="k">      end do</span>
<a name="ln-771"></a>
<a name="ln-772"></a><span class="k">    end subroutine </span><span class="n">add_kkl_source</span>
<a name="ln-773"></a>
<a name="ln-774"></a>
<a name="ln-775"></a>    <span class="k">subroutine </span><span class="n">add_sa_source</span><span class="p">()</span>
<a name="ln-776"></a>      <span class="c">!&lt; Add residual due to source terms of SA turbulence model</span>
<a name="ln-777"></a>      <span class="k">implicit none</span>
<a name="ln-778"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-779"></a>
<a name="ln-780"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD1</span>
<a name="ln-781"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD2</span>
<a name="ln-782"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fv1</span>
<a name="ln-783"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fv2</span>
<a name="ln-784"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fw</span>
<a name="ln-785"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">g</span>
<a name="ln-786"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Scap</span>
<a name="ln-787"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">r</span>
<a name="ln-788"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vort</span>
<a name="ln-789"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_v</span>
<a name="ln-790"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_v</span>
<a name="ln-791"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_v</span>
<a name="ln-792"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">lamda</span>
<a name="ln-793"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">kd2</span>
<a name="ln-794"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">xi</span>
<a name="ln-795"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu</span>
<a name="ln-796"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradrho_x</span>
<a name="ln-797"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradrho_y</span>
<a name="ln-798"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradrho_z</span>
<a name="ln-799"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">RhoFace</span>
<a name="ln-800"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Area</span>
<a name="ln-801"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Normal</span>
<a name="ln-802"></a>
<a name="ln-803"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-804"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-805"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-806"></a>
<a name="ln-807"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-808"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-809"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-810"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-811"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-812"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-813"></a>
<a name="ln-814"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-815"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-816"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-817"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span>
<a name="ln-818"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span>
<a name="ln-819"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-820"></a>
<a name="ln-821"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">xn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,:)</span>
<a name="ln-822"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">yn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,:)</span>
<a name="ln-823"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">zn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,:)</span>
<a name="ln-824"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">xn</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">,:)</span>
<a name="ln-825"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">yn</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">,:)</span>
<a name="ln-826"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">zn</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-827"></a>
<a name="ln-828"></a>            <span class="n">gradrho_x</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-829"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-830"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-831"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-832"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-833"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-834"></a>                        <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-835"></a>
<a name="ln-836"></a>            <span class="n">gradrho_y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-837"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-838"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-839"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-840"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-841"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-842"></a>                        <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-843"></a>
<a name="ln-844"></a>            <span class="n">gradrho_z</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-845"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-846"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-847"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-848"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-849"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-850"></a>                        <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-851"></a>
<a name="ln-852"></a>
<a name="ln-853"></a>            <span class="c">! __ vorticity __</span>
<a name="ln-854"></a>            <span class="n">vort</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span>  <span class="p">((</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-855"></a>                         <span class="o">+</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                         <span class="o">+</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-857"></a>                          <span class="p">)&amp;</span>
<a name="ln-858"></a>                       <span class="p">)</span>
<a name="ln-859"></a>
<a name="ln-860"></a>            <span class="c">! ___ cross diffusion ___</span>
<a name="ln-861"></a>            <span class="n">CD1</span> <span class="o">=</span> <span class="n">cb2</span><span class="o">*</span><span class="p">((</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-862"></a>                    <span class="o">+</span>  <span class="p">(</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-863"></a>                    <span class="o">+</span>  <span class="p">(</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-864"></a>                     <span class="p">)</span>
<a name="ln-865"></a>
<a name="ln-866"></a>            <span class="c">! ___ addition cross diffusion result conservative form of tv ___</span>
<a name="ln-867"></a>            <span class="n">CD2</span> <span class="o">=</span>    <span class="p">((</span><span class="n">gradrho_x</span><span class="o">*</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-868"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">gradrho_y</span><span class="o">*</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-869"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">gradrho_z</span><span class="o">*</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-870"></a>                     <span class="p">)</span>
<a name="ln-871"></a>
<a name="ln-872"></a>            <span class="n">kd2</span>  <span class="o">=</span> <span class="p">(</span><span class="n">kappa_sa</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-873"></a>            <span class="n">nu</span>   <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-874"></a>            <span class="n">xi</span>   <span class="o">=</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">nu</span>
<a name="ln-875"></a>
<a name="ln-876"></a>            <span class="c">! ___ functions ___</span>
<a name="ln-877"></a>            <span class="n">fv1</span>  <span class="o">=</span> <span class="p">(</span><span class="n">xi</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">xi</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cv1</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-878"></a>            <span class="n">fv2</span>  <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">xi</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">xi</span><span class="o">*</span><span class="n">fv1</span><span class="p">))</span>
<a name="ln-879"></a>
<a name="ln-880"></a>            <span class="c">! ___ Shear stress for production ___</span>
<a name="ln-881"></a>            <span class="n">scap</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vort</span> <span class="o">+</span> <span class="p">(</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fv2</span><span class="o">/</span><span class="p">(</span><span class="n">kd2</span><span class="p">)),</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">vort</span><span class="p">)</span>
<a name="ln-882"></a>
<a name="ln-883"></a>            <span class="c">! ___ wall function ___</span>
<a name="ln-884"></a>            <span class="n">r</span>    <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Scap</span><span class="o">*</span><span class="n">kd2</span><span class="p">),</span> <span class="mi">1</span><span class="mf">0.0</span><span class="p">)</span>
<a name="ln-885"></a>            <span class="n">g</span>    <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">cw2</span><span class="o">*</span><span class="p">((</span><span class="n">r</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span>
<a name="ln-886"></a>            <span class="n">fw</span>   <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="p">(</span><span class="n">cw3</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="n">g</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">cw3</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span> <span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>
<a name="ln-887"></a>
<a name="ln-888"></a>            <span class="c">! ____ Dissipation term ___</span>
<a name="ln-889"></a>            <span class="n">D_v</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">cw1</span><span class="o">*</span><span class="n">fw</span><span class="o">*</span><span class="p">((</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-890"></a>
<a name="ln-891"></a>            <span class="c">! ____ PRODUCTION term____</span>
<a name="ln-892"></a>            <span class="n">P_v</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">cb1</span><span class="o">*</span><span class="n">Scap</span><span class="o">*</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-893"></a>
<a name="ln-894"></a>            <span class="c">! ____ cross diffusion term ___</span>
<a name="ln-895"></a>            <span class="n">lamda</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">CD1</span><span class="o">/</span><span class="n">sigma_sa</span> <span class="o">-</span> <span class="n">CD2</span><span class="o">*</span><span class="p">(</span><span class="n">nu</span><span class="o">+</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="n">sigma_sa</span>
<a name="ln-896"></a>
<a name="ln-897"></a>            <span class="n">S_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_v</span> <span class="o">-</span> <span class="n">D_v</span>  <span class="o">+</span> <span class="n">lamda</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-898"></a>            <span class="n">tv_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">tv_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_v</span>
<a name="ln-899"></a>
<a name="ln-900"></a>          <span class="k">end do</span>
<a name="ln-901"></a><span class="k">        end do</span>
<a name="ln-902"></a><span class="k">      end do</span>
<a name="ln-903"></a>
<a name="ln-904"></a><span class="k">    end subroutine </span><span class="n">add_sa_source</span>
<a name="ln-905"></a>
<a name="ln-906"></a>    <span class="k">subroutine </span><span class="n">add_saBC_source</span><span class="p">()</span>
<a name="ln-907"></a>      <span class="c">!&lt; Add residual due to source terms of SABC transition model</span>
<a name="ln-908"></a>      <span class="k">implicit none</span>
<a name="ln-909"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-910"></a>
<a name="ln-911"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD1</span>
<a name="ln-912"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD2</span>
<a name="ln-913"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fv1</span>
<a name="ln-914"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fv2</span>
<a name="ln-915"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fw</span>
<a name="ln-916"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">g</span>
<a name="ln-917"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Scap</span>
<a name="ln-918"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">r</span>
<a name="ln-919"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S_v</span>
<a name="ln-920"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">D_v</span>
<a name="ln-921"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">P_v</span>
<a name="ln-922"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">lamda</span>
<a name="ln-923"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dist_i</span>
<a name="ln-924"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dist_i_2</span>
<a name="ln-925"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Ji</span>
<a name="ln-926"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Ji_2</span>
<a name="ln-927"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Ji_3</span>
<a name="ln-928"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">S</span>
<a name="ln-929"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Omega</span>
<a name="ln-930"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">k2</span>
<a name="ln-931"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">inv_k2_d2</span>
<a name="ln-932"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Shat</span>
<a name="ln-933"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">inv_Shat</span>
<a name="ln-934"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu</span>
<a name="ln-935"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradrho_x</span>
<a name="ln-936"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradrho_y</span>
<a name="ln-937"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gradrho_z</span>
<a name="ln-938"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">RhoFace</span>
<a name="ln-939"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Area</span>
<a name="ln-940"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Normal</span>
<a name="ln-941"></a>      <span class="c">! transition modeling variables</span>
<a name="ln-942"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">chi_1</span><span class="o">=</span><span class="mf">0.002</span>
<a name="ln-943"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">chi_2</span><span class="o">=</span><span class="mf">5.0</span>
<a name="ln-944"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu_BC</span>
<a name="ln-945"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu_cr</span>
<a name="ln-946"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nu_t</span>
<a name="ln-947"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span>
<a name="ln-948"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">glim</span>
<a name="ln-949"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">g_6</span>
<a name="ln-950"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vmag</span>
<a name="ln-951"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Production</span>
<a name="ln-952"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Destruction</span>
<a name="ln-953"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">re_v</span>
<a name="ln-954"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">re_theta</span>
<a name="ln-955"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">re_theta_t</span>
<a name="ln-956"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term1</span>
<a name="ln-957"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term2</span>
<a name="ln-958"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">term_exponential</span>
<a name="ln-959"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">gamma_BC</span>
<a name="ln-960"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">tu</span>
<a name="ln-961"></a>
<a name="ln-962"></a>      <span class="n">tu</span> <span class="o">=</span> <span class="n">free_stream_tu</span>
<a name="ln-963"></a>
<a name="ln-964"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-965"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-966"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-967"></a>
<a name="ln-968"></a>            <span class="c">!Local_vel_mag</span>
<a name="ln-969"></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-970"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-971"></a>            <span class="n">w</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-972"></a>            <span class="n">vmag</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="p">)</span>
<a name="ln-973"></a>
<a name="ln-974"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-975"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-976"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-977"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-978"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-979"></a>            <span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-980"></a>
<a name="ln-981"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-982"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-983"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-984"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span>
<a name="ln-985"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span>
<a name="ln-986"></a>            <span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-987"></a>
<a name="ln-988"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">xn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,:)</span>
<a name="ln-989"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">yn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,:)</span>
<a name="ln-990"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">zn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,:)</span>
<a name="ln-991"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">xn</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">,:)</span>
<a name="ln-992"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">yn</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">,:)</span>
<a name="ln-993"></a>            <span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">zn</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-994"></a>
<a name="ln-995"></a>            <span class="n">gradrho_x</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-996"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-997"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-998"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-999"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1000"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1001"></a>                        <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1002"></a>
<a name="ln-1003"></a>            <span class="n">gradrho_y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1004"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1005"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1006"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1007"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1008"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1009"></a>                        <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1010"></a>
<a name="ln-1011"></a>            <span class="n">gradrho_z</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1012"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1013"></a>                         <span class="o">-</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1014"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1015"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1016"></a>                         <span class="o">+</span><span class="p">(</span><span class="n">RhoFace</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">Normal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Area</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1017"></a>                        <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1018"></a>
<a name="ln-1019"></a>
<a name="ln-1020"></a>            <span class="c">! __ vorticity __</span>
<a name="ln-1021"></a>            <span class="n">Omega</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span>  <span class="p">((</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-1022"></a>                         <span class="o">+</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-1023"></a>                         <span class="o">+</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">-</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">&amp;</span>
<a name="ln-1024"></a>                          <span class="p">)&amp;</span>
<a name="ln-1025"></a>                       <span class="p">)</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a>            <span class="c">! ___ cross diffusion ___</span>
<a name="ln-1028"></a>            <span class="n">CD1</span> <span class="o">=</span> <span class="n">cb2</span><span class="o">*</span><span class="p">((</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-1029"></a>                    <span class="o">+</span>  <span class="p">(</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-1030"></a>                    <span class="o">+</span>  <span class="p">(</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-1031"></a>                     <span class="p">)</span>
<a name="ln-1032"></a>
<a name="ln-1033"></a>            <span class="c">! ___ addition cross diffusion result conservative form of tv ___</span>
<a name="ln-1034"></a>            <span class="n">CD2</span> <span class="o">=</span>    <span class="p">((</span><span class="n">gradrho_x</span><span class="o">*</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-1035"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">gradrho_y</span><span class="o">*</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-1036"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">gradrho_z</span><span class="o">*</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))&amp;</span>
<a name="ln-1037"></a>                     <span class="p">)</span>
<a name="ln-1038"></a>
<a name="ln-1039"></a>            <span class="n">dist_i</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1040"></a>            <span class="n">dist_i_2</span> <span class="o">=</span> <span class="n">dist_i</span><span class="o">*</span><span class="n">dist_i</span>
<a name="ln-1041"></a>            <span class="n">k2</span> <span class="o">=</span> <span class="n">kappa_sa</span><span class="o">*</span><span class="n">kappa_sa</span>
<a name="ln-1042"></a>            <span class="n">nu</span>   <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1043"></a>            <span class="n">Ji</span>   <span class="o">=</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">nu</span>
<a name="ln-1044"></a>            <span class="n">Ji_2</span> <span class="o">=</span> <span class="n">Ji</span><span class="o">*</span><span class="n">Ji</span>
<a name="ln-1045"></a>            <span class="n">Ji_3</span> <span class="o">=</span> <span class="n">Ji_2</span><span class="o">*</span><span class="n">ji</span>
<a name="ln-1046"></a>
<a name="ln-1047"></a>
<a name="ln-1048"></a>            <span class="c">! ___ functions ___</span>
<a name="ln-1049"></a>            <span class="n">fv1</span>  <span class="o">=</span> <span class="p">(</span><span class="n">Ji_3</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">Ji_3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cv1_3</span><span class="p">))</span>
<a name="ln-1050"></a>            <span class="n">fv2</span>  <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">Ji</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ji</span><span class="o">*</span><span class="n">fv1</span><span class="p">))</span>
<a name="ln-1051"></a>
<a name="ln-1052"></a>            <span class="c">! ___ Shear stress for production ___</span>
<a name="ln-1053"></a>            <span class="n">S</span> <span class="o">=</span> <span class="n">Omega</span>
<a name="ln-1054"></a>            <span class="n">inv_k2_d2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">k2</span><span class="o">*</span><span class="n">dist_i_2</span><span class="p">)</span>
<a name="ln-1055"></a>            <span class="n">Shat</span>      <span class="o">=</span> <span class="n">S</span> <span class="o">+</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fv2</span><span class="o">*</span><span class="n">inv_k2_d2</span>
<a name="ln-1056"></a>            <span class="n">Shat</span>      <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Shat</span><span class="p">,</span> <span class="mf">1.0e-10</span><span class="p">)</span>
<a name="ln-1057"></a>            <span class="n">inv_Shat</span>  <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">Shat</span>
<a name="ln-1058"></a>
<a name="ln-1059"></a>            <span class="c">! ____ PRODUCTION term____</span>
<a name="ln-1060"></a>            <span class="n">chi_1</span> <span class="o">=</span> <span class="mf">0.002</span>
<a name="ln-1061"></a>            <span class="n">chi_2</span> <span class="o">=</span> <span class="mf">5.0</span>
<a name="ln-1062"></a>
<a name="ln-1063"></a>            <span class="n">nu_t</span> <span class="o">=</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fv1</span>
<a name="ln-1064"></a>            <span class="n">nu_cr</span> <span class="o">=</span> <span class="n">chi_2</span><span class="o">/</span><span class="n">Reynolds_number</span>
<a name="ln-1065"></a>            <span class="n">nu_bc</span> <span class="o">=</span> <span class="n">nu_t</span><span class="o">/</span><span class="p">(</span><span class="n">vmag</span><span class="o">*</span><span class="n">dist_i</span><span class="p">)</span>
<a name="ln-1066"></a>
<a name="ln-1067"></a>            <span class="n">re_v</span> <span class="o">=</span> <span class="n">dist_i_2</span><span class="o">*</span><span class="n">Omega</span><span class="o">/</span><span class="n">nu</span>
<a name="ln-1068"></a>            <span class="n">re_theta</span> <span class="o">=</span> <span class="n">re_v</span><span class="o">/</span><span class="mf">2.193</span>
<a name="ln-1069"></a>            <span class="n">re_theta_t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">80</span><span class="mf">3.73</span><span class="o">*</span><span class="p">((</span><span class="n">tu</span><span class="o">+</span><span class="mf">0.6067</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.027</span><span class="p">)))</span>
<a name="ln-1070"></a>            <span class="c">!re_theta_t = 163.0 + exp(6.91-0.18)</span>
<a name="ln-1071"></a>
<a name="ln-1072"></a>
<a name="ln-1073"></a>            <span class="n">term1</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">re_theta</span><span class="o">-</span><span class="n">re_theta_t</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">chi_1</span><span class="o">*</span><span class="n">re_theta_t</span><span class="p">))</span>
<a name="ln-1074"></a>            <span class="n">term2</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nu_BC</span><span class="o">-</span><span class="n">nu_cr</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span><span class="o">/</span><span class="n">nu_cr</span><span class="p">)</span>
<a name="ln-1075"></a>            <span class="n">term_exponential</span> <span class="o">=</span> <span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span><span class="p">)</span>
<a name="ln-1076"></a>            <span class="n">gamma_BC</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">term_exponential</span><span class="p">)</span>
<a name="ln-1077"></a><span class="c">!            intermittency(i,j,k) = gamma_BC</span>
<a name="ln-1078"></a>
<a name="ln-1079"></a>            <span class="n">Production</span> <span class="o">=</span> <span class="n">gamma_BC</span><span class="o">*</span><span class="n">cb1</span><span class="o">*</span><span class="n">Shat</span><span class="o">*</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1080"></a>
<a name="ln-1081"></a>            <span class="c">! ___ Destruction term___ !</span>
<a name="ln-1082"></a>            <span class="n">r</span>    <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">inv_Shat</span><span class="o">*</span><span class="n">inv_k2_d2</span><span class="p">,</span> <span class="mi">1</span><span class="mf">0.0</span><span class="p">)</span>
<a name="ln-1083"></a>            <span class="n">g</span>    <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">cw2</span><span class="o">*</span><span class="p">((</span><span class="n">r</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span>
<a name="ln-1084"></a>            <span class="n">g_6</span>  <span class="o">=</span> <span class="n">g</span><span class="o">**</span><span class="mi">6</span>
<a name="ln-1085"></a>            <span class="n">glim</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">+</span><span class="n">cw3_6</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">g_6</span><span class="o">+</span><span class="n">cw3_6</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>
<a name="ln-1086"></a>            <span class="n">fw</span>   <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="n">glim</span>
<a name="ln-1087"></a>            <span class="n">Destruction</span> <span class="o">=</span> <span class="p">(</span><span class="n">cw1</span><span class="o">*</span><span class="n">fw</span><span class="o">*</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">dist_i_2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1088"></a>
<a name="ln-1089"></a>            <span class="c">! ____ cross diffusion term ___</span>
<a name="ln-1090"></a>            <span class="n">lamda</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">CD1</span><span class="o">/</span><span class="n">sigma_sa</span> <span class="o">-</span> <span class="n">CD2</span><span class="o">*</span><span class="p">(</span><span class="n">nu</span><span class="o">+</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="n">sigma_sa</span><span class="p">)</span><span class="o">*</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1091"></a>
<a name="ln-1092"></a>            <span class="n">S_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">Production</span> <span class="o">-</span> <span class="n">Destruction</span>  <span class="o">+</span> <span class="n">lamda</span><span class="p">)</span>
<a name="ln-1093"></a>            <span class="n">tv_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>   <span class="o">=</span> <span class="n">tv_residue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_v</span>
<a name="ln-1094"></a>
<a name="ln-1095"></a>          <span class="k">end do</span>
<a name="ln-1096"></a><span class="k">        end do</span>
<a name="ln-1097"></a><span class="k">      end do</span>
<a name="ln-1098"></a>
<a name="ln-1099"></a><span class="k">    end subroutine </span><span class="n">add_saBC_source</span>
<a name="ln-1100"></a>
<a name="ln-1101"></a>
<a name="ln-1102"></a><span class="k">end module </span><span class="n">source</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-06-17T18:49:25.362593 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>