<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>bc_primitive.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>bc_primitive.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 8.6% of total for source files.">1706 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/bc_primitive.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">bc_primitive.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/bc_primitive.html">bc_primitive</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/bc_primitive.f90.html#src">bc_primitive.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>Apply boundary condition at every iteration</p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~bc_primitive.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilebc_primitivef90EfferentGraph" width="623pt" height="221pt"
 viewBox="0.00 0.00 623.00 221.48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 217.4825)">
<title>sourcefile~~bc_primitive.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-217.4825 619,-217.4825 619,4 -4,4"/>
<!-- sourcefile~bc_primitive.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~bc_primitive.f90</title>
<polygon fill="none" stroke="#000000" points="615,-104 527,-104 527,-80 615,-80 615,-104"/>
<text text-anchor="middle" x="571" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">bc_primitive.f90</text>
</g>
<!-- sourcefile~read_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~read_bc.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/read_bc.f90.html" xlink:title="read_bc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="486.5,-184 416.5,-184 416.5,-160 486.5,-160 486.5,-184"/>
<text text-anchor="middle" x="451.5" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">read_bc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~bc_primitive.f90&#45;&gt;sourcefile~read_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~bc_primitive.f90&#45;&gt;sourcefile~read_bc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M553.2462,-104.0699C537.061,-115.0529 512.4724,-131.6869 491,-146 486.9439,-148.7037 482.6445,-151.5519 478.4328,-154.3321"/>
<polygon fill="#ff0000" stroke="#ff0000" points="476.443,-151.4516 470.0169,-159.8752 480.2934,-157.2975 476.443,-151.4516"/>
</g>
<!-- sourcefile~ft_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~ft_bc.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/ft_bc.f90.html" xlink:title="FT_bc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="482,-104 421,-104 421,-80 482,-80 482,-104"/>
<text text-anchor="middle" x="451.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">FT_bc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~bc_primitive.f90&#45;&gt;sourcefile~ft_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~bc_primitive.f90&#45;&gt;sourcefile~ft_bc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M526.8421,-92C515.556,-92 503.4719,-92 492.3595,-92"/>
<polygon fill="#ff0000" stroke="#ff0000" points="492.0609,-88.5001 482.0609,-92 492.0609,-95.5001 492.0609,-88.5001"/>
</g>
<!-- sourcefile~copy_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~copy_bc.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/copy_bc.f90.html" xlink:title="copy_bc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="376,-66 306,-66 306,-42 376,-42 376,-66"/>
<text text-anchor="middle" x="341" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">copy_bc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~bc_primitive.f90&#45;&gt;sourcefile~copy_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~bc_primitive.f90&#45;&gt;sourcefile~copy_bc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M529.7352,-79.9567C517.3625,-76.6749 503.7035,-73.3744 491,-71 456.0867,-64.4743 416.1016,-60.0936 386.1988,-57.4156"/>
<polygon fill="#ff0000" stroke="#ff0000" points="386.3318,-53.9142 376.0672,-56.5387 385.7281,-60.8881 386.3318,-53.9142"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="270,-146 216,-146 216,-122 270,-122 270,-146"/>
<text text-anchor="middle" x="243" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~bc_primitive.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~bc_primitive.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M341,-132C320.9314,-130.1722 298.4599,-130.4634 280.1026,-131.3042"/>
<polygon fill="#ff0000" stroke="#ff0000" points="279.8954,-127.8102 270.0946,-131.8343 280.2657,-134.8004 279.8954,-127.8102"/>
</g>
<!-- sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~global_vars.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/global_vars.f90.html" xlink:title="global_vars.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="180,-184 95,-184 95,-160 180,-160 180,-184"/>
<text text-anchor="middle" x="137.5" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_vars.f90</text>
</a>
</g>
</g>
<!-- sourcefile~bc_primitive.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~bc_primitive.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M535.7767,-104.0144C490.8503,-117.9749 410.626,-138.3412 341,-132"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M341,-132C294.3435,-129.6563 286.9814,-78.2534 243,-94"/>
</g>
<!-- sourcefile~global_sst.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~global_sst.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/global_sst.f90.html" xlink:title="global_sst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="491,-24 412,-24 412,0 491,0 491,-24"/>
<text text-anchor="middle" x="451.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~bc_primitive.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~bc_primitive.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M553.2462,-79.9301C537.061,-68.9471 512.4724,-52.3131 491,-38 486.9439,-35.2963 482.6445,-32.4481 478.4328,-29.6679"/>
<polygon fill="#ff0000" stroke="#ff0000" points="480.2934,-26.7025 470.0169,-24.1248 476.443,-32.5484 480.2934,-26.7025"/>
</g>
<!-- sourcefile~read_bc.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~read_bc.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M419.2736,-184.009C378.5413,-197.8349 306.1179,-217.9299 243,-212"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M243,-212C216.1505,-210.577 187.7633,-199.1805 167.2063,-188.9147"/>
<polygon fill="#ff0000" stroke="#ff0000" points="168.5533,-185.6704 158.0658,-184.1665 165.3264,-191.8823 168.5533,-185.6704"/>
</g>
<!-- sourcefile~layout.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~layout.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/layout.f90.html" xlink:title="layout.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="370.5,-184 311.5,-184 311.5,-160 370.5,-160 370.5,-184"/>
<text text-anchor="middle" x="341" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">layout.f90</text>
</a>
</g>
</g>
<!-- sourcefile~read_bc.f90&#45;&gt;sourcefile~layout.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~read_bc.f90&#45;&gt;sourcefile~layout.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M416.2333,-172C405.0143,-172 392.5247,-172 380.9965,-172"/>
<polygon fill="#ff0000" stroke="#ff0000" points="380.7437,-168.5001 370.7437,-172 380.7437,-175.5001 380.7437,-168.5001"/>
</g>
<!-- sourcefile~global.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~global.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/global.f90.html" xlink:title="global.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="59,-204 0,-204 0,-180 59,-180 59,-204"/>
<text text-anchor="middle" x="29.5" y="-189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global.f90</text>
</a>
</g>
</g>
<!-- sourcefile~read_bc.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~read_bc.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M243,-212C196.1768,-209.5184 184.3887,-212.1155 137.5,-212"/>
</g>
<!-- sourcefile~ft_bc.f90&#45;&gt;sourcefile~copy_bc.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~ft_bc.f90&#45;&gt;sourcefile~copy_bc.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M420.7196,-81.4149C409.8435,-77.6747 397.3821,-73.3893 385.5935,-69.3353"/>
<polygon fill="#ffff00" stroke="#ffff00" points="386.4936,-65.9437 375.8989,-66.0014 384.2171,-72.5632 386.4936,-65.9437"/>
</g>
<!-- sourcefile~ft_bc.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~ft_bc.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M420.8496,-86.5619C379.3253,-80.4637 303.4424,-73.8545 243,-94"/>
</g>
<!-- sourcefile~copy_bc.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~copy_bc.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M314.3206,-66.0036C294.8142,-74.5047 267.5815,-85.8069 243,-94"/>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M243,-94C208.2431,-105.5845 175.5157,-133.4018 155.9874,-152.4816"/>
<polygon fill="#00ff00" stroke="#00ff00" points="153.2715,-150.2488 148.6966,-159.805 158.2323,-155.1875 153.2715,-150.2488"/>
</g>
<!-- sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M215.8311,-143.7859C205.1469,-147.6343 192.6153,-152.148 180.7474,-156.4227"/>
<polygon fill="#00ffff" stroke="#00ffff" points="179.2118,-153.2557 170.9896,-159.9374 181.584,-159.8415 179.2118,-153.2557"/>
</g>
<!-- sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M94.8155,-179.9045C86.3482,-181.4725 77.4923,-183.1125 69.1319,-184.6608"/>
<polygon fill="#0000ff" stroke="#0000ff" points="68.4347,-181.2303 59.2392,-186.4927 69.7094,-188.1132 68.4347,-181.2303"/>
</g>
<!-- sourcefile~layout.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~layout.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M311.3308,-160.4956C301.3242,-156.6155 290.0366,-152.2387 279.5612,-148.1768"/>
<polygon fill="#ff0000" stroke="#ff0000" points="280.8183,-144.9104 270.2293,-144.5583 278.2876,-151.4369 280.8183,-144.9104"/>
</g>
<!-- sourcefile~layout.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~layout.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M311.3437,-171.4622C291.8728,-171.3903 265.8706,-171.8277 243,-174"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M243,-174C225.934,-175.621 207.2478,-175.7896 190.4062,-175.3512"/>
<polygon fill="#ff0000" stroke="#ff0000" points="190.3014,-171.8457 180.1892,-175.0072 190.0658,-178.8418 190.3014,-171.8457"/>
</g>
<!-- sourcefile~layout.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~bc_primitive.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~layout.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M243,-174C193.3855,-178.7124 187.3376,-212.1228 137.5,-212"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M137.5,-212C114.4991,-211.9433 89.1964,-207.4999 68.8674,-202.8162"/>
<polygon fill="#ff0000" stroke="#ff0000" points="69.5665,-199.3846 59.0246,-200.4417 67.9249,-206.1894 69.5665,-199.3846"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~bc_primitive.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilebc_primitivef90AfferentGraph" width="499pt" height="52pt"
 viewBox="0.00 0.00 499.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~bc_primitive.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 495,-48 495,4 -4,4"/>
<!-- sourcefile~bc_primitive.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~bc_primitive.f90</title>
<polygon fill="none" stroke="#000000" points="88,-44 0,-44 0,-20 88,-20 88,-44"/>
<text text-anchor="middle" x="44" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">bc_primitive.f90</text>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="283,-44 224,-44 224,-20 283,-20 283,-44"/>
<text text-anchor="middle" x="253.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~bc_primitive.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~bc_primitive.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M223.8294,-32.5488C212.6047,-32.7312 199.7137,-32.9106 188,-33 159.5564,-33.2171 152.4439,-33.1778 124,-33 115.6141,-32.9476 106.734,-32.8643 98.0593,-32.7676"/>
<polygon fill="#ff0000" stroke="#ff0000" points="98.0528,-29.2673 88.0121,-32.6489 97.9701,-36.2669 98.0528,-29.2673"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="188,-24 124,-24 124,0 188,0 188,-24"/>
<text text-anchor="middle" x="156" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M223.9822,-25.9451C215.8447,-24.2758 206.8557,-22.4319 198.1525,-20.6467"/>
<polygon fill="#00ffff" stroke="#00ffff" points="198.6345,-17.1727 188.1352,-18.5918 197.2278,-24.03 198.6345,-17.1727"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~bc_primitive.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~bc_primitive.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M123.9053,-17.7312C115.8273,-19.1737 106.9323,-20.7621 98.1004,-22.3392"/>
<polygon fill="#ff0000" stroke="#ff0000" points="97.4315,-18.9032 88.2026,-24.1067 98.6621,-25.7942 97.4315,-18.9032"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="491,-44 437,-44 437,-20 491,-20 491,-44"/>
<text text-anchor="middle" x="464" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M436.7124,-32.5275C425.6304,-32.7172 412.7042,-32.9071 401,-33 364.5567,-33.2892 355.4434,-33.2782 319,-33 310.6723,-32.9364 301.7495,-32.8274 293.2535,-32.7041"/>
<polygon fill="#ff0000" stroke="#ff0000" points="293.2233,-29.2034 283.1706,-32.5488 293.1154,-36.2025 293.2233,-29.2034"/>
</g>
<!-- sourcefile~start_finish.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~start_finish.f90</title>
<g id="a_sourcefile~~bc_primitive.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/start_finish.f90.html" xlink:title="start_finish.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="401,-24 319,-24 319,0 401,0 401,-24"/>
<text text-anchor="middle" x="360" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_finish.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M436.9467,-26.7974C428.9882,-25.267 420.0079,-23.54 411.0646,-21.8201"/>
<polygon fill="#00ffff" stroke="#00ffff" points="411.5205,-18.3437 401.0394,-19.8922 410.1985,-25.2178 411.5205,-18.3437"/>
</g>
<!-- sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~bc_primitive.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M318.8243,-19.7325C310.3352,-21.3267 301.4138,-23.0021 292.9863,-24.5847"/>
<polygon fill="#ff0000" stroke="#ff0000" points="292.1959,-21.1719 283.0137,-26.4575 293.4879,-28.0516 292.1959,-21.1719"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/bc_primitive.html">bc_primitive</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/bc_primitive.f90.html#src">bc_primitive.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; Apply boundary condition at every iteration</span>
<a name="ln-2"></a><span class="k">module </span><span class="n">bc_primitive</span>
<a name="ln-3"></a>  <span class="c">!&lt; Apply boundary condition at every iteration</span>
<a name="ln-4"></a>  <span class="c">!--------------------------------------------</span>
<a name="ln-5"></a>  <span class="c">! 170515  Jatinder Pal Singh Sandhu</span>
<a name="ln-6"></a>  <span class="c">! Aim : applying boundary condition to domain</span>
<a name="ln-7"></a>  <span class="c">!-------------------------------------------</span>
<a name="ln-8"></a><span class="cp">#include &quot;../error.inc&quot;</span>
<a name="ln-9"></a>
<a name="ln-10"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">imin_id</span>
<a name="ln-11"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">imax_id</span>
<a name="ln-12"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">jmin_id</span>
<a name="ln-13"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">jmax_id</span>
<a name="ln-14"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">kmin_id</span>
<a name="ln-15"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">kmax_id</span>
<a name="ln-16"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_density</span>
<a name="ln-17"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_x_speed</span>
<a name="ln-18"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_y_speed</span>
<a name="ln-19"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_z_speed</span>
<a name="ln-20"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_pressure</span>
<a name="ln-21"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_tk</span>
<a name="ln-22"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_tw</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_tkl</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_tgm</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_wall_temperature</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_Ttemperature</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_Tpressure</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">fixed_tv</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mu_ref</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">R_gas</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">sutherland_temp</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">pressure</span>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">density</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">x_speed</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">y_speed</span>
<a name="ln-36"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">z_speed</span>
<a name="ln-37"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tk</span>
<a name="ln-38"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tw</span>
<a name="ln-39"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tkl</span>
<a name="ln-40"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tv</span>
<a name="ln-41"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tgm</span>
<a name="ln-42"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">accur</span>
<a name="ln-43"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">imx</span>
<a name="ln-44"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">jmx</span>
<a name="ln-45"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">kmx</span>
<a name="ln-46"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">turbulence</span>
<a name="ln-47"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">transition</span>
<a name="ln-48"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">xnx</span>
<a name="ln-49"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">xny</span>
<a name="ln-50"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">xnz</span>
<a name="ln-51"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">ynx</span>
<a name="ln-52"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">yny</span>
<a name="ln-53"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">ynz</span>
<a name="ln-54"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">znx</span>
<a name="ln-55"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">zny</span>
<a name="ln-56"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">znz</span>
<a name="ln-57"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mu_t</span>
<a name="ln-58"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">T_ref</span>
<a name="ln-59"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">dist</span>
<a name="ln-60"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">process_id</span>
<a name="ln-61"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tk_inf</span>
<a name="ln-62"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tw_inf</span>
<a name="ln-63"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">te_inf</span>
<a name="ln-64"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tv_inf</span>
<a name="ln-65"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tgm_inf</span>
<a name="ln-66"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tkl_inf</span>
<a name="ln-67"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">face_names</span>
<a name="ln-68"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">id</span>
<a name="ln-69"></a>
<a name="ln-70"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">gm</span>
<a name="ln-71"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">x_speed_inf</span>
<a name="ln-72"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">y_speed_inf</span>
<a name="ln-73"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">z_speed_inf</span>
<a name="ln-74"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">density_inf</span>
<a name="ln-75"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">pressure_inf</span>
<a name="ln-76"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">vel_mag</span>
<a name="ln-77"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">qp</span>
<a name="ln-78"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">current_iter</span>
<a name="ln-79"></a>
<a name="ln-80"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">beta1</span>
<a name="ln-81"></a>  <span class="k">use </span><span class="n">utils</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">turbulence_read_error</span>
<a name="ln-82"></a>
<a name="ln-83"></a>  <span class="k">use </span><span class="n">read_bc</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">read_fixed_values</span>
<a name="ln-84"></a>  <span class="k">use </span><span class="n">copy_bc</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">copy3</span>
<a name="ln-85"></a>  <span class="k">use </span><span class="n">FT_bc</span>     <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">flow_tangency</span>
<a name="ln-86"></a>
<a name="ln-87"></a>  <span class="k">implicit none</span>
<a name="ln-88"></a><span class="k">  private</span>
<a name="ln-89"></a>
<a name="ln-90"></a><span class="k">  </span><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">face_num</span>
<a name="ln-91"></a>  <span class="c">!&lt; Number of the face : 1:imin, 2:imax, 3:jmin, 4:jmax, 5:kmin, 6:kmax</span>
<a name="ln-92"></a>
<a name="ln-93"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">populate_ghost_primitive</span>
<a name="ln-94"></a>
<a name="ln-95"></a>
<a name="ln-96"></a>  <span class="k">contains</span>
<a name="ln-97"></a>
<a name="ln-98"></a><span class="k">    subroutine </span><span class="n">populate_ghost_primitive</span><span class="p">()</span>
<a name="ln-99"></a>      <span class="c">!&lt; Populate the state variables in the ghost cell</span>
<a name="ln-100"></a>      <span class="c">!&lt; with particular value based on the boundary conditio </span>
<a name="ln-101"></a>      <span class="c">!&lt; being applied at that face</span>
<a name="ln-102"></a>      <span class="k">implicit none</span>
<a name="ln-103"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-104"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-105"></a>
<a name="ln-106"></a>      
<a name="ln-107"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-108"></a>        <span class="n">face_num</span> <span class="o">=</span> <span class="n">i</span>
<a name="ln-109"></a>        <span class="n">face</span> <span class="o">=</span> <span class="n">face_names</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span>
<a name="ln-110"></a>
<a name="ln-111"></a>        <span class="k">select case</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">face_num</span><span class="p">))</span>
<a name="ln-112"></a>
<a name="ln-113"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-114"></a>            <span class="k">call </span><span class="n">supersonic_inlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-115"></a>
<a name="ln-116"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-117"></a>            <span class="k">call </span><span class="n">supersonic_outlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-118"></a>
<a name="ln-119"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-120"></a>            <span class="k">call </span><span class="n">subsonic_inlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-121"></a>
<a name="ln-122"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-123"></a>            <span class="k">call </span><span class="n">subsonic_outlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-124"></a>
<a name="ln-125"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-126"></a>            <span class="k">call </span><span class="n">wall</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-127"></a>
<a name="ln-128"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-129"></a>            <span class="k">call </span><span class="n">slip_wall</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-130"></a>
<a name="ln-131"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-132"></a>            <span class="k">call </span><span class="n">pole</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-133"></a>
<a name="ln-134"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<a name="ln-135"></a>            <span class="k">call </span><span class="n">far_field</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-136"></a>
<a name="ln-137"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-138"></a>            <span class="k">call </span><span class="n">periodic_bc</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-139"></a>
<a name="ln-140"></a>          <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">)</span>
<a name="ln-141"></a>            <span class="k">call </span><span class="n">total_pressure</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-142"></a>
<a name="ln-143"></a>          <span class="k">case </span><span class="n">Default</span>
<a name="ln-144"></a>            <span class="k">if</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==-</span><span class="mi">10</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-145"></a><span class="k">              continue</span> <span class="c">!interface boundary </span>
<a name="ln-146"></a>            <span class="k">else</span>
<a name="ln-147"></a><span class="k">              print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot; boundary condition not recognised -&gt; id is :&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-148"></a>            <span class="k">end if</span>
<a name="ln-149"></a>
<a name="ln-150"></a><span class="k">          end select</span>
<a name="ln-151"></a><span class="k">        end do</span>
<a name="ln-152"></a><span class="c">!        qp(0,0,:,:) = 0.5*(qp(0,1,:,:)+qp(1,0,:,:))</span>
<a name="ln-153"></a><span class="c">!        qp(0,jmx,:,:) = 0.5*(qp(0,jmx-1,:,:)+qp(1,jmx,:,:))</span>
<a name="ln-154"></a><span class="c">!        qp(imx,0,:,:) = 0.5*(qp(imx,1,:,:)+qp(imx-1,0,:,:))</span>
<a name="ln-155"></a><span class="c">!        qp(imx,jmx,:,:) = 0.5*(qp(imx,jmx-1,:,:)+qp(imx-1,jmx,:,:))</span>
<a name="ln-156"></a><span class="c">!        qp(0,:,0,:) = 0.5*(qp(0,:,1,:)+qp(1,:,0,:))</span>
<a name="ln-157"></a><span class="c">!        qp(0,:,kmx,:) = 0.5*(qp(0,:,kmx-1,:)+qp(1,:,kmx,:))</span>
<a name="ln-158"></a><span class="c">!        qp(imx,:,0,:) = 0.5*(qp(imx,:,1,:)+qp(imx-1,:,0,:))</span>
<a name="ln-159"></a><span class="c">!        qp(imx,:,kmx,:) = 0.5*(qp(imx,:,jmx-1,:)+qp(imx-1,:,jmx,:))</span>
<a name="ln-160"></a>         <span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:))</span>
<a name="ln-161"></a>         <span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:))</span>
<a name="ln-162"></a>         <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span>   <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:))</span>
<a name="ln-163"></a>         <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:))</span>
<a name="ln-164"></a>         <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:))</span>
<a name="ln-165"></a>         <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:,:))</span>
<a name="ln-166"></a>         <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="p">,:,:)</span>   <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:))</span>
<a name="ln-167"></a>         <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="p">,:,:)</span><span class="o">+</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:))</span>
<a name="ln-168"></a>         <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-169"></a>         <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-170"></a>         <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-171"></a>         <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-172"></a>         <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-173"></a>         <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-174"></a>         <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-175"></a>         <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="p">,:)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span><span class="n">jmx</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:))</span>
<a name="ln-176"></a>
<a name="ln-177"></a>      <span class="k">end subroutine </span><span class="n">populate_ghost_primitive</span>
<a name="ln-178"></a>
<a name="ln-179"></a>
<a name="ln-180"></a>      <span class="k">subroutine </span><span class="n">supersonic_inlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-181"></a>        <span class="c">!&lt; Supersonic inlet boundary condition</span>
<a name="ln-182"></a>        <span class="c">!&lt; All the values of state variables are fixed</span>
<a name="ln-183"></a>        <span class="k">implicit none</span>
<a name="ln-184"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-185"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-186"></a>        <span class="k">if</span><span class="p">(</span><span class="n">current_iter</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-187"></a><span class="k">        call </span><span class="n">fix</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="n">fixed_density</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-188"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">x_speed</span> <span class="p">,</span> <span class="n">fixed_x_speed</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-189"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">y_speed</span> <span class="p">,</span> <span class="n">fixed_y_speed</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-190"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">z_speed</span> <span class="p">,</span> <span class="n">fixed_z_speed</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-191"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">fixed_pressure</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-192"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-193"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-194"></a>            <span class="c">!do nothing</span>
<a name="ln-195"></a>            <span class="k">continue</span>
<a name="ln-196"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-197"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-198"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-199"></a>            <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-200"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-201"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-202"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-203"></a>            <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-204"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-205"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-206"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-207"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-208"></a>            <span class="n">Fatal_error</span>
<a name="ln-209"></a>        <span class="k">end select</span>
<a name="ln-210"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-211"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-212"></a>            <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-213"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-214"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-215"></a>            <span class="k">continue</span>
<a name="ln-216"></a><span class="k">        end select</span>
<a name="ln-217"></a><span class="k">        end if</span>
<a name="ln-218"></a><span class="k">      end subroutine </span><span class="n">supersonic_inlet</span>
<a name="ln-219"></a>
<a name="ln-220"></a>
<a name="ln-221"></a>      <span class="k">subroutine </span><span class="n">supersonic_outlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-222"></a>        <span class="c">!&lt; Supersonic outlet boundary condition. </span>
<a name="ln-223"></a>        <span class="c">!&lt; All the values of state variables are copied </span>
<a name="ln-224"></a>        <span class="c">!&lt; from inside the domain</span>
<a name="ln-225"></a>        <span class="k">implicit none</span>
<a name="ln-226"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-227"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-228"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-229"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">x_speed</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-230"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">y_speed</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-231"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">z_speed</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-232"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-233"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-234"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-235"></a>            <span class="c">!do nothing</span>
<a name="ln-236"></a>            <span class="k">continue</span>
<a name="ln-237"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-238"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-239"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-240"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-241"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-242"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-243"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-244"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-245"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-246"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-247"></a>            <span class="n">Fatal_error</span>
<a name="ln-248"></a>        <span class="k">end select</span>
<a name="ln-249"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-250"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-251"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-252"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-253"></a>            <span class="k">continue</span>
<a name="ln-254"></a><span class="k">        end select</span>
<a name="ln-255"></a><span class="k">      end subroutine </span><span class="n">supersonic_outlet</span>
<a name="ln-256"></a>
<a name="ln-257"></a>
<a name="ln-258"></a>      <span class="k">subroutine </span><span class="n">subsonic_inlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-259"></a>        <span class="c">!&lt; Subsonic inlet boundary condition. </span>
<a name="ln-260"></a>        <span class="c">!&lt; All the state variables&#39;s value expect pressure</span>
<a name="ln-261"></a>        <span class="c">!&lt; is fixed and pressure is copied from inside the </span>
<a name="ln-262"></a>        <span class="c">!&lt; domain</span>
<a name="ln-263"></a>        <span class="k">implicit none</span>
<a name="ln-264"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-265"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-266"></a>        <span class="k">if</span><span class="p">(</span><span class="n">current_iter</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-267"></a><span class="k">        call </span><span class="n">fix</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="n">fixed_density</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-268"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">x_speed</span> <span class="p">,</span> <span class="n">fixed_x_speed</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-269"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">y_speed</span> <span class="p">,</span> <span class="n">fixed_y_speed</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-270"></a>        <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">z_speed</span> <span class="p">,</span> <span class="n">fixed_z_speed</span> <span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-271"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-272"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-273"></a>            <span class="c">!do nothing</span>
<a name="ln-274"></a>            <span class="k">continue</span>
<a name="ln-275"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-276"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-277"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-278"></a>            <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-279"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-280"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-281"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-282"></a>            <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-283"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-284"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-285"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-286"></a>           <span class="c">! call turbulence_read_error()</span>
<a name="ln-287"></a>           <span class="n">Fatal_error</span>
<a name="ln-288"></a>        <span class="k">end select</span>
<a name="ln-289"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-290"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-291"></a>            <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-292"></a>            <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-293"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-294"></a>            <span class="k">continue</span>
<a name="ln-295"></a><span class="k">        end select</span>
<a name="ln-296"></a><span class="k">        end if</span>
<a name="ln-297"></a><span class="k">        call </span><span class="n">copy3</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-298"></a>      <span class="k">end subroutine </span><span class="n">subsonic_inlet</span>
<a name="ln-299"></a>
<a name="ln-300"></a>
<a name="ln-301"></a>      <span class="k">subroutine </span><span class="n">subsonic_outlet</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-302"></a>        <span class="c">!&lt; Subsonic outlet boundary condition. </span>
<a name="ln-303"></a>        <span class="c">!&lt; All the state variables&#39;s value expect pressure</span>
<a name="ln-304"></a>        <span class="c">!&lt; is copied from the inside of the domain and pressure </span>
<a name="ln-305"></a>        <span class="c">!&lt; is fixed</span>
<a name="ln-306"></a>        <span class="k">implicit none</span>
<a name="ln-307"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-308"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-309"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-310"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">x_speed</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-311"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">y_speed</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-312"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">z_speed</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-313"></a>        <span class="k">if</span><span class="p">(</span><span class="n">current_iter</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-314"></a><span class="k">        call </span><span class="n">fix</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">fixed_pressure</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-315"></a>        <span class="k">end if</span>
<a name="ln-316"></a><span class="k">        select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-317"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-318"></a>            <span class="c">!do nothing</span>
<a name="ln-319"></a>            <span class="k">continue</span>
<a name="ln-320"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-321"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-322"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-323"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-324"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-325"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-326"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-327"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-328"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-329"></a>           <span class="c">! call turbulence_read_error()</span>
<a name="ln-330"></a>           <span class="n">Fatal_error</span>
<a name="ln-331"></a>        <span class="k">end select</span>
<a name="ln-332"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-333"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-334"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-335"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-336"></a>            <span class="k">continue</span>
<a name="ln-337"></a><span class="k">        end select</span>
<a name="ln-338"></a><span class="k">      end subroutine </span><span class="n">subsonic_outlet</span>
<a name="ln-339"></a>
<a name="ln-340"></a>      <span class="k">subroutine </span><span class="n">wall</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-341"></a>        <span class="c">!&lt; Adiabatic/Isothermal wall boundary condition</span>
<a name="ln-342"></a>        <span class="k">implicit none</span>
<a name="ln-343"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-344"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-345"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-346"></a>        <span class="k">call </span><span class="n">temp_based_density</span><span class="p">(</span><span class="n">fixed_wall_temperature</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-347"></a>        <span class="k">call </span><span class="n">no_slip</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-348"></a>      <span class="k">end subroutine </span><span class="n">wall</span>
<a name="ln-349"></a>
<a name="ln-350"></a>
<a name="ln-351"></a>      <span class="k">subroutine </span><span class="n">slip_wall</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-352"></a>        <span class="c">!&lt; Slip wall boundary condition. </span>
<a name="ln-353"></a>        <span class="c">!&lt; Maintain flow tangency</span>
<a name="ln-354"></a>        <span class="k">implicit none</span>
<a name="ln-355"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-356"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-357"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-358"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-359"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-360"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-361"></a>            <span class="c">!do nothing</span>
<a name="ln-362"></a>            <span class="k">continue</span>
<a name="ln-363"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-364"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-365"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-366"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-367"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-368"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-369"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-370"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-371"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-372"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-373"></a>            <span class="n">Fatal_error</span>
<a name="ln-374"></a>        <span class="k">end select</span>
<a name="ln-375"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-376"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-377"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-378"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-379"></a>            <span class="k">continue</span>
<a name="ln-380"></a><span class="k">        end select</span>
<a name="ln-381"></a><span class="k">        call </span><span class="n">flow_tangency</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-382"></a>      <span class="k">end subroutine </span><span class="n">slip_wall</span>
<a name="ln-383"></a>
<a name="ln-384"></a>
<a name="ln-385"></a>      <span class="k">subroutine </span><span class="n">pole</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-386"></a>        <span class="c">!&lt; Boundary condition for the block face</span>
<a name="ln-387"></a>        <span class="c">!&lt; with zero area; turning into a pole</span>
<a name="ln-388"></a>        <span class="k">implicit none</span>
<a name="ln-389"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-390"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-391"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-392"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">x_speed</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-393"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">y_speed</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-394"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">z_speed</span> <span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-395"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-396"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-397"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-398"></a>            <span class="c">!do nothing</span>
<a name="ln-399"></a>            <span class="k">continue</span>
<a name="ln-400"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-401"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span> 
<a name="ln-402"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-403"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-404"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-405"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-406"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-407"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-408"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-409"></a>            <span class="k">call </span><span class="n">turbulence_read_error</span><span class="p">()</span>
<a name="ln-410"></a>        <span class="k">end select</span>
<a name="ln-411"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-412"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-413"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-414"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-415"></a>            <span class="k">continue</span>
<a name="ln-416"></a><span class="k">        end select</span>
<a name="ln-417"></a><span class="k">      end subroutine </span><span class="n">pole</span>
<a name="ln-418"></a>
<a name="ln-419"></a>
<a name="ln-420"></a>
<a name="ln-421"></a>      <span class="k">subroutine </span><span class="n">fix</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">fix_val</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-422"></a>        <span class="c">!&lt; Generalized subroutine to fix particular value</span>
<a name="ln-423"></a>        <span class="c">!&lt; at particular face</span>
<a name="ln-424"></a>        <span class="k">implicit none</span>
<a name="ln-425"></a><span class="k">        </span><span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-426"></a>        <span class="c">!&lt; Variable of which values are being fixed in the ghost cell</span>
<a name="ln-427"></a>        <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>       <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fix_val</span>
<a name="ln-428"></a>        <span class="c">!&lt; Amount of value that need to be fixed.</span>
<a name="ln-429"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>         <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">face</span>
<a name="ln-430"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-431"></a>
<a name="ln-432"></a>        <span class="k">select case</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-433"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-434"></a>              <span class="n">var</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-435"></a>              <span class="n">var</span><span class="p">(</span>     <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-436"></a>              <span class="n">var</span><span class="p">(</span>     <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-437"></a>           <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-438"></a>              <span class="n">var</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-439"></a>              <span class="n">var</span><span class="p">(</span>  <span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-440"></a>              <span class="n">var</span><span class="p">(</span>  <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-441"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-442"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-443"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-444"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-445"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-446"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-447"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-448"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-449"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-450"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-451"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-452"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-453"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-454"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-455"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-456"></a>              <span class="n">var</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fix_val</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-457"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-458"></a>            <span class="c">!print*, &quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-459"></a>            <span class="n">Fatal_error</span>
<a name="ln-460"></a>        <span class="k">end select</span>
<a name="ln-461"></a><span class="k">            </span>
<a name="ln-462"></a><span class="k">      end subroutine </span><span class="n">fix</span>
<a name="ln-463"></a>
<a name="ln-464"></a>
<a name="ln-465"></a>      <span class="k">subroutine </span><span class="n">no_slip</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-466"></a>        <span class="c">!&lt; No-slip wall boundary condition. All the </span>
<a name="ln-467"></a>        <span class="c">!&lt; component of velocity throught face is zero</span>
<a name="ln-468"></a>        <span class="k">implicit none</span>
<a name="ln-469"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-470"></a>        <span class="c">!&lt; Name of the face at which boundary condition is called</span>
<a name="ln-471"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">x_speed</span><span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-472"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">y_speed</span><span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-473"></a>        <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">z_speed</span><span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-474"></a>        <span class="k">select case</span><span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-475"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<a name="ln-476"></a>            <span class="c">!do nothing</span>
<a name="ln-477"></a>            <span class="k">continue</span>
<a name="ln-478"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-479"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span>  <span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-480"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-481"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span>  <span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-482"></a>            <span class="k">call </span><span class="n">set_omega_at_wall</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-483"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-484"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span>  <span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-485"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span> <span class="p">,</span> <span class="s2">&quot;anti&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-486"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-487"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-488"></a>            <span class="n">Fatal_error</span>
<a name="ln-489"></a>        <span class="k">end select</span>
<a name="ln-490"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-491"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-492"></a>            <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-493"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-494"></a>            <span class="k">continue</span>
<a name="ln-495"></a><span class="k">        end select</span>
<a name="ln-496"></a><span class="k">      end subroutine </span><span class="n">no_slip</span>
<a name="ln-497"></a>
<a name="ln-498"></a>    
<a name="ln-499"></a>
<a name="ln-500"></a>      <span class="k">subroutine </span><span class="n">set_omega_at_wall</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-501"></a>        <span class="c">!&lt; Set value of turbulence variable: omega (turbulenct dissipation rate). </span>
<a name="ln-502"></a>        <span class="c">!&lt; Value fixed is accourding to the SST turbulence model</span>
<a name="ln-503"></a>        <span class="k">implicit none</span>
<a name="ln-504"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-505"></a>        <span class="kt">real</span> <span class="kd">::</span> <span class="n">T_face</span>
<a name="ln-506"></a>        <span class="kt">real</span> <span class="kd">::</span> <span class="n">mu</span>
<a name="ln-507"></a>        <span class="kt">real</span> <span class="kd">::</span> <span class="n">rho</span>
<a name="ln-508"></a>        <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span>
<a name="ln-509"></a>        
<a name="ln-510"></a>        <span class="k">select case</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-511"></a>          <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-512"></a>            <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-513"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-514"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-515"></a>              <span class="n">T_face</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">pressure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span><span class="o">/</span><span class="n">R_gas</span>
<a name="ln-516"></a>              <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_face</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T_face</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-517"></a>              <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-518"></a>              <span class="n">tw</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mi">120</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-519"></a>            <span class="k">end do</span>
<a name="ln-520"></a><span class="k">          end do</span>
<a name="ln-521"></a><span class="k">        end do</span>
<a name="ln-522"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-523"></a>          <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-524"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-525"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-526"></a>              <span class="n">T_face</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">pressure</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span><span class="o">/</span><span class="n">R_gas</span>
<a name="ln-527"></a>              <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_face</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T_face</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-528"></a>              <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">imx</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-529"></a>              <span class="n">tw</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mi">120</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-530"></a>            <span class="k">end do</span>
<a name="ln-531"></a><span class="k">          end do</span>
<a name="ln-532"></a><span class="k">        end do</span>
<a name="ln-533"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-534"></a>          <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-535"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-536"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-537"></a>              <span class="n">T_face</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span><span class="o">/</span><span class="n">R_gas</span>
<a name="ln-538"></a>              <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_face</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T_face</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-539"></a>              <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-540"></a>              <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mi">120</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-541"></a>            <span class="k">end do</span>
<a name="ln-542"></a><span class="k">          end do</span>
<a name="ln-543"></a><span class="k">        end do</span>
<a name="ln-544"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-545"></a>          <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-546"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-547"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-548"></a>              <span class="n">T_face</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span><span class="o">/</span><span class="n">R_gas</span>
<a name="ln-549"></a>              <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_face</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T_face</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-550"></a>              <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-551"></a>              <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mi">120</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">jmx</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-552"></a>            <span class="k">end do</span>
<a name="ln-553"></a><span class="k">          end do</span>
<a name="ln-554"></a><span class="k">        end do</span>
<a name="ln-555"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-556"></a>          <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-557"></a>          <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-558"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-559"></a>              <span class="n">T_face</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">/</span><span class="n">R_gas</span>
<a name="ln-560"></a>              <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_face</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T_face</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-561"></a>              <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-562"></a>              <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="mi">120</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<a name="ln-563"></a>            <span class="k">end do</span>
<a name="ln-564"></a><span class="k">          end do</span>
<a name="ln-565"></a><span class="k">        end do</span>
<a name="ln-566"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-567"></a>          <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-568"></a>          <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-569"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-570"></a>              <span class="n">T_face</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="p">)))</span><span class="o">/</span><span class="n">R_gas</span>
<a name="ln-571"></a>              <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_face</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T_face</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-572"></a>              <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="p">))</span>
<a name="ln-573"></a>              <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">120</span><span class="o">*</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kmx</span><span class="o">-</span><span class="n">l</span><span class="p">)</span>
<a name="ln-574"></a>            <span class="k">end do</span>
<a name="ln-575"></a><span class="k">          end do</span>
<a name="ln-576"></a><span class="k">        end do</span>
<a name="ln-577"></a>
<a name="ln-578"></a><span class="k">      end select</span>
<a name="ln-579"></a><span class="k">    end subroutine </span><span class="n">set_omega_at_wall</span>
<a name="ln-580"></a>
<a name="ln-581"></a>    <span class="k">subroutine </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a name="ln-582"></a>      <span class="c">!&lt; A Fail-check subroutine which set the freestream</span>
<a name="ln-583"></a>      <span class="c">!&lt; as the fixed value in case not specified explicitly</span>
<a name="ln-584"></a>      <span class="k">implicit none</span>
<a name="ln-585"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">model</span>
<a name="ln-586"></a>
<a name="ln-587"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a name="ln-588"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-589"></a>          <span class="c">!do nothing</span>
<a name="ln-590"></a>          <span class="k">continue</span>
<a name="ln-591"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;sa&quot;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-592"></a>          <span class="k">if</span><span class="p">(</span><span class="n">fixed_tv</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span><span class="n">fixed_tv</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">=</span><span class="n">tv_inf</span>
<a name="ln-593"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-594"></a>          <span class="k">if</span><span class="p">(</span><span class="n">fixed_tk</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span> <span class="n">fixed_tk</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">=</span><span class="n">tk_inf</span>
<a name="ln-595"></a>          <span class="k">if</span><span class="p">(</span><span class="n">fixed_tw</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span> <span class="n">fixed_tw</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">=</span><span class="n">tw_inf</span>
<a name="ln-596"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-597"></a>          <span class="k">if</span><span class="p">(</span><span class="n">fixed_tk</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span> <span class="n">fixed_tk</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">=</span><span class="n">tk_inf</span>
<a name="ln-598"></a>          <span class="k">if</span><span class="p">(</span><span class="n">fixed_tkl</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span> <span class="n">fixed_tkl</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">=</span><span class="n">tkl_inf</span>
<a name="ln-599"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-600"></a>         <span class="c">! call turbulence_read_error()</span>
<a name="ln-601"></a>         <span class="n">Fatal_error</span>
<a name="ln-602"></a>      <span class="k">end select</span>
<a name="ln-603"></a>
<a name="ln-604"></a><span class="k">      select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-605"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-606"></a>          <span class="k">if</span><span class="p">(</span><span class="n">fixed_tgm</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span> <span class="n">fixed_tgm</span><span class="p">(</span><span class="n">face_num</span><span class="p">)</span><span class="o">=</span><span class="n">tgm_inf</span>
<a name="ln-607"></a>        <span class="k">Case </span><span class="n">DEFAULT</span>
<a name="ln-608"></a>          <span class="k">continue</span>
<a name="ln-609"></a><span class="k">      end select</span>
<a name="ln-610"></a><span class="k">    end subroutine </span><span class="n">check_if_value_fixed</span>
<a name="ln-611"></a>
<a name="ln-612"></a>    <span class="k">subroutine </span><span class="n">far_field</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-613"></a>      <span class="c">!&lt; Far-field Riemann boundary condition</span>
<a name="ln-614"></a>      <span class="k">implicit none</span>
<a name="ln-615"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-616"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">cinf</span><span class="p">,</span> <span class="nb">cexp</span>   <span class="c">! speed of sound</span>
<a name="ln-617"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Rinf</span><span class="p">,</span> <span class="n">Rexp</span>   <span class="c">! Riemann invarient</span>
<a name="ln-618"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Uninf</span><span class="p">,</span> <span class="n">Unexp</span> <span class="c">! face normal speed</span>
<a name="ln-619"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Unb</span> <span class="c">! normal velocity boundary</span>
<a name="ln-620"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Cb</span>  <span class="c">! speed of sound boundary</span>
<a name="ln-621"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vel_diff</span>
<a name="ln-622"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span>
<a name="ln-623"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">uf</span><span class="p">,</span> <span class="n">vf</span><span class="p">,</span> <span class="n">wf</span>
<a name="ln-624"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-625"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-626"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face_already_has_fixed_values</span><span class="o">=</span><span class="mi">0</span><span class="c">!0=.no.</span>
<a name="ln-627"></a>
<a name="ln-628"></a>      <span class="n">face_already_has_fixed_values</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-629"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-630"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-631"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-632"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-633"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-634"></a>                <span class="c">! interior cell</span>
<a name="ln-635"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-636"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-637"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-638"></a>                <span class="c">! ghost cell</span>
<a name="ln-639"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i-1,j,k)</span>
<a name="ln-640"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i-1,j,k)</span>
<a name="ln-641"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i-1,j,k)</span>
<a name="ln-642"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-643"></a>                <span class="c">!cinf = sqrt(gm*pressure(i-1,j,k)/density(i-1,j,k))</span>
<a name="ln-644"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-645"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-646"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-647"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-648"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-649"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-650"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-651"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-652"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-653"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-654"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-655"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-656"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-657"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-658"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-659"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-660"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-661"></a>                      <span class="c">!do nothing</span>
<a name="ln-662"></a>                      <span class="k">continue</span>
<a name="ln-663"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-664"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-665"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-666"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-667"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-668"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-669"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-670"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-671"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-672"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-673"></a>                      <span class="n">Fatal_error</span>
<a name="ln-674"></a>                  <span class="k">end select</span>
<a name="ln-675"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-676"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-677"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-678"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-679"></a>                      <span class="k">continue</span>
<a name="ln-680"></a><span class="k">                  end select</span>
<a name="ln-681"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-682"></a>                <span class="k">else</span>
<a name="ln-683"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-684"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-685"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-686"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-687"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure_inf</span><span class="o">/</span><span class="p">(</span><span class="n">density_inf</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-688"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-689"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-690"></a>
<a name="ln-691"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-692"></a><span class="k">                  select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-693"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-694"></a>                      <span class="c">!do nothing</span>
<a name="ln-695"></a>                      <span class="k">continue</span>
<a name="ln-696"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-697"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-698"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-699"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-700"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-701"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-702"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-703"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-704"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-705"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-706"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-707"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-708"></a>                      <span class="n">Fatal_error</span>
<a name="ln-709"></a>                  <span class="k">end select</span>
<a name="ln-710"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-711"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-712"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-713"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-714"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-715"></a>                      <span class="k">continue</span>
<a name="ln-716"></a><span class="k">                  end select</span>
<a name="ln-717"></a><span class="k">                  end if</span>
<a name="ln-718"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-719"></a>                <span class="k">end if</span>
<a name="ln-720"></a><span class="k">              end do</span>
<a name="ln-721"></a><span class="k">            end do</span>
<a name="ln-722"></a><span class="k">          end do</span>
<a name="ln-723"></a><span class="k">          </span><span class="n">qp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,:,:,:)</span>
<a name="ln-724"></a>          <span class="n">qp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,:,:,:)</span>
<a name="ln-725"></a>         <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-726"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-727"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-728"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">imx</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-729"></a>                <span class="c">! interior cell</span>
<a name="ln-730"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-731"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-732"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-733"></a>                <span class="c">! ghost cell</span>
<a name="ln-734"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k)</span>
<a name="ln-735"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k)</span>
<a name="ln-736"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k)</span>
<a name="ln-737"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-738"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k)/density(i,j,k))</span>
<a name="ln-739"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-740"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-741"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-742"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-743"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-744"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-745"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-746"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-747"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-748"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-749"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-750"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-751"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-752"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-753"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-754"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-755"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-756"></a>                      <span class="c">!do nothing</span>
<a name="ln-757"></a>                      <span class="k">continue</span>
<a name="ln-758"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-759"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-760"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-761"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-762"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-763"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-764"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-765"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-766"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-767"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-768"></a>                      <span class="n">Fatal_error</span>
<a name="ln-769"></a>                  <span class="k">end select</span>
<a name="ln-770"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-771"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-772"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-773"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-774"></a>                      <span class="k">continue</span>
<a name="ln-775"></a><span class="k">                  end select</span>
<a name="ln-776"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-777"></a>                <span class="k">else</span>
<a name="ln-778"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-779"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-780"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-781"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-782"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure_inf</span><span class="o">/</span><span class="p">(</span><span class="n">density_inf</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-783"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-784"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-785"></a>
<a name="ln-786"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-787"></a><span class="k">                  select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-788"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-789"></a>                      <span class="c">!do nothing</span>
<a name="ln-790"></a>                      <span class="k">continue</span>
<a name="ln-791"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-792"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-793"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-794"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-795"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-796"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-797"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-798"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-799"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-800"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-801"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-802"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-803"></a>                      <span class="n">Fatal_error</span>
<a name="ln-804"></a>                  <span class="k">end select</span>
<a name="ln-805"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-806"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-807"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-808"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-809"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-810"></a>                      <span class="k">continue</span>
<a name="ln-811"></a><span class="k">                  end select</span>
<a name="ln-812"></a><span class="k">                  end if</span>
<a name="ln-813"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-814"></a>                <span class="k">end if</span>
<a name="ln-815"></a><span class="k">              end do</span>
<a name="ln-816"></a><span class="k">            end do</span>
<a name="ln-817"></a><span class="k">          end do</span>
<a name="ln-818"></a><span class="k">          </span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,:,:,:)</span>
<a name="ln-819"></a>          <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,:,:,:)</span>
<a name="ln-820"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-821"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-822"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-823"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-824"></a>                <span class="c">! interior cell</span>
<a name="ln-825"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-826"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-827"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-828"></a>                <span class="c">! ghost cell</span>
<a name="ln-829"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j-1,k)</span>
<a name="ln-830"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j-1,k)</span>
<a name="ln-831"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j-1,k)</span>
<a name="ln-832"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-833"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j-1,k)/density(i,j-1,k))</span>
<a name="ln-834"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-835"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-836"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-837"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-838"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-839"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-840"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-841"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-842"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-843"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-844"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-845"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-846"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-847"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-848"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-849"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-850"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-851"></a>                      <span class="c">!do nothing</span>
<a name="ln-852"></a>                      <span class="k">continue</span>
<a name="ln-853"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-854"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-855"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-856"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-857"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-858"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-859"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-860"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-861"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-862"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-863"></a>                      <span class="n">Fatal_error</span>
<a name="ln-864"></a>                  <span class="k">end select</span>
<a name="ln-865"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-866"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-867"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-868"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-869"></a>                      <span class="k">continue</span>
<a name="ln-870"></a><span class="k">                  end select</span>
<a name="ln-871"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-872"></a>                <span class="k">else</span>
<a name="ln-873"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-874"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-875"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-876"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-877"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure_inf</span><span class="o">/</span><span class="p">(</span><span class="n">density_inf</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-878"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-879"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-880"></a>
<a name="ln-881"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-882"></a><span class="k">                  select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-883"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-884"></a>                      <span class="c">!do nothing</span>
<a name="ln-885"></a>                      <span class="k">continue</span>
<a name="ln-886"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-887"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-888"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-889"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-890"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-891"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-892"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-893"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-894"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-895"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-896"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-897"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-898"></a>                      <span class="n">Fatal_error</span>
<a name="ln-899"></a>                  <span class="k">end select</span>
<a name="ln-900"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-901"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-902"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-903"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-904"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-905"></a>                      <span class="k">continue</span>
<a name="ln-906"></a><span class="k">                  end select</span>
<a name="ln-907"></a><span class="k">                  end if</span>
<a name="ln-908"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-909"></a>                <span class="k">end if</span>
<a name="ln-910"></a><span class="k">              end do</span>
<a name="ln-911"></a><span class="k">            end do</span>
<a name="ln-912"></a><span class="k">          end do</span>
<a name="ln-913"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,:,:)</span>
<a name="ln-914"></a>          <span class="n">qp</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,:,:)</span>
<a name="ln-915"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-916"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-917"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jmx</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-918"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-919"></a>                <span class="c">! interior cell</span>
<a name="ln-920"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-921"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-922"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-923"></a>                <span class="c">! ghost cell</span>
<a name="ln-924"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k)</span>
<a name="ln-925"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k)</span>
<a name="ln-926"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k)</span>
<a name="ln-927"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-928"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k)/density(i,j,k))</span>
<a name="ln-929"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-930"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-931"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-932"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-933"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-934"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-935"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-936"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-937"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-938"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-939"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-940"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-941"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-942"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-943"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-944"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-945"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-946"></a>                      <span class="c">!do nothing</span>
<a name="ln-947"></a>                      <span class="k">continue</span>
<a name="ln-948"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-949"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-950"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-951"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-952"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-953"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-954"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-955"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-956"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-957"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-958"></a>                      <span class="n">Fatal_error</span>
<a name="ln-959"></a>                  <span class="k">end select</span>
<a name="ln-960"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-961"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-962"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-963"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-964"></a>                      <span class="k">continue</span>
<a name="ln-965"></a><span class="k">                  end select</span>
<a name="ln-966"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-967"></a>                <span class="k">else</span>
<a name="ln-968"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-969"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-970"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-971"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-972"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure_inf</span><span class="o">/</span><span class="p">(</span><span class="n">density_inf</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-973"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-974"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-975"></a>
<a name="ln-976"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-977"></a><span class="k">                  select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-978"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-979"></a>                      <span class="c">!do nothing</span>
<a name="ln-980"></a>                      <span class="k">continue</span>
<a name="ln-981"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-982"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-983"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-984"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-985"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-986"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-987"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-988"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-989"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-990"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-991"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-992"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-993"></a>                      <span class="n">Fatal_error</span>
<a name="ln-994"></a>                  <span class="k">end select</span>
<a name="ln-995"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-996"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-997"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-998"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-999"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1000"></a>                      <span class="k">continue</span>
<a name="ln-1001"></a><span class="k">                  end select</span>
<a name="ln-1002"></a><span class="k">                  end if</span>
<a name="ln-1003"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1004"></a>                <span class="k">end if</span>
<a name="ln-1005"></a><span class="k">              end do</span>
<a name="ln-1006"></a><span class="k">            end do</span>
<a name="ln-1007"></a><span class="k">          end do</span>
<a name="ln-1008"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,:,:)</span>
<a name="ln-1009"></a>          <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,:,:)</span>
<a name="ln-1010"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-1011"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1012"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1013"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1014"></a>                <span class="c">! interior cell</span>
<a name="ln-1015"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1016"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1017"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1018"></a>                <span class="c">! ghost cell</span>
<a name="ln-1019"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k-1)</span>
<a name="ln-1020"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k-1)</span>
<a name="ln-1021"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k-1)</span>
<a name="ln-1022"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1023"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k-1)/density(i,j,k-1))</span>
<a name="ln-1024"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1025"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1026"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1027"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1028"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1029"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1030"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1031"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1032"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1033"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1034"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1035"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1036"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-1037"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-1038"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-1039"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1040"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1041"></a>                      <span class="c">!do nothing</span>
<a name="ln-1042"></a>                      <span class="k">continue</span>
<a name="ln-1043"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1044"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1045"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1046"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1047"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1048"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1049"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1050"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1051"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1052"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1053"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1054"></a>                  <span class="k">end select</span>
<a name="ln-1055"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1056"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1057"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1058"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1059"></a>                      <span class="k">continue</span>
<a name="ln-1060"></a><span class="k">                  end select</span>
<a name="ln-1061"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1062"></a>                <span class="k">else</span>
<a name="ln-1063"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1064"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1065"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1066"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1067"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure_inf</span><span class="o">/</span><span class="p">(</span><span class="n">density_inf</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-1068"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-1069"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-1070"></a>
<a name="ln-1071"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1072"></a><span class="k">                  select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1073"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1074"></a>                      <span class="c">!do nothing</span>
<a name="ln-1075"></a>                      <span class="k">continue</span>
<a name="ln-1076"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1077"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1078"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1079"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1080"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1081"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1082"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1083"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1084"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1085"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1086"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1087"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1088"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1089"></a>                  <span class="k">end select</span>
<a name="ln-1090"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1091"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1092"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1093"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1094"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1095"></a>                      <span class="k">continue</span>
<a name="ln-1096"></a><span class="k">                  end select</span>
<a name="ln-1097"></a><span class="k">                  end if</span>
<a name="ln-1098"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1099"></a>                <span class="k">end if</span>
<a name="ln-1100"></a><span class="k">              end do</span>
<a name="ln-1101"></a><span class="k">            end do</span>
<a name="ln-1102"></a><span class="k">          end do</span>
<a name="ln-1103"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="mi">0</span><span class="p">,:)</span>
<a name="ln-1104"></a>          <span class="n">qp</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="mi">0</span><span class="p">,:)</span>
<a name="ln-1105"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-1106"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kmx</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-1107"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1108"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1109"></a>                <span class="c">! interior cell</span>
<a name="ln-1110"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1111"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1112"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1113"></a>                <span class="c">! ghost cell</span>
<a name="ln-1114"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k)</span>
<a name="ln-1115"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k)</span>
<a name="ln-1116"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k)</span>
<a name="ln-1117"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1118"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k)/density(i,j,k))</span>
<a name="ln-1119"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1120"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1121"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1122"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1123"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1124"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1125"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1126"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1127"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1128"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1129"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1130"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1131"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-1132"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-1133"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-1134"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1135"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1136"></a>                      <span class="c">!do nothing</span>
<a name="ln-1137"></a>                      <span class="k">continue</span>
<a name="ln-1138"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1139"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1140"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1141"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1142"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1143"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1144"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1145"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1146"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1147"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1148"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1149"></a>                  <span class="k">end select</span>
<a name="ln-1150"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1151"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1152"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1153"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1154"></a>                      <span class="k">continue</span>
<a name="ln-1155"></a><span class="k">                  end select</span>
<a name="ln-1156"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1157"></a>                <span class="k">else</span>
<a name="ln-1158"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1159"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1160"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1161"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1162"></a>                  <span class="n">s</span> <span class="o">=</span> <span class="n">pressure_inf</span><span class="o">/</span><span class="p">(</span><span class="n">density_inf</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="p">))</span>
<a name="ln-1163"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-1164"></a>                  <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="o">/</span><span class="n">gm</span><span class="p">)</span>
<a name="ln-1165"></a>
<a name="ln-1166"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1167"></a><span class="k">                  select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1168"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1169"></a>                      <span class="c">!do nothing</span>
<a name="ln-1170"></a>                      <span class="k">continue</span>
<a name="ln-1171"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1172"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1173"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1174"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1175"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1176"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1177"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1178"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1179"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1180"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1181"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1182"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1183"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1184"></a>                  <span class="k">end select</span>
<a name="ln-1185"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1186"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1187"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1188"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1189"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1190"></a>                      <span class="k">continue</span>
<a name="ln-1191"></a><span class="k">                  end select</span>
<a name="ln-1192"></a><span class="k">                  end if</span>
<a name="ln-1193"></a><span class="k">                  </span><span class="n">face_already_has_fixed_values</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1194"></a>                <span class="k">end if</span>
<a name="ln-1195"></a><span class="k">              end do</span>
<a name="ln-1196"></a><span class="k">            end do</span>
<a name="ln-1197"></a><span class="k">          end do</span>
<a name="ln-1198"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="p">,:)</span>
<a name="ln-1199"></a>          <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="p">,:)</span>
<a name="ln-1200"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1201"></a>          <span class="c">!print*, &quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-1202"></a>          <span class="n">Fatal_error</span>
<a name="ln-1203"></a>      <span class="k">end select</span>
<a name="ln-1204"></a>
<a name="ln-1205"></a><span class="k">    end subroutine </span><span class="n">far_field</span>
<a name="ln-1206"></a>
<a name="ln-1207"></a>
<a name="ln-1208"></a>    <span class="k">subroutine </span><span class="n">total_pressure</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-1209"></a>      <span class="c">!&lt; Total Pressure Riemann boundary condition</span>
<a name="ln-1210"></a>      <span class="k">implicit none</span>
<a name="ln-1211"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-1212"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">cinf</span><span class="p">,</span> <span class="nb">cexp</span>   <span class="c">! speed of sound</span>
<a name="ln-1213"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Rinf</span><span class="p">,</span> <span class="n">Rexp</span>   <span class="c">! Riemann invarient</span>
<a name="ln-1214"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Uninf</span><span class="p">,</span> <span class="n">Unexp</span> <span class="c">! face normal speed</span>
<a name="ln-1215"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Unb</span> <span class="c">! normal velocity boundary</span>
<a name="ln-1216"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Cb</span>  <span class="c">! speed of sound boundary</span>
<a name="ln-1217"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vel_diff</span>
<a name="ln-1218"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span>
<a name="ln-1219"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">uf</span><span class="p">,</span> <span class="n">vf</span><span class="p">,</span> <span class="n">wf</span>
<a name="ln-1220"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Mb</span>
<a name="ln-1221"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-1222"></a>
<a name="ln-1223"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-1224"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-1225"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1226"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1227"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1228"></a>                <span class="c">! interior cell</span>
<a name="ln-1229"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1230"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1231"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1232"></a>                <span class="c">! ghost cell</span>
<a name="ln-1233"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i-1,j,k)</span>
<a name="ln-1234"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i-1,j,k)</span>
<a name="ln-1235"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i-1,j,k)</span>
<a name="ln-1236"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1237"></a>                <span class="c">!cinf = sqrt(gm*pressure(i-1,j,k)/density(i-1,j,k))</span>
<a name="ln-1238"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1239"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1240"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1241"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1242"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1243"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1244"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1245"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1246"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1247"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1248"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1249"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1250"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1251"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1252"></a>                      <span class="c">!do nothing</span>
<a name="ln-1253"></a>                      <span class="k">continue</span>
<a name="ln-1254"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1255"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1256"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1257"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1258"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1259"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1260"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1261"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1262"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1263"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1264"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1265"></a>                  <span class="k">end select</span>
<a name="ln-1266"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1267"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1268"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1269"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1270"></a>                      <span class="k">continue</span>
<a name="ln-1271"></a><span class="k">                  end select</span>
<a name="ln-1272"></a><span class="k">                else</span>
<a name="ln-1273"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1274"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1275"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1276"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1277"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1278"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1279"></a>                      <span class="c">!do nothing</span>
<a name="ln-1280"></a>                      <span class="k">continue</span>
<a name="ln-1281"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1282"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1283"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1284"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1285"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1286"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1287"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1288"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1289"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1290"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1291"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1292"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1293"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1294"></a>                  <span class="k">end select</span>
<a name="ln-1295"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1296"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1297"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1298"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1299"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1300"></a>                      <span class="k">continue</span>
<a name="ln-1301"></a><span class="k">                  end select</span>
<a name="ln-1302"></a><span class="k">                end if</span>
<a name="ln-1303"></a><span class="k">                </span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Cb</span>
<a name="ln-1304"></a>                <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">fixed_Tpressure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">Mb</span><span class="o">*</span><span class="n">Mb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>
<a name="ln-1305"></a>                <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="p">)</span>
<a name="ln-1306"></a>              <span class="k">end do</span>
<a name="ln-1307"></a><span class="k">            end do</span>
<a name="ln-1308"></a><span class="k">          end do</span>
<a name="ln-1309"></a><span class="k">          </span><span class="n">qp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,:,:,:)</span>
<a name="ln-1310"></a>          <span class="n">qp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="mi">0</span><span class="p">,:,:,:)</span>
<a name="ln-1311"></a>         <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-1312"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1313"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1314"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">imx</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-1315"></a>                <span class="c">! interior cell</span>
<a name="ln-1316"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1317"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1318"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1319"></a>                <span class="c">! ghost cell</span>
<a name="ln-1320"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k)</span>
<a name="ln-1321"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k)</span>
<a name="ln-1322"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k)</span>
<a name="ln-1323"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1324"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k)/density(i,j,k))</span>
<a name="ln-1325"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1326"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1327"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1328"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1329"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1330"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1331"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1332"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1333"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1334"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1335"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1336"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1337"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1338"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1339"></a>                      <span class="c">!do nothing</span>
<a name="ln-1340"></a>                      <span class="k">continue</span>
<a name="ln-1341"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1342"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1343"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1344"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1345"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1346"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1347"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1348"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1349"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1350"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1351"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1352"></a>                  <span class="k">end select</span>
<a name="ln-1353"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1354"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1355"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1356"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1357"></a>                      <span class="k">continue</span>
<a name="ln-1358"></a><span class="k">                  end select</span>
<a name="ln-1359"></a><span class="k">                else</span>
<a name="ln-1360"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1361"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1362"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1363"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1364"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1365"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1366"></a>                      <span class="c">!do nothing</span>
<a name="ln-1367"></a>                      <span class="k">continue</span>
<a name="ln-1368"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1369"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1370"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1371"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1372"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1373"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1374"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1375"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1376"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1377"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1378"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1379"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1380"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1381"></a>                  <span class="k">end select</span>
<a name="ln-1382"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1383"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1384"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1385"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1386"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1387"></a>                      <span class="k">continue</span>
<a name="ln-1388"></a><span class="k">                  end select</span>
<a name="ln-1389"></a><span class="k">                end if</span>
<a name="ln-1390"></a><span class="k">                </span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Cb</span>
<a name="ln-1391"></a>                <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">fixed_Tpressure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">Mb</span><span class="o">*</span><span class="n">Mb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>
<a name="ln-1392"></a>                <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="p">)</span>
<a name="ln-1393"></a>              <span class="k">end do</span>
<a name="ln-1394"></a><span class="k">            end do</span>
<a name="ln-1395"></a><span class="k">          end do</span>
<a name="ln-1396"></a><span class="k">          </span><span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,:,:,:)</span>
<a name="ln-1397"></a>          <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">,:,:,:)</span>
<a name="ln-1398"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-1399"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1400"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1401"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1402"></a>                <span class="c">! interior cell</span>
<a name="ln-1403"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1404"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1405"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1406"></a>                <span class="c">! ghost cell</span>
<a name="ln-1407"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j-1,k)</span>
<a name="ln-1408"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j-1,k)</span>
<a name="ln-1409"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j-1,k)</span>
<a name="ln-1410"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1411"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j-1,k)/density(i,j-1,k))</span>
<a name="ln-1412"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1413"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1414"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1415"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1416"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1417"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1418"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1419"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1420"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1421"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1422"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1423"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1424"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1425"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1426"></a>                      <span class="c">!do nothing</span>
<a name="ln-1427"></a>                      <span class="k">continue</span>
<a name="ln-1428"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1429"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1430"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1431"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1432"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1433"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1434"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1435"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1436"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1437"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1438"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1439"></a>                  <span class="k">end select</span>
<a name="ln-1440"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1441"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1442"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1443"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1444"></a>                      <span class="k">continue</span>
<a name="ln-1445"></a><span class="k">                  end select</span>
<a name="ln-1446"></a><span class="k">                else</span>
<a name="ln-1447"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1448"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1449"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1450"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1451"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1452"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1453"></a>                      <span class="c">!do nothing</span>
<a name="ln-1454"></a>                      <span class="k">continue</span>
<a name="ln-1455"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1456"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1457"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1458"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1459"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1460"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1461"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1462"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1463"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1464"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1465"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1466"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1467"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1468"></a>                  <span class="k">end select</span>
<a name="ln-1469"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1470"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1471"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1472"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1473"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1474"></a>                      <span class="k">continue</span>
<a name="ln-1475"></a><span class="k">                  end select</span>
<a name="ln-1476"></a><span class="k">                end if</span>
<a name="ln-1477"></a><span class="k">                </span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Cb</span>
<a name="ln-1478"></a>                <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">fixed_Tpressure</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">Mb</span><span class="o">*</span><span class="n">Mb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>
<a name="ln-1479"></a>                <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="p">)</span>
<a name="ln-1480"></a>              <span class="k">end do</span>
<a name="ln-1481"></a><span class="k">            end do</span>
<a name="ln-1482"></a><span class="k">          end do</span>
<a name="ln-1483"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,:,:)</span>
<a name="ln-1484"></a>          <span class="n">qp</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="mi">0</span><span class="p">,:,:)</span>
<a name="ln-1485"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-1486"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1487"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jmx</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-1488"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1489"></a>                <span class="c">! interior cell</span>
<a name="ln-1490"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1491"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1492"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1493"></a>                <span class="c">! ghost cell</span>
<a name="ln-1494"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k)</span>
<a name="ln-1495"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k)</span>
<a name="ln-1496"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k)</span>
<a name="ln-1497"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1498"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k)/density(i,j,k))</span>
<a name="ln-1499"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1500"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1501"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1502"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1503"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1504"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1505"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1506"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1507"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1508"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1509"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1510"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1511"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1512"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1513"></a>                      <span class="c">!do nothing</span>
<a name="ln-1514"></a>                      <span class="k">continue</span>
<a name="ln-1515"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1516"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1517"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1518"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1519"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1520"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1521"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1522"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1523"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1524"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1525"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1526"></a>                  <span class="k">end select</span>
<a name="ln-1527"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1528"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1529"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1530"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1531"></a>                      <span class="k">continue</span>
<a name="ln-1532"></a><span class="k">                  end select</span>
<a name="ln-1533"></a><span class="k">                else</span>
<a name="ln-1534"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1535"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1536"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1537"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1538"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1539"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1540"></a>                      <span class="c">!do nothing</span>
<a name="ln-1541"></a>                      <span class="k">continue</span>
<a name="ln-1542"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1543"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1544"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1545"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1546"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1547"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1548"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1549"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1550"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1551"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1552"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1553"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1554"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1555"></a>                  <span class="k">end select</span>
<a name="ln-1556"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1557"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1558"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1559"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1560"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1561"></a>                      <span class="k">continue</span>
<a name="ln-1562"></a><span class="k">                  end select</span>
<a name="ln-1563"></a><span class="k">                end if</span>
<a name="ln-1564"></a><span class="k">                </span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Cb</span>
<a name="ln-1565"></a>                <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">fixed_Tpressure</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">Mb</span><span class="o">*</span><span class="n">Mb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>
<a name="ln-1566"></a>                <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="p">)</span>
<a name="ln-1567"></a>              <span class="k">end do</span>
<a name="ln-1568"></a><span class="k">            end do</span>
<a name="ln-1569"></a><span class="k">          end do</span>
<a name="ln-1570"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,:,:)</span>
<a name="ln-1571"></a>          <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">,:,:)</span>
<a name="ln-1572"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-1573"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1574"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1575"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1576"></a>                <span class="c">! interior cell</span>
<a name="ln-1577"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1578"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1579"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1580"></a>                <span class="c">! ghost cell</span>
<a name="ln-1581"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k-1)</span>
<a name="ln-1582"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k-1)</span>
<a name="ln-1583"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k-1)</span>
<a name="ln-1584"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1585"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k-1)/density(i,j,k-1))</span>
<a name="ln-1586"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1587"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1588"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1589"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1590"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1591"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1592"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1593"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1594"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1595"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1596"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1597"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1598"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1599"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1600"></a>                      <span class="c">!do nothing</span>
<a name="ln-1601"></a>                      <span class="k">continue</span>
<a name="ln-1602"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1603"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1604"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1605"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1606"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1607"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1608"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1609"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1610"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1611"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1612"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1613"></a>                  <span class="k">end select</span>
<a name="ln-1614"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1615"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1616"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1617"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1618"></a>                      <span class="k">continue</span>
<a name="ln-1619"></a><span class="k">                  end select</span>
<a name="ln-1620"></a><span class="k">                else</span>
<a name="ln-1621"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1622"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1623"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1624"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1625"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1626"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1627"></a>                      <span class="c">!do nothing</span>
<a name="ln-1628"></a>                      <span class="k">continue</span>
<a name="ln-1629"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1630"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1631"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1632"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1633"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1634"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1635"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1636"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1637"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1638"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1639"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1640"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1641"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1642"></a>                  <span class="k">end select</span>
<a name="ln-1643"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1644"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1645"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1646"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1647"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1648"></a>                      <span class="k">continue</span>
<a name="ln-1649"></a><span class="k">                  end select</span>
<a name="ln-1650"></a><span class="k">                end if</span>
<a name="ln-1651"></a><span class="k">                </span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Cb</span>
<a name="ln-1652"></a>                <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fixed_Tpressure</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">Mb</span><span class="o">*</span><span class="n">Mb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>
<a name="ln-1653"></a>                <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="p">)</span>
<a name="ln-1654"></a>              <span class="k">end do</span>
<a name="ln-1655"></a><span class="k">            end do</span>
<a name="ln-1656"></a><span class="k">          end do</span>
<a name="ln-1657"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="mi">0</span><span class="p">,:)</span>
<a name="ln-1658"></a>          <span class="n">qp</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="mi">0</span><span class="p">,:)</span>
<a name="ln-1659"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-1660"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kmx</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-1661"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1662"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1663"></a>                <span class="c">! interior cell</span>
<a name="ln-1664"></a>                <span class="n">u</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1665"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1666"></a>                <span class="n">w</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1667"></a>                <span class="c">! ghost cell</span>
<a name="ln-1668"></a>                <span class="n">uf</span> <span class="o">=</span> <span class="n">x_speed_inf</span><span class="c">!x_speed(i,j,k)</span>
<a name="ln-1669"></a>                <span class="n">vf</span> <span class="o">=</span> <span class="n">y_speed_inf</span><span class="c">!y_speed(i,j,k)</span>
<a name="ln-1670"></a>                <span class="n">wf</span> <span class="o">=</span> <span class="n">z_speed_inf</span><span class="c">!z_speed(i,j,k)</span>
<a name="ln-1671"></a>                <span class="nb">cexp</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1672"></a>                <span class="c">!cinf = sqrt(gm*pressure(i,j,k)/density(i,j,k))</span>
<a name="ln-1673"></a>                <span class="n">cinf</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure_inf</span><span class="o">/</span><span class="n">density_inf</span><span class="p">)</span>
<a name="ln-1674"></a>                <span class="n">Unexp</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1675"></a>                <span class="n">Uninf</span> <span class="o">=</span> <span class="n">uf</span><span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">vf</span><span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="n">wf</span><span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1676"></a>                <span class="n">Rinf</span>  <span class="o">=</span> <span class="n">Uninf</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">cinf</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1677"></a>                <span class="n">Rexp</span>  <span class="o">=</span> <span class="n">Unexp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nb">cexp</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1678"></a>                <span class="n">Unb</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">+</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1679"></a>                <span class="n">Cb</span>    <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rexp</span> <span class="o">-</span> <span class="n">Rinf</span><span class="p">)</span>
<a name="ln-1680"></a>                <span class="k">if</span><span class="p">(</span><span class="n">Unb</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1681"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Unexp</span>
<a name="ln-1682"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1683"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1684"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1685"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1686"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1687"></a>                      <span class="c">!do nothing</span>
<a name="ln-1688"></a>                      <span class="k">continue</span>
<a name="ln-1689"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1690"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1691"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1692"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1693"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1694"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1695"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1696"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1697"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1698"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1699"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1700"></a>                  <span class="k">end select</span>
<a name="ln-1701"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1702"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1703"></a>                      <span class="k">call </span><span class="n">copy3</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1704"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1705"></a>                      <span class="k">continue</span>
<a name="ln-1706"></a><span class="k">                  end select</span>
<a name="ln-1707"></a><span class="k">                else</span>
<a name="ln-1708"></a><span class="k">                  </span><span class="n">vel_diff</span> <span class="o">=</span> <span class="n">Unb</span> <span class="o">-</span> <span class="n">Uninf</span>
<a name="ln-1709"></a>                  <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">x_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1710"></a>                  <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">y_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1711"></a>                  <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">z_speed_inf</span> <span class="o">+</span> <span class="n">vel_diff</span><span class="o">*</span><span class="p">(</span><span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1712"></a>                  <span class="k">select case</span> <span class="p">(</span><span class="n">turbulence</span><span class="p">)</span>
<a name="ln-1713"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-1714"></a>                      <span class="c">!do nothing</span>
<a name="ln-1715"></a>                      <span class="k">continue</span>
<a name="ln-1716"></a><span class="k">                    case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-1717"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">fixed_tv</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1718"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-1719"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span>
<a name="ln-1720"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1721"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tw</span><span class="p">,</span> <span class="n">fixed_tw</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1722"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-1723"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;kkl&quot;</span><span class="p">)</span>
<a name="ln-1724"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tk</span><span class="p">,</span> <span class="n">fixed_tk</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1725"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tkl</span><span class="p">,</span> <span class="n">fixed_tkl</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1726"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1727"></a>                      <span class="c">!call turbulence_read_error()</span>
<a name="ln-1728"></a>                      <span class="n">Fatal_error</span>
<a name="ln-1729"></a>                  <span class="k">end select</span>
<a name="ln-1730"></a><span class="k">                  select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-1731"></a>                    <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-1732"></a>                      <span class="k">call </span><span class="n">check_if_value_fixed</span><span class="p">(</span><span class="s2">&quot;lctm2015&quot;</span><span class="p">)</span>
<a name="ln-1733"></a>                      <span class="k">call </span><span class="n">fix</span><span class="p">(</span><span class="n">tgm</span><span class="p">,</span> <span class="n">fixed_tgm</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1734"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1735"></a>                      <span class="k">continue</span>
<a name="ln-1736"></a><span class="k">                  end select</span>
<a name="ln-1737"></a><span class="k">                end if</span>
<a name="ln-1738"></a><span class="k">                </span><span class="n">Mb</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Cb</span>
<a name="ln-1739"></a>                <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">fixed_Tpressure</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">Mb</span><span class="o">*</span><span class="n">Mb</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">gm</span><span class="o">/</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span>
<a name="ln-1740"></a>                <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Cb</span><span class="o">*</span><span class="n">Cb</span><span class="p">)</span>
<a name="ln-1741"></a>              <span class="k">end do</span>
<a name="ln-1742"></a><span class="k">            end do</span>
<a name="ln-1743"></a><span class="k">          end do</span>
<a name="ln-1744"></a><span class="k">          </span><span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="p">,:)</span>
<a name="ln-1745"></a>          <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="p">,:)</span>
<a name="ln-1746"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-1747"></a>          <span class="c">!print*, &quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-1748"></a>          <span class="n">Fatal_error</span>
<a name="ln-1749"></a>      <span class="k">end select</span>
<a name="ln-1750"></a>
<a name="ln-1751"></a><span class="k">    end subroutine </span><span class="n">total_pressure</span>
<a name="ln-1752"></a>
<a name="ln-1753"></a>    <span class="k">subroutine </span><span class="n">temp_based_density</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span>
<a name="ln-1754"></a>      <span class="c">!&lt; Specify the density in the ghost cell based on the</span>
<a name="ln-1755"></a>      <span class="c">!&lt; temperature on the wall. Isothermal or adiabatic</span>
<a name="ln-1756"></a>      <span class="k">implicit none</span>
<a name="ln-1757"></a><span class="k">      </span><span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>     <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">temperature</span>
<a name="ln-1758"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>         <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">face</span>
<a name="ln-1759"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">stag_temp</span>
<a name="ln-1760"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-1761"></a>
<a name="ln-1762"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-1763"></a>        <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-1764"></a>          <span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1765"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1766"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1767"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1768"></a>                  <span class="n">stag_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1769"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1770"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1771"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1772"></a>                <span class="k">end do</span>
<a name="ln-1773"></a><span class="k">              end do</span>
<a name="ln-1774"></a><span class="k">            end do</span>
<a name="ln-1775"></a><span class="k">          </span><span class="n">elseif</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1776"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1777"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1778"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1779"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1780"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1781"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1782"></a>                <span class="k">end do</span>
<a name="ln-1783"></a><span class="k">              end do</span>
<a name="ln-1784"></a><span class="k">            end do</span>
<a name="ln-1785"></a><span class="k">          else</span>
<a name="ln-1786"></a><span class="k">            call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-1787"></a>          <span class="k">end if</span>
<a name="ln-1788"></a><span class="k">         case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-1789"></a>          <span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1790"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1791"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1792"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1793"></a>                  <span class="n">stag_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1794"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1795"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1796"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1797"></a>                <span class="k">end do</span>
<a name="ln-1798"></a><span class="k">              end do</span>
<a name="ln-1799"></a><span class="k">            end do</span>
<a name="ln-1800"></a><span class="k">          </span><span class="n">elseif</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1801"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1802"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1803"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1804"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1805"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1806"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1807"></a>                <span class="k">end do</span>
<a name="ln-1808"></a><span class="k">              end do</span>
<a name="ln-1809"></a><span class="k">            end do</span>
<a name="ln-1810"></a><span class="k">          else</span>
<a name="ln-1811"></a><span class="k">            call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-1812"></a>          <span class="k">end if</span>
<a name="ln-1813"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-1814"></a>          <span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1815"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1816"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1817"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1818"></a>                  <span class="n">stag_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1819"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1820"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1821"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1822"></a>                <span class="k">end do</span>
<a name="ln-1823"></a><span class="k">              end do</span>
<a name="ln-1824"></a><span class="k">            end do</span>
<a name="ln-1825"></a><span class="k">          </span><span class="n">elseif</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1826"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1827"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1828"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1829"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1830"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1831"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1832"></a>                <span class="k">end do</span>
<a name="ln-1833"></a><span class="k">              end do</span>
<a name="ln-1834"></a><span class="k">            end do</span>
<a name="ln-1835"></a><span class="k">          else</span>
<a name="ln-1836"></a><span class="k">            call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-1837"></a>          <span class="k">end if</span>
<a name="ln-1838"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-1839"></a>          <span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1840"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1841"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1842"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1843"></a>                  <span class="n">stag_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1844"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1845"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1846"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1847"></a>                <span class="k">end do</span>
<a name="ln-1848"></a><span class="k">              end do</span>
<a name="ln-1849"></a><span class="k">            end do</span>
<a name="ln-1850"></a><span class="k">          </span><span class="n">elseif</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1851"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1852"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1853"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1854"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1855"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1856"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="p">)))))</span>
<a name="ln-1857"></a>                <span class="k">end do</span>
<a name="ln-1858"></a><span class="k">              end do</span>
<a name="ln-1859"></a><span class="k">            end do</span>
<a name="ln-1860"></a><span class="k">          else</span>
<a name="ln-1861"></a><span class="k">            call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-1862"></a>          <span class="k">end if</span>
<a name="ln-1863"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-1864"></a>          <span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1865"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1866"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1867"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1868"></a>                  <span class="n">stag_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1869"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1870"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1871"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1872"></a>                <span class="k">end do</span>
<a name="ln-1873"></a><span class="k">              end do</span>
<a name="ln-1874"></a><span class="k">            end do</span>
<a name="ln-1875"></a><span class="k">          </span><span class="n">elseif</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1876"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<a name="ln-1877"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1878"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1879"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">0</span><span class="p">)))))</span>
<a name="ln-1880"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)))))</span>
<a name="ln-1881"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)))))</span>
<a name="ln-1882"></a>                <span class="k">end do</span>
<a name="ln-1883"></a><span class="k">              end do</span>
<a name="ln-1884"></a><span class="k">            end do</span>
<a name="ln-1885"></a><span class="k">          else</span>
<a name="ln-1886"></a><span class="k">            call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-1887"></a>          <span class="k">end if</span>
<a name="ln-1888"></a><span class="k">        case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-1889"></a>          <span class="k">if</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1890"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1891"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1892"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1893"></a>                  <span class="n">stag_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gm</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">gm</span><span class="o">*</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-1894"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1895"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1896"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">stag_temp</span><span class="p">)</span>
<a name="ln-1897"></a>                <span class="k">end do</span>
<a name="ln-1898"></a><span class="k">              end do</span>
<a name="ln-1899"></a><span class="k">            end do</span>
<a name="ln-1900"></a><span class="k">          </span><span class="n">elseif</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1901"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1902"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1903"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1904"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">0</span><span class="p">)))))</span>
<a name="ln-1905"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)))))</span>
<a name="ln-1906"></a>                  <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">temperature</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R_gas</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)))))</span>
<a name="ln-1907"></a>                <span class="k">end do</span>
<a name="ln-1908"></a><span class="k">              end do</span>
<a name="ln-1909"></a><span class="k">            end do</span>
<a name="ln-1910"></a><span class="k">          else</span>
<a name="ln-1911"></a><span class="k">            call </span><span class="n">copy3</span><span class="p">(</span><span class="n">density</span> <span class="p">,</span> <span class="s2">&quot;symm&quot;</span><span class="p">,</span>  <span class="n">face</span><span class="p">)</span>
<a name="ln-1912"></a>          <span class="k">end if</span>
<a name="ln-1913"></a><span class="k">        case </span><span class="n">DEFAULT</span>
<a name="ln-1914"></a>          <span class="c">!print*, &quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-1915"></a>          <span class="n">Fatal_error</span>
<a name="ln-1916"></a>      <span class="k">end select</span>
<a name="ln-1917"></a>
<a name="ln-1918"></a><span class="k">    end subroutine </span><span class="n">temp_based_density</span>
<a name="ln-1919"></a>
<a name="ln-1920"></a>
<a name="ln-1921"></a>    <span class="k">subroutine </span><span class="n">periodic_bc</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a name="ln-1922"></a>      <span class="c">!&lt; Single block periodic boundary condition.</span>
<a name="ln-1923"></a>      <span class="c">!&lt; Not to be used for multiblock boundary condition</span>
<a name="ln-1924"></a>      <span class="k">implicit none</span>
<a name="ln-1925"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">face</span>
<a name="ln-1926"></a>
<a name="ln-1927"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">face</span><span class="p">))</span>
<a name="ln-1928"></a>
<a name="ln-1929"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;imin&#39;</span><span class="p">)</span>
<a name="ln-1930"></a>          <span class="n">qp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span>
<a name="ln-1931"></a>
<a name="ln-1932"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;imax&#39;</span><span class="p">)</span>
<a name="ln-1933"></a>          <span class="n">qp</span><span class="p">(</span><span class="n">imx</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:,:,:)</span>
<a name="ln-1934"></a>
<a name="ln-1935"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;jmin&#39;</span><span class="p">)</span>
<a name="ln-1936"></a>          <span class="n">qp</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,:,:)</span> <span class="o">=</span>   <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span>
<a name="ln-1937"></a>
<a name="ln-1938"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;jmax&#39;</span><span class="p">)</span>
<a name="ln-1939"></a>          <span class="n">qp</span><span class="p">(:,</span><span class="n">jmx</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:,:)</span>
<a name="ln-1940"></a>
<a name="ln-1941"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kmin&#39;</span><span class="p">)</span>
<a name="ln-1942"></a>          <span class="n">qp</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-1943"></a>
<a name="ln-1944"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kmax&#39;</span><span class="p">)</span>
<a name="ln-1945"></a>          <span class="n">qp</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:)</span>
<a name="ln-1946"></a>
<a name="ln-1947"></a>        <span class="k">case </span><span class="n">Default</span>
<a name="ln-1948"></a>          <span class="n">Fatal_error</span>
<a name="ln-1949"></a>
<a name="ln-1950"></a>      <span class="k">end select</span>
<a name="ln-1951"></a>
<a name="ln-1952"></a><span class="k">    end subroutine </span><span class="n">periodic_bc</span>
<a name="ln-1953"></a><span class="k">end module </span><span class="n">bc_primitive</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-09-25T21:24:49.588962 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>