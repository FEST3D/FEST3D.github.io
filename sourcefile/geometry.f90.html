<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>geometry.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>geometry.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.7% of total for source files.">333 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/geometry.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">geometry.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/geometry.html">geometry</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/geometry.f90.html#src">geometry.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>The geometry module contains various geometrical quantities like 
 normals, areas and volumes to be used in computations. </p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~geometry.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilegeometryf90EfferentGraph" width="390pt" height="52pt"
 viewBox="0.00 0.00 390.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~geometry.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~geometry.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 386,-48 386,4 -4,4"/>
<!-- sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~geometry.f90</title>
<polygon fill="none" stroke="#000000" points="382,-24 306,-24 306,0 382,0 382,-24"/>
<text text-anchor="middle" x="344" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">geometry.f90</text>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~geometry.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="270,-44 216,-44 216,-20 270,-20 270,-44"/>
<text text-anchor="middle" x="243" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~geometry.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~geometry.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M305.8162,-19.5611C297.3968,-21.2284 288.4908,-22.9919 280.1145,-24.6506"/>
<polygon fill="#ff0000" stroke="#ff0000" points="279.3577,-21.2324 270.2281,-26.6083 280.7175,-28.0991 279.3577,-21.2324"/>
</g>
<!-- sourcefile~global_vars.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~global_vars.f90</title>
<g id="a_sourcefile~~geometry.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/global_vars.f90.html" xlink:title="global_vars.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="180,-24 95,-24 95,0 180,0 180,-24"/>
<text text-anchor="middle" x="137.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_vars.f90</text>
</a>
</g>
</g>
<!-- sourcefile~geometry.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~geometry.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M305.9749,-11.3877C294.4219,-11.2282 281.6918,-11.079 270,-11 246.0005,-10.8378 239.9995,-10.8471 216,-11 207.7639,-11.0525 199.0419,-11.1359 190.5225,-11.2327"/>
<polygon fill="#ff0000" stroke="#ff0000" points="190.2344,-7.7358 180.2774,-11.3563 190.3189,-14.7353 190.2344,-7.7358"/>
</g>
<!-- sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M215.8311,-26.8495C207.9353,-25.3527 199.0306,-23.6646 190.1303,-21.9773"/>
<polygon fill="#ff0000" stroke="#ff0000" points="190.6146,-18.5069 180.1377,-20.083 189.3107,-25.3844 190.6146,-18.5069"/>
</g>
<!-- sourcefile~global.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~global.f90</title>
<g id="a_sourcefile~~geometry.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/global.f90.html" xlink:title="global.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="59,-24 0,-24 0,0 59,0 59,-24"/>
<text text-anchor="middle" x="29.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global.f90</text>
</a>
</g>
</g>
<!-- sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M94.8155,-12C86.4413,-12 77.6869,-12 69.4077,-12"/>
<polygon fill="#00ffff" stroke="#00ffff" points="69.2393,-8.5001 59.2392,-12 69.2392,-15.5001 69.2393,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~geometry.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilegeometryf90AfferentGraph" width="641pt" height="266pt"
 viewBox="0.00 0.00 641.00 265.62" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~geometry.f90~~AfferentGraph" class="graph" transform="scale(.9877 .9877) rotate(0) translate(4 264.933)">
<title>sourcefile~~geometry.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-264.933 645,-264.933 645,4 -4,4"/>
<!-- sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~geometry.f90</title>
<polygon fill="none" stroke="#000000" points="76,-134 0,-134 0,-110 76,-110 76,-134"/>
<text text-anchor="middle" x="38" y="-119.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">geometry.f90</text>
</g>
<!-- sourcefile~time.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~time.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/time.f90.html" xlink:title="time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="175,-54 121,-54 121,-30 175,-30 175,-54"/>
<text text-anchor="middle" x="148" y="-39.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M131.1382,-54.152C125.0968,-58.5127 118.2389,-63.4708 112,-68 95.5864,-79.9157 77.1616,-93.3607 62.8027,-103.8541"/>
<polygon fill="#ff0000" stroke="#ff0000" points="60.4493,-101.239 54.4421,-109.9662 64.5805,-106.8899 60.4493,-101.239"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="311,-134 247,-134 247,-110 311,-110 311,-134"/>
<text text-anchor="middle" x="279" y="-119.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M246.7544,-113.0414C228.5013,-108.4339 205.1571,-103.3105 184,-101 152.1891,-97.526 143.6946,-96.5899 112,-101 102.3794,-102.3387 92.252,-104.6118 82.6825,-107.1804"/>
<polygon fill="#ff0000" stroke="#ff0000" points="81.623,-103.8428 72.9565,-109.9373 83.532,-110.5775 81.623,-103.8428"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M259.1039,-109.8497C237.0474,-96.3801 201.2943,-74.5461 176.3215,-59.2956"/>
<polygon fill="#ff0000" stroke="#ff0000" points="178.0127,-56.2274 167.6541,-54.0025 174.3644,-62.2015 178.0127,-56.2274"/>
</g>
<!-- sourcefile~plusgs.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~plusgs.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/plusgs.f90.html" xlink:title="plusgs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="178.5,-176 117.5,-176 117.5,-152 178.5,-152 178.5,-176"/>
<text text-anchor="middle" x="148" y="-161.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">plusgs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~plusgs.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~plusgs.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M246.9538,-132.2744C229.361,-137.9148 207.3668,-144.9664 188.5846,-150.9881"/>
<polygon fill="#00ff91" stroke="#00ff91" points="187.2672,-147.7349 178.8133,-154.1209 189.4044,-154.4007 187.2672,-147.7349"/>
</g>
<!-- sourcefile~viscous2.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~viscous2.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/viscous2.f90.html" xlink:title="viscous2.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="184,-218 112,-218 112,-194 184,-194 184,-218"/>
<text text-anchor="middle" x="148" y="-203.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">viscous2.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~viscous2.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~viscous2.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M261.3391,-134.1524C242.4109,-147.0727 211.385,-167.952 184,-185 182.0536,-186.2117 180.0374,-187.4452 177.9986,-188.6765"/>
<polygon fill="#0091ff" stroke="#0091ff" points="175.8706,-185.8697 169.0613,-193.9866 179.4462,-191.8876 175.8706,-185.8697"/>
</g>
<!-- sourcefile~lusgs.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~lusgs.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/lusgs.f90.html" xlink:title="lusgs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="175.5,-134 120.5,-134 120.5,-110 175.5,-110 175.5,-134"/>
<text text-anchor="middle" x="148" y="-119.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">lusgs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~lusgs.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~lusgs.f90</title>
<path fill="none" stroke="#ff00da" stroke-dasharray="5,2" d="M246.9538,-122C228.4621,-122 205.1077,-122 185.7318,-122"/>
<polygon fill="#ff00da" stroke="#ff00da" points="185.7217,-118.5001 175.7217,-122 185.7216,-125.5001 185.7217,-118.5001"/>
</g>
<!-- sourcefile~create_and_erase.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~create_and_erase.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/create_and_erase.f90.html" xlink:title="create_and_erase.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="338,-24 220,-24 220,0 338,0 338,-24"/>
<text text-anchor="middle" x="279" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">create_and_erase.f90</text>
</a>
</g>
</g>
<!-- sourcefile~create_and_erase.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~create_and_erase.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M219.6188,-3.2054C186.1075,-1.0754 144.5559,-3.3767 112,-21 79.8846,-38.3849 58.0515,-76.4492 46.8362,-100.5641"/>
<polygon fill="#ff0000" stroke="#ff0000" points="43.5312,-99.3834 42.6806,-109.9441 49.9312,-102.2188 43.5312,-99.3834"/>
</g>
<!-- sourcefile~create_and_erase.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~create_and_erase.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M226.4721,-24.0293C212.655,-27.1935 198.0356,-30.5415 185.2083,-33.479"/>
<polygon fill="#ff0000" stroke="#ff0000" points="184.3211,-30.0915 175.3547,-35.7356 185.8837,-36.9149 184.3211,-30.0915"/>
</g>
<!-- sourcefile~plusgs.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~plusgs.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M117.3589,-152.3007C105.505,-147.7746 91.7592,-142.5263 79.072,-137.682"/>
<polygon fill="#ff0000" stroke="#ff0000" points="80.2159,-134.3724 69.6252,-134.0751 77.7189,-140.9119 80.2159,-134.3724"/>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M125.9085,-193.945C121.219,-191.1577 116.3681,-188.0966 112,-185 92.837,-171.4153 72.6316,-153.9741 58.1848,-140.8885"/>
<polygon fill="#ff0000" stroke="#ff0000" points="60.5326,-138.2927 50.7945,-134.119 55.8044,-143.4545 60.5326,-138.2927"/>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="433,-134 374,-134 374,-110 433,-110 433,-134"/>
<text text-anchor="middle" x="403.5" y="-119.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M279,-246C207.9963,-269.2105 176.2598,-265.091 112,-227 79.6265,-207.8101 57.7786,-168.295 46.6466,-143.589"/>
<polygon fill="#ff0000" stroke="#ff0000" points="49.8229,-142.1155 42.6562,-134.3124 43.3926,-144.8816 49.8229,-142.1155"/>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M373.8467,-112.4294C362.6239,-108.8239 349.7298,-104.7015 338,-101 284.7833,-84.2069 223.0617,-65.1109 184.7659,-53.3074"/>
<polygon fill="#ff0000" stroke="#ff0000" points="185.6706,-49.9238 175.0833,-50.3246 183.6097,-56.6136 185.6706,-49.9238"/>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M373.9952,-122C358.3937,-122 338.9559,-122 321.7349,-122"/>
<polygon fill="#ffda00" stroke="#ffda00" points="321.353,-118.5001 311.3529,-122 321.3529,-125.5001 321.353,-118.5001"/>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~viscous2.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~viscous2.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M396.7999,-134.0731C380.7939,-161.3712 337.2827,-226.9478 279,-246"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M279,-246C242.8084,-257.8307 200.6412,-239.2132 174.1323,-223.6082"/>
<polygon fill="#0091ff" stroke="#0091ff" points="175.7965,-220.5229 165.4442,-218.2689 172.1314,-226.4867 175.7965,-220.5229"/>
</g>
<!-- sourcefile~lusgs.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~lusgs.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M120.2424,-122C109.9049,-122 97.8497,-122 86.2069,-122"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.1351,-118.5001 76.135,-122 86.135,-125.5001 86.1351,-118.5001"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="641,-134 587,-134 587,-110 641,-110 641,-134"/>
<text text-anchor="middle" x="614" y="-119.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M586.7124,-122.5275C575.6304,-122.7172 562.7042,-122.9071 551,-123 514.5567,-123.2892 505.4434,-123.2782 469,-123 460.6723,-122.9364 451.7495,-122.8274 443.2535,-122.7041"/>
<polygon fill="#4800ff" stroke="#4800ff" points="443.2233,-119.2034 433.1706,-122.5488 443.1154,-126.2025 443.2233,-119.2034"/>
</g>
<!-- sourcefile~start_finish.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~start_finish.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/start_finish.f90.html" xlink:title="start_finish.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="551,-114 469,-114 469,-90 551,-90 551,-114"/>
<text text-anchor="middle" x="510" y="-99.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_finish.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M586.9467,-116.7974C578.9882,-115.267 570.0079,-113.54 561.0646,-111.8201"/>
<polygon fill="#00ffff" stroke="#00ffff" points="561.5205,-108.3437 551.0394,-109.8922 560.1985,-115.2178 561.5205,-108.3437"/>
</g>
<!-- sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M468.8243,-109.7325C460.3352,-111.3267 451.4138,-113.0021 442.9863,-114.5847"/>
<polygon fill="#4800ff" stroke="#4800ff" points="442.1959,-111.1719 433.0137,-116.4575 443.4879,-118.0516 442.1959,-111.1719"/>
</g>
</g>
</svg>
</div><script>var pansourcefilegeometryf90AfferentGraph = svgPanZoom('#sourcefilegeometryf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/geometry.html">geometry</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/geometry.f90.html#src">geometry.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>    <span class="c">!&lt; The geometry module contains various geometrical quantities like </span>
<a name="ln-2"></a>    <span class="c">!&lt; normals, areas and volumes to be used in computations. </span>
<a name="ln-3"></a><span class="k">module </span><span class="n">geometry</span>
<a name="ln-4"></a>    <span class="c">!&lt; The geometry module contains various geometrical quantities like </span>
<a name="ln-5"></a>    <span class="c">!&lt; normals, areas and volumes to be used in computations. </span>
<a name="ln-6"></a>    <span class="c">!-------------------------------------------------------------------</span>
<a name="ln-7"></a><span class="cp">#include &quot;error.inc&quot;</span>
<a name="ln-8"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">imx</span>
<a name="ln-9"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">jmx</span>
<a name="ln-10"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kmx</span>
<a name="ln-11"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">grid_x</span>
<a name="ln-12"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">grid_y</span>
<a name="ln-13"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">grid_z</span>
<a name="ln-14"></a>
<a name="ln-15"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xn</span>           <span class="c">!face unit norm x</span>
<a name="ln-16"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">yn</span>           <span class="c">!face unit norm y</span>
<a name="ln-17"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">zn</span>           <span class="c">!face unit norm z</span>
<a name="ln-18"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xnx</span><span class="p">,</span> <span class="n">xny</span><span class="p">,</span> <span class="n">xnz</span> <span class="c">!face unit normal x</span>
<a name="ln-19"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ynx</span><span class="p">,</span> <span class="n">yny</span><span class="p">,</span> <span class="n">ynz</span> <span class="c">!face unit normal y</span>
<a name="ln-20"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">znx</span><span class="p">,</span> <span class="n">zny</span><span class="p">,</span> <span class="n">znz</span> <span class="c">!face unit normal z</span>
<a name="ln-21"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xA</span><span class="p">,</span> <span class="n">yA</span><span class="p">,</span> <span class="n">zA</span>    <span class="c">!face area</span>
<a name="ln-22"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">volume</span>
<a name="ln-23"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span>   <span class="n">left_ghost_centroid</span>
<a name="ln-24"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span>  <span class="n">right_ghost_centroid</span>
<a name="ln-25"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span>  <span class="n">front_ghost_centroid</span>
<a name="ln-26"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span>   <span class="n">back_ghost_centroid</span>
<a name="ln-27"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span>    <span class="n">top_ghost_centroid</span>
<a name="ln-28"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">bottom_ghost_centroid</span>
<a name="ln-29"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">imin_id</span>
<a name="ln-30"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">imax_id</span>
<a name="ln-31"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">jmin_id</span>
<a name="ln-32"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">jmax_id</span>
<a name="ln-33"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kmin_id</span>
<a name="ln-34"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kmax_id</span>
<a name="ln-35"></a>    <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">process_id</span>
<a name="ln-36"></a>    
<a name="ln-37"></a>    <span class="k">use </span><span class="n">utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">alloc</span><span class="p">,</span> <span class="n">dealloc</span><span class="p">,</span> <span class="n">dmsg</span>
<a name="ln-38"></a>
<a name="ln-39"></a>    <span class="k">implicit none</span>
<a name="ln-40"></a><span class="k">    private</span>
<a name="ln-41"></a>
<a name="ln-42"></a><span class="k">    </span><span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">public</span><span class="kd">::</span> <span class="n">CellCenter</span>
<a name="ln-43"></a>    <span class="c">!&lt; Store Cell-center location </span>
<a name="ln-44"></a>
<a name="ln-45"></a>    <span class="c">! Public methods</span>
<a name="ln-46"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">setup_geometry</span>
<a name="ln-47"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">destroy_geometry</span>
<a name="ln-48"></a>
<a name="ln-49"></a>    <span class="k">contains</span>
<a name="ln-50"></a>
<a name="ln-51"></a><span class="k">        subroutine </span><span class="n">allocate_memory_volumes</span><span class="p">()</span>
<a name="ln-52"></a>            <span class="c">!&lt; Allocate memory for the volume variables.</span>
<a name="ln-53"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-54"></a>            
<a name="ln-55"></a>            <span class="k">implicit none</span>
<a name="ln-56"></a>
<a name="ln-57"></a><span class="k">            call </span><span class="n">alloc</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-58"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for volume.&#39;</span><span class="p">)</span>
<a name="ln-59"></a>
<a name="ln-60"></a>        <span class="k">end subroutine </span><span class="n">allocate_memory_volumes</span>
<a name="ln-61"></a>
<a name="ln-62"></a>        <span class="k">subroutine </span><span class="n">allocate_memory_areas</span><span class="p">()</span>
<a name="ln-63"></a>            <span class="c">!&lt; Allocate memory for the area variables.</span>
<a name="ln-64"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-65"></a>            
<a name="ln-66"></a>            <span class="k">implicit none</span>
<a name="ln-67"></a>
<a name="ln-68"></a><span class="k">            call </span><span class="n">alloc</span><span class="p">(</span><span class="n">xA</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-69"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for xA.&#39;</span><span class="p">)</span>
<a name="ln-70"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">yA</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-71"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for yA.&#39;</span><span class="p">)</span>
<a name="ln-72"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">zA</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-73"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for yA.&#39;</span><span class="p">)</span>
<a name="ln-74"></a>
<a name="ln-75"></a>        <span class="k">end subroutine </span><span class="n">allocate_memory_areas</span>
<a name="ln-76"></a>
<a name="ln-77"></a>        <span class="k">subroutine </span><span class="n">allocate_memory_normals</span><span class="p">()</span>
<a name="ln-78"></a>            <span class="c">!&lt; Allocate memory for the normal variables.</span>
<a name="ln-79"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-80"></a>                        
<a name="ln-81"></a>            <span class="k">implicit none</span>
<a name="ln-82"></a>
<a name="ln-83"></a><span class="k">            call </span><span class="n">alloc</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-84"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for xnx.&#39;</span><span class="p">)</span>
<a name="ln-85"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">yn</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-86"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for ynx.&#39;</span><span class="p">)</span>
<a name="ln-87"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">zn</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-88"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for ynx.&#39;</span><span class="p">)</span>
<a name="ln-89"></a>
<a name="ln-90"></a>            <span class="n">xnx</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">xn</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-91"></a>            <span class="n">xny</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">xn</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-92"></a>            <span class="n">xnz</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">xn</span><span class="p">(:,:,:,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-93"></a>
<a name="ln-94"></a>            <span class="n">ynx</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">yn</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-95"></a>            <span class="n">yny</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">yn</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-96"></a>            <span class="n">ynz</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">yn</span><span class="p">(:,:,:,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-97"></a>
<a name="ln-98"></a>            <span class="n">znx</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">zn</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-99"></a>            <span class="n">zny</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">zn</span><span class="p">(:,:,:,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-100"></a>            <span class="n">znz</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">zn</span><span class="p">(:,:,:,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-101"></a>
<a name="ln-102"></a>        <span class="k">end subroutine </span><span class="n">allocate_memory_normals</span>
<a name="ln-103"></a>
<a name="ln-104"></a>        <span class="k">subroutine </span><span class="n">allocate_memory_ghost_centroids</span><span class="p">()</span>
<a name="ln-105"></a>            <span class="c">!&lt; Allocate memory for centroids of ghost cells</span>
<a name="ln-106"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-107"></a>            
<a name="ln-108"></a>            <span class="k">implicit none</span>
<a name="ln-109"></a>
<a name="ln-110"></a><span class="k">            call </span><span class="n">alloc</span><span class="p">(</span><span class="n">CellCenter</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-111"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for volume.&#39;</span><span class="p">)</span>
<a name="ln-112"></a>
<a name="ln-113"></a><span class="c">!</span>
<a name="ln-114"></a><span class="c">!            call alloc(left_ghost_centroid, 1, jmx-1, 1, kmx-1, 1, 3, &amp;</span>
<a name="ln-115"></a><span class="c">!                    errmsg=&#39;Error: Unable to allocate memory for left_ghost_centroid&#39;)</span>
<a name="ln-116"></a><span class="c">!            call alloc(right_ghost_centroid, 1, jmx-1, 1, kmx-1, 1, 3, &amp;</span>
<a name="ln-117"></a><span class="c">!                    errmsg=&#39;Error: Unable to allocate memory for right_ghost_centroid&#39;)</span>
<a name="ln-118"></a><span class="c">!            call alloc(front_ghost_centroid, 1, imx-1, 1, kmx-1, 1, 3, &amp;</span>
<a name="ln-119"></a><span class="c">!                    errmsg=&#39;Error: Unable to allocate memory for front_ghost_centroid&#39;)</span>
<a name="ln-120"></a><span class="c">!            call alloc(back_ghost_centroid, 1, imx-1, 1, kmx-1, 1, 3, &amp;</span>
<a name="ln-121"></a><span class="c">!                    errmsg=&#39;Error: Unable to allocate memory for back_ghost_centroid&#39;)</span>
<a name="ln-122"></a><span class="c">!            call alloc(top_ghost_centroid, 1, imx-1, 1, jmx-1, 1, 3, &amp;</span>
<a name="ln-123"></a><span class="c">!                    errmsg=&#39;Error: Unable to allocate memory for top_ghost_centroid&#39;)</span>
<a name="ln-124"></a><span class="c">!            call alloc(bottom_ghost_centroid, 1, imx-1, 1, jmx-1, 1, 3, &amp;</span>
<a name="ln-125"></a><span class="c">!                    errmsg=&#39;Error: Unable to allocate memory for bottom_ghost_centroid&#39;)</span>
<a name="ln-126"></a>
<a name="ln-127"></a>        <span class="k">end subroutine </span><span class="n">allocate_memory_ghost_centroids</span>
<a name="ln-128"></a>
<a name="ln-129"></a>        <span class="k">subroutine </span><span class="n">allocate_memory</span><span class="p">()</span>
<a name="ln-130"></a>            <span class="c">!&lt; Allocate memory for the required variables.</span>
<a name="ln-131"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-132"></a>            
<a name="ln-133"></a>            <span class="k">implicit none</span>
<a name="ln-134"></a>
<a name="ln-135"></a><span class="k">            call </span><span class="n">dmsg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate_memory&#39;</span><span class="p">)</span>
<a name="ln-136"></a>
<a name="ln-137"></a>            <span class="k">call </span><span class="n">allocate_memory_normals</span><span class="p">()</span>
<a name="ln-138"></a>            <span class="k">call </span><span class="n">allocate_memory_areas</span><span class="p">()</span>
<a name="ln-139"></a>            <span class="k">call </span><span class="n">allocate_memory_volumes</span><span class="p">()</span>
<a name="ln-140"></a>            <span class="k">call </span><span class="n">allocate_memory_ghost_centroids</span><span class="p">()</span>
<a name="ln-141"></a>
<a name="ln-142"></a>        <span class="k">end subroutine </span><span class="n">allocate_memory</span>
<a name="ln-143"></a>
<a name="ln-144"></a>        <span class="k">subroutine </span><span class="n">deallocate_memory</span><span class="p">()</span>
<a name="ln-145"></a>          <span class="c">!&lt; Deallocate the memoery used by the geometry variables</span>
<a name="ln-146"></a>
<a name="ln-147"></a>            <span class="k">implicit none</span>
<a name="ln-148"></a>
<a name="ln-149"></a><span class="k">            call </span><span class="n">dmsg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;deallocate_memory&#39;</span><span class="p">)</span>
<a name="ln-150"></a>
<a name="ln-151"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
<a name="ln-152"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">yn</span><span class="p">)</span>
<a name="ln-153"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">zn</span><span class="p">)</span>
<a name="ln-154"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">xA</span><span class="p">)</span>
<a name="ln-155"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">yA</span><span class="p">)</span>
<a name="ln-156"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">zA</span><span class="p">)</span>
<a name="ln-157"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-158"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">CellCenter</span><span class="p">)</span>
<a name="ln-159"></a><span class="c">!            call dealloc(left_ghost_centroid)</span>
<a name="ln-160"></a><span class="c">!            call dealloc(right_ghost_centroid)</span>
<a name="ln-161"></a><span class="c">!            call dealloc(front_ghost_centroid)</span>
<a name="ln-162"></a><span class="c">!            call dealloc(back_ghost_centroid)</span>
<a name="ln-163"></a><span class="c">!            call dealloc(top_ghost_centroid)</span>
<a name="ln-164"></a><span class="c">!            call dealloc(bottom_ghost_centroid)</span>
<a name="ln-165"></a>    
<a name="ln-166"></a>        <span class="k">end subroutine </span><span class="n">deallocate_memory</span>
<a name="ln-167"></a>
<a name="ln-168"></a>        <span class="k">subroutine </span><span class="n">normalize_face_normals</span><span class="p">()</span>
<a name="ln-169"></a>            <span class="c">!&lt; Normalize the face normal vectors computed to get unit</span>
<a name="ln-170"></a>            <span class="c">!&lt; vectors</span>
<a name="ln-171"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-172"></a>            
<a name="ln-173"></a>            <span class="k">implicit none</span>
<a name="ln-174"></a><span class="k">            </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-175"></a>
<a name="ln-176"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-177"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-178"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-179"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-180"></a><span class="k">                    </span><span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-181"></a>                    <span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-182"></a>                    <span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">xA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-183"></a>                  <span class="k">end if</span>
<a name="ln-184"></a><span class="k">                end do</span>
<a name="ln-185"></a><span class="k">              end do</span>
<a name="ln-186"></a><span class="k">            end do</span>
<a name="ln-187"></a>
<a name="ln-188"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-189"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-190"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-191"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-192"></a><span class="k">                    </span><span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-193"></a>                    <span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-194"></a>                    <span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">yA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-195"></a>                  <span class="k">end if</span>
<a name="ln-196"></a><span class="k">                end do</span>
<a name="ln-197"></a><span class="k">              end do</span>
<a name="ln-198"></a><span class="k">            end do</span>
<a name="ln-199"></a>
<a name="ln-200"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-201"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-202"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-203"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-204"></a><span class="k">                    </span><span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-205"></a>                    <span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-206"></a>                    <span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">zA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-207"></a>                  <span class="k">end if</span>
<a name="ln-208"></a><span class="k">                end do</span>
<a name="ln-209"></a><span class="k">              end do</span>
<a name="ln-210"></a><span class="k">            end do</span>
<a name="ln-211"></a>
<a name="ln-212"></a>            <span class="c">! pole boundary condition</span>
<a name="ln-213"></a>            <span class="k">if</span><span class="p">(</span><span class="n">imin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-214"></a><span class="k">              </span><span class="n">xn</span><span class="p">(</span> <span class="mi">1</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:,:)</span>
<a name="ln-215"></a>              <span class="n">xn</span><span class="p">(</span> <span class="mi">0</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:,:)</span>
<a name="ln-216"></a>              <span class="n">xn</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:,:)</span>
<a name="ln-217"></a>              <span class="n">xn</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:,:)</span>
<a name="ln-218"></a>            <span class="k">end if</span>
<a name="ln-219"></a>
<a name="ln-220"></a><span class="k">            if</span><span class="p">(</span><span class="n">imax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-221"></a><span class="k">              </span><span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span>
<a name="ln-222"></a>              <span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span>
<a name="ln-223"></a>              <span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span>
<a name="ln-224"></a>              <span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">xn</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:,:)</span>
<a name="ln-225"></a>            <span class="k">end if</span>
<a name="ln-226"></a>
<a name="ln-227"></a><span class="k">            if</span><span class="p">(</span><span class="n">jmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-228"></a><span class="k">              </span><span class="n">yn</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:,:)</span>
<a name="ln-229"></a>              <span class="n">yn</span><span class="p">(:,</span> <span class="mi">0</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:,:)</span>
<a name="ln-230"></a>              <span class="n">yn</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:,:)</span>
<a name="ln-231"></a>              <span class="n">yn</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:,:)</span>
<a name="ln-232"></a>            <span class="k">end if</span>
<a name="ln-233"></a>
<a name="ln-234"></a><span class="k">            if</span><span class="p">(</span><span class="n">jmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-235"></a><span class="k">              </span><span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span>
<a name="ln-236"></a>              <span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span>
<a name="ln-237"></a>              <span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span>
<a name="ln-238"></a>              <span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">yn</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)</span>
<a name="ln-239"></a>            <span class="k">end if</span>
<a name="ln-240"></a>
<a name="ln-241"></a><span class="k">            if</span><span class="p">(</span><span class="n">kmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-242"></a><span class="k">              </span><span class="n">zn</span><span class="p">(:,:,</span> <span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">,:)</span>
<a name="ln-243"></a>              <span class="n">zn</span><span class="p">(:,:,</span> <span class="mi">0</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">,:)</span>
<a name="ln-244"></a>              <span class="n">zn</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">,:)</span>
<a name="ln-245"></a>              <span class="n">zn</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">,:)</span>
<a name="ln-246"></a>            <span class="k">end if</span>
<a name="ln-247"></a>
<a name="ln-248"></a><span class="k">            if</span><span class="p">(</span><span class="n">kmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-249"></a><span class="k">              </span><span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-250"></a>              <span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-251"></a>              <span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-252"></a>              <span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:)</span><span class="o">=</span><span class="n">zn</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)</span>
<a name="ln-253"></a>            <span class="k">end if</span>
<a name="ln-254"></a>
<a name="ln-255"></a><span class="k">            </span>
<a name="ln-256"></a><span class="k">        end subroutine </span><span class="n">normalize_face_normals</span>
<a name="ln-257"></a>
<a name="ln-258"></a>        <span class="k">subroutine </span><span class="n">compute_face_areas</span><span class="p">()</span>
<a name="ln-259"></a>            <span class="c">!&lt; Compute face areas based on area vectors</span>
<a name="ln-260"></a>            <span class="c">!&lt;</span>
<a name="ln-261"></a>            <span class="c">!&lt; The face areas are computed using the face area vectors. </span>
<a name="ln-262"></a>            <span class="c">!&lt; Prior to using this subroutine, the face area vectors must</span>
<a name="ln-263"></a>            <span class="c">!&lt; computed and placed in the face normal variables. </span>
<a name="ln-264"></a>            <span class="c">!&lt;</span>
<a name="ln-265"></a>            <span class="c">!&lt; Since the area is given by abs(d1 x d2), the areas are</span>
<a name="ln-266"></a>            <span class="c">!&lt; calculated using the normal vectors calculated in </span>
<a name="ln-267"></a>            <span class="c">!&lt; compute_face_area_vectors, but before normalising them</span>
<a name="ln-268"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-269"></a>            
<a name="ln-270"></a>            <span class="k">implicit none</span>
<a name="ln-271"></a>
<a name="ln-272"></a><span class="k">            </span><span class="n">xA</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">xnx</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="n">xny</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-273"></a>                          <span class="p">(</span><span class="n">xnz</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span>
<a name="ln-274"></a>
<a name="ln-275"></a>            <span class="n">yA</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">ynx</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="n">yny</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-276"></a>                          <span class="p">(</span><span class="n">ynz</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span>
<a name="ln-277"></a>            
<a name="ln-278"></a>            <span class="n">zA</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">znx</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="n">zny</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-279"></a>                          <span class="p">(</span><span class="n">znz</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:))</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span>
<a name="ln-280"></a>
<a name="ln-281"></a>            <span class="c">! Pole boundary conditions</span>
<a name="ln-282"></a>            <span class="c">! making sure face area is exactly equal zero</span>
<a name="ln-283"></a>            <span class="k">if</span><span class="p">(</span><span class="n">imin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">xA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span>     <span class="p">,</span>  <span class="p">:,</span>  <span class="p">:)</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-284"></a>            <span class="k">if</span><span class="p">(</span><span class="n">imax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">xA</span><span class="p">(</span><span class="n">imx</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>  <span class="p">:,</span>  <span class="p">:)</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-285"></a>            <span class="k">if</span><span class="p">(</span><span class="n">jmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">yA</span><span class="p">(</span>  <span class="p">:,</span>     <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="p">:)</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-286"></a>            <span class="k">if</span><span class="p">(</span><span class="n">jmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">yA</span><span class="p">(</span>  <span class="p">:,</span><span class="n">jmx</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>  <span class="p">:)</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-287"></a>            <span class="k">if</span><span class="p">(</span><span class="n">kmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">zA</span><span class="p">(</span>  <span class="p">:,</span>  <span class="p">:,</span>     <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-288"></a>            <span class="k">if</span><span class="p">(</span><span class="n">kmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">zA</span><span class="p">(</span>  <span class="p">:,</span>  <span class="p">:,</span><span class="n">kmx</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-289"></a>
<a name="ln-290"></a>        <span class="k">end subroutine </span><span class="n">compute_face_areas</span>
<a name="ln-291"></a>
<a name="ln-292"></a>        <span class="k">subroutine </span><span class="n">compute_face_area_vectors</span><span class="p">()</span>
<a name="ln-293"></a>            <span class="c">!&lt; Compute face area vectors</span>
<a name="ln-294"></a>            <span class="c">!&lt;</span>
<a name="ln-295"></a>            <span class="c">!&lt; The face area vectors denote the face area both in </span>
<a name="ln-296"></a>            <span class="c">!&lt; magnitude and direction. They are placed in the face </span>
<a name="ln-297"></a>            <span class="c">!&lt; normal variables for further calculation.</span>
<a name="ln-298"></a>            <span class="c">!&lt;</span>
<a name="ln-299"></a>            <span class="c">!&lt; The face normal is given by d1 x d2, where d1 and d2 are</span>
<a name="ln-300"></a>            <span class="c">!&lt; the diagonals of a face</span>
<a name="ln-301"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-302"></a>            
<a name="ln-303"></a>            <span class="k">implicit none</span>
<a name="ln-304"></a>
<a name="ln-305"></a><span class="k">    </span>
<a name="ln-306"></a><span class="k">            </span><span class="kt">real</span> <span class="kd">::</span> <span class="n">d1x</span><span class="p">,</span> <span class="n">d2x</span><span class="p">,</span> <span class="n">d1y</span><span class="p">,</span> <span class="n">d2y</span><span class="p">,</span> <span class="n">d1z</span><span class="p">,</span> <span class="n">d2z</span>
<a name="ln-307"></a>            <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-308"></a>
<a name="ln-309"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-310"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-311"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-312"></a>                <span class="n">d1x</span> <span class="o">=</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-313"></a>                <span class="n">d1y</span> <span class="o">=</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-314"></a>                <span class="n">d1z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-315"></a>                <span class="n">d2x</span> <span class="o">=</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-316"></a>                <span class="n">d2y</span> <span class="o">=</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-317"></a>                <span class="n">d2z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-318"></a>                <span class="n">xnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1y</span><span class="o">*</span><span class="n">d2z</span> <span class="o">-</span> <span class="n">d1z</span><span class="o">*</span><span class="n">d2y</span><span class="p">)</span>
<a name="ln-319"></a>                <span class="n">xny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1z</span><span class="o">*</span><span class="n">d2x</span> <span class="o">-</span> <span class="n">d1x</span><span class="o">*</span><span class="n">d2z</span><span class="p">)</span>
<a name="ln-320"></a>                <span class="n">xnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1x</span><span class="o">*</span><span class="n">d2y</span> <span class="o">-</span> <span class="n">d1y</span><span class="o">*</span><span class="n">d2x</span><span class="p">)</span>
<a name="ln-321"></a>               <span class="k">end do</span>
<a name="ln-322"></a><span class="k">              end do</span>
<a name="ln-323"></a><span class="k">             end do</span>
<a name="ln-324"></a>
<a name="ln-325"></a>
<a name="ln-326"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-327"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-328"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-329"></a>               <span class="n">d1x</span> <span class="o">=</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-330"></a>               <span class="n">d1y</span> <span class="o">=</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-331"></a>               <span class="n">d1z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-332"></a>               <span class="n">d2x</span> <span class="o">=</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-333"></a>               <span class="n">d2y</span> <span class="o">=</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-334"></a>               <span class="n">d2z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-335"></a>            
<a name="ln-336"></a>               <span class="n">ynx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1y</span><span class="o">*</span><span class="n">d2z</span> <span class="o">-</span> <span class="n">d1z</span><span class="o">*</span><span class="n">d2y</span><span class="p">)</span>
<a name="ln-337"></a>               <span class="n">yny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1z</span><span class="o">*</span><span class="n">d2x</span> <span class="o">-</span> <span class="n">d1x</span><span class="o">*</span><span class="n">d2z</span><span class="p">)</span>
<a name="ln-338"></a>               <span class="n">ynz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1x</span><span class="o">*</span><span class="n">d2y</span> <span class="o">-</span> <span class="n">d1y</span><span class="o">*</span><span class="n">d2x</span><span class="p">)</span>
<a name="ln-339"></a>              <span class="k">end do</span>
<a name="ln-340"></a><span class="k">             end do</span>
<a name="ln-341"></a><span class="k">            end do</span>
<a name="ln-342"></a>
<a name="ln-343"></a><span class="k">            </span>
<a name="ln-344"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-345"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-346"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-347"></a>               <span class="n">d1x</span> <span class="o">=</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-348"></a>               <span class="n">d1y</span> <span class="o">=</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-349"></a>               <span class="n">d1z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-350"></a>               <span class="n">d2x</span> <span class="o">=</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-351"></a>               <span class="n">d2y</span> <span class="o">=</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-352"></a>               <span class="n">d2z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-353"></a>            
<a name="ln-354"></a>               <span class="n">znx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1y</span><span class="o">*</span><span class="n">d2z</span> <span class="o">-</span> <span class="n">d1z</span><span class="o">*</span><span class="n">d2y</span><span class="p">)</span>
<a name="ln-355"></a>               <span class="n">zny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1z</span><span class="o">*</span><span class="n">d2x</span> <span class="o">-</span> <span class="n">d1x</span><span class="o">*</span><span class="n">d2z</span><span class="p">)</span>
<a name="ln-356"></a>               <span class="n">znz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1x</span><span class="o">*</span><span class="n">d2y</span> <span class="o">-</span> <span class="n">d1y</span><span class="o">*</span><span class="n">d2x</span><span class="p">)</span>
<a name="ln-357"></a>              <span class="k">end do</span>
<a name="ln-358"></a><span class="k">             end do</span>
<a name="ln-359"></a><span class="k">            end do</span>
<a name="ln-360"></a>
<a name="ln-361"></a>
<a name="ln-362"></a><span class="k">        end subroutine </span><span class="n">compute_face_area_vectors</span>
<a name="ln-363"></a>
<a name="ln-364"></a>        <span class="k">subroutine </span><span class="n">compute_face_areas_and_normals</span><span class="p">()</span>
<a name="ln-365"></a>            <span class="c">!&lt; Compute the face areas and normals</span>
<a name="ln-366"></a>            <span class="c">!&lt;</span>
<a name="ln-367"></a>            <span class="c">!&lt; This is the 2-dimensional version. In this case, the face </span>
<a name="ln-368"></a>            <span class="c">!&lt; areas default to edge lengths.</span>
<a name="ln-369"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-370"></a>
<a name="ln-371"></a>            <span class="k">implicit none</span>
<a name="ln-372"></a>
<a name="ln-373"></a><span class="k">            call </span><span class="n">compute_face_area_vectors</span><span class="p">()</span>
<a name="ln-374"></a>            <span class="k">call </span><span class="n">compute_face_areas</span><span class="p">()</span>
<a name="ln-375"></a>            <span class="k">call </span><span class="n">normalize_face_normals</span><span class="p">()</span>
<a name="ln-376"></a>        
<a name="ln-377"></a>        <span class="k">end subroutine </span><span class="n">compute_face_areas_and_normals</span>
<a name="ln-378"></a>       
<a name="ln-379"></a>        <span class="k">function </span><span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
<a name="ln-380"></a>            <span class="c">!&lt; Compute the volume of a tetrahedron, given 4 points which</span>
<a name="ln-381"></a>            <span class="c">!&lt; are 1-D arrays</span>
<a name="ln-382"></a>            <span class="c">!&lt; Since we know that the determinant is to be evaluated of </span>
<a name="ln-383"></a>            <span class="c">!&lt; a 3x3 matrix, we write the expression itself</span>
<a name="ln-384"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-385"></a>
<a name="ln-386"></a>            <span class="k">implicit none</span>
<a name="ln-387"></a><span class="k">            </span><span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span>
<a name="ln-388"></a>            <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A</span>
<a name="ln-389"></a>            <span class="kt">real</span> <span class="kd">::</span> <span class="n">vol_tetrahedron</span>
<a name="ln-390"></a>
<a name="ln-391"></a>            <span class="n">A</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p4</span>
<a name="ln-392"></a>            <span class="n">A</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p4</span>
<a name="ln-393"></a>            <span class="n">A</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">-</span> <span class="n">p4</span>
<a name="ln-394"></a>
<a name="ln-395"></a>            <span class="c">!vol_tetrahedron = A(1,1) * (A(2,2)*A(3,3) - A(2,3)*A(3,2)) + &amp;</span>
<a name="ln-396"></a>            <span class="c">!                  A(1,2) * (A(2,3)*A(3,1) - A(2,1)*A(3,3)) + &amp;</span>
<a name="ln-397"></a>            <span class="c">!                  A(1,3) * (A(2,1)*A(3,2) - A(2,2)*A(3,1))</span>
<a name="ln-398"></a>            <span class="n">vol_tetrahedron</span> <span class="o">=</span> <span class="p">(</span><span class="n">p4</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">p2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="p">&amp;</span>
<a name="ln-399"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">p4</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">p2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span> <span class="p">&amp;</span>
<a name="ln-400"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">p4</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-401"></a>            <span class="n">vol_tetrahedron</span> <span class="o">=</span> <span class="o">-</span><span class="n">vol_tetrahedron</span> <span class="o">/</span> <span class="mf">6.</span>                  
<a name="ln-402"></a>        
<a name="ln-403"></a>        <span class="k">end function </span><span class="n">vol_tetrahedron</span>
<a name="ln-404"></a>        
<a name="ln-405"></a>        <span class="k">function </span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">)</span>
<a name="ln-406"></a>            <span class="c">!&lt; Compute the volume of a hexahedron, given a list of points</span>
<a name="ln-407"></a>            <span class="c">! The points are arranged in a specific order. For the </span>
<a name="ln-408"></a>            <span class="c">! element i,j,k, the order of nodes required are:</span>
<a name="ln-409"></a>            <span class="c">! i,j,k</span>
<a name="ln-410"></a>            <span class="c">! i+1, j, k</span>
<a name="ln-411"></a>            <span class="c">! i+1, j+1, k</span>
<a name="ln-412"></a>            <span class="c">! i, j+1, k</span>
<a name="ln-413"></a>            <span class="c">! i, j, k+1</span>
<a name="ln-414"></a>            <span class="c">! i+1, j, k+1</span>
<a name="ln-415"></a>            <span class="c">! i+1, j+1, k+1</span>
<a name="ln-416"></a>            <span class="c">! i, j+1, k+1</span>
<a name="ln-417"></a>            <span class="c">!</span>
<a name="ln-418"></a>            <span class="c">! The hexahedron is to be split into 5 tetrahedrons. </span>
<a name="ln-419"></a>            <span class="c">! Source: Split hex into 5 tetrahedron:</span>
<a name="ln-420"></a>            <span class="c">! No assumptions about planarity seem to be made. All cuts </span>
<a name="ln-421"></a>            <span class="c">! were made with a plane containing only 3 vertices at a time.</span>
<a name="ln-422"></a>            <span class="c">! https://ieeexplore.ieee.org/ieee_pilot/articles/06/ttg2009061587/assets/img/article_1/fig_6/large.gif</span>
<a name="ln-423"></a>            <span class="c">!</span>
<a name="ln-424"></a>            <span class="c">! The indices of the 5 split tetrahedra can be visualised from</span>
<a name="ln-425"></a>            <span class="c">! the above link. But since the volume of each tetrahedron </span>
<a name="ln-426"></a>            <span class="c">! depends on the determinant calculated, it is IMPERATIVE to </span>
<a name="ln-427"></a>            <span class="c">! ensure that a &quot;correct&quot; order is followed for the 4 points. </span>
<a name="ln-428"></a>            <span class="c">!            </span>
<a name="ln-429"></a>            <span class="c">! The logic to get the &quot;correct&quot; order is explained as </span>
<a name="ln-430"></a>            <span class="c">! follows (Refer wiki article on parallelepiped):</span>
<a name="ln-431"></a>            <span class="c">! The determinant is taken of a matrix of pi - p4, i = 1, 2, 3. </span>
<a name="ln-432"></a>            <span class="c">! Graphically it denotes the sides with p4 as common vertex, </span>
<a name="ln-433"></a>            <span class="c">! with direction outward from p4, i.e., directed from </span>
<a name="ln-434"></a>            <span class="c">! p4 to pi, i = 1, 2, 3</span>
<a name="ln-435"></a>            <span class="c">! Hence, if you ensure that  cross(p1-p4, p2-p4) is along </span>
<a name="ln-436"></a>            <span class="c">! p3-p4, then the determinant will be positive.</span>
<a name="ln-437"></a>            <span class="c">!</span>
<a name="ln-438"></a>            <span class="c">! From the above link, a set of 5 tetrahedra was obtained. </span>
<a name="ln-439"></a>            <span class="c">! Each tetrahedra has 4 points, and in the function calls </span>
<a name="ln-440"></a>            <span class="c">! below, care was taken to ensure that the order is observed</span>
<a name="ln-441"></a>            <span class="c">! while passing parameters into the vol_tetrahedron function</span>
<a name="ln-442"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-443"></a>
<a name="ln-444"></a>            <span class="k">implicit none</span>
<a name="ln-445"></a><span class="k">            </span><span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_list</span>
<a name="ln-446"></a>            <span class="kt">real</span> <span class="kd">::</span> <span class="n">vol_hexahedron</span>
<a name="ln-447"></a>            <span class="kt">real</span> <span class="kd">::</span> <span class="n">vol_hexahedron1</span>
<a name="ln-448"></a>            
<a name="ln-449"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-450"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-451"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-452"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">))</span>
<a name="ln-453"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-454"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-455"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-456"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-457"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-458"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-459"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-460"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-461"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">))</span>
<a name="ln-462"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-463"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-464"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-465"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-466"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-467"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-468"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-469"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-470"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-471"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-472"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-473"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-474"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-475"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-476"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-477"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-478"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-479"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-480"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-481"></a>
<a name="ln-482"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">,</span><span class="n">vol_hexahedron1</span><span class="p">)</span>
<a name="ln-483"></a>            
<a name="ln-484"></a>        <span class="k">end function </span><span class="n">vol_hexahedron</span>
<a name="ln-485"></a>        
<a name="ln-486"></a>        <span class="k">subroutine </span><span class="n">compute_volumes</span><span class="p">()</span>
<a name="ln-487"></a>            <span class="c">!&lt; Compute the grid cell volumes</span>
<a name="ln-488"></a>            <span class="c">!&lt; Each grid is a hexahedron, whose volume is calculated by</span>
<a name="ln-489"></a>            <span class="c">!&lt; splitting it into 5 tetrahedrons, whose volume is known</span>
<a name="ln-490"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-491"></a>
<a name="ln-492"></a>            <span class="k">implicit none</span>
<a name="ln-493"></a><span class="k">            </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-494"></a>            <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_list</span>
<a name="ln-495"></a>
<a name="ln-496"></a>            <span class="n">volume</span><span class="o">=</span><span class="mf">1.</span>
<a name="ln-497"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">0</span>
<a name="ln-498"></a>                <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">0</span>
<a name="ln-499"></a>                    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">0</span>
<a name="ln-500"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-501"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-502"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-503"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-504"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-505"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-506"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-507"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-508"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-509"></a>                        <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
<a name="ln-510"></a>                        <span class="k">if</span><span class="p">(</span><span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-511"></a><span class="k">                          if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">i</span><span class="o">==</span><span class="n">imx</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">j</span><span class="o">==</span><span class="n">jmx</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">k</span><span class="o">==</span><span class="n">kmx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-512"></a>                            <span class="c">!print*, &quot;Ghost Cell volume negative&quot;</span>
<a name="ln-513"></a>                            <span class="n">volume</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
<a name="ln-514"></a>                          <span class="k">else</span>
<a name="ln-515"></a><span class="k">                            print</span><span class="o">*</span><span class="p">,</span> <span class="n">process_id</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-516"></a>                            <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;negative volume :&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
<a name="ln-517"></a>                            <span class="k">STOP</span>
<a name="ln-518"></a><span class="k">                          end if</span>
<a name="ln-519"></a><span class="k">                        end if</span>
<a name="ln-520"></a><span class="k">                    end do</span>
<a name="ln-521"></a><span class="k">                end do</span>
<a name="ln-522"></a><span class="k">            end do</span>
<a name="ln-523"></a><span class="k">            if</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">volume</span><span class="o">==</span><span class="mf">0.0</span><span class="p">))</span><span class="k">then</span>
<a name="ln-524"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-525"></a>            <span class="k">end if</span>
<a name="ln-526"></a><span class="k">            if</span><span class="p">(</span><span class="nb">any</span><span class="p">((</span><span class="n">volume</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">))</span><span class="k">then</span>
<a name="ln-527"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-528"></a>            <span class="k">end if</span>
<a name="ln-529"></a><span class="k">            </span>
<a name="ln-530"></a><span class="k">        end subroutine </span><span class="n">compute_volumes</span>
<a name="ln-531"></a>
<a name="ln-532"></a>        <span class="k">subroutine </span><span class="n">compute_geometric_parameters</span><span class="p">()</span>
<a name="ln-533"></a>            <span class="c">!&lt; Compute the geometric parameters based on the grid points</span>
<a name="ln-534"></a>            <span class="c">!&lt;</span>
<a name="ln-535"></a>            <span class="c">!&lt; The geometric parameters include the face normals and </span>
<a name="ln-536"></a>            <span class="c">!&lt; areas and the cell volumes.</span>
<a name="ln-537"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-538"></a>            
<a name="ln-539"></a>            <span class="k">implicit none</span>
<a name="ln-540"></a>
<a name="ln-541"></a><span class="k">            call </span><span class="n">dmsg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;compute_geometric_parameters&#39;</span><span class="p">)</span>
<a name="ln-542"></a>
<a name="ln-543"></a>            <span class="k">call </span><span class="n">compute_face_areas_and_normals</span><span class="p">()</span>
<a name="ln-544"></a>            <span class="k">call </span><span class="n">compute_volumes</span><span class="p">()</span>
<a name="ln-545"></a>
<a name="ln-546"></a>        <span class="k">end subroutine </span><span class="n">compute_geometric_parameters</span>
<a name="ln-547"></a>
<a name="ln-548"></a>        <span class="k">subroutine </span><span class="n">compute_ghost_cell_centroid</span><span class="p">()</span>
<a name="ln-549"></a>          <span class="c">!&lt; compute cell center of all cell including ghost cells</span>
<a name="ln-550"></a>          <span class="k">implicit none</span>
<a name="ln-551"></a><span class="k">          </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-552"></a>
<a name="ln-553"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-554"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-555"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-556"></a>                <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.125</span> <span class="o">*</span> <span class="p">(</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-557"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-558"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-559"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-560"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-561"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-562"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-563"></a>                                              <span class="o">+</span> <span class="n">grid_x</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-564"></a>                                              <span class="p">)</span>
<a name="ln-565"></a>
<a name="ln-566"></a>                <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.125</span> <span class="o">*</span> <span class="p">(</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-567"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-568"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-569"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-570"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-571"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-572"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-573"></a>                                              <span class="o">+</span> <span class="n">grid_y</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-574"></a>                                              <span class="p">)</span>
<a name="ln-575"></a>
<a name="ln-576"></a>                <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.125</span> <span class="o">*</span> <span class="p">(</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-577"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-578"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-579"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-580"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-581"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-582"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-583"></a>                                              <span class="o">+</span> <span class="n">grid_z</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-584"></a>                                              <span class="p">)</span>
<a name="ln-585"></a>              <span class="k">end do</span>
<a name="ln-586"></a><span class="k">            end do</span>
<a name="ln-587"></a><span class="k">          end do</span>
<a name="ln-588"></a>
<a name="ln-589"></a><span class="k">        end subroutine </span><span class="n">compute_ghost_cell_centroid</span>
<a name="ln-590"></a>
<a name="ln-591"></a>        <span class="k">subroutine </span><span class="n">setup_geometry</span><span class="p">()</span>
<a name="ln-592"></a>            <span class="c">!&lt; Make the geometry module useful</span>
<a name="ln-593"></a>            <span class="c">!&lt;</span>
<a name="ln-594"></a>            <span class="c">!&lt; Allocates memory to the variables and initializes them.</span>
<a name="ln-595"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-596"></a>
<a name="ln-597"></a>            <span class="k">implicit none</span>
<a name="ln-598"></a>
<a name="ln-599"></a><span class="k">            call </span><span class="n">dmsg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;setup_geometry&#39;</span><span class="p">)</span>
<a name="ln-600"></a>
<a name="ln-601"></a>            <span class="k">call </span><span class="n">allocate_memory</span><span class="p">()</span>
<a name="ln-602"></a>            <span class="k">call </span><span class="n">compute_geometric_parameters</span><span class="p">()</span>
<a name="ln-603"></a>            <span class="k">call </span><span class="n">compute_ghost_cell_centroid</span><span class="p">()</span>
<a name="ln-604"></a>
<a name="ln-605"></a>        <span class="k">end subroutine </span><span class="n">setup_geometry</span>
<a name="ln-606"></a>
<a name="ln-607"></a>        <span class="k">subroutine </span><span class="n">destroy_geometry</span><span class="p">()</span>
<a name="ln-608"></a>          <span class="c">!&lt; nullify all the face normal pionter </span>
<a name="ln-609"></a>
<a name="ln-610"></a>            <span class="k">implicit none</span>
<a name="ln-611"></a><span class="k">            </span>
<a name="ln-612"></a><span class="k">            call </span><span class="n">dmsg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy_geometry&#39;</span><span class="p">)</span>
<a name="ln-613"></a>
<a name="ln-614"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">xnx</span><span class="p">)</span>
<a name="ln-615"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">xny</span><span class="p">)</span>
<a name="ln-616"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">xnz</span><span class="p">)</span>
<a name="ln-617"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">ynx</span><span class="p">)</span>
<a name="ln-618"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">yny</span><span class="p">)</span>
<a name="ln-619"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">ynz</span><span class="p">)</span>
<a name="ln-620"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">znx</span><span class="p">)</span>
<a name="ln-621"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">zny</span><span class="p">)</span>
<a name="ln-622"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">znz</span><span class="p">)</span>
<a name="ln-623"></a>            <span class="k">call </span><span class="n">deallocate_memory</span><span class="p">()</span>
<a name="ln-624"></a>
<a name="ln-625"></a>        <span class="k">end subroutine </span><span class="n">destroy_geometry</span>
<a name="ln-626"></a>
<a name="ln-627"></a><span class="k">end module </span><span class="n">geometry</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-05-20T17:53:20.873044 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>