<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>geometry.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>geometry.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.1% of total for source files.">329 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/geometry.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">geometry.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/geometry.html">geometry</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/geometry.f90.html#src">geometry.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>The geometry module calculates various geometrical quantities like 
 face-normals, face-areas and cell-volumes to be used in computations. </p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~geometry.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilegeometryf90EfferentGraph" width="191pt" height="74pt"
 viewBox="0.00 0.00 191.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~geometry.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~geometry.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 187,-70 187,4 -4,4"/>
<!-- sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~geometry.f90</title>
<polygon fill="none" stroke="#000000" points="183,-45 107,-45 107,-21 183,-21 183,-45"/>
<text text-anchor="middle" x="145" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">geometry.f90</text>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~geometry.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="62.5,-66 8.5,-66 8.5,-42 62.5,-42 62.5,-66"/>
<text text-anchor="middle" x="35.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~geometry.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~geometry.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M106.7022,-40.3448C95.6724,-42.4601 83.6604,-44.7638 72.6983,-46.8661"/>
<polygon fill="#ff0000" stroke="#ff0000" points="71.738,-43.4864 62.5762,-48.8073 73.0565,-50.3611 71.738,-43.4864"/>
</g>
<!-- sourcefile~vartypes.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~vartypes.f90</title>
<g id="a_sourcefile~~geometry.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/vartypes.f90.html" xlink:title="vartypes.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">vartypes.f90</text>
</a>
</g>
</g>
<!-- sourcefile~geometry.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~geometry.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~geometry.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M106.7022,-25.6552C98.3686,-24.057 89.4744,-22.3513 80.896,-20.7061"/>
<polygon fill="#ff0000" stroke="#ff0000" points="81.5034,-17.2589 71.0231,-18.8127 80.1849,-24.1336 81.5034,-17.2589"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~geometry.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilegeometryf90AfferentGraph" width="269pt" height="32pt"
 viewBox="0.00 0.00 269.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~geometry.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~geometry.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 265,-28 265,4 -4,4"/>
<!-- sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~geometry.f90</title>
<polygon fill="none" stroke="#000000" points="76,-24 0,-24 0,0 76,0 76,-24"/>
<text text-anchor="middle" x="38" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">geometry.f90</text>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="171,-24 112,-24 112,0 171,0 171,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M111.8411,-12C103.8553,-12 95.0055,-12 86.2874,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="86.1733,-8.5001 76.1732,-12 86.1732,-15.5001 86.1733,-8.5001"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~geometry.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="261,-24 207,-24 207,0 261,0 261,-24"/>
<text text-anchor="middle" x="234" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~geometry.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M206.7472,-12C198.791,-12 189.9269,-12 181.361,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="181.1413,-8.5001 171.1413,-12 181.1413,-15.5001 181.1413,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/geometry.html">geometry</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/geometry.f90.html#src">geometry.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>    <span class="c">!&lt; The geometry module calculates various geometrical quantities like </span>
<a name="ln-2"></a>    <span class="c">!&lt; face-normals, face-areas and cell-volumes to be used in computations. </span>
<a name="ln-3"></a><span class="k">module </span><span class="n">geometry</span>
<a name="ln-4"></a>    <span class="c">!&lt; The geometry module calculates various geometrical quantities like </span>
<a name="ln-5"></a>    <span class="c">!&lt; face-normals, face-areas and cell-volumes to be used in computations. </span>
<a name="ln-6"></a>    <span class="c">!-------------------------------------------------------------------</span>
<a name="ln-7"></a><span class="cp">#include &quot;error.inc&quot;</span>
<a name="ln-8"></a><span class="cp">#include &quot;debug.h&quot;</span>
<a name="ln-9"></a>    <span class="k">use </span><span class="n">vartypes</span>
<a name="ln-10"></a>    <span class="k">use </span><span class="n">utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">alloc</span>
<a name="ln-11"></a>
<a name="ln-12"></a>    <span class="k">implicit none</span>
<a name="ln-13"></a><span class="k">    private</span>
<a name="ln-14"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">imx</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">kmx</span>
<a name="ln-15"></a>
<a name="ln-16"></a>    <span class="c">! Public methods</span>
<a name="ln-17"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">setup_geometry</span>
<a name="ln-18"></a>
<a name="ln-19"></a>    <span class="k">contains</span>
<a name="ln-20"></a>
<a name="ln-21"></a><span class="k">        subroutine </span><span class="n">allocate_memory</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">)</span>
<a name="ln-22"></a>            <span class="c">!&lt; Allocate memory for the required variables.</span>
<a name="ln-23"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-24"></a>            <span class="k">implicit none</span>
<a name="ln-25"></a><span class="k">            type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-26"></a>            <span class="c">!&lt; Store cell center quantities: volume, cell center coordinate</span>
<a name="ln-27"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-28"></a>            <span class="c">!&lt; Store face quantites for I faces: normal and area</span>
<a name="ln-29"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-30"></a>            <span class="c">!&lt; Store face quantites for J faces: normal and area</span>
<a name="ln-31"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-32"></a>            <span class="c">!&lt; Store face quantites for K faces: normal and area</span>
<a name="ln-33"></a>
<a name="ln-34"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;allocate_memory&#39;</span><span class="p">)</span>
<a name="ln-35"></a>
<a name="ln-36"></a>            <span class="k">allocate</span><span class="p">(</span><span class="n">cells</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-37"></a>            <span class="c">!&lt; Allocate memory for cells</span>
<a name="ln-38"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-39"></a>
<a name="ln-40"></a>            <span class="k">allocate</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-41"></a>            <span class="k">allocate</span><span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-42"></a>            <span class="k">allocate</span><span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-43"></a>            <span class="c">!&lt; Allocate memory for the face variables.</span>
<a name="ln-44"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-45"></a>
<a name="ln-46"></a>
<a name="ln-47"></a>        <span class="k">end subroutine </span><span class="n">allocate_memory</span>
<a name="ln-48"></a>
<a name="ln-49"></a>
<a name="ln-50"></a>        <span class="k">subroutine </span><span class="n">normalize_face_normals</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-51"></a>            <span class="c">!&lt; Normalize the face normal vectors computed to get unit</span>
<a name="ln-52"></a>            <span class="c">!&lt; vectors</span>
<a name="ln-53"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-54"></a>            
<a name="ln-55"></a>            <span class="k">implicit none</span>
<a name="ln-56"></a><span class="k">            type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-57"></a>            <span class="c">!&lt; Store face quantites for I faces: normal and area</span>
<a name="ln-58"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-59"></a>            <span class="c">!&lt; Store face quantites for J faces: normal and area</span>
<a name="ln-60"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-61"></a>            <span class="c">!&lt; Store face quantites for K faces: normal and area</span>
<a name="ln-62"></a>            <span class="k">type</span><span class="p">(</span><span class="n">boundarytype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>
<a name="ln-63"></a>            <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-64"></a>
<a name="ln-65"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-66"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-67"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-68"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-69"></a><span class="k">                    </span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span> <span class="o">=</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="o">/</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-70"></a>                    <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span> <span class="o">=</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="o">/</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-71"></a>                    <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span> <span class="o">=</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="o">/</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-72"></a>                  <span class="k">end if</span>
<a name="ln-73"></a><span class="k">                end do</span>
<a name="ln-74"></a><span class="k">              end do</span>
<a name="ln-75"></a><span class="k">            end do</span>
<a name="ln-76"></a>
<a name="ln-77"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-78"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-79"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-80"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-81"></a><span class="k">                    </span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span> <span class="o">=</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="o">/</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-82"></a>                    <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span> <span class="o">=</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="o">/</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-83"></a>                    <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span> <span class="o">=</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="o">/</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-84"></a>                  <span class="k">end if</span>
<a name="ln-85"></a><span class="k">                end do</span>
<a name="ln-86"></a><span class="k">              end do</span>
<a name="ln-87"></a><span class="k">            end do</span>
<a name="ln-88"></a>
<a name="ln-89"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-90"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-91"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-92"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-93"></a><span class="k">                    </span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span> <span class="o">=</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="o">/</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-94"></a>                    <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span> <span class="o">=</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="o">/</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-95"></a>                    <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span> <span class="o">=</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="o">/</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-96"></a>                  <span class="k">end if</span>
<a name="ln-97"></a><span class="k">                end do</span>
<a name="ln-98"></a><span class="k">              end do</span>
<a name="ln-99"></a><span class="k">            end do</span>
<a name="ln-100"></a>
<a name="ln-101"></a>            <span class="c">! pole boundary condition</span>
<a name="ln-102"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">imin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-103"></a><span class="k">              </span><span class="n">Ifaces</span><span class="p">(</span> <span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-104"></a>              <span class="n">Ifaces</span><span class="p">(</span> <span class="mi">0</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-105"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-106"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-107"></a>              <span class="n">Ifaces</span><span class="p">(</span> <span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-108"></a>              <span class="n">Ifaces</span><span class="p">(</span> <span class="mi">0</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-109"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-110"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-111"></a>              <span class="n">Ifaces</span><span class="p">(</span> <span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-112"></a>              <span class="n">Ifaces</span><span class="p">(</span> <span class="mi">0</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-113"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-114"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-115"></a>            <span class="k">end if</span>
<a name="ln-116"></a>
<a name="ln-117"></a><span class="k">            if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">imax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-118"></a><span class="k">              </span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-119"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-120"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-121"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nx</span>
<a name="ln-122"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-123"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-124"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-125"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">ny</span>
<a name="ln-126"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-127"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-128"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-129"></a>              <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:)%</span><span class="n">nz</span>
<a name="ln-130"></a>            <span class="k">end if</span>
<a name="ln-131"></a>
<a name="ln-132"></a><span class="k">            if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">jmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-133"></a><span class="k">              </span><span class="n">Jfaces</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-134"></a>              <span class="n">Jfaces</span><span class="p">(:,</span> <span class="mi">0</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-135"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-136"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-137"></a>              <span class="n">Jfaces</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-138"></a>              <span class="n">Jfaces</span><span class="p">(:,</span> <span class="mi">0</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-139"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-140"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-141"></a>              <span class="n">Jfaces</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-142"></a>              <span class="n">Jfaces</span><span class="p">(:,</span> <span class="mi">0</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-143"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-144"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="o">-</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-145"></a>            <span class="k">end if</span>
<a name="ln-146"></a>
<a name="ln-147"></a><span class="k">            if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">jmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-148"></a><span class="k">              </span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-149"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-150"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-151"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nx</span>
<a name="ln-152"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-153"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-154"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-155"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">ny</span>
<a name="ln-156"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">0</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-157"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-158"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-159"></a>              <span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,:)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Jfaces</span><span class="p">(:,</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:)%</span><span class="n">nz</span>
<a name="ln-160"></a>            <span class="k">end if</span>
<a name="ln-161"></a>
<a name="ln-162"></a><span class="k">            if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">kmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-163"></a><span class="k">              </span><span class="n">Kfaces</span><span class="p">(:,:,</span> <span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-164"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span> <span class="mi">0</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-165"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-166"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-167"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span> <span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-168"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span> <span class="mi">0</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-169"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-170"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-171"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span> <span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-172"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span> <span class="mi">0</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-173"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-174"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">2</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-175"></a>            <span class="k">end if</span>
<a name="ln-176"></a>
<a name="ln-177"></a><span class="k">            if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">kmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-178"></a><span class="k">              </span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">0</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-179"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-180"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-181"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)%</span><span class="n">nx</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-182"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">0</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-183"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-184"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-185"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)%</span><span class="n">ny</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-186"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">0</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-187"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-188"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-189"></a>              <span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)%</span><span class="n">nz</span><span class="o">=</span><span class="n">Kfaces</span><span class="p">(:,:,</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-190"></a>            <span class="k">end if</span>
<a name="ln-191"></a>
<a name="ln-192"></a><span class="k">            </span>
<a name="ln-193"></a><span class="k">        end subroutine </span><span class="n">normalize_face_normals</span>
<a name="ln-194"></a>
<a name="ln-195"></a>        <span class="k">subroutine </span><span class="n">compute_face_areas</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-196"></a>            <span class="c">!&lt; Compute face areas based on area vectors</span>
<a name="ln-197"></a>            <span class="c">!&lt;</span>
<a name="ln-198"></a>            <span class="c">!&lt; The face areas are computed using the face area vectors. </span>
<a name="ln-199"></a>            <span class="c">!&lt; Prior to using this subroutine, the face area vectors must</span>
<a name="ln-200"></a>            <span class="c">!&lt; computed and placed in the face normal variables. </span>
<a name="ln-201"></a>            <span class="c">!&lt;</span>
<a name="ln-202"></a>            <span class="c">!&lt; Since the area is given by abs(d1 x d2), the areas are</span>
<a name="ln-203"></a>            <span class="c">!&lt; calculated using the normal vectors calculated in </span>
<a name="ln-204"></a>            <span class="c">!&lt; compute_face_area_vectors, but before normalising them</span>
<a name="ln-205"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-206"></a>            
<a name="ln-207"></a>            <span class="k">implicit none</span>
<a name="ln-208"></a><span class="k">            type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-209"></a>            <span class="c">!&lt; Store face quantites for I faces: normal and area</span>
<a name="ln-210"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-211"></a>            <span class="c">!&lt; Store face quantites for J faces: normal and area</span>
<a name="ln-212"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-213"></a>            <span class="c">!&lt; Store face quantites for K faces: normal and area</span>
<a name="ln-214"></a>            <span class="k">type</span><span class="p">(</span><span class="n">boundarytype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>
<a name="ln-215"></a>
<a name="ln-216"></a>            <span class="n">Ifaces</span><span class="p">(:,:,:)%</span><span class="n">A</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">Ifaces</span><span class="p">(:,:,:)%</span><span class="n">nx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ifaces</span><span class="p">(:,:,:)%</span><span class="n">ny</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-217"></a>                                  <span class="p">(</span><span class="n">Ifaces</span><span class="p">(:,:,:)%</span><span class="n">nz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-218"></a>
<a name="ln-219"></a>            <span class="n">Jfaces</span><span class="p">(:,:,:)%</span><span class="n">A</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">Jfaces</span><span class="p">(:,:,:)%</span><span class="n">nx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Jfaces</span><span class="p">(:,:,:)%</span><span class="n">ny</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-220"></a>                                  <span class="p">(</span><span class="n">Jfaces</span><span class="p">(:,:,:)%</span><span class="n">nz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-221"></a>
<a name="ln-222"></a>            <span class="n">Kfaces</span><span class="p">(:,:,:)%</span><span class="n">A</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">Kfaces</span><span class="p">(:,:,:)%</span><span class="n">nx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Kfaces</span><span class="p">(:,:,:)%</span><span class="n">ny</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-223"></a>                                  <span class="p">(</span><span class="n">Kfaces</span><span class="p">(:,:,:)%</span><span class="n">nz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-224"></a>
<a name="ln-225"></a>            <span class="c">! Pole boundary conditions</span>
<a name="ln-226"></a>            <span class="c">! making sure face area is exactly equal zero</span>
<a name="ln-227"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">imin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">Ifaces</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span>     <span class="p">,</span>  <span class="p">:,</span>  <span class="p">:)%</span><span class="n">A</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-228"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">imax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">imx</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>  <span class="p">:,</span>  <span class="p">:)%</span><span class="n">A</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-229"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">jmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">Jfaces</span><span class="p">(</span>  <span class="p">:,</span>     <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="p">:)%</span><span class="n">A</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-230"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">jmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">Jfaces</span><span class="p">(</span>  <span class="p">:,</span><span class="n">jmx</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>  <span class="p">:)%</span><span class="n">A</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-231"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">kmin_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">Kfaces</span><span class="p">(</span>  <span class="p">:,</span>  <span class="p">:,</span>     <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-232"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc</span><span class="p">%</span><span class="n">kmax_id</span><span class="o">==-</span><span class="mi">7</span><span class="p">)</span> <span class="n">Kfaces</span><span class="p">(</span>  <span class="p">:,</span>  <span class="p">:,</span><span class="n">kmx</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)%</span><span class="n">A</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-233"></a>
<a name="ln-234"></a>        <span class="k">end subroutine </span><span class="n">compute_face_areas</span>
<a name="ln-235"></a>
<a name="ln-236"></a>        <span class="k">subroutine </span><span class="n">compute_face_area_vectors</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<a name="ln-237"></a>            <span class="c">!&lt; Compute face area vectors</span>
<a name="ln-238"></a>            <span class="c">!&lt;</span>
<a name="ln-239"></a>            <span class="c">!&lt; The face area vectors denote the face area both in </span>
<a name="ln-240"></a>            <span class="c">!&lt; magnitude and direction. They are placed in the face </span>
<a name="ln-241"></a>            <span class="c">!&lt; normal variables for further calculation.</span>
<a name="ln-242"></a>            <span class="c">!&lt;</span>
<a name="ln-243"></a>            <span class="c">!&lt; The face normal is given by d1 x d2, where d1 and d2 are</span>
<a name="ln-244"></a>            <span class="c">!&lt; the diagonals of a face</span>
<a name="ln-245"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-246"></a>            
<a name="ln-247"></a>            <span class="k">implicit none</span>
<a name="ln-248"></a><span class="k">            type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-249"></a>            <span class="c">!&lt; Store face quantites for I faces: normal and area</span>
<a name="ln-250"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-251"></a>            <span class="c">!&lt; Store face quantites for J faces: normal and area</span>
<a name="ln-252"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-253"></a>            <span class="c">!&lt; Store face quantites for K faces: normal and area</span>
<a name="ln-254"></a>            <span class="k">type</span><span class="p">(</span><span class="n">nodetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nodes</span>
<a name="ln-255"></a>            <span class="c">!&lt; Grid points</span>
<a name="ln-256"></a>
<a name="ln-257"></a>    
<a name="ln-258"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d1x</span><span class="p">,</span> <span class="n">d2x</span><span class="p">,</span> <span class="n">d1y</span><span class="p">,</span> <span class="n">d2y</span><span class="p">,</span> <span class="n">d1z</span><span class="p">,</span> <span class="n">d2z</span>
<a name="ln-259"></a>            <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-260"></a>
<a name="ln-261"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-262"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-263"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-264"></a>                <span class="n">d1x</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span>
<a name="ln-265"></a>                <span class="n">d1y</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span>
<a name="ln-266"></a>                <span class="n">d1z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span>
<a name="ln-267"></a>                <span class="n">d2x</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span>
<a name="ln-268"></a>                <span class="n">d2y</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span>
<a name="ln-269"></a>                <span class="n">d2z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span>
<a name="ln-270"></a>                <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1y</span><span class="o">*</span><span class="n">d2z</span> <span class="o">-</span> <span class="n">d1z</span><span class="o">*</span><span class="n">d2y</span><span class="p">)</span>
<a name="ln-271"></a>                <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1z</span><span class="o">*</span><span class="n">d2x</span> <span class="o">-</span> <span class="n">d1x</span><span class="o">*</span><span class="n">d2z</span><span class="p">)</span>
<a name="ln-272"></a>                <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1x</span><span class="o">*</span><span class="n">d2y</span> <span class="o">-</span> <span class="n">d1y</span><span class="o">*</span><span class="n">d2x</span><span class="p">)</span>
<a name="ln-273"></a>               <span class="k">end do</span>
<a name="ln-274"></a><span class="k">              end do</span>
<a name="ln-275"></a><span class="k">             end do</span>
<a name="ln-276"></a>
<a name="ln-277"></a>
<a name="ln-278"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-279"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-280"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-281"></a>               <span class="n">d1x</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span>
<a name="ln-282"></a>               <span class="n">d1y</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span>
<a name="ln-283"></a>               <span class="n">d1z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span>
<a name="ln-284"></a>               <span class="n">d2x</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span>
<a name="ln-285"></a>               <span class="n">d2y</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span>
<a name="ln-286"></a>               <span class="n">d2z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span>
<a name="ln-287"></a>            
<a name="ln-288"></a>               <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1y</span><span class="o">*</span><span class="n">d2z</span> <span class="o">-</span> <span class="n">d1z</span><span class="o">*</span><span class="n">d2y</span><span class="p">)</span>
<a name="ln-289"></a>               <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1z</span><span class="o">*</span><span class="n">d2x</span> <span class="o">-</span> <span class="n">d1x</span><span class="o">*</span><span class="n">d2z</span><span class="p">)</span>
<a name="ln-290"></a>               <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1x</span><span class="o">*</span><span class="n">d2y</span> <span class="o">-</span> <span class="n">d1y</span><span class="o">*</span><span class="n">d2x</span><span class="p">)</span>
<a name="ln-291"></a>              <span class="k">end do</span>
<a name="ln-292"></a><span class="k">             end do</span>
<a name="ln-293"></a><span class="k">            end do</span>
<a name="ln-294"></a>
<a name="ln-295"></a><span class="k">            </span>
<a name="ln-296"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">3</span>
<a name="ln-297"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-298"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-299"></a>               <span class="n">d1x</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span>
<a name="ln-300"></a>               <span class="n">d1y</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span>
<a name="ln-301"></a>               <span class="n">d1z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span>
<a name="ln-302"></a>               <span class="n">d2x</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">x</span>
<a name="ln-303"></a>               <span class="n">d2y</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">y</span>
<a name="ln-304"></a>               <span class="n">d2z</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">-</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">z</span>
<a name="ln-305"></a>            
<a name="ln-306"></a>               <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1y</span><span class="o">*</span><span class="n">d2z</span> <span class="o">-</span> <span class="n">d1z</span><span class="o">*</span><span class="n">d2y</span><span class="p">)</span>
<a name="ln-307"></a>               <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1z</span><span class="o">*</span><span class="n">d2x</span> <span class="o">-</span> <span class="n">d1x</span><span class="o">*</span><span class="n">d2z</span><span class="p">)</span>
<a name="ln-308"></a>               <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d1x</span><span class="o">*</span><span class="n">d2y</span> <span class="o">-</span> <span class="n">d1y</span><span class="o">*</span><span class="n">d2x</span><span class="p">)</span>
<a name="ln-309"></a>              <span class="k">end do</span>
<a name="ln-310"></a><span class="k">             end do</span>
<a name="ln-311"></a><span class="k">            end do</span>
<a name="ln-312"></a>
<a name="ln-313"></a>
<a name="ln-314"></a><span class="k">        end subroutine </span><span class="n">compute_face_area_vectors</span>
<a name="ln-315"></a>
<a name="ln-316"></a>        <span class="k">subroutine </span><span class="n">compute_face_areas_and_normals</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span><span class="n">Jfaces</span><span class="p">,</span><span class="n">Kfaces</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-317"></a>            <span class="c">!&lt; Compute the face areas and normals</span>
<a name="ln-318"></a>            <span class="c">!&lt;</span>
<a name="ln-319"></a>            <span class="c">!&lt; This is the 2-dimensional version. In this case, the face </span>
<a name="ln-320"></a>            <span class="c">!&lt; areas default to edge lengths.</span>
<a name="ln-321"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-322"></a>
<a name="ln-323"></a>            <span class="k">implicit none</span>
<a name="ln-324"></a><span class="k">            type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-325"></a>            <span class="c">!&lt; Store face quantites for I faces: normal and area</span>
<a name="ln-326"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-327"></a>            <span class="c">!&lt; Store face quantites for J faces: normal and area</span>
<a name="ln-328"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-329"></a>            <span class="c">!&lt; Store face quantites for K faces: normal and area</span>
<a name="ln-330"></a>            <span class="k">type</span><span class="p">(</span><span class="n">nodetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nodes</span>
<a name="ln-331"></a>            <span class="c">!&lt; Grid points</span>
<a name="ln-332"></a>            <span class="k">type</span><span class="p">(</span><span class="n">boundarytype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>
<a name="ln-333"></a>            <span class="c">!&lt; boundary condition and fixed values</span>
<a name="ln-334"></a>
<a name="ln-335"></a>            <span class="k">call </span><span class="n">compute_face_area_vectors</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span><span class="n">Jfaces</span><span class="p">,</span><span class="n">Kfaces</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<a name="ln-336"></a>            <span class="k">call </span><span class="n">compute_face_areas</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span><span class="n">Jfaces</span><span class="p">,</span><span class="n">Kfaces</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-337"></a>            <span class="k">call </span><span class="n">normalize_face_normals</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span><span class="n">Jfaces</span><span class="p">,</span><span class="n">Kfaces</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-338"></a>        
<a name="ln-339"></a>        <span class="k">end subroutine </span><span class="n">compute_face_areas_and_normals</span>
<a name="ln-340"></a>       
<a name="ln-341"></a>        <span class="k">function </span><span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
<a name="ln-342"></a>            <span class="c">!&lt; Compute the volume of a tetrahedron, given 4 points which</span>
<a name="ln-343"></a>            <span class="c">!&lt; are 1-D arrays</span>
<a name="ln-344"></a>            <span class="c">!&lt; Since we know that the determinant is to be evaluated of </span>
<a name="ln-345"></a>            <span class="c">!&lt; a 3x3 matrix, we write the expression itself</span>
<a name="ln-346"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-347"></a>
<a name="ln-348"></a>            <span class="k">implicit none</span>
<a name="ln-349"></a><span class="k">            </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span>
<a name="ln-350"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A</span>
<a name="ln-351"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vol_tetrahedron</span>
<a name="ln-352"></a>
<a name="ln-353"></a>            <span class="n">A</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p4</span>
<a name="ln-354"></a>            <span class="n">A</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p4</span>
<a name="ln-355"></a>            <span class="n">A</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">-</span> <span class="n">p4</span>
<a name="ln-356"></a>
<a name="ln-357"></a>            <span class="c">!vol_tetrahedron = A(1,1) * (A(2,2)*A(3,3) - A(2,3)*A(3,2)) + &amp;</span>
<a name="ln-358"></a>            <span class="c">!                  A(1,2) * (A(2,3)*A(3,1) - A(2,1)*A(3,3)) + &amp;</span>
<a name="ln-359"></a>            <span class="c">!                  A(1,3) * (A(2,1)*A(3,2) - A(2,2)*A(3,1))</span>
<a name="ln-360"></a>            <span class="n">vol_tetrahedron</span> <span class="o">=</span> <span class="p">(</span><span class="n">p4</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">p2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="p">&amp;</span>
<a name="ln-361"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">p4</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">p2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span> <span class="p">&amp;</span>
<a name="ln-362"></a>                            <span class="o">+</span> <span class="p">(</span><span class="n">p4</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-363"></a>            <span class="n">vol_tetrahedron</span> <span class="o">=</span> <span class="o">-</span><span class="n">vol_tetrahedron</span> <span class="o">/</span> <span class="mf">6.</span>                  
<a name="ln-364"></a>        
<a name="ln-365"></a>        <span class="k">end function </span><span class="n">vol_tetrahedron</span>
<a name="ln-366"></a>        
<a name="ln-367"></a>        <span class="k">function </span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">)</span>
<a name="ln-368"></a>            <span class="c">!&lt; Compute the volume of a hexahedron, given a list of points</span>
<a name="ln-369"></a>            <span class="c">! The points are arranged in a specific order. For the </span>
<a name="ln-370"></a>            <span class="c">! element i,j,k, the order of nodes required are:</span>
<a name="ln-371"></a>            <span class="c">! i,j,k</span>
<a name="ln-372"></a>            <span class="c">! i+1, j, k</span>
<a name="ln-373"></a>            <span class="c">! i+1, j+1, k</span>
<a name="ln-374"></a>            <span class="c">! i, j+1, k</span>
<a name="ln-375"></a>            <span class="c">! i, j, k+1</span>
<a name="ln-376"></a>            <span class="c">! i+1, j, k+1</span>
<a name="ln-377"></a>            <span class="c">! i+1, j+1, k+1</span>
<a name="ln-378"></a>            <span class="c">! i, j+1, k+1</span>
<a name="ln-379"></a>            <span class="c">!</span>
<a name="ln-380"></a>            <span class="c">! The hexahedron is to be split into 5 tetrahedrons. </span>
<a name="ln-381"></a>            <span class="c">! Source: Split hex into 5 tetrahedron:</span>
<a name="ln-382"></a>            <span class="c">! No assumptions about planarity seem to be made. All cuts </span>
<a name="ln-383"></a>            <span class="c">! were made with a plane containing only 3 vertices at a time.</span>
<a name="ln-384"></a>            <span class="c">! https://ieeexplore.ieee.org/ieee_pilot/articles/06/ttg2009061587/assets/img/article_1/fig_6/large.gif</span>
<a name="ln-385"></a>            <span class="c">!</span>
<a name="ln-386"></a>            <span class="c">! The indices of the 5 split tetrahedra can be visualised from</span>
<a name="ln-387"></a>            <span class="c">! the above link. But since the volume of each tetrahedron </span>
<a name="ln-388"></a>            <span class="c">! depends on the determinant calculated, it is IMPERATIVE to </span>
<a name="ln-389"></a>            <span class="c">! ensure that a &quot;correct&quot; order is followed for the 4 points. </span>
<a name="ln-390"></a>            <span class="c">!            </span>
<a name="ln-391"></a>            <span class="c">! The logic to get the &quot;correct&quot; order is explained as </span>
<a name="ln-392"></a>            <span class="c">! follows (Refer wiki article on parallelepiped):</span>
<a name="ln-393"></a>            <span class="c">! The determinant is taken of a matrix of pi - p4, i = 1, 2, 3. </span>
<a name="ln-394"></a>            <span class="c">! Graphically it denotes the sides with p4 as common vertex, </span>
<a name="ln-395"></a>            <span class="c">! with direction outward from p4, i.e., directed from </span>
<a name="ln-396"></a>            <span class="c">! p4 to pi, i = 1, 2, 3</span>
<a name="ln-397"></a>            <span class="c">! Hence, if you ensure that  cross(p1-p4, p2-p4) is along </span>
<a name="ln-398"></a>            <span class="c">! p3-p4, then the determinant will be positive.</span>
<a name="ln-399"></a>            <span class="c">!</span>
<a name="ln-400"></a>            <span class="c">! From the above link, a set of 5 tetrahedra was obtained. </span>
<a name="ln-401"></a>            <span class="c">! Each tetrahedra has 4 points, and in the function calls </span>
<a name="ln-402"></a>            <span class="c">! below, care was taken to ensure that the order is observed</span>
<a name="ln-403"></a>            <span class="c">! while passing parameters into the vol_tetrahedron function</span>
<a name="ln-404"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-405"></a>
<a name="ln-406"></a>            <span class="k">implicit none</span>
<a name="ln-407"></a><span class="k">            </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_list</span>
<a name="ln-408"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vol_hexahedron</span>
<a name="ln-409"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vol_hexahedron1</span>
<a name="ln-410"></a>            
<a name="ln-411"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-412"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-413"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-414"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">))</span>
<a name="ln-415"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-416"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-417"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-418"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-419"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-420"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-421"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-422"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-423"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">))</span>
<a name="ln-424"></a>            <span class="n">vol_hexahedron1</span> <span class="o">=</span> <span class="n">vol_hexahedron1</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-425"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-426"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-427"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-428"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-429"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-430"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-431"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-432"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">8</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-433"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-434"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-435"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-436"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-437"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-438"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-439"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-440"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="n">vol_hexahedron</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-441"></a>                             <span class="n">vol_tetrahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-442"></a>                                             <span class="n">p_list</span><span class="p">(:,</span><span class="mi">7</span><span class="p">),</span> <span class="n">p_list</span><span class="p">(:,</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-443"></a>
<a name="ln-444"></a>            <span class="n">vol_hexahedron</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">,</span><span class="n">vol_hexahedron1</span><span class="p">)</span>
<a name="ln-445"></a>            
<a name="ln-446"></a>        <span class="k">end function </span><span class="n">vol_hexahedron</span>
<a name="ln-447"></a>        
<a name="ln-448"></a>        <span class="k">subroutine </span><span class="n">compute_volumes</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<a name="ln-449"></a>            <span class="c">!&lt; Compute the grid cell volumes</span>
<a name="ln-450"></a>            <span class="c">!&lt; Each grid is a hexahedron, whose volume is calculated by</span>
<a name="ln-451"></a>            <span class="c">!&lt; splitting it into 5 tetrahedrons, whose volume is known</span>
<a name="ln-452"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-453"></a>
<a name="ln-454"></a>            <span class="k">implicit none</span>
<a name="ln-455"></a><span class="k">            type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-456"></a>            <span class="c">!&lt; Cell center quanties: volume and coordiantes of cell center</span>
<a name="ln-457"></a>            <span class="k">type</span><span class="p">(</span><span class="n">nodetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nodes</span>
<a name="ln-458"></a>            <span class="c">!&lt; Grid points</span>
<a name="ln-459"></a>            <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-460"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_list</span>
<a name="ln-461"></a>
<a name="ln-462"></a>            <span class="n">cells</span><span class="p">(:,:,:)%</span><span class="n">volume</span><span class="o">=</span><span class="mf">1.</span>
<a name="ln-463"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">0</span>
<a name="ln-464"></a>                <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">0</span>
<a name="ln-465"></a>                    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">0</span>
<a name="ln-466"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-467"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-468"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-469"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-470"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-471"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-472"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-473"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-474"></a>                        <span class="n">p_list</span><span class="p">(:,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span><span class="p">,</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-475"></a>                        <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
<a name="ln-476"></a>                        <span class="k">if</span><span class="p">(</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-477"></a><span class="k">                          if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">i</span><span class="o">==</span><span class="n">imx</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">j</span><span class="o">==</span><span class="n">jmx</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">k</span><span class="o">==</span><span class="n">kmx</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-478"></a>                            <span class="c">!print*, &quot;Ghost Cell volume negative&quot;</span>
<a name="ln-479"></a>                            <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
<a name="ln-480"></a>                          <span class="k">else</span>
<a name="ln-481"></a><span class="k">                            print</span><span class="o">*</span><span class="p">,</span> <span class="n">process_id</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-482"></a>                            <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;negative volume :&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vol_hexahedron</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
<a name="ln-483"></a>                            <span class="k">STOP</span>
<a name="ln-484"></a><span class="k">                          end if</span>
<a name="ln-485"></a><span class="k">                        end if</span>
<a name="ln-486"></a><span class="k">                    end do</span>
<a name="ln-487"></a><span class="k">                end do</span>
<a name="ln-488"></a><span class="k">            end do</span>
<a name="ln-489"></a><span class="k">            if</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">cells</span><span class="p">(:,:,:)%</span><span class="n">volume</span><span class="o">==</span><span class="mf">0.0</span><span class="p">))</span><span class="k">then</span>
<a name="ln-490"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-491"></a>            <span class="k">end if</span>
<a name="ln-492"></a><span class="k">            if</span><span class="p">(</span><span class="nb">any</span><span class="p">((</span><span class="n">cells</span><span class="p">(:,:,:)%</span><span class="n">volume</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">))</span><span class="k">then</span>
<a name="ln-493"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-494"></a>            <span class="k">end if</span>
<a name="ln-495"></a><span class="k">            </span>
<a name="ln-496"></a><span class="k">        end subroutine </span><span class="n">compute_volumes</span>
<a name="ln-497"></a>
<a name="ln-498"></a>
<a name="ln-499"></a>
<a name="ln-500"></a>        <span class="k">subroutine </span><span class="n">compute_ghost_cell_centroid</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<a name="ln-501"></a>          <span class="c">!&lt; Compute cell center of all cell including ghost cells</span>
<a name="ln-502"></a>          <span class="k">implicit none</span>
<a name="ln-503"></a><span class="k">          type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-504"></a>          <span class="c">!&lt; Cell center quanties: volume and coordiantes of cell center</span>
<a name="ln-505"></a>          <span class="k">type</span><span class="p">(</span><span class="n">nodetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nodes</span>
<a name="ln-506"></a>          <span class="c">!&lt; Grid points</span>
<a name="ln-507"></a>          <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-508"></a>
<a name="ln-509"></a>          <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-510"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-511"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span>
<a name="ln-512"></a>                <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">=</span> <span class="mf">0.125</span> <span class="o">*</span><span class="p">(</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-513"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-514"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-515"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-516"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-517"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-518"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-519"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">x</span> <span class="p">&amp;</span>
<a name="ln-520"></a>                                              <span class="p">)</span>
<a name="ln-521"></a>
<a name="ln-522"></a>                <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">=</span> <span class="mf">0.125</span> <span class="o">*</span><span class="p">(</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-523"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-524"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-525"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-526"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-527"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-528"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-529"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">y</span> <span class="p">&amp;</span>
<a name="ln-530"></a>                                              <span class="p">)</span>
<a name="ln-531"></a>
<a name="ln-532"></a>                <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">=</span> <span class="mf">0.125</span> <span class="o">*</span><span class="p">(</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-533"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-534"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-535"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-536"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-537"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-538"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-539"></a>                                              <span class="o">+</span> <span class="n">nodes</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">z</span>  <span class="p">&amp;</span>
<a name="ln-540"></a>                                              <span class="p">)</span>
<a name="ln-541"></a>              <span class="k">end do</span>
<a name="ln-542"></a><span class="k">            end do</span>
<a name="ln-543"></a><span class="k">          end do</span>
<a name="ln-544"></a>
<a name="ln-545"></a><span class="k">        end subroutine </span><span class="n">compute_ghost_cell_centroid</span>
<a name="ln-546"></a>
<a name="ln-547"></a>
<a name="ln-548"></a>        <span class="k">subroutine </span><span class="n">setup_geometry</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-549"></a>            <span class="c">!&lt; Make the geometry module useful</span>
<a name="ln-550"></a>            <span class="c">!&lt;</span>
<a name="ln-551"></a>            <span class="c">!&lt; Allocates memory to the variables and initializes them.</span>
<a name="ln-552"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-553"></a>
<a name="ln-554"></a>            <span class="k">implicit none</span>
<a name="ln-555"></a><span class="k">            type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-556"></a>            <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-557"></a>            <span class="c">!&lt; Cell center quanties: volume and coordiantes of cell center</span>
<a name="ln-558"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-559"></a>            <span class="c">!&lt; Store face quantites for I faces: normal and area</span>
<a name="ln-560"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-561"></a>            <span class="c">!&lt; Store face quantites for J faces: normal and area</span>
<a name="ln-562"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-563"></a>            <span class="c">!&lt; Store face quantites for K faces: normal and area</span>
<a name="ln-564"></a>            <span class="k">type</span><span class="p">(</span><span class="n">nodetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nodes</span>
<a name="ln-565"></a>            <span class="c">!&lt; Grid points</span>
<a name="ln-566"></a>            <span class="k">type</span><span class="p">(</span><span class="n">boundarytype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>
<a name="ln-567"></a>            <span class="c">!&lt; boundary conditions and fixed values</span>
<a name="ln-568"></a>
<a name="ln-569"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;setup_geometry&#39;</span><span class="p">)</span>
<a name="ln-570"></a>
<a name="ln-571"></a>            <span class="n">imx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-572"></a>            <span class="n">jmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-573"></a>            <span class="n">kmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-574"></a>
<a name="ln-575"></a>            <span class="k">call </span><span class="n">allocate_memory</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">)</span>
<a name="ln-576"></a>            <span class="k">call </span><span class="n">compute_face_areas_and_normals</span><span class="p">(</span><span class="n">Ifaces</span><span class="p">,</span><span class="n">Jfaces</span><span class="p">,</span><span class="n">Kfaces</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<a name="ln-577"></a>            <span class="k">call </span><span class="n">compute_volumes</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<a name="ln-578"></a>            <span class="k">call </span><span class="n">compute_ghost_cell_centroid</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
<a name="ln-579"></a>
<a name="ln-580"></a>        <span class="k">end subroutine </span><span class="n">setup_geometry</span>
<a name="ln-581"></a>
<a name="ln-582"></a>
<a name="ln-583"></a><span class="k">end module </span><span class="n">geometry</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-12-28T21:23:55.181614 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>