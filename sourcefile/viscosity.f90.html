<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>viscosity.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>viscosity.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.3% of total for source files.">455 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/viscosity.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">viscosity.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/viscosity.html">viscosity</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/viscosity.f90.html#src">viscosity.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>Setup, destroy, calculate molecular and turbulence viscosity</p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~viscosity.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileviscosityf90EfferentGraph" width="409pt" height="238pt"
 viewBox="0.00 0.00 409.00 238.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~viscosity.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 234)">
<title>sourcefile~~viscosity.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-234 405,-234 405,4 -4,4"/>
<!-- sourcefile~viscosity.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~viscosity.f90</title>
<polygon fill="none" stroke="#000000" points="401,-125 331,-125 331,-101 401,-101 401,-125"/>
<text text-anchor="middle" x="366" y="-110.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">viscosity.f90</text>
</g>
<!-- sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~global_sa.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/global_sa.f90.html" xlink:title="global_sa.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="293.5,-230 217.5,-230 217.5,-206 293.5,-206 293.5,-230"/>
<text text-anchor="middle" x="255.5" y="-215.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sa.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sa.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M358.0157,-125.108C345.9844,-142.6576 321.7504,-175.4185 295,-197 293.6286,-198.1064 292.1901,-199.1816 290.7071,-200.2225"/>
<polygon fill="#ff0000" stroke="#ff0000" points="288.476,-197.4916 281.8847,-205.7865 292.2101,-203.4125 288.476,-197.4916"/>
</g>
<!-- sourcefile~copy_bc.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~copy_bc.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/copy_bc.f90.html" xlink:title="copy_bc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="290.5,-188 220.5,-188 220.5,-164 290.5,-164 290.5,-188"/>
<text text-anchor="middle" x="255.5" y="-173.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">copy_bc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~copy_bc.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~copy_bc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M346.2477,-125.0112C332.0798,-133.5461 312.4849,-145.1872 295,-155 292.6062,-156.3434 290.1205,-157.7162 287.6139,-159.0846"/>
<polygon fill="#ff0000" stroke="#ff0000" points="285.7121,-156.1336 278.5716,-163.9607 289.0346,-162.2948 285.7121,-156.1336"/>
</g>
<!-- sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~global_kkl.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/global_kkl.f90.html" xlink:title="global_kkl.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="294.5,-146 216.5,-146 216.5,-122 294.5,-122 294.5,-146"/>
<text text-anchor="middle" x="255.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_kkl.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_kkl.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M330.7333,-119.7023C322.3812,-121.2895 313.325,-123.0106 304.4854,-124.6905"/>
<polygon fill="#ff0000" stroke="#ff0000" points="303.8172,-121.2548 294.6465,-126.5604 305.1241,-128.1317 303.8172,-121.2548"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="282.5,-104 228.5,-104 228.5,-80 282.5,-80 282.5,-104"/>
<text text-anchor="middle" x="255.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M330.7333,-106.2977C318.5945,-103.9908 304.9683,-101.4012 292.6818,-99.0662"/>
<polygon fill="#ff0000" stroke="#ff0000" points="293.2158,-95.6051 282.7382,-97.1765 291.9088,-102.4821 293.2158,-95.6051"/>
</g>
<!-- sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~global_vars.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/global_vars.f90.html" xlink:title="global_vars.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="180,-104 95,-104 95,-80 180,-80 180,-104"/>
<text text-anchor="middle" x="137.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_vars.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M351.0322,-100.8827C337.3679,-90.6558 316.1351,-76.7832 295,-71 257.1855,-60.6528 212.816,-68.2663 180.8237,-77.0875"/>
<polygon fill="#ff0000" stroke="#ff0000" points="179.5215,-73.8211 170.8956,-79.9727 181.4751,-80.543 179.5215,-73.8211"/>
</g>
<!-- sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~global_sst.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/global_sst.f90.html" xlink:title="global_sst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="295,-24 216,-24 216,0 295,0 295,-24"/>
<text text-anchor="middle" x="255.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M355.947,-100.7433C342.841,-85.1696 318.7751,-57.9226 295,-38 291.6727,-35.2119 288.0349,-32.4664 284.3566,-29.8647"/>
<polygon fill="#ff0000" stroke="#ff0000" points="286.0736,-26.8008 275.8279,-24.1032 282.1551,-32.6013 286.0736,-26.8008"/>
</g>
<!-- sourcefile~copy_bc.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~copy_bc.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M230.8534,-163.8163C225.8374,-161.0829 220.6699,-158.076 216,-155 195.6835,-141.6175 174.2483,-124.1586 158.9196,-111.0147"/>
<polygon fill="#ffff00" stroke="#ffff00" points="160.9245,-108.1205 151.0778,-104.2098 156.3366,-113.4074 160.9245,-108.1205"/>
</g>
<!-- sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M228.4284,-92C217.1536,-92 203.6527,-92 190.5475,-92"/>
<polygon fill="#00ffff" stroke="#00ffff" points="190.1724,-88.5001 180.1724,-92 190.1723,-95.5001 190.1724,-88.5001"/>
</g>
<!-- sourcefile~global.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~global.f90</title>
<g id="a_sourcefile~~viscosity.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/global.f90.html" xlink:title="global.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="59,-104 0,-104 0,-80 59,-80 59,-104"/>
<text text-anchor="middle" x="29.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global.f90</text>
</a>
</g>
</g>
<!-- sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~viscosity.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M94.8155,-92C86.4413,-92 77.6869,-92 69.4077,-92"/>
<polygon fill="#0000ff" stroke="#0000ff" points="69.2393,-88.5001 59.2392,-92 69.2392,-95.5001 69.2393,-88.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~viscosity.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileviscosityf90AfferentGraph" width="481pt" height="52pt"
 viewBox="0.00 0.00 481.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~viscosity.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~viscosity.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 477,-48 477,4 -4,4"/>
<!-- sourcefile~viscosity.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~viscosity.f90</title>
<polygon fill="none" stroke="#000000" points="70,-44 0,-44 0,-20 70,-20 70,-44"/>
<text text-anchor="middle" x="35" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">viscosity.f90</text>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~viscosity.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="265,-44 206,-44 206,-20 265,-20 265,-44"/>
<text text-anchor="middle" x="235.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M205.8294,-32.5488C194.6047,-32.7312 181.7137,-32.9106 170,-33 141.5564,-33.2171 134.4437,-33.2003 106,-33 97.6743,-32.9414 88.7997,-32.8441 80.2455,-32.7326"/>
<polygon fill="#ff0000" stroke="#ff0000" points="80.076,-29.23 70.0285,-32.5912 79.9791,-36.2293 80.076,-29.23"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~viscosity.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="170,-24 106,-24 106,0 170,0 170,-24"/>
<text text-anchor="middle" x="138" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M205.9822,-25.9451C197.8447,-24.2758 188.8557,-22.4319 180.1525,-20.6467"/>
<polygon fill="#00ffff" stroke="#00ffff" points="180.6345,-17.1727 170.1352,-18.5918 179.2278,-24.03 180.6345,-17.1727"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M105.9748,-18.2185C97.8252,-19.8009 88.9127,-21.5315 80.2405,-23.2154"/>
<polygon fill="#ff0000" stroke="#ff0000" points="79.3801,-19.817 70.2306,-25.1591 80.7145,-26.6887 79.3801,-19.817"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~viscosity.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="473,-44 419,-44 419,-20 473,-20 473,-44"/>
<text text-anchor="middle" x="446" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M418.7124,-32.5275C407.6304,-32.7172 394.7042,-32.9071 383,-33 346.5567,-33.2892 337.4434,-33.2782 301,-33 292.6723,-32.9364 283.7495,-32.8274 275.2535,-32.7041"/>
<polygon fill="#ff0000" stroke="#ff0000" points="275.2233,-29.2034 265.1706,-32.5488 275.1154,-36.2025 275.2233,-29.2034"/>
</g>
<!-- sourcefile~start_finish.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~start_finish.f90</title>
<g id="a_sourcefile~~viscosity.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/start_finish.f90.html" xlink:title="start_finish.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="383,-24 301,-24 301,0 383,0 383,-24"/>
<text text-anchor="middle" x="342" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_finish.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M418.9467,-26.7974C410.9882,-25.267 402.0079,-23.54 393.0646,-21.8201"/>
<polygon fill="#00ffff" stroke="#00ffff" points="393.5205,-18.3437 383.0394,-19.8922 392.1985,-25.2178 393.5205,-18.3437"/>
</g>
<!-- sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~viscosity.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M300.8243,-19.7325C292.3352,-21.3267 283.4138,-23.0021 274.9863,-24.5847"/>
<polygon fill="#ff0000" stroke="#ff0000" points="274.1959,-21.1719 265.0137,-26.4575 275.4879,-28.0516 274.1959,-21.1719"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/viscosity.html">viscosity</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/viscosity.f90.html#src">viscosity.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; Setup, destroy, calculate molecular and turbulence viscosity</span>
<a name="ln-2"></a><span class="k">module </span><span class="n">viscosity</span>
<a name="ln-3"></a>  <span class="c">!&lt; Setup, destroy, calculate molecular and turbulence viscosity</span>
<a name="ln-4"></a>  <span class="c">!----------------------------------------------------</span>
<a name="ln-5"></a>  <span class="c">! author   - Jatinder Pal Singh Sandhu</span>
<a name="ln-6"></a>  <span class="c">! obective - setup     ,</span>
<a name="ln-7"></a>  <span class="c">!            destroy   , and </span>
<a name="ln-8"></a>  <span class="c">!            calculate </span>
<a name="ln-9"></a>  <span class="c">! molecular and turbulence viscosity based on switch</span>
<a name="ln-10"></a>  <span class="c">!-----------------------------------------------------</span>
<a name="ln-11"></a>
<a name="ln-12"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">turbulence</span>
<a name="ln-13"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">transition</span>
<a name="ln-14"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu</span>
<a name="ln-15"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_ref</span>
<a name="ln-16"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Sutherland_temp</span>
<a name="ln-17"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">T_ref</span>
<a name="ln-18"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">R_gas</span>
<a name="ln-19"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_variation</span>
<a name="ln-20"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">process_id</span>
<a name="ln-21"></a>
<a name="ln-22"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">pressure</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">density</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sst_mu</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kkl_mu</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sa_mu</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_t</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tw</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tk</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tkl</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tv</span>
<a name="ln-32"></a>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">imx</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">jmx</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">global_vars</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kmx</span>
<a name="ln-36"></a>
<a name="ln-37"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">id</span>
<a name="ln-38"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">face_names</span>
<a name="ln-39"></a>  <span class="k">use </span><span class="n">global_vars</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dist</span>
<a name="ln-40"></a>  <span class="k">use </span><span class="n">global_kkl</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cmu</span>
<a name="ln-41"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">bstar</span>
<a name="ln-42"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">a1</span>
<a name="ln-43"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sst_F1</span>
<a name="ln-44"></a>  <span class="k">use </span><span class="n">global_sst</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w2</span>
<a name="ln-45"></a>  <span class="k">use </span><span class="n">global_sa</span>    <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cv1</span>
<a name="ln-46"></a>
<a name="ln-47"></a>  <span class="c">! gradients</span>
<a name="ln-48"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_x</span>
<a name="ln-49"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_y</span>
<a name="ln-50"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_z</span> 
<a name="ln-51"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_x</span> 
<a name="ln-52"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_y</span>
<a name="ln-53"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_z</span>
<a name="ln-54"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_x</span>
<a name="ln-55"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_y</span>
<a name="ln-56"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_z</span>
<a name="ln-57"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_x</span>
<a name="ln-58"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_y</span>
<a name="ln-59"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_z</span>
<a name="ln-60"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_x</span>
<a name="ln-61"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_y</span>
<a name="ln-62"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_z</span>
<a name="ln-63"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_x</span>
<a name="ln-64"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_y</span>
<a name="ln-65"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_z</span>
<a name="ln-66"></a>
<a name="ln-67"></a>  <span class="k">use </span><span class="n">copy_bc</span>       <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">copy1</span>
<a name="ln-68"></a>
<a name="ln-69"></a>  <span class="k">use </span><span class="n">utils</span>       <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dmsg</span>
<a name="ln-70"></a>  <span class="k">use </span><span class="n">utils</span>       <span class="p">,</span> <span class="n">only</span> <span class="p">:</span>   <span class="n">alloc</span>
<a name="ln-71"></a>  <span class="k">use </span><span class="n">utils</span>       <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dealloc</span>
<a name="ln-72"></a>
<a name="ln-73"></a><span class="cp">#include &quot;error.inc&quot;</span>
<a name="ln-74"></a>
<a name="ln-75"></a>  <span class="k">implicit none</span>
<a name="ln-76"></a><span class="k">  private</span>
<a name="ln-77"></a>
<a name="ln-78"></a><span class="k">  public</span> <span class="kd">::</span> <span class="n">setup_viscosity</span>
<a name="ln-79"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">destroy_viscosity</span>
<a name="ln-80"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">calculate_viscosity</span>
<a name="ln-81"></a>
<a name="ln-82"></a>  <span class="k">contains</span>
<a name="ln-83"></a>
<a name="ln-84"></a><span class="k">    subroutine </span><span class="n">calculate_viscosity</span><span class="p">()</span>
<a name="ln-85"></a>      <span class="c">!&lt; Calculate molecular and turbulent viscosity</span>
<a name="ln-86"></a>      <span class="k">implicit none</span>
<a name="ln-87"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-88"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">T</span> <span class="c">! molecular viscosity</span>
<a name="ln-89"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">c</span> <span class="c">! kkl eddy viscosity</span>
<a name="ln-90"></a>      <span class="c">!- sst varibales -!</span>
<a name="ln-91"></a>      <span class="kt">real</span>    <span class="kd">::</span> <span class="n">F</span>
<a name="ln-92"></a>      <span class="kt">real</span>    <span class="kd">::</span> <span class="n">arg2</span>
<a name="ln-93"></a>      <span class="kt">real</span>    <span class="kd">::</span> <span class="n">vort</span>
<a name="ln-94"></a>      <span class="kt">real</span>    <span class="kd">::</span> <span class="n">NUM</span>
<a name="ln-95"></a>      <span class="kt">real</span>    <span class="kd">::</span> <span class="n">DENOM</span>
<a name="ln-96"></a>      <span class="c">! for arg2</span>
<a name="ln-97"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">var1</span>
<a name="ln-98"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">var2</span>
<a name="ln-99"></a>      <span class="c">!for vorticity</span>
<a name="ln-100"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">wijwij</span>
<a name="ln-101"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">wx</span>
<a name="ln-102"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">wy</span>
<a name="ln-103"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">wz</span>
<a name="ln-104"></a>      <span class="c">!for strain calculation</span>
<a name="ln-105"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">SijSij</span>
<a name="ln-106"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Sxx</span><span class="p">,</span> <span class="n">Syy</span><span class="p">,</span> <span class="n">Szz</span>
<a name="ln-107"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Sxy</span><span class="p">,</span> <span class="n">Szx</span><span class="p">,</span> <span class="n">Syz</span>
<a name="ln-108"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">strain</span>
<a name="ln-109"></a>      <span class="c">!for arg1</span>
<a name="ln-110"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">arg1</span>
<a name="ln-111"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">CD</span>
<a name="ln-112"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">right</span>
<a name="ln-113"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">left</span>
<a name="ln-114"></a>
<a name="ln-115"></a>      <span class="c">! sa variables</span>
<a name="ln-116"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">fv1</span>
<a name="ln-117"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">xi</span>
<a name="ln-118"></a>
<a name="ln-119"></a>      <span class="c">!--- calculate_molecular_viscosity ---!</span>
<a name="ln-120"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mu_ref</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-121"></a><span class="k">        select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">mu_variation</span><span class="p">))</span>
<a name="ln-122"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;sutherland_law&#39;</span><span class="p">)</span>
<a name="ln-123"></a>            <span class="c">! apply_sutherland_law</span>
<a name="ln-124"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-125"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-126"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-127"></a>                  <span class="n">T</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">R_gas</span><span class="p">)</span>
<a name="ln-128"></a>                  <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="o">*</span> <span class="p">((</span><span class="n">T</span><span class="o">/</span><span class="n">T_ref</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.5</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-129"></a>                            <span class="o">*</span><span class="p">((</span><span class="n">T_ref</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">)&amp;</span>
<a name="ln-130"></a>                            <span class="o">/</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">Sutherland_temp</span><span class="p">))</span>
<a name="ln-131"></a>                <span class="k">end do</span>
<a name="ln-132"></a><span class="k">              end do</span>
<a name="ln-133"></a><span class="k">            end do</span>
<a name="ln-134"></a>
<a name="ln-135"></a><span class="k">          case</span> <span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
<a name="ln-136"></a>            <span class="c">!do nothing</span>
<a name="ln-137"></a>            <span class="c">!mu will be equal to mu_ref</span>
<a name="ln-138"></a>            <span class="k">continue</span>
<a name="ln-139"></a>
<a name="ln-140"></a><span class="k">          case </span><span class="n">DEFAULT</span>
<a name="ln-141"></a>            <span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;mu_variation not recognized:&quot;</span>
<a name="ln-142"></a>            <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;   found &#39;&quot;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">mu_variation</span><span class="p">),</span><span class="s2">&quot;&#39;&quot;</span>
<a name="ln-143"></a>            <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;accepted values: 1) sutherland_law&quot;</span>
<a name="ln-144"></a>            <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;                 2) constant&quot;</span>
<a name="ln-145"></a>            <span class="n">Fatal_error</span>
<a name="ln-146"></a>        <span class="k">end select</span>
<a name="ln-147"></a><span class="k">      end if</span>
<a name="ln-148"></a>      <span class="c">!--- end molecular viscosity calculation---!</span>
<a name="ln-149"></a>
<a name="ln-150"></a>      <span class="c">!--- calculate_turbulent_viscosity  ---!</span>
<a name="ln-151"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">turbulence</span><span class="o">/=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-152"></a><span class="k">        select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-153"></a>
<a name="ln-154"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-155"></a>            <span class="c">!do nothing</span>
<a name="ln-156"></a>            <span class="k">continue</span>
<a name="ln-157"></a>
<a name="ln-158"></a><span class="k">          case</span> <span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-159"></a>            <span class="c">!call calculate_sa_mu()</span>
<a name="ln-160"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-161"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-162"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-163"></a>                  <span class="c">! xsi </span>
<a name="ln-164"></a>                   <span class="n">xi</span> <span class="o">=</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-165"></a>                  <span class="c">!calculation fo fv1 function</span>
<a name="ln-166"></a>                  <span class="n">fv1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">xi</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cv1</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-167"></a>                  <span class="n">sa_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fv1</span>
<a name="ln-168"></a>                <span class="k">end do</span>
<a name="ln-169"></a><span class="k">              end do</span>
<a name="ln-170"></a><span class="k">            end do</span>
<a name="ln-171"></a>
<a name="ln-172"></a>            <span class="c">! populating ghost cell</span>
<a name="ln-173"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-174"></a>              <span class="k">select case</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-175"></a>                <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">:)</span>
<a name="ln-176"></a>                  <span class="c">!interface</span>
<a name="ln-177"></a>                  <span class="k">continue</span>
<a name="ln-178"></a>
<a name="ln-179"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-180"></a>                  <span class="c">!call copy1(sa_mu, &quot;symm&quot;, face_names(i))</span>
<a name="ln-181"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-182"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-183"></a>                        <span class="n">sa_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sa_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-184"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-185"></a>                        <span class="n">sa_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sa_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-186"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-187"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-188"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-189"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-190"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-191"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-192"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-193"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-194"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-195"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-196"></a>                      <span class="n">Fatal_error</span>
<a name="ln-197"></a>                  <span class="k">end select</span>
<a name="ln-198"></a>
<a name="ln-199"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-200"></a>                  <span class="c">!call copy1(sa_mu, &quot;anti&quot;, face_names(i))</span>
<a name="ln-201"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-202"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-203"></a>                        <span class="n">sa_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-204"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-205"></a>                        <span class="n">sa_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-206"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-207"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-208"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-209"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-210"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-211"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-212"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-213"></a>                        <span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-214"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-215"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-216"></a>                      <span class="n">Fatal_error</span>
<a name="ln-217"></a>                  <span class="k">end select</span>
<a name="ln-218"></a><span class="k">              end select</span>
<a name="ln-219"></a><span class="k">            end do</span>
<a name="ln-220"></a>            <span class="c">!--- end of sa eddy viscosity  ---!</span>
<a name="ln-221"></a>
<a name="ln-222"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-223"></a>            <span class="c">!call calculate_sst_mu()</span>
<a name="ln-224"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-225"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-226"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-227"></a>
<a name="ln-228"></a>                  <span class="c">! calculate_arg2()</span>
<a name="ln-229"></a>                  <span class="n">var1</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">bstar</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-230"></a>                  <span class="n">var2</span> <span class="o">=</span> <span class="mi">500</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-231"></a>                  <span class="n">arg2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
<a name="ln-232"></a>
<a name="ln-233"></a>                  <span class="c">! calculate_f2()</span>
<a name="ln-234"></a>                  <span class="n">F</span> <span class="o">=</span> <span class="nb">tanh</span><span class="p">(</span><span class="n">arg2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-235"></a>
<a name="ln-236"></a>                  <span class="c">! calculate_vorticity(</span>
<a name="ln-237"></a>                  <span class="n">sxx</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-238"></a>                  <span class="n">syy</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-239"></a>                  <span class="n">szz</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-240"></a>                  <span class="n">syz</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-241"></a>                  <span class="n">szx</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-242"></a>                  <span class="n">sxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-243"></a>
<a name="ln-244"></a>                  <span class="n">SijSij</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">sxx</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">syy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">szz</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">syz</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">szx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sxy</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-245"></a>
<a name="ln-246"></a>                  <span class="n">strain</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">SijSij</span><span class="p">)</span>
<a name="ln-247"></a>
<a name="ln-248"></a>                  <span class="n">NUM</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-249"></a>                  <span class="n">DENOM</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">a1</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span> <span class="n">strain</span><span class="o">*</span><span class="n">F</span><span class="p">),</span><span class="mf">1.0e-10</span><span class="p">)</span>
<a name="ln-250"></a>                  <span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">NUM</span><span class="o">/</span><span class="n">DENOM</span>
<a name="ln-251"></a>                  <span class="c">!-- end eddy visocisyt calculation --!</span>
<a name="ln-252"></a>                  <span class="c">!-- calculating blending function F1 --!</span>
<a name="ln-253"></a>                  <span class="n">CD</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span>                             <span class="p">&amp;</span> 
<a name="ln-254"></a>                                                      <span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-255"></a>                                                    <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-256"></a>                                                    <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-257"></a>                                                     <span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>                  <span class="p">&amp;</span>
<a name="ln-258"></a>                           <span class="mf">1.0e-10</span><span class="p">)</span>
<a name="ln-259"></a>
<a name="ln-260"></a>                  <span class="n">right</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">CD</span><span class="o">*</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-261"></a>                  <span class="n">left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
<a name="ln-262"></a>                  <span class="n">arg1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
<a name="ln-263"></a>                  <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">tanh</span><span class="p">(</span><span class="n">arg1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-264"></a>                  <span class="c">!-- end of blending function F1 calculation --!</span>
<a name="ln-265"></a>                <span class="k">end do</span>
<a name="ln-266"></a><span class="k">              end do</span>
<a name="ln-267"></a><span class="k">            end do</span>
<a name="ln-268"></a>
<a name="ln-269"></a><span class="k">            select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-270"></a>              <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-271"></a>                <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-272"></a>                  <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-273"></a>                    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-274"></a>                      <span class="c">!modified blending function (Menter 2015)</span>
<a name="ln-275"></a>                      <span class="n">var1</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-276"></a>                      <span class="n">var2</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">var1</span><span class="o">/</span><span class="mi">120</span><span class="p">)</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
<a name="ln-277"></a>                      <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">var2</span><span class="p">)</span>
<a name="ln-278"></a>                    <span class="k">end do</span>
<a name="ln-279"></a><span class="k">                  end do</span>
<a name="ln-280"></a><span class="k">                end do</span>
<a name="ln-281"></a><span class="k">              case </span><span class="n">DEFAULT</span>
<a name="ln-282"></a>                <span class="c">!do nothing</span>
<a name="ln-283"></a>                <span class="k">continue</span>
<a name="ln-284"></a><span class="k">            end select</span>
<a name="ln-285"></a>
<a name="ln-286"></a>            <span class="c">! populating ghost cell</span>
<a name="ln-287"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-288"></a>              <span class="k">select case</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-289"></a>                <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">:)</span>
<a name="ln-290"></a>                  <span class="c">!interface</span>
<a name="ln-291"></a>                  <span class="k">continue</span>
<a name="ln-292"></a>
<a name="ln-293"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-294"></a>                  <span class="c">!call copy1(sst_mu, &quot;symm&quot;, face_names(i))</span>
<a name="ln-295"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-296"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-297"></a>                        <span class="n">sst_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-298"></a>                        <span class="n">sst_F1</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-299"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-300"></a>                        <span class="n">sst_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-301"></a>                        <span class="n">sst_F1</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-302"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-303"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-304"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-305"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-306"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-307"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-308"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-309"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-310"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-311"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-312"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-313"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-314"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-315"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-316"></a>                      <span class="n">Fatal_error</span>
<a name="ln-317"></a>                  <span class="k">end select</span>
<a name="ln-318"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-319"></a>                  <span class="c">!call copy1(sst_mu, &quot;anti&quot;, face_names(i))</span>
<a name="ln-320"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-321"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-322"></a>                        <span class="n">sst_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-323"></a>                        <span class="n">sst_F1</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-324"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-325"></a>                        <span class="n">sst_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-326"></a>                        <span class="n">sst_F1</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-327"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-328"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-329"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-330"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-331"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-332"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-333"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-334"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-335"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-336"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-337"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-338"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-339"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-340"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-341"></a>                      <span class="n">Fatal_error</span>
<a name="ln-342"></a>                  <span class="k">end select</span>
<a name="ln-343"></a><span class="k">              end select</span>
<a name="ln-344"></a><span class="k">            end do</span>
<a name="ln-345"></a>            <span class="c">!--- end of sst2003 eddy viscosity  and blending fucntion calculation ---!</span>
<a name="ln-346"></a>
<a name="ln-347"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">)</span>
<a name="ln-348"></a>            <span class="c">!call calculate_sst_mu()</span>
<a name="ln-349"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-350"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-351"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-352"></a>
<a name="ln-353"></a>                  <span class="c">! calculate_arg2()</span>
<a name="ln-354"></a>                  <span class="n">var1</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">bstar</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-355"></a>                  <span class="n">var2</span> <span class="o">=</span> <span class="mi">500</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-356"></a>                  <span class="n">arg2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
<a name="ln-357"></a>
<a name="ln-358"></a>                  <span class="c">! calculate_f2()</span>
<a name="ln-359"></a>                  <span class="n">F</span> <span class="o">=</span> <span class="nb">tanh</span><span class="p">(</span><span class="n">arg2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-360"></a>
<a name="ln-361"></a>                  <span class="c">! calculate_vorticity(</span>
<a name="ln-362"></a>                  <span class="n">wx</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-363"></a>                  <span class="n">wy</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-364"></a>                  <span class="n">wz</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-365"></a>
<a name="ln-366"></a>                  <span class="n">wijwij</span> <span class="o">=</span> <span class="n">wx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">wy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">wz</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-367"></a>
<a name="ln-368"></a>                  <span class="n">vort</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">wijwij</span><span class="p">)</span>
<a name="ln-369"></a>
<a name="ln-370"></a>                  <span class="n">NUM</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-371"></a>                  <span class="n">DENOM</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">a1</span><span class="o">*</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span> <span class="n">vort</span><span class="o">*</span><span class="n">F</span><span class="p">),</span><span class="mf">1.e-20</span><span class="p">)</span>
<a name="ln-372"></a>                  <span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">NUM</span><span class="o">/</span><span class="n">DENOM</span>
<a name="ln-373"></a>                  <span class="c">!-- end eddy visocisyt calculation --!</span>
<a name="ln-374"></a>                  <span class="c">!-- calculating blending function F1 --!</span>
<a name="ln-375"></a>                  <span class="n">CD</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span>                             <span class="p">&amp;</span> 
<a name="ln-376"></a>                                                      <span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-377"></a>                                                    <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-378"></a>                                                    <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-379"></a>                                                     <span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>                  <span class="p">&amp;</span>
<a name="ln-380"></a>                           <span class="err">1</span><span class="n">e</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span>
<a name="ln-381"></a>
<a name="ln-382"></a>                  <span class="n">right</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_w2</span><span class="o">*</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">CD</span><span class="o">*</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-383"></a>                  <span class="n">left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
<a name="ln-384"></a>                  <span class="n">arg1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
<a name="ln-385"></a>                  <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">tanh</span><span class="p">(</span><span class="n">arg1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-386"></a>                  <span class="c">!-- end of blending function F1 calculation --!</span>
<a name="ln-387"></a>                <span class="k">end do</span>
<a name="ln-388"></a><span class="k">              end do</span>
<a name="ln-389"></a><span class="k">            end do</span>
<a name="ln-390"></a>
<a name="ln-391"></a><span class="k">            select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-392"></a>              <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-393"></a>                <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-394"></a>                  <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-395"></a>                    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-396"></a>                      <span class="c">!modified blending function (Menter 2015)</span>
<a name="ln-397"></a>                      <span class="n">var1</span> <span class="o">=</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-398"></a>                      <span class="n">var2</span> <span class="o">=</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">var1</span><span class="o">/</span><span class="mi">120</span><span class="p">)</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
<a name="ln-399"></a>                      <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">var2</span><span class="p">)</span>
<a name="ln-400"></a>                    <span class="k">end do</span>
<a name="ln-401"></a><span class="k">                  end do</span>
<a name="ln-402"></a><span class="k">                end do</span>
<a name="ln-403"></a><span class="k">              case </span><span class="n">DEFAULT</span>
<a name="ln-404"></a>                <span class="c">!do nothing</span>
<a name="ln-405"></a>                <span class="k">continue</span>
<a name="ln-406"></a><span class="k">            end select</span>
<a name="ln-407"></a>
<a name="ln-408"></a>            <span class="c">! populating ghost cell</span>
<a name="ln-409"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-410"></a>              <span class="k">select case</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-411"></a>                <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">:)</span>
<a name="ln-412"></a>                  <span class="c">!interface</span>
<a name="ln-413"></a>                  <span class="k">continue</span>
<a name="ln-414"></a>
<a name="ln-415"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-416"></a>                  <span class="c">!call copy1(sst_mu, &quot;symm&quot;, face_names(i))</span>
<a name="ln-417"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-418"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-419"></a>                        <span class="n">sst_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-420"></a>                        <span class="n">sst_F1</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-421"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-422"></a>                        <span class="n">sst_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-423"></a>                        <span class="n">sst_F1</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-424"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-425"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-426"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-427"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-428"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-429"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-430"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-431"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-432"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-433"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-434"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-435"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-436"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-437"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-438"></a>                      <span class="n">Fatal_error</span>
<a name="ln-439"></a>                  <span class="k">end select</span>
<a name="ln-440"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-441"></a>                  <span class="c">!call copy1(sst_mu, &quot;anti&quot;, face_names(i))</span>
<a name="ln-442"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-443"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-444"></a>                        <span class="n">sst_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-445"></a>                        <span class="n">sst_F1</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-446"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-447"></a>                        <span class="n">sst_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-448"></a>                        <span class="n">sst_F1</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-449"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-450"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-451"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-452"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-453"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-454"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-455"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-456"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-457"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-458"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-459"></a>                        <span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">sst_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-460"></a>                        <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span>  <span class="n">sst_F1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-461"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-462"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-463"></a>                      <span class="n">Fatal_error</span>
<a name="ln-464"></a>                  <span class="k">end select</span>
<a name="ln-465"></a><span class="k">              end select</span>
<a name="ln-466"></a><span class="k">            end do</span>
<a name="ln-467"></a>            <span class="c">!--- end of sst eddy viscosity  and blending fucntion calculation ---!</span>
<a name="ln-468"></a>
<a name="ln-469"></a>
<a name="ln-470"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-471"></a>            <span class="c">!--- calculate_kkl_mu()</span>
<a name="ln-472"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">cmu</span><span class="o">**</span><span class="mf">0.25</span>
<a name="ln-473"></a>
<a name="ln-474"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">kmx</span>
<a name="ln-475"></a>              <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">jmx</span>
<a name="ln-476"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">imx</span>
<a name="ln-477"></a>                  <span class="n">kkl_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)&amp;</span>
<a name="ln-478"></a>                    <span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span><span class="mf">1.e-20</span><span class="p">))</span>
<a name="ln-479"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.e-14</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.e-14</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-480"></a>                    <span class="n">kkl_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span><span class="mf">0.0</span> 
<a name="ln-481"></a>                <span class="k">end do</span>
<a name="ln-482"></a><span class="k">              end do</span>
<a name="ln-483"></a><span class="k">            end do</span>
<a name="ln-484"></a>
<a name="ln-485"></a>            <span class="c">! populating ghost cell</span>
<a name="ln-486"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-487"></a>              <span class="k">select case</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-488"></a>                <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">:)</span>
<a name="ln-489"></a>                  <span class="c">!interface</span>
<a name="ln-490"></a>                  <span class="k">continue</span>
<a name="ln-491"></a>
<a name="ln-492"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-493"></a>                  <span class="c">!call copy1(kkl_mu, &quot;symm&quot;, face_names(i))</span>
<a name="ln-494"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-495"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-496"></a>                        <span class="n">kkl_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">kkl_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-497"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-498"></a>                        <span class="n">kkl_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">kkl_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-499"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-500"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-501"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-502"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-503"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-504"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-505"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-506"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-507"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-508"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-509"></a>                      <span class="n">Fatal_error</span>
<a name="ln-510"></a>                  <span class="k">end select</span>
<a name="ln-511"></a><span class="k">                case</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-512"></a>                  <span class="c">!call copy1(kkl_mu, &quot;anti&quot;, face_names(i))</span>
<a name="ln-513"></a>                  <span class="k">select case</span><span class="p">(</span><span class="n">face_names</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-514"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imin&quot;</span><span class="p">)</span>
<a name="ln-515"></a>                        <span class="n">kkl_mu</span><span class="p">(</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">kkl_mu</span><span class="p">(</span>     <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-516"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;imax&quot;</span><span class="p">)</span>
<a name="ln-517"></a>                        <span class="n">kkl_mu</span><span class="p">(</span>  <span class="n">imx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">kkl_mu</span><span class="p">(</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-518"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmin&quot;</span><span class="p">)</span>
<a name="ln-519"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-520"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;jmax&quot;</span><span class="p">)</span>
<a name="ln-521"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">jmx</span>  <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-522"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmin&quot;</span><span class="p">)</span>
<a name="ln-523"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">)</span>
<a name="ln-524"></a>                    <span class="k">case</span><span class="p">(</span><span class="s2">&quot;kmax&quot;</span><span class="p">)</span>
<a name="ln-525"></a>                        <span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="n">kmx</span>  <span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">kkl_mu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-526"></a>                    <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-527"></a>                      <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: wrong face for boundary condition&quot;</span>
<a name="ln-528"></a>                      <span class="n">Fatal_error</span>
<a name="ln-529"></a>                  <span class="k">end select</span>
<a name="ln-530"></a><span class="k">              end select</span>
<a name="ln-531"></a><span class="k">            end do</span>
<a name="ln-532"></a>            <span class="c">!--- end of kkl eddy viscosity calculation ---!</span>
<a name="ln-533"></a>
<a name="ln-534"></a>          <span class="k">case </span><span class="n">DEFAULT</span> 
<a name="ln-535"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-536"></a>            <span class="n">Fatal_error</span>
<a name="ln-537"></a>
<a name="ln-538"></a>        <span class="k">end select</span>
<a name="ln-539"></a><span class="k">      end if</span>
<a name="ln-540"></a>      <span class="c">!--- end turbulent viscosity calculation---!</span>
<a name="ln-541"></a>      <span class="c">!--- check on viscosity ---!</span>
<a name="ln-542"></a>      <span class="k">if</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">mu</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-543"></a><span class="k">        </span><span class="n">Fatal_error</span>
<a name="ln-544"></a>      <span class="k">end if</span>
<a name="ln-545"></a>
<a name="ln-546"></a><span class="k">    end subroutine </span><span class="n">calculate_viscosity</span>
<a name="ln-547"></a>
<a name="ln-548"></a>    <span class="k">subroutine </span><span class="n">setup_viscosity</span><span class="p">()</span>
<a name="ln-549"></a>      <span class="c">!&lt; allocate and pointer for molecular and turbulent viscosity</span>
<a name="ln-550"></a>
<a name="ln-551"></a>      <span class="c">!setup_molecular_viscosity()</span>
<a name="ln-552"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mu_ref</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-553"></a><span class="k">        call </span><span class="n">alloc</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-554"></a>        <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_ref</span> <span class="c">!intialize</span>
<a name="ln-555"></a>      <span class="k">end if</span>
<a name="ln-556"></a>
<a name="ln-557"></a>      <span class="c">!--- setup_turbulent_viscosity ---!</span>
<a name="ln-558"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">turbulence</span><span class="o">/=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-559"></a><span class="k">        call </span><span class="n">alloc</span><span class="p">(</span><span class="n">mu_t</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-560"></a>
<a name="ln-561"></a>        <span class="k">select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-562"></a>
<a name="ln-563"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-564"></a>            <span class="c">!do nothing</span>
<a name="ln-565"></a>            <span class="k">continue</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">          case</span> <span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-568"></a>            <span class="n">sa_mu</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">mu_t</span><span class="p">(:,:,:)</span>
<a name="ln-569"></a>
<a name="ln-570"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-571"></a>            <span class="n">sst_mu</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">mu_t</span><span class="p">(:,:,:)</span>
<a name="ln-572"></a>            <span class="c">!-- sst blending funciton F1 --!</span>
<a name="ln-573"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">sst_F1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-574"></a>            <span class="n">sst_F1</span><span class="o">=</span><span class="mf">0.</span>
<a name="ln-575"></a>            <span class="c">!-- sst blnding function setup compete--!</span>
<a name="ln-576"></a>
<a name="ln-577"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-578"></a>            <span class="n">kkl_mu</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">mu_t</span><span class="p">(:,:,:)</span>
<a name="ln-579"></a>
<a name="ln-580"></a>          <span class="k">case </span><span class="n">DEFAULT</span> 
<a name="ln-581"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-582"></a>            <span class="n">Fatal_error</span>
<a name="ln-583"></a>
<a name="ln-584"></a>        <span class="k">end select</span>
<a name="ln-585"></a><span class="k">      end if</span>
<a name="ln-586"></a>      <span class="c">! --- end turbulent viscosity setup ---!</span>
<a name="ln-587"></a>
<a name="ln-588"></a>    <span class="k">end subroutine </span><span class="n">setup_viscosity</span>
<a name="ln-589"></a>
<a name="ln-590"></a>    <span class="k">subroutine </span><span class="n">destroy_viscosity</span><span class="p">()</span>
<a name="ln-591"></a>      <span class="c">!&lt; deallocate and nullify viscosity (turbulent/molecular)</span>
<a name="ln-592"></a>
<a name="ln-593"></a>      <span class="c">! destroy_molecular_viscosity ---!</span>
<a name="ln-594"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">mu_ref</span><span class="o">/=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-595"></a><span class="k">        call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
<a name="ln-596"></a>      <span class="k">end if</span>
<a name="ln-597"></a>
<a name="ln-598"></a>      <span class="c">!--- destroy_turbulent_viscosity ---!</span>
<a name="ln-599"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">turbulence</span><span class="o">/=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-600"></a><span class="k">        select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-601"></a>
<a name="ln-602"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-603"></a>            <span class="c">!do nothing</span>
<a name="ln-604"></a>            <span class="k">continue</span>
<a name="ln-605"></a>
<a name="ln-606"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-607"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">sa_mu</span><span class="p">)</span>
<a name="ln-608"></a>
<a name="ln-609"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-610"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">sst_mu</span><span class="p">)</span>
<a name="ln-611"></a>            <span class="c">!-- blending funciton F1 --!</span>
<a name="ln-612"></a>            <span class="k">call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">sst_F1</span><span class="p">)</span>
<a name="ln-613"></a>            <span class="c">!--- sst blending funciton destoryed--!</span>
<a name="ln-614"></a>
<a name="ln-615"></a>          <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-616"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">kkl_mu</span><span class="p">)</span>
<a name="ln-617"></a>
<a name="ln-618"></a>          <span class="k">case </span><span class="n">DEFAULT</span> 
<a name="ln-619"></a>            <span class="c">!call turbulence_read_error()</span>
<a name="ln-620"></a>            <span class="n">Fatal_error</span>
<a name="ln-621"></a>
<a name="ln-622"></a>        <span class="k">end select</span>
<a name="ln-623"></a><span class="k">        call </span><span class="n">dealloc</span><span class="p">(</span><span class="n">mu_t</span><span class="p">)</span>
<a name="ln-624"></a>      <span class="k">end if</span>
<a name="ln-625"></a>      <span class="c">!--- end of turublent viscosity destruction ---!</span>
<a name="ln-626"></a>
<a name="ln-627"></a>    <span class="k">end subroutine </span><span class="n">destroy_viscosity</span>
<a name="ln-628"></a>
<a name="ln-629"></a><span class="k">end module </span><span class="n">viscosity</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-06-24T13:14:54.817885 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>