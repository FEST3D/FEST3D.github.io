<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>viscous2.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>viscous2.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 3.3% of total for source files.">654 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/viscous2.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">viscous2.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/viscous.html">viscous</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/viscous2.f90.html#src">viscous2.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>The viscous module contains the viscous fluxes calculations </p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~viscous2.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileviscous2f90EfferentGraph" width="501pt" height="276pt"
 viewBox="0.00 0.00 501.00 276.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~viscous2.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 272)">
<title>sourcefile~~viscous2.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-272 497,-272 497,4 -4,4"/>
<!-- sourcefile~viscous2.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~viscous2.f90</title>
<polygon fill="none" stroke="#000000" points="493,-146 421,-146 421,-122 493,-122 493,-146"/>
<text text-anchor="middle" x="457" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">viscous2.f90</text>
</g>
<!-- sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~global_sa.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/global_sa.f90.html" xlink:title="global_sa.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="383.5,-268 307.5,-268 307.5,-244 383.5,-244 383.5,-268"/>
<text text-anchor="middle" x="345.5" y="-253.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sa.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~global_sa.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M449.7443,-146.2778C437.9029,-165.6342 412.9245,-203.7385 385,-230 382.0564,-232.7683 378.7846,-235.4332 375.4196,-237.9321"/>
<polygon fill="#ff0000" stroke="#ff0000" points="373.2245,-235.1949 366.9969,-243.7663 377.2104,-240.9493 373.2245,-235.1949"/>
</g>
<!-- sourcefile~geometry.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~geometry.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/geometry.f90.html" xlink:title="geometry.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="383.5,-146 307.5,-146 307.5,-122 383.5,-122 383.5,-146"/>
<text text-anchor="middle" x="345.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">geometry.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~geometry.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M420.7991,-134C412.2058,-134 402.9028,-134 393.8636,-134"/>
<polygon fill="#ff0000" stroke="#ff0000" points="393.822,-130.5001 383.822,-134 393.822,-137.5001 393.822,-130.5001"/>
</g>
<!-- sourcefile~global.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~global.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/global.f90.html" xlink:title="global.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="59,-207 0,-207 0,-183 59,-183 59,-207"/>
<text text-anchor="middle" x="29.5" y="-192.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M243,-216C182.1971,-212.5296 111.963,-204.9248 69.1528,-199.8831"/>
<polygon fill="#ff0000" stroke="#ff0000" points="69.4869,-196.3982 59.1434,-198.692 68.6597,-203.3492 69.4869,-196.3982"/>
</g>
<!-- sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~global_kkl.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/global_kkl.f90.html" xlink:title="global_kkl.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384.5,-188 306.5,-188 306.5,-164 384.5,-164 384.5,-188"/>
<text text-anchor="middle" x="345.5" y="-173.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_kkl.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~global_kkl.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M425.0486,-146.0355C413.1516,-150.5169 399.4745,-155.6688 386.8541,-160.4227"/>
<polygon fill="#ff0000" stroke="#ff0000" points="385.5804,-157.1623 377.4561,-163.9627 388.048,-163.713 385.5804,-157.1623"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="270,-146 216,-146 216,-122 270,-122 270,-146"/>
<text text-anchor="middle" x="243" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M423.011,-121.9384C411.1441,-118.305 397.6322,-114.8046 385,-113 350.2418,-108.0345 340.6577,-107.3758 306,-113 297.3297,-114.407 288.2401,-116.8365 279.7488,-119.5553"/>
<polygon fill="#ff0000" stroke="#ff0000" points="278.4542,-116.2987 270.1165,-122.8359 280.711,-122.925 278.4542,-116.2987"/>
</g>
<!-- sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~global_vars.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/global_vars.f90.html" xlink:title="global_vars.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="180,-187 95,-187 95,-163 180,-163 180,-187"/>
<text text-anchor="middle" x="137.5" y="-172.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_vars.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M447.2345,-146.0851C434.5751,-160.8148 411.0162,-185.1966 385,-197 327.0151,-223.3074 306.3806,-222.1008 243,-216"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M243,-216C215.6091,-214.4366 186.7153,-202.3835 166.105,-191.7475"/>
<polygon fill="#ff0000" stroke="#ff0000" points="167.7207,-188.6424 157.2534,-187.0031 164.4138,-194.8121 167.7207,-188.6424"/>
</g>
<!-- sourcefile~string.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~string.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/string.f90.html" xlink:title="string.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-66 317,-66 317,-42 374,-42 374,-66"/>
<text text-anchor="middle" x="345.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">string.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~string.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~string.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M441.473,-121.9211C427.0273,-110.7877 404.8117,-93.93 385,-80 381.195,-77.3246 377.1395,-74.56 373.1307,-71.8766"/>
<polygon fill="#ff0000" stroke="#ff0000" points="374.8166,-68.7954 364.545,-66.1983 370.9551,-74.634 374.8166,-68.7954"/>
</g>
<!-- sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~global_sst.f90</title>
<g id="a_sourcefile~~viscous2.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/global_sst.f90.html" xlink:title="global_sst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="385,-24 306,-24 306,0 385,0 385,-24"/>
<text text-anchor="middle" x="345.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous2.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~viscous2.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M450.7255,-121.7305C439.7369,-101.2066 415.2726,-59.5545 385,-33 383.7155,-31.8733 382.3601,-30.7851 380.9554,-29.7372"/>
<polygon fill="#ff0000" stroke="#ff0000" points="382.7999,-26.7612 372.5224,-24.1875 378.9518,-32.6086 382.7999,-26.7612"/>
</g>
<!-- sourcefile~geometry.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~geometry.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M307.3328,-134C298.4144,-134 288.9295,-134 280.0602,-134"/>
<polygon fill="#ffbf00" stroke="#ffbf00" points="280.0019,-130.5001 270.0019,-134 280.0018,-137.5001 280.0019,-130.5001"/>
</g>
<!-- sourcefile~geometry.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~geometry.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#ffbf00" stroke-dasharray="5,2" d="M307.3145,-145.5921C295.4339,-148.9361 282.2404,-152.384 270,-155 243.9225,-160.5732 214.6335,-165.1653 190.2371,-168.5374"/>
<polygon fill="#ffbf00" stroke="#ffbf00" points="189.5456,-165.099 180.1046,-169.9073 190.4834,-172.0359 189.5456,-165.099"/>
</g>
<!-- sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~utils.f90&#45;&gt;sourcefile~global_vars.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M215.8311,-144.5585C204.3494,-149.0206 190.7343,-154.3118 178.102,-159.221"/>
<polygon fill="#00ffff" stroke="#00ffff" points="176.7382,-155.9959 168.6852,-162.8806 179.2739,-162.5205 176.7382,-155.9959"/>
</g>
<!-- sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90 -->
<g id="sourcefile~~viscous2.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~global_vars.f90&#45;&gt;sourcefile~global.f90</title>
<path fill="none" stroke="#003fff" stroke-dasharray="5,2" d="M94.8155,-182.9045C86.3482,-184.4725 77.4923,-186.1125 69.1319,-187.6608"/>
<polygon fill="#003fff" stroke="#003fff" points="68.4347,-184.2303 59.2392,-189.4927 69.7094,-191.1132 68.4347,-184.2303"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~viscous2.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileviscous2f90AfferentGraph" width="483pt" height="52pt"
 viewBox="0.00 0.00 483.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~viscous2.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~viscous2.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 479,-48 479,4 -4,4"/>
<!-- sourcefile~viscous2.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~viscous2.f90</title>
<polygon fill="none" stroke="#000000" points="72,-44 0,-44 0,-20 72,-20 72,-44"/>
<text text-anchor="middle" x="36" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">viscous2.f90</text>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~viscous2.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="267,-44 208,-44 208,-20 267,-20 267,-44"/>
<text text-anchor="middle" x="237.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~viscous2.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~viscous2.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M207.8294,-32.5488C196.6047,-32.7312 183.7137,-32.9106 172,-33 143.5564,-33.2171 136.4438,-33.1975 108,-33 99.7348,-32.9426 90.9362,-32.8482 82.4311,-32.7396"/>
<polygon fill="#ff0000" stroke="#ff0000" points="82.3044,-29.2377 72.2579,-32.6018 82.2095,-36.237 82.3044,-29.2377"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~viscous2.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="172,-24 108,-24 108,0 172,0 172,-24"/>
<text text-anchor="middle" x="140" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M207.9822,-25.9451C199.8447,-24.2758 190.8557,-22.4319 182.1525,-20.6467"/>
<polygon fill="#00ffff" stroke="#00ffff" points="182.6345,-17.1727 172.1352,-18.5918 181.2278,-24.03 182.6345,-17.1727"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~viscous2.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~viscous2.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M107.948,-18.1639C99.7975,-19.7312 90.8764,-21.4468 82.1756,-23.1201"/>
<polygon fill="#ff0000" stroke="#ff0000" points="81.2812,-19.7279 72.1222,-25.0534 82.6032,-26.6019 81.2812,-19.7279"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~viscous2.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="475,-44 421,-44 421,-20 475,-20 475,-44"/>
<text text-anchor="middle" x="448" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M420.7124,-32.5275C409.6304,-32.7172 396.7042,-32.9071 385,-33 348.5567,-33.2892 339.4434,-33.2782 303,-33 294.6723,-32.9364 285.7495,-32.8274 277.2535,-32.7041"/>
<polygon fill="#ff0000" stroke="#ff0000" points="277.2233,-29.2034 267.1706,-32.5488 277.1154,-36.2025 277.2233,-29.2034"/>
</g>
<!-- sourcefile~start_finish.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~start_finish.f90</title>
<g id="a_sourcefile~~viscous2.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/start_finish.f90.html" xlink:title="start_finish.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="385,-24 303,-24 303,0 385,0 385,-24"/>
<text text-anchor="middle" x="344" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">start_finish.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~start_finish.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M420.9467,-26.7974C412.9882,-25.267 404.0079,-23.54 395.0646,-21.8201"/>
<polygon fill="#00ffff" stroke="#00ffff" points="395.5205,-18.3437 385.0394,-19.8922 394.1985,-25.2178 395.5205,-18.3437"/>
</g>
<!-- sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~viscous2.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~start_finish.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M302.8243,-19.7325C294.3352,-21.3267 285.4138,-23.0021 276.9863,-24.5847"/>
<polygon fill="#ff0000" stroke="#ff0000" points="276.1959,-21.1719 267.0137,-26.4575 277.4879,-28.0516 276.1959,-21.1719"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/viscous.html">viscous</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/viscous2.f90.html#src">viscous2.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; The viscous module contains the viscous fluxes calculations </span>
<a name="ln-2"></a><span class="k">module </span><span class="n">viscous</span>
<a name="ln-3"></a>  <span class="c">!&lt; The viscous module contains the viscous fluxes calculations</span>
<a name="ln-4"></a>  <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-5"></a><span class="cp">#include &quot;error.inc&quot;</span>
<a name="ln-6"></a>  <span class="k">use </span><span class="n">global</span>     <span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">FILE_NAME_LENGTH</span>
<a name="ln-7"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">imx</span>
<a name="ln-8"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">jmx</span>
<a name="ln-9"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kmx</span>
<a name="ln-10"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">grid_x</span>
<a name="ln-11"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">grid_y</span>
<a name="ln-12"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">grid_z</span>
<a name="ln-13"></a>
<a name="ln-14"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xnx</span><span class="p">,</span> <span class="n">xny</span><span class="p">,</span> <span class="n">xnz</span> <span class="c">!face unit normal x</span>
<a name="ln-15"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ynx</span><span class="p">,</span> <span class="n">yny</span><span class="p">,</span> <span class="n">ynz</span> <span class="c">!face unit normal y</span>
<a name="ln-16"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">znx</span><span class="p">,</span> <span class="n">zny</span><span class="p">,</span> <span class="n">znz</span> <span class="c">!face unit normal z</span>
<a name="ln-17"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xA</span><span class="p">,</span> <span class="n">yA</span><span class="p">,</span> <span class="n">zA</span>    <span class="c">!face area</span>
<a name="ln-18"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">vol</span> <span class="o">=&gt;</span> <span class="n">volume</span>
<a name="ln-19"></a>  <span class="k">use </span><span class="n">geometry</span>   <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">CellCenter</span>
<a name="ln-20"></a>  
<a name="ln-21"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">process_id</span>
<a name="ln-22"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gm</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">n_var</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">R_gas</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_ref</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">T_ref</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Pr</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tPr</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Sutherland_temp</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">density</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">x_speed</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">y_speed</span>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">z_speed</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">pressure</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tk</span>
<a name="ln-36"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tw</span>
<a name="ln-37"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tkl</span>
<a name="ln-38"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tv</span>
<a name="ln-39"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">tgm</span>
<a name="ln-40"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_x</span>
<a name="ln-41"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_y</span>
<a name="ln-42"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_z</span>
<a name="ln-43"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_x</span>
<a name="ln-44"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_y</span>
<a name="ln-45"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_z</span>
<a name="ln-46"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_x</span>
<a name="ln-47"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_y</span>
<a name="ln-48"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_z</span>
<a name="ln-49"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_x</span>
<a name="ln-50"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_y</span>
<a name="ln-51"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_z</span>
<a name="ln-52"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_x</span>
<a name="ln-53"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_y</span>
<a name="ln-54"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_z</span>
<a name="ln-55"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_x</span>
<a name="ln-56"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_y</span>
<a name="ln-57"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_z</span>
<a name="ln-58"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtkl_x</span>
<a name="ln-59"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtkl_y</span>
<a name="ln-60"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtkl_z</span>
<a name="ln-61"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_x</span>
<a name="ln-62"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_y</span>
<a name="ln-63"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_z</span>
<a name="ln-64"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtgm_x</span>
<a name="ln-65"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtgm_y</span>
<a name="ln-66"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtgm_z</span>
<a name="ln-67"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu</span>
<a name="ln-68"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_t</span>
<a name="ln-69"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">kkl_mu</span>
<a name="ln-70"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sst_mu</span>
<a name="ln-71"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">turbulence</span>
<a name="ln-72"></a>  <span class="k">use </span><span class="n">global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">transition</span>
<a name="ln-73"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sst_F1</span>
<a name="ln-74"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k1</span>
<a name="ln-75"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k2</span>
<a name="ln-76"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w1</span>
<a name="ln-77"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w2</span>
<a name="ln-78"></a>  <span class="k">use </span><span class="n">global_kkl</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k</span>
<a name="ln-79"></a>  <span class="k">use </span><span class="n">global_kkl</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_phi</span>
<a name="ln-80"></a>  <span class="k">use </span><span class="n">global_sa</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_sa</span>
<a name="ln-81"></a>  <span class="k">use </span><span class="n">global_sa</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cb2</span>
<a name="ln-82"></a>  <span class="k">use </span><span class="n">utils</span>      <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">alloc</span><span class="p">,</span> <span class="n">dealloc</span><span class="p">,</span> <span class="n">dmsg</span>
<a name="ln-83"></a>  <span class="k">use </span><span class="n">string</span>
<a name="ln-84"></a>  <span class="k">implicit none</span>
<a name="ln-85"></a><span class="k">  private</span>
<a name="ln-86"></a>
<a name="ln-87"></a><span class="k">  public</span> <span class="kd">::</span> <span class="n">compute_viscous_fluxes</span>
<a name="ln-88"></a>
<a name="ln-89"></a>  <span class="k">contains</span>
<a name="ln-90"></a>
<a name="ln-91"></a><span class="k">    subroutine </span><span class="n">compute_viscous_fluxes</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<a name="ln-92"></a>      <span class="c">!&lt; Call to all viscous flux subroutine based on </span>
<a name="ln-93"></a>      <span class="c">!&lt; the drection and turbulence/transition model being</span>
<a name="ln-94"></a>      <span class="c">!&lt; used</span>
<a name="ln-95"></a>
<a name="ln-96"></a>        <span class="k">implicit none</span>
<a name="ln-97"></a><span class="k">        </span><span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">F</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">H</span>
<a name="ln-98"></a>
<a name="ln-99"></a>        <span class="k">call </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-100"></a>        <span class="k">call </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-101"></a>        <span class="c">!if(kmx==2)then</span>
<a name="ln-102"></a>        <span class="c">!  continue</span>
<a name="ln-103"></a>        <span class="c">!else</span>
<a name="ln-104"></a>          <span class="k">call </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-105"></a>        <span class="c">!end if</span>
<a name="ln-106"></a>        
<a name="ln-107"></a>        <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-108"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-109"></a>            <span class="c">!do nothing</span>
<a name="ln-110"></a>            <span class="k">continue</span>
<a name="ln-111"></a>
<a name="ln-112"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-113"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-114"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-115"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-116"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-117"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-118"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-119"></a>            <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-120"></a><span class="k">              continue</span>
<a name="ln-121"></a><span class="k">            else</span>
<a name="ln-122"></a><span class="k">              call </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-123"></a>            <span class="k">end if</span>
<a name="ln-124"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-125"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-126"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-127"></a>            <span class="c">!if(kmx==2)then</span>
<a name="ln-128"></a>            <span class="c">!  continue</span>
<a name="ln-129"></a>            <span class="c">!else</span>
<a name="ln-130"></a>              <span class="k">call </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-131"></a>            <span class="c">!end if</span>
<a name="ln-132"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-133"></a>            <span class="n">Fatal_error</span>
<a name="ln-134"></a>        <span class="k">end select</span>
<a name="ln-135"></a>
<a name="ln-136"></a>
<a name="ln-137"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-138"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-139"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-140"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-141"></a>            <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-142"></a><span class="k">              continue</span>
<a name="ln-143"></a><span class="k">            else</span>
<a name="ln-144"></a><span class="k">              call </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-145"></a>            <span class="k">end if</span>
<a name="ln-146"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">)</span>
<a name="ln-147"></a>            <span class="c">!do nothing</span>
<a name="ln-148"></a>            <span class="k">continue</span>
<a name="ln-149"></a><span class="k">          case </span><span class="n">DEFAULT</span>
<a name="ln-150"></a>            <span class="n">Fatal_error</span>
<a name="ln-151"></a>        <span class="k">end select</span>
<a name="ln-152"></a>
<a name="ln-153"></a>
<a name="ln-154"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-155"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-156"></a>            <span class="k">end if</span>
<a name="ln-157"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">F</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-158"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-159"></a>            <span class="k">end if</span>
<a name="ln-160"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-161"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-162"></a>            <span class="k">end if</span>
<a name="ln-163"></a>
<a name="ln-164"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes</span>
<a name="ln-165"></a>
<a name="ln-166"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
<a name="ln-167"></a>      <span class="c">!&lt; Compute viscous fluxes for first five Navier-Stokes equation</span>
<a name="ln-168"></a>      <span class="k">implicit none</span>
<a name="ln-169"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">direction</span> <span class="c">!&lt; Face direction</span>
<a name="ln-170"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> <span class="c">!&lt; Flux array</span>
<a name="ln-171"></a>      <span class="c">! local variables</span>
<a name="ln-172"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dudx</span><span class="p">,</span> <span class="n">dudy</span><span class="p">,</span> <span class="n">dudz</span>
<a name="ln-173"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dvdx</span><span class="p">,</span> <span class="n">dvdy</span><span class="p">,</span> <span class="n">dvdz</span>
<a name="ln-174"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dwdx</span><span class="p">,</span> <span class="n">dwdy</span><span class="p">,</span> <span class="n">dwdz</span>
<a name="ln-175"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dTdx</span><span class="p">,</span> <span class="n">dTdy</span><span class="p">,</span> <span class="n">dTdz</span>
<a name="ln-176"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-177"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-178"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">T_RE</span>
<a name="ln-179"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">T_LE</span>
<a name="ln-180"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">K_heat</span><span class="p">,</span> <span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span>
<a name="ln-181"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-182"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-183"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">total_mu</span>
<a name="ln-184"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-185"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-186"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-187"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delu</span>
<a name="ln-188"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delv</span>
<a name="ln-189"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delw</span>
<a name="ln-190"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delT</span>
<a name="ln-191"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_xx</span>
<a name="ln-192"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_xy</span>
<a name="ln-193"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_xz</span>
<a name="ln-194"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_yx</span>
<a name="ln-195"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_yy</span>
<a name="ln-196"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_yz</span>
<a name="ln-197"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_zx</span>
<a name="ln-198"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_zy</span>
<a name="ln-199"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_zz</span>
<a name="ln-200"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-201"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-202"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-203"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-204"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">uface</span>
<a name="ln-205"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">vface</span>
<a name="ln-206"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">wface</span>
<a name="ln-207"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fA</span>
<a name="ln-208"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnx</span>
<a name="ln-209"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fny</span>
<a name="ln-210"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnz</span>
<a name="ln-211"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-212"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-213"></a>
<a name="ln-214"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-215"></a>      <span class="c">! select Direction</span>
<a name="ln-216"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-217"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span>
<a name="ln-218"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-219"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-220"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-221"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-222"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">xnx</span>
<a name="ln-223"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">xny</span>
<a name="ln-224"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">xnz</span>
<a name="ln-225"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">xA</span>
<a name="ln-226"></a>
<a name="ln-227"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-228"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-229"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-230"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-231"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">ynx</span>
<a name="ln-232"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">yny</span>
<a name="ln-233"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">ynz</span>
<a name="ln-234"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">yA</span>
<a name="ln-235"></a>
<a name="ln-236"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-237"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-238"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-239"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-240"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">znx</span>
<a name="ln-241"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">zny</span>
<a name="ln-242"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">znz</span>
<a name="ln-243"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">zA</span>
<a name="ln-244"></a>
<a name="ln-245"></a>        <span class="k">case </span><span class="n">Default</span>
<a name="ln-246"></a>          <span class="n">Fatal_error</span>
<a name="ln-247"></a>
<a name="ln-248"></a>      <span class="k">end select</span>
<a name="ln-249"></a>
<a name="ln-250"></a>
<a name="ln-251"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-252"></a>      <span class="c">! Calculating the fluxes at the faces</span>
<a name="ln-253"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-254"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-255"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-256"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-257"></a>
<a name="ln-258"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-259"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-260"></a>          <span class="n">dudx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-261"></a>          <span class="n">dudy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-262"></a>          <span class="n">dudz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-263"></a>          <span class="n">dvdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-264"></a>          <span class="n">dvdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-265"></a>          <span class="n">dvdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-266"></a>          <span class="n">dwdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-267"></a>          <span class="n">dwdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-268"></a>          <span class="n">dwdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-269"></a>          <span class="n">dTdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradT_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradT_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-270"></a>          <span class="n">dTdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradT_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradT_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-271"></a>          <span class="n">dTdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradT_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradT_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-272"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-273"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-274"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-275"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-276"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-277"></a>
<a name="ln-278"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>          <span class="c">! Finding the temperature of left and right element to the face i,j,k</span>
<a name="ln-281"></a>          <span class="n">T_LE</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_gas</span><span class="p">)</span>
<a name="ln-282"></a>          <span class="n">T_RE</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_gas</span><span class="p">)</span>
<a name="ln-283"></a>
<a name="ln-284"></a>          <span class="c">! difference in state across face</span>
<a name="ln-285"></a>          <span class="n">delu</span> <span class="o">=</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-286"></a>          <span class="n">delv</span> <span class="o">=</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-287"></a>          <span class="n">delw</span> <span class="o">=</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-288"></a>          <span class="n">delT</span> <span class="o">=</span> <span class="n">T_RE</span> <span class="o">-</span> <span class="n">T_LE</span>
<a name="ln-289"></a>
<a name="ln-290"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-291"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-292"></a>
<a name="ln-293"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delu</span> <span class="o">-</span> <span class="p">(</span><span class="n">dudx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dudy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dudz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-294"></a>          <span class="n">dudx</span>        <span class="o">=</span>  <span class="n">dudx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-295"></a>          <span class="n">dudy</span>        <span class="o">=</span>  <span class="n">dudy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-296"></a>          <span class="n">dudz</span>        <span class="o">=</span>  <span class="n">dudz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-297"></a>
<a name="ln-298"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delv</span> <span class="o">-</span> <span class="p">(</span><span class="n">dvdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dvdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dvdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-299"></a>          <span class="n">dvdx</span>        <span class="o">=</span>  <span class="n">dvdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-300"></a>          <span class="n">dvdy</span>        <span class="o">=</span>  <span class="n">dvdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-301"></a>          <span class="n">dvdz</span>        <span class="o">=</span>  <span class="n">dvdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-302"></a>
<a name="ln-303"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delw</span> <span class="o">-</span> <span class="p">(</span><span class="n">dwdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dwdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dwdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-304"></a>          <span class="n">dwdx</span>        <span class="o">=</span> <span class="n">dwdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-305"></a>          <span class="n">dwdy</span>        <span class="o">=</span> <span class="n">dwdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-306"></a>          <span class="n">dwdz</span>        <span class="o">=</span> <span class="n">dwdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-307"></a>
<a name="ln-308"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delT</span> <span class="o">-</span> <span class="p">(</span><span class="n">dTdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dTdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dTdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-309"></a>          <span class="n">dTdx</span>        <span class="o">=</span> <span class="n">dTdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-310"></a>          <span class="n">dTdy</span>        <span class="o">=</span> <span class="n">dTdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-311"></a>          <span class="n">dTdz</span>        <span class="o">=</span> <span class="n">dTdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-312"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-313"></a>
<a name="ln-314"></a>          <span class="n">mu_f</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-315"></a>          <span class="k">if</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">turbulence</span><span class="p">)</span><span class="o">/=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-316"></a><span class="k">            </span><span class="n">mut_f</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-317"></a>          <span class="k">else</span>
<a name="ln-318"></a><span class="k">            </span><span class="n">mut_f</span> <span class="o">=</span> <span class="mf">0.0</span> 
<a name="ln-319"></a>          <span class="k">end if</span>
<a name="ln-320"></a>
<a name="ln-321"></a>          <span class="c">! effective viscosity</span>
<a name="ln-322"></a>          <span class="n">total_mu</span> <span class="o">=</span> <span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span>
<a name="ln-323"></a>
<a name="ln-324"></a>          <span class="c">! Using lambda = -2 * mu / 3</span>
<a name="ln-325"></a>          <span class="c">! diagonal terms of stress tensor</span>
<a name="ln-326"></a>          <span class="n">Tau_xx</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dudx</span> <span class="o">-</span> <span class="p">((</span><span class="n">dudx</span> <span class="o">+</span> <span class="n">dvdy</span> <span class="o">+</span> <span class="n">dwdz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span> 
<a name="ln-327"></a>          <span class="n">Tau_yy</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dvdy</span> <span class="o">-</span> <span class="p">((</span><span class="n">dudx</span> <span class="o">+</span> <span class="n">dvdy</span> <span class="o">+</span> <span class="n">dwdz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span> 
<a name="ln-328"></a>          <span class="n">Tau_zz</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwdz</span> <span class="o">-</span> <span class="p">((</span><span class="n">dudx</span> <span class="o">+</span> <span class="n">dvdy</span> <span class="o">+</span> <span class="n">dwdz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span> 
<a name="ln-329"></a>          <span class="c">! off diagonal symmetrical part of stress tensor</span>
<a name="ln-330"></a>          <span class="n">Tau_xy</span> <span class="o">=</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dvdx</span> <span class="o">+</span> <span class="n">dudy</span><span class="p">)</span>
<a name="ln-331"></a>          <span class="n">Tau_xz</span> <span class="o">=</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwdx</span> <span class="o">+</span> <span class="n">dudz</span><span class="p">)</span>
<a name="ln-332"></a>          <span class="n">Tau_yz</span> <span class="o">=</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwdy</span> <span class="o">+</span> <span class="n">dvdz</span><span class="p">)</span>
<a name="ln-333"></a>          <span class="n">Tau_yx</span> <span class="o">=</span> <span class="n">Tau_xy</span>
<a name="ln-334"></a>          <span class="n">Tau_zx</span> <span class="o">=</span> <span class="n">Tau_xz</span>
<a name="ln-335"></a>          <span class="n">Tau_zy</span> <span class="o">=</span> <span class="n">Tau_yz</span>
<a name="ln-336"></a>
<a name="ln-337"></a>          <span class="c">! Pr: Prandtl Number and tPr: Turbulent Prandtl number</span>
<a name="ln-338"></a>          <span class="c">! Qx, Qy, Qz: Conduction fluxes</span>
<a name="ln-339"></a>          <span class="n">K_heat</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_f</span><span class="o">/</span><span class="n">Pr</span> <span class="o">+</span> <span class="n">mut_f</span><span class="o">/</span><span class="n">tPr</span><span class="p">)</span><span class="o">*</span> <span class="n">gm</span> <span class="o">*</span> <span class="n">R_gas</span> <span class="o">/</span> <span class="p">(</span><span class="n">gm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-340"></a>          <span class="n">Qx</span> <span class="o">=</span> <span class="n">K_heat</span><span class="o">*</span><span class="n">dTdx</span>
<a name="ln-341"></a>          <span class="n">Qy</span> <span class="o">=</span> <span class="n">K_heat</span><span class="o">*</span><span class="n">dTdy</span>
<a name="ln-342"></a>          <span class="n">Qz</span> <span class="o">=</span> <span class="n">K_heat</span><span class="o">*</span><span class="n">dTdz</span>
<a name="ln-343"></a>
<a name="ln-344"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-345"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">fnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-346"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">fny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-347"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">fnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-348"></a>          <span class="n">area</span>  <span class="o">=</span>  <span class="n">fA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-349"></a>          <span class="n">uface</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-350"></a>          <span class="n">vface</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-351"></a>          <span class="n">wface</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_speed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-352"></a>
<a name="ln-353"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-354"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">Tau_xx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">Tau_xy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">Tau_xz</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
<a name="ln-355"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">Tau_yx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">Tau_yy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">Tau_yz</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
<a name="ln-356"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">Tau_zx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">Tau_zy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">Tau_zz</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
<a name="ln-357"></a>         
<a name="ln-358"></a>          <span class="c">! Energy flux</span>
<a name="ln-359"></a>          <span class="c">! (TijVj + Qi)ni</span>
<a name="ln-360"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span> <span class="o">*</span> <span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-361"></a>                          <span class="p">((</span><span class="n">Tau_xx</span><span class="o">*</span><span class="n">uface</span> <span class="o">+</span> <span class="n">Tau_xy</span><span class="o">*</span><span class="n">vface</span> <span class="o">+</span> <span class="n">Tau_xz</span><span class="o">*</span><span class="n">wface</span> <span class="o">+</span> <span class="n">Qx</span><span class="p">)</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-362"></a>                          <span class="p">((</span><span class="n">Tau_yx</span><span class="o">*</span><span class="n">uface</span> <span class="o">+</span> <span class="n">Tau_yy</span><span class="o">*</span><span class="n">vface</span> <span class="o">+</span> <span class="n">Tau_yz</span><span class="o">*</span><span class="n">wface</span> <span class="o">+</span> <span class="n">Qy</span><span class="p">)</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-363"></a>                          <span class="p">((</span><span class="n">Tau_zx</span><span class="o">*</span><span class="n">uface</span> <span class="o">+</span> <span class="n">Tau_zy</span><span class="o">*</span><span class="n">vface</span> <span class="o">+</span> <span class="n">Tau_zz</span><span class="o">*</span><span class="n">wface</span> <span class="o">+</span> <span class="n">Qz</span><span class="p">)</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-364"></a>          
<a name="ln-365"></a>         
<a name="ln-366"></a>        <span class="k">end do</span>
<a name="ln-367"></a><span class="k">       end do</span>
<a name="ln-368"></a><span class="k">      end do</span>
<a name="ln-369"></a>
<a name="ln-370"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_laminar</span>
<a name="ln-371"></a>
<a name="ln-372"></a>
<a name="ln-373"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
<a name="ln-374"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to SST turbulence model</span>
<a name="ln-375"></a>      <span class="k">implicit none</span>
<a name="ln-376"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">direction</span> <span class="c">!&lt; face direction</span>
<a name="ln-377"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> <span class="c">!&lt; flux array</span>
<a name="ln-378"></a>      <span class="c">! local variables</span>
<a name="ln-379"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">tkface</span>
<a name="ln-380"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-381"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-382"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-383"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-384"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-385"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">total_mu</span>
<a name="ln-386"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-387"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-388"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-389"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">deltk</span>
<a name="ln-390"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">deltw</span>
<a name="ln-391"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_xx</span>
<a name="ln-392"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_yy</span>
<a name="ln-393"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_zz</span>
<a name="ln-394"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-395"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-396"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-397"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-398"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fA</span>
<a name="ln-399"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnx</span>
<a name="ln-400"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fny</span>
<a name="ln-401"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnz</span>
<a name="ln-402"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-403"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-404"></a>      <span class="c">!--- sst variable requirement ---!</span>
<a name="ln-405"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dtkdx</span><span class="p">,</span> <span class="n">dtkdy</span><span class="p">,</span> <span class="n">dtkdz</span><span class="p">,</span> <span class="n">dtwdx</span><span class="p">,</span> <span class="n">dtwdy</span><span class="p">,</span> <span class="n">dtwdz</span>
<a name="ln-406"></a>      <span class="kt">real</span> <span class="kd">::</span>  <span class="n">F1</span>
<a name="ln-407"></a>      <span class="kt">real</span> <span class="kd">::</span>  <span class="n">sigma_kf</span>
<a name="ln-408"></a>      <span class="kt">real</span> <span class="kd">::</span>  <span class="n">sigma_wf</span>
<a name="ln-409"></a>
<a name="ln-410"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-411"></a>      <span class="c">! select Direction</span>
<a name="ln-412"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-413"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span>
<a name="ln-414"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-415"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-416"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-417"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-418"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">xnx</span>
<a name="ln-419"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">xny</span>
<a name="ln-420"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">xnz</span>
<a name="ln-421"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">xA</span>
<a name="ln-422"></a>
<a name="ln-423"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-424"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-425"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-426"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-427"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">ynx</span>
<a name="ln-428"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">yny</span>
<a name="ln-429"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">ynz</span>
<a name="ln-430"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">yA</span>
<a name="ln-431"></a>
<a name="ln-432"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-433"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-434"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-435"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-436"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">znx</span>
<a name="ln-437"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">zny</span>
<a name="ln-438"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">znz</span>
<a name="ln-439"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">zA</span>
<a name="ln-440"></a>
<a name="ln-441"></a>        <span class="k">case </span><span class="n">Default</span>
<a name="ln-442"></a>          <span class="n">Fatal_error</span>
<a name="ln-443"></a>
<a name="ln-444"></a>      <span class="k">end select</span>
<a name="ln-445"></a>
<a name="ln-446"></a>
<a name="ln-447"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-448"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-449"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-450"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-451"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-452"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-453"></a>
<a name="ln-454"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-455"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-456"></a>          <span class="n">dtkdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-457"></a>          <span class="n">dtkdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-458"></a>          <span class="n">dtkdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-459"></a>          <span class="n">dtwdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-460"></a>          <span class="n">dtwdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-461"></a>          <span class="n">dtwdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-462"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-463"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-464"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-465"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-466"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-467"></a>
<a name="ln-468"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-469"></a>
<a name="ln-470"></a>          <span class="c">! difference in state across face</span>
<a name="ln-471"></a>          <span class="n">deltk</span> <span class="o">=</span> <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-472"></a>          <span class="n">deltw</span> <span class="o">=</span> <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">tw</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-473"></a>
<a name="ln-474"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-475"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-476"></a>
<a name="ln-477"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltk</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-478"></a>          <span class="n">dtkdx</span>       <span class="o">=</span>  <span class="n">dtkdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-479"></a>          <span class="n">dtkdy</span>       <span class="o">=</span>  <span class="n">dtkdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-480"></a>          <span class="n">dtkdz</span>       <span class="o">=</span>  <span class="n">dtkdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-481"></a>
<a name="ln-482"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltw</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtwdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtwdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtwdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-483"></a>          <span class="n">dtwdx</span>       <span class="o">=</span>  <span class="n">dtwdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-484"></a>          <span class="n">dtwdy</span>       <span class="o">=</span>  <span class="n">dtwdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-485"></a>          <span class="n">dtwdz</span>       <span class="o">=</span>  <span class="n">dtwdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-486"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-487"></a>
<a name="ln-488"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span>    <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span>     <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-489"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">sst_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-490"></a>          <span class="n">F1</span>       <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-491"></a>          <span class="n">sigma_kf</span> <span class="o">=</span> <span class="n">sigma_k1</span><span class="o">*</span><span class="n">F1</span> <span class="o">+</span> <span class="n">sigma_k2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-492"></a>          <span class="n">sigma_wf</span> <span class="o">=</span> <span class="n">sigma_w1</span><span class="o">*</span><span class="n">F1</span> <span class="o">+</span> <span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-493"></a>
<a name="ln-494"></a>          <span class="n">total_mu</span> <span class="o">=</span> <span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span>
<a name="ln-495"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-496"></a>          <span class="n">tkface</span>   <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>     <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span>      <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-497"></a>          <span class="c">! k in reynolds stress</span>
<a name="ln-498"></a>          <span class="n">Tau_xx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rhoface</span><span class="o">*</span><span class="n">tkface</span><span class="o">/</span><span class="mf">3.0</span>
<a name="ln-499"></a>          <span class="n">Tau_yy</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-500"></a>          <span class="n">Tau_zz</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-501"></a>
<a name="ln-502"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-503"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">fnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-504"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">fny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-505"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">fnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-506"></a>          <span class="n">area</span>  <span class="o">=</span>  <span class="n">fA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-507"></a>
<a name="ln-508"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-509"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_xx</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-510"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_yy</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-511"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_zz</span> <span class="o">*</span> <span class="n">nz</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-512"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_kf</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-513"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_kf</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-514"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_wf</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtwdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtwdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtwdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-515"></a>         
<a name="ln-516"></a>        <span class="k">end do</span>
<a name="ln-517"></a><span class="k">       end do</span>
<a name="ln-518"></a><span class="k">      end do</span>
<a name="ln-519"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_sst</span>
<a name="ln-520"></a>
<a name="ln-521"></a>
<a name="ln-522"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
<a name="ln-523"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to k-kL turbulence model</span>
<a name="ln-524"></a>      <span class="k">implicit none</span>
<a name="ln-525"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">direction</span> <span class="c">!&lt; Face direction</span>
<a name="ln-526"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> <span class="c">!&lt; Flux array</span>
<a name="ln-527"></a>      <span class="c">! local variables</span>
<a name="ln-528"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">tkface</span>
<a name="ln-529"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-530"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-531"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-532"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-533"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-534"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">total_mu</span>
<a name="ln-535"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-536"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-537"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-538"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">deltk</span>
<a name="ln-539"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">deltkl</span>
<a name="ln-540"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_xx</span>
<a name="ln-541"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_yy</span>
<a name="ln-542"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">Tau_zz</span>
<a name="ln-543"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-544"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-545"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-546"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-547"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fA</span>
<a name="ln-548"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnx</span>
<a name="ln-549"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fny</span>
<a name="ln-550"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnz</span>
<a name="ln-551"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-552"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-553"></a>      <span class="c">!--- kkl variable requirement  ---!</span>
<a name="ln-554"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dtkdx</span><span class="p">,</span> <span class="n">dtkdy</span><span class="p">,</span> <span class="n">dtkdz</span>
<a name="ln-555"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dtkldx</span><span class="p">,</span> <span class="n">dtkldy</span><span class="p">,</span> <span class="n">dtkldz</span>
<a name="ln-556"></a>
<a name="ln-557"></a>
<a name="ln-558"></a>
<a name="ln-559"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-560"></a>      <span class="c">! select Direction</span>
<a name="ln-561"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-562"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span>
<a name="ln-563"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-564"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-565"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-566"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-567"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">xnx</span>
<a name="ln-568"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">xny</span>
<a name="ln-569"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">xnz</span>
<a name="ln-570"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">xA</span>
<a name="ln-571"></a>
<a name="ln-572"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-573"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-574"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-575"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-576"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">ynx</span>
<a name="ln-577"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">yny</span>
<a name="ln-578"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">ynz</span>
<a name="ln-579"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">yA</span>
<a name="ln-580"></a>
<a name="ln-581"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-582"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-583"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-584"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-585"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">znx</span>
<a name="ln-586"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">zny</span>
<a name="ln-587"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">znz</span>
<a name="ln-588"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">zA</span>
<a name="ln-589"></a>
<a name="ln-590"></a>        <span class="k">case </span><span class="n">Default</span>
<a name="ln-591"></a>          <span class="n">Fatal_error</span>
<a name="ln-592"></a>
<a name="ln-593"></a>      <span class="k">end select</span>
<a name="ln-594"></a>
<a name="ln-595"></a>
<a name="ln-596"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-597"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-598"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-599"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-600"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-601"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-602"></a>
<a name="ln-603"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-604"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-605"></a>          <span class="n">dtkdx</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-606"></a>          <span class="n">dtkdy</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-607"></a>          <span class="n">dtkdz</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-608"></a>          <span class="n">dtkldx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtkl_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtkl_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-609"></a>          <span class="n">dtkldy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtkl_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtkl_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-610"></a>          <span class="n">dtkldz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtkl_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtkl_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-611"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-612"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-613"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-614"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-615"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-616"></a>
<a name="ln-617"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-618"></a>
<a name="ln-619"></a>          <span class="c">! difference in state across face</span>
<a name="ln-620"></a>          <span class="n">deltk</span>  <span class="o">=</span>  <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span>  <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-621"></a>          <span class="n">deltkl</span> <span class="o">=</span> <span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">tkl</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-622"></a>
<a name="ln-623"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-624"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-625"></a>
<a name="ln-626"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltk</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-627"></a>          <span class="n">dtkdx</span>       <span class="o">=</span>  <span class="n">dtkdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-628"></a>          <span class="n">dtkdy</span>       <span class="o">=</span>  <span class="n">dtkdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-629"></a>          <span class="n">dtkdz</span>       <span class="o">=</span>  <span class="n">dtkdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-630"></a>
<a name="ln-631"></a>          <span class="n">normal_comp</span>  <span class="o">=</span> <span class="p">(</span><span class="n">deltkl</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtkldx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtkldy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtkldz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-632"></a>          <span class="n">dtkldx</span>       <span class="o">=</span>  <span class="n">dtkldx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-633"></a>          <span class="n">dtkldy</span>       <span class="o">=</span>  <span class="n">dtkldy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-634"></a>          <span class="n">dtkldz</span>       <span class="o">=</span>  <span class="n">dtkldz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-635"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-636"></a>
<a name="ln-637"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span>    <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span>     <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-638"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">kkl_mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">kkl_mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-639"></a>
<a name="ln-640"></a>          <span class="n">total_mu</span> <span class="o">=</span> <span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span>
<a name="ln-641"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-642"></a>          <span class="n">tkface</span>   <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>     <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span>      <span class="n">tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-643"></a>          <span class="c">! k in reynolds stress</span>
<a name="ln-644"></a>          <span class="n">Tau_xx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rhoface</span><span class="o">*</span><span class="n">tkface</span><span class="o">/</span><span class="mf">3.0</span>
<a name="ln-645"></a>          <span class="n">Tau_yy</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-646"></a>          <span class="n">Tau_zz</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-647"></a>
<a name="ln-648"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-649"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">fnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-650"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">fny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-651"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">fnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-652"></a>          <span class="n">area</span>  <span class="o">=</span>  <span class="n">fA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-653"></a>
<a name="ln-654"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-655"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_xx</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-656"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_yy</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-657"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_zz</span> <span class="o">*</span> <span class="n">nz</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-658"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_k</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-659"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_k</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-660"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_phi</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkldx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkldy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkldz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-661"></a>         
<a name="ln-662"></a>        <span class="k">end do</span>
<a name="ln-663"></a><span class="k">       end do</span>
<a name="ln-664"></a><span class="k">      end do</span>
<a name="ln-665"></a>
<a name="ln-666"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_kkl</span>
<a name="ln-667"></a>
<a name="ln-668"></a>
<a name="ln-669"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
<a name="ln-670"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to SA turbulence model</span>
<a name="ln-671"></a>      <span class="k">implicit none</span>
<a name="ln-672"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">direction</span> <span class="c">!&lt; Face direction</span>
<a name="ln-673"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> <span class="c">!&lt; Flux array</span>
<a name="ln-674"></a>      <span class="c">! local variables</span>
<a name="ln-675"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-676"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-677"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-678"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-679"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-680"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-681"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-682"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-683"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">deltv</span>
<a name="ln-684"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-685"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-686"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-687"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-688"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fA</span>
<a name="ln-689"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnx</span>
<a name="ln-690"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fny</span>
<a name="ln-691"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnz</span>
<a name="ln-692"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-693"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-694"></a>      <span class="c">!--- sa variable requirement ---!</span>
<a name="ln-695"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dtvdx</span><span class="p">,</span> <span class="n">dtvdy</span><span class="p">,</span> <span class="n">dtvdz</span>
<a name="ln-696"></a>
<a name="ln-697"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-698"></a>      <span class="c">! select Direction</span>
<a name="ln-699"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-700"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span>
<a name="ln-701"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-702"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-703"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-704"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-705"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">xnx</span>
<a name="ln-706"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">xny</span>
<a name="ln-707"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">xnz</span>
<a name="ln-708"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">xA</span>
<a name="ln-709"></a>
<a name="ln-710"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-711"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-712"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-713"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-714"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">ynx</span>
<a name="ln-715"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">yny</span>
<a name="ln-716"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">ynz</span>
<a name="ln-717"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">yA</span>
<a name="ln-718"></a>
<a name="ln-719"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-720"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-721"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-722"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-723"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">znx</span>
<a name="ln-724"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">zny</span>
<a name="ln-725"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">znz</span>
<a name="ln-726"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">zA</span>
<a name="ln-727"></a>
<a name="ln-728"></a>        <span class="k">case </span><span class="n">Default</span>
<a name="ln-729"></a>          <span class="n">Fatal_error</span>
<a name="ln-730"></a>
<a name="ln-731"></a>      <span class="k">end select</span>
<a name="ln-732"></a>
<a name="ln-733"></a>
<a name="ln-734"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-735"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-736"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-737"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-738"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-739"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-740"></a>
<a name="ln-741"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-742"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-743"></a>          <span class="n">dtvdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-744"></a>          <span class="n">dtvdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-745"></a>          <span class="n">dtvdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-746"></a>
<a name="ln-747"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-748"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-749"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-750"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-751"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-752"></a>
<a name="ln-753"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-754"></a>
<a name="ln-755"></a>          <span class="c">! difference in state across face</span>
<a name="ln-756"></a>          <span class="n">deltv</span> <span class="o">=</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-757"></a>
<a name="ln-758"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-759"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-760"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltv</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtvdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtvdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtvdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-761"></a>          <span class="n">dtvdx</span>       <span class="o">=</span>  <span class="n">dtvdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-762"></a>          <span class="n">dtvdy</span>       <span class="o">=</span>  <span class="n">dtvdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-763"></a>          <span class="n">dtvdz</span>       <span class="o">=</span>  <span class="n">dtvdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-764"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-765"></a>
<a name="ln-766"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-767"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-768"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">tv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">rhoface</span>
<a name="ln-769"></a>
<a name="ln-770"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-771"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">fnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-772"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">fny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-773"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">fnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-774"></a>          <span class="n">area</span>  <span class="o">=</span>  <span class="n">fA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-775"></a>
<a name="ln-776"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-777"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtvdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtvdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtvdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span><span class="o">/</span><span class="n">sigma_sa</span>
<a name="ln-778"></a>         
<a name="ln-779"></a>        <span class="k">end do</span>
<a name="ln-780"></a><span class="k">       end do</span>
<a name="ln-781"></a><span class="k">      end do</span>
<a name="ln-782"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_sa</span>
<a name="ln-783"></a>
<a name="ln-784"></a>
<a name="ln-785"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
<a name="ln-786"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to LCTM2015 transition model</span>
<a name="ln-787"></a>      <span class="k">implicit none</span>
<a name="ln-788"></a><span class="k">      </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">direction</span> <span class="c">!&lt; Face direction</span>
<a name="ln-789"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> <span class="c">!&lt; Flux array</span>
<a name="ln-790"></a>      <span class="c">! local variables</span>
<a name="ln-791"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-792"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-793"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-794"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-795"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-796"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-797"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-798"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-799"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">deltgm</span>
<a name="ln-800"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-801"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-802"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-803"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-804"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fA</span>
<a name="ln-805"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnx</span>
<a name="ln-806"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fny</span>
<a name="ln-807"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">fnz</span>
<a name="ln-808"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-809"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-810"></a>      <span class="c">!--- sa variable requirement ---!</span>
<a name="ln-811"></a>      <span class="kt">real</span> <span class="kd">::</span> <span class="n">dtgmdx</span><span class="p">,</span> <span class="n">dtgmdy</span><span class="p">,</span> <span class="n">dtgmdz</span>
<a name="ln-812"></a>
<a name="ln-813"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-814"></a>      <span class="c">! select Direction</span>
<a name="ln-815"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-816"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">direction</span><span class="p">))</span>
<a name="ln-817"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-818"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-819"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-820"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-821"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">xnx</span>
<a name="ln-822"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">xny</span>
<a name="ln-823"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">xnz</span>
<a name="ln-824"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">xA</span>
<a name="ln-825"></a>
<a name="ln-826"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-827"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-828"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-829"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-830"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">ynx</span>
<a name="ln-831"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">yny</span>
<a name="ln-832"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">ynz</span>
<a name="ln-833"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">yA</span>
<a name="ln-834"></a>
<a name="ln-835"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-836"></a>          <span class="n">ii</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-837"></a>          <span class="n">jj</span>  <span class="o">=</span>  <span class="mi">0</span>
<a name="ln-838"></a>          <span class="n">kk</span>  <span class="o">=</span>  <span class="mi">1</span>
<a name="ln-839"></a>          <span class="n">fnx</span> <span class="o">=&gt;</span> <span class="n">znx</span>
<a name="ln-840"></a>          <span class="n">fny</span> <span class="o">=&gt;</span> <span class="n">zny</span>
<a name="ln-841"></a>          <span class="n">fnz</span> <span class="o">=&gt;</span> <span class="n">znz</span>
<a name="ln-842"></a>          <span class="n">fA</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>   <span class="o">=&gt;</span> <span class="n">zA</span>
<a name="ln-843"></a>
<a name="ln-844"></a>        <span class="k">case </span><span class="n">Default</span>
<a name="ln-845"></a>          <span class="n">Fatal_error</span>
<a name="ln-846"></a>
<a name="ln-847"></a>      <span class="k">end select</span>
<a name="ln-848"></a>
<a name="ln-849"></a>
<a name="ln-850"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-851"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-852"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-853"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-854"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-855"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-856"></a>
<a name="ln-857"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-858"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-859"></a>          <span class="n">dtgmdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtgm_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtgm_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-860"></a>          <span class="n">dtgmdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtgm_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtgm_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-861"></a>          <span class="n">dtgmdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtgm_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtgm_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-862"></a>
<a name="ln-863"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-864"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-865"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-866"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-867"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">CellCenter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-868"></a>
<a name="ln-869"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-870"></a>
<a name="ln-871"></a>          <span class="c">! difference in state across face</span>
<a name="ln-872"></a>          <span class="n">deltgm</span> <span class="o">=</span> <span class="n">tgm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">tgm</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span>
<a name="ln-873"></a>
<a name="ln-874"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-875"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-876"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltgm</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtgmdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtgmdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtgmdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-877"></a>          <span class="n">dtgmdx</span>       <span class="o">=</span>  <span class="n">dtgmdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-878"></a>          <span class="n">dtgmdy</span>       <span class="o">=</span>  <span class="n">dtgmdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-879"></a>          <span class="n">dtgmdz</span>       <span class="o">=</span>  <span class="n">dtgmdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-880"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-881"></a>
<a name="ln-882"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">density</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-883"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-884"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-885"></a>
<a name="ln-886"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-887"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">fnx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-888"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">fny</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-889"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">fnz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-890"></a>          <span class="n">area</span>  <span class="o">=</span>  <span class="n">fA</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-891"></a>
<a name="ln-892"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-893"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n_var</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtgmdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtgmdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtgmdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-894"></a>         
<a name="ln-895"></a>        <span class="k">end do</span>
<a name="ln-896"></a><span class="k">       end do</span>
<a name="ln-897"></a><span class="k">      end do</span>
<a name="ln-898"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_lctm2015</span>
<a name="ln-899"></a>
<a name="ln-900"></a>
<a name="ln-901"></a><span class="k">end module </span><span class="n">viscous</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2019-09-24T22:49:06.131269 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>