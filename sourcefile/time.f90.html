<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>time.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>time.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.5% of total for source files.">234 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/time.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">time.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/time.html">time</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/time.f90.html#src">time.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>Calculate the time step for the current iteration</p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~time.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefiletimef90EfferentGraph" width="427pt" height="605pt"
 viewBox="0.00 0.00 427.00 604.62" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~time.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 600.624)">
<title>sourcefile~~time.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-600.624 423,-600.624 423,4 -4,4"/>
<!-- sourcefile~time.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~time.f90</title>
<polygon fill="none" stroke="#000000" points="419,-211.0057 365,-211.0057 365,-187.0057 419,-187.0057 419,-211.0057"/>
<text text-anchor="middle" x="392" y="-196.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">time.f90</text>
</g>
<!-- sourcefile~viscosity.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~viscosity.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/viscosity.f90.html" xlink:title="viscosity.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="310.5,-411.0057 240.5,-411.0057 240.5,-387.0057 310.5,-387.0057 310.5,-411.0057"/>
<text text-anchor="middle" x="275.5" y="-396.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">viscosity.f90</text>
</a>
</g>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M384.8878,-211.2155C365.5467,-244.4191 311.8252,-336.6448 287.6105,-378.2152"/>
<polygon fill="#ff0000" stroke="#ff0000" points="284.5282,-376.553 282.5191,-386.9556 290.5769,-380.0764 284.5282,-376.553"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="62.5,-453.0057 8.5,-453.0057 8.5,-429.0057 62.5,-429.0057 62.5,-453.0057"/>
<text text-anchor="middle" x="35.5" y="-438.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M390.5508,-211.0844C382.9162,-268.4155 341.6065,-513.2341 186,-584.0057 154.0392,-598.5418 136.8673,-602.4647 107,-584.0057 63.937,-557.3913 45.9424,-496.1177 39.1542,-463.078"/>
<polygon fill="#ff0000" stroke="#ff0000" points="42.555,-462.2242 37.2617,-453.0465 35.6763,-463.522 42.555,-462.2242"/>
</g>
<!-- sourcefile~face_interpolant.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~face_interpolant.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/face_interpolant.f90.html" xlink:title="face_interpolant.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="329,-171.0057 222,-171.0057 222,-147.0057 329,-147.0057 329,-171.0057"/>
<text text-anchor="middle" x="275.5" y="-156.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">face_interpolant.f90</text>
</a>
</g>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~face_interpolant.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~face_interpolant.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M364.9797,-189.7283C351.7463,-185.1847 335.4598,-179.5927 320.4248,-174.4305"/>
<polygon fill="#ff0000" stroke="#ff0000" points="321.3646,-171.0527 310.77,-171.1155 319.0914,-177.6733 321.3646,-171.0527"/>
</g>
<!-- sourcefile~read.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~read.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/read.f90.html" xlink:title="read.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="302.5,-67.0057 248.5,-67.0057 248.5,-43.0057 302.5,-43.0057 302.5,-67.0057"/>
<text text-anchor="middle" x="275.5" y="-52.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">read.f90</text>
</a>
</g>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~read.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~read.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M382.0673,-186.7283C361.9486,-161.8607 316.2194,-105.3369 291.7168,-75.0504"/>
<polygon fill="#ff0000" stroke="#ff0000" points="294.4183,-72.8249 285.4076,-67.252 288.9762,-77.2277 294.4183,-72.8249"/>
</g>
<!-- sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~vartypes.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/vartypes.f90.html" xlink:title="vartypes.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-191.0057 0,-191.0057 0,-167.0057 71,-167.0057 71,-191.0057"/>
<text text-anchor="middle" x="35.5" y="-176.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">vartypes.f90</text>
</a>
</g>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M364.7521,-199.2231C319.4486,-199.5357 225.7701,-199.9749 146.5,-199.0057"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M263.5365,-411.184C247.5395,-426.507 217.5203,-452.0244 186,-462.0057 148.327,-473.9353 103.2151,-464.7151 72.2671,-455.0109"/>
<polygon fill="#ff0000" stroke="#ff0000" points="73.3373,-451.6784 62.7442,-451.8694 71.1443,-458.3261 73.3373,-451.6784"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M258.9854,-386.7777C227.9505,-363.502 159.3386,-310.6233 107,-260.0057 86.7919,-240.462 65.7387,-216.0392 51.7563,-199.1488"/>
<polygon fill="#ff0000" stroke="#ff0000" points="54.178,-196.5822 45.1309,-191.0686 48.765,-201.0206 54.178,-196.5822"/>
</g>
<!-- sourcefile~global_sa.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~global_sa.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/global_sa.f90.html" xlink:title="global_sa.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="184.5,-533.0057 108.5,-533.0057 108.5,-509.0057 184.5,-509.0057 184.5,-533.0057"/>
<text text-anchor="middle" x="146.5" y="-518.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sa.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sa.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sa.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M265.845,-411.0961C250.2542,-430.1957 218.0327,-467.9547 186,-495.0057 182.6834,-497.8065 179.0518,-500.5594 175.3768,-503.1649"/>
<polygon fill="#ff0000" stroke="#ff0000" points="173.1745,-500.4289 166.8507,-508.9296 177.0953,-506.2279 173.1745,-500.4289"/>
</g>
<!-- sourcefile~gradients.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~gradients.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/gradients.f90.html" xlink:title="gradients.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="184,-453.0057 109,-453.0057 109,-429.0057 184,-429.0057 184,-453.0057"/>
<text text-anchor="middle" x="146.5" y="-438.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">gradients.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M240.2502,-410.4824C225.8083,-415.1844 208.8844,-420.6945 193.4201,-425.7294"/>
<polygon fill="#ff0000" stroke="#ff0000" points="191.9346,-422.5321 183.5094,-428.9561 194.1017,-429.1882 191.9346,-422.5321"/>
</g>
<!-- sourcefile~copy_bc.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~copy_bc.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/copy_bc.f90.html" xlink:title="copy_bc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="181.5,-251.0057 111.5,-251.0057 111.5,-227.0057 181.5,-227.0057 181.5,-251.0057"/>
<text text-anchor="middle" x="146.5" y="-236.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">copy_bc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~copy_bc.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~copy_bc.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M269.4664,-386.7415C256.6989,-361.6674 224.9026,-303.6475 186,-265.0057 183.1331,-262.158 179.9085,-259.4443 176.5698,-256.9182"/>
<polygon fill="#ff0000" stroke="#ff0000" points="178.3768,-253.9112 168.1739,-251.0563 174.3695,-259.6507 178.3768,-253.9112"/>
</g>
<!-- sourcefile~wall_dist.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~wall_dist.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/wall_dist.f90.html" xlink:title="wall_dist.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="182,-411.0057 111,-411.0057 111,-387.0057 182,-387.0057 182,-411.0057"/>
<text text-anchor="middle" x="146.5" y="-396.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">wall_dist.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~wall_dist.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~wall_dist.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M240.2502,-399.0057C225.4412,-399.0057 208.0223,-399.0057 192.2435,-399.0057"/>
<polygon fill="#ff0000" stroke="#ff0000" points="192.1555,-395.5058 182.1554,-399.0057 192.1554,-402.5058 192.1555,-395.5058"/>
</g>
<!-- sourcefile~global_kkl.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~global_kkl.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/global_kkl.f90.html" xlink:title="global_kkl.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="185.5,-369.0057 107.5,-369.0057 107.5,-345.0057 185.5,-345.0057 185.5,-369.0057"/>
<text text-anchor="middle" x="146.5" y="-354.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_kkl.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_kkl.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_kkl.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M240.2502,-387.529C225.8083,-382.827 208.8844,-377.3169 193.4201,-372.282"/>
<polygon fill="#ff0000" stroke="#ff0000" points="194.1017,-368.8231 183.5094,-369.0553 191.9346,-375.4792 194.1017,-368.8231"/>
</g>
<!-- sourcefile~global_sst.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~global_sst.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/global_sst.f90.html" xlink:title="global_sst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="186,-575.0057 107,-575.0057 107,-551.0057 186,-551.0057 186,-575.0057"/>
<text text-anchor="middle" x="146.5" y="-560.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M270.5066,-411.2074C259.0701,-437.9026 228.6409,-502.2732 186,-542.0057 184.7499,-543.1705 183.423,-544.2902 182.0416,-545.3639"/>
<polygon fill="#ff0000" stroke="#ff0000" points="180.0184,-542.5069 173.6914,-551.0051 183.937,-548.3073 180.0184,-542.5069"/>
</g>
<!-- sourcefile~face_interpolant.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~face_interpolant.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M265.3275,-171.0993C249.0277,-190.3351 215.8521,-228.9056 186,-260.0057 152.2615,-295.1545 138.4349,-298.7823 107,-336.0057 83.9449,-363.3061 61.4326,-398.109 48.0111,-419.9821"/>
<polygon fill="#00ff66" stroke="#00ff66" points="44.8703,-418.4114 42.6776,-428.7768 50.8557,-422.0412 44.8703,-418.4114"/>
</g>
<!-- sourcefile~face_interpolant.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~face_interpolant.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M251.9266,-171.192C226.5651,-183.1288 184.717,-199.473 146.5,-199.0057"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M146.5,-199.0057C124.8247,-198.7406 101.1387,-194.9648 81.2344,-190.7642"/>
<polygon fill="#00ff66" stroke="#00ff66" points="81.7209,-187.2873 71.201,-188.5451 80.2092,-194.1221 81.7209,-187.2873"/>
</g>
<!-- sourcefile~weno_nm.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~weno_nm.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/weno_nm.f90.html" xlink:title="weno_NM.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="186,-171.0057 107,-171.0057 107,-147.0057 186,-147.0057 186,-171.0057"/>
<text text-anchor="middle" x="146.5" y="-156.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">weno_NM.f90</text>
</a>
</g>
</g>
<!-- sourcefile~face_interpolant.f90&#45;&gt;sourcefile~weno_nm.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~face_interpolant.f90&#45;&gt;sourcefile~weno_nm.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M221.9131,-159.0057C213.4483,-159.0057 204.7253,-159.0057 196.3501,-159.0057"/>
<polygon fill="#00ff66" stroke="#00ff66" points="196.3477,-155.5058 186.3476,-159.0057 196.3476,-162.5058 196.3477,-155.5058"/>
</g>
<!-- sourcefile~ppm.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~ppm.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/ppm.f90.html" xlink:title="ppm.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="173.5,-129.0057 119.5,-129.0057 119.5,-105.0057 173.5,-105.0057 173.5,-129.0057"/>
<text text-anchor="middle" x="146.5" y="-114.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ppm.f90</text>
</a>
</g>
</g>
<!-- sourcefile~face_interpolant.f90&#45;&gt;sourcefile~ppm.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~face_interpolant.f90&#45;&gt;sourcefile~ppm.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M238.5338,-146.9702C221.2319,-141.337 200.676,-134.6444 183.3844,-129.0145"/>
<polygon fill="#00ff66" stroke="#00ff66" points="184.2222,-125.6065 173.6299,-125.8387 182.055,-132.2626 184.2222,-125.6065"/>
</g>
<!-- sourcefile~weno.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~weno.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/weno.f90.html" xlink:title="weno.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="174.5,-87.0057 118.5,-87.0057 118.5,-63.0057 174.5,-63.0057 174.5,-87.0057"/>
<text text-anchor="middle" x="146.5" y="-72.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">weno.f90</text>
</a>
</g>
</g>
<!-- sourcefile~face_interpolant.f90&#45;&gt;sourcefile~weno.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~face_interpolant.f90&#45;&gt;sourcefile~weno.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M259.4183,-146.7655C241.8142,-133.5872 212.5508,-112.3205 186,-96.0057 183.8577,-94.6893 181.6255,-93.37 179.3604,-92.0696"/>
<polygon fill="#00ff66" stroke="#00ff66" points="181.0233,-88.9896 170.5818,-87.1937 177.6244,-95.109 181.0233,-88.9896"/>
</g>
<!-- sourcefile~muscl.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~muscl.f90</title>
<g id="a_sourcefile~~time.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/muscl.f90.html" xlink:title="muscl.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="175.5,-45.0057 117.5,-45.0057 117.5,-21.0057 175.5,-21.0057 175.5,-45.0057"/>
<text text-anchor="middle" x="146.5" y="-30.6057" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">muscl.f90</text>
</a>
</g>
</g>
<!-- sourcefile~face_interpolant.f90&#45;&gt;sourcefile~muscl.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~face_interpolant.f90&#45;&gt;sourcefile~muscl.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M267.3412,-146.6857C252.918,-125.6155 221.1061,-82.2082 186,-54.0057 184.6263,-52.9021 183.1859,-51.8293 181.7013,-50.7903"/>
<polygon fill="#00ff66" stroke="#00ff66" points="183.201,-47.5986 172.8737,-45.2328 179.4716,-53.5224 183.201,-47.5986"/>
</g>
<!-- sourcefile~read.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~read.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M259.2404,-42.9858C227.4478,-21.0779 155.8913,20.2457 107,-12.0057 57.6129,-44.5841 42.2124,-119.0918 37.5084,-156.5842"/>
<polygon fill="#0066ff" stroke="#0066ff" points="33.9832,-156.6207 36.3661,-166.9441 40.9411,-157.3879 33.9832,-156.6207"/>
</g>
<!-- sourcefile~weno_nm.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~weno_nm.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M106.74,-166.1696C98.514,-167.6518 89.7851,-169.2246 81.3618,-170.7423"/>
<polygon fill="#ff0000" stroke="#ff0000" points="80.5139,-167.3386 71.2931,-172.5565 81.7553,-174.2277 80.5139,-167.3386"/>
</g>
<!-- sourcefile~ppm.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~ppm.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M123.4573,-129.097C118.0411,-131.983 112.3028,-135.0767 107,-138.0057 93.0908,-145.6884 77.795,-154.4206 64.9327,-161.8462"/>
<polygon fill="#ff9900" stroke="#ff9900" points="62.9518,-158.9488 56.0516,-166.9886 66.4594,-165.0066 62.9518,-158.9488"/>
</g>
<!-- sourcefile~gradients.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~gradients.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M108.9205,-441.0057C97.2673,-441.0057 84.4334,-441.0057 72.7993,-441.0057"/>
<polygon fill="#33ff00" stroke="#33ff00" points="72.5206,-437.5058 62.5206,-441.0057 72.5205,-444.5058 72.5206,-437.5058"/>
</g>
<!-- sourcefile~gradients.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~gradients.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M116.8837,-428.7465C113.1911,-426.2721 109.7526,-423.3731 107,-420.0057 52.6484,-353.5151 39.6077,-246.8513 36.4828,-201.0574"/>
<polygon fill="#33ff00" stroke="#33ff00" points="39.9741,-200.8059 35.8945,-191.028 32.9862,-201.2159 39.9741,-200.8059"/>
</g>
<!-- sourcefile~copy_bc.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~copy_bc.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M124.0375,-226.8638C107.6381,-217.9992 85.188,-205.864 66.9982,-196.0317"/>
<polygon fill="#00ff66" stroke="#00ff66" points="68.3905,-192.8058 57.9291,-191.1295 65.0618,-198.9637 68.3905,-192.8058"/>
</g>
<!-- sourcefile~wall_dist.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~wall_dist.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M114.6919,-411.0412C101.4949,-416.0346 86.0977,-421.8606 72.4072,-427.0408"/>
<polygon fill="#00ffff" stroke="#00ffff" points="70.91,-423.865 62.7958,-430.6775 73.3873,-430.412 70.91,-423.865"/>
</g>
<!-- sourcefile~wall_dist.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~wall_dist.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M117.4551,-386.863C113.5883,-384.3518 109.9483,-381.4114 107,-378.0057 61.3169,-325.2361 44.0522,-241.086 38.1919,-201.2725"/>
<polygon fill="#00ffff" stroke="#00ffff" points="41.6485,-200.7159 36.8273,-191.2816 34.7129,-201.6633 41.6485,-200.7159"/>
</g>
<!-- sourcefile~weno.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~weno.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M120.5557,-87.0138C115.8468,-89.6818 111.1259,-92.7089 107,-96.0057 84.1438,-114.2692 62.9393,-140.5527 49.6542,-158.6236"/>
<polygon fill="#0066ff" stroke="#0066ff" points="46.7964,-156.6028 43.796,-166.7639 52.4781,-160.6916 46.7964,-156.6028"/>
</g>
<!-- sourcefile~muscl.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~time.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~muscl.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M118.7845,-45.1324C114.5566,-47.6938 110.4572,-50.6538 107,-54.0057 76.1002,-83.9641 54.4259,-130.1556 43.5423,-157.2011"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="40.1423,-156.2878 39.7823,-166.8765 46.6669,-158.8234 40.1423,-156.2878"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~time.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefiletimef90AfferentGraph" width="347pt" height="52pt"
 viewBox="0.00 0.00 347.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~time.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~time.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 343,-48 343,4 -4,4"/>
<!-- sourcefile~time.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~time.f90</title>
<polygon fill="none" stroke="#000000" points="54,-44 0,-44 0,-20 54,-20 54,-44"/>
<text text-anchor="middle" x="27" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">time.f90</text>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~time.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="249,-44 190,-44 190,-20 249,-20 249,-44"/>
<text text-anchor="middle" x="219.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M189.8294,-32.5488C178.6047,-32.7312 165.7137,-32.9106 154,-33 125.5564,-33.2171 118.4435,-33.2257 90,-33 81.7705,-32.9347 72.9368,-32.8214 64.5649,-32.694"/>
<polygon fill="#ff0000" stroke="#ff0000" points="64.343,-29.19 54.2876,-32.5275 64.2296,-36.1891 64.343,-29.19"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~time.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="154,-24 90,-24 90,0 154,0 154,-24"/>
<text text-anchor="middle" x="122" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M189.9822,-25.9451C181.8447,-24.2758 172.8557,-22.4319 164.1525,-20.6467"/>
<polygon fill="#00ffff" stroke="#00ffff" points="164.6345,-17.1727 154.1352,-18.5918 163.2278,-24.03 164.6345,-17.1727"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M89.8373,-18.7711C81.5713,-20.5113 72.6111,-22.3977 64.1166,-24.186"/>
<polygon fill="#ff0000" stroke="#ff0000" points="63.1287,-20.8171 54.0643,-26.3023 64.5709,-27.667 63.1287,-20.8171"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~time.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="339,-44 285,-44 285,-20 339,-20 339,-44"/>
<text text-anchor="middle" x="312" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~time.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M284.7472,-32C276.791,-32 267.9269,-32 259.361,-32"/>
<polygon fill="#ff0000" stroke="#ff0000" points="259.1413,-28.5001 249.1413,-32 259.1413,-35.5001 259.1413,-28.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/time.html">time</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/time.f90.html#src">time.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; Calculate the time step for the current iteration</span>
<a name="ln-2"></a><span class="k">module </span><span class="nb">time</span>
<a name="ln-3"></a>  <span class="c">!&lt; Calculate the time step for the current iteration</span>
<a name="ln-4"></a>  <span class="k">use </span><span class="n">vartypes</span>
<a name="ln-5"></a>  <span class="k">use </span><span class="n">mpi</span>
<a name="ln-6"></a>  <span class="k">use </span><span class="n">viscosity</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu</span>
<a name="ln-7"></a>  <span class="k">use </span><span class="n">viscosity</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_t</span>
<a name="ln-8"></a>  <span class="k">use </span><span class="n">utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">alloc</span>
<a name="ln-9"></a>  <span class="k">use </span><span class="n">face_interpolant</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="p">&amp;</span>
<a name="ln-10"></a>          <span class="n">x_qp_left</span><span class="p">,</span> <span class="n">x_qp_right</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-11"></a>          <span class="n">y_qp_left</span><span class="p">,</span> <span class="n">y_qp_right</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-12"></a>          <span class="n">z_qp_left</span><span class="p">,</span> <span class="n">z_qp_right</span>
<a name="ln-13"></a>  <span class="k">use read</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">read_input_and_controls</span>
<a name="ln-14"></a>
<a name="ln-15"></a><span class="cp">#include &quot;debug.h&quot;</span>
<a name="ln-16"></a><span class="cp">#include &quot;error.h&quot;</span>
<a name="ln-17"></a>
<a name="ln-18"></a>    <span class="k">private</span>
<a name="ln-19"></a><span class="k">    </span><span class="kt">integer</span> <span class="kd">::</span> <span class="p">&amp;</span>
<a name="ln-20"></a>    <span class="n">nb_ticks_initial</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">!&lt; Initial value of the clock tick counter</span>
<a name="ln-21"></a>    <span class="n">nb_ticks_final</span><span class="p">,</span>   <span class="p">&amp;</span> <span class="c">!&lt; Final value of the clock tick counter</span>
<a name="ln-22"></a>    <span class="n">nb_ticks_max</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">!&lt; Maximum value of the clock counter</span>
<a name="ln-23"></a>    <span class="n">nb_ticks_sec</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">!&lt; Number of clock ticks per second</span>
<a name="ln-24"></a>    <span class="n">nb_ticks</span>           <span class="c">!&lt; Number of clock ticks of the code</span>
<a name="ln-25"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">elapsed_time</span>  <span class="c">!&lt; real(wp) time in seconds</span>
<a name="ln-26"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">t1</span>         <span class="c">!&lt; Start clock time</span>
<a name="ln-27"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">t2</span>         <span class="c">!&lt; Finish clock time</span>
<a name="ln-28"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cpu_time_elapsed</span>
<a name="ln-29"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sim_clock</span><span class="o">=</span><span class="mf">0.0</span>
<a name="ln-30"></a>
<a name="ln-31"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">imx</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">kmx</span><span class="p">,</span> <span class="n">n_var</span>
<a name="ln-32"></a>    <span class="c">! Public methods</span>
<a name="ln-33"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">setup_time</span>
<a name="ln-34"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">destroy_time</span>
<a name="ln-35"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">compute_time_step</span>
<a name="ln-36"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">update_simulation_clock</span>
<a name="ln-37"></a>
<a name="ln-38"></a>    <span class="k">contains</span>
<a name="ln-39"></a>
<a name="ln-40"></a><span class="k">        subroutine </span><span class="n">setup_time</span><span class="p">(</span><span class="n">delta_t</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-41"></a>          <span class="c">!&lt; Allocate memeroy and setup initial clock</span>
<a name="ln-42"></a>            <span class="k">implicit none</span>
<a name="ln-43"></a><span class="k">            type</span><span class="p">(</span><span class="n">controltype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">control</span>
<a name="ln-44"></a>            <span class="c">!&lt; Control parameters</span>
<a name="ln-45"></a>            <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-46"></a>            <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-47"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-48"></a>            <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-49"></a>
<a name="ln-50"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;initmisc&#39;</span><span class="p">)</span>
<a name="ln-51"></a>
<a name="ln-52"></a>            <span class="n">imx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-53"></a>            <span class="n">jmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-54"></a>            <span class="n">kmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-55"></a>            <span class="n">n_var</span> <span class="o">=</span> <span class="n">control</span><span class="p">%</span><span class="n">n_var</span>
<a name="ln-56"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">delta_t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-57"></a>                    <span class="n">errmsg</span><span class="o">=</span><span class="s1">&#39;Error: Unable to allocate memory for delta_t.&#39;</span><span class="p">)</span>
<a name="ln-58"></a>            <span class="k">CALL </span><span class="nb">SYSTEM_CLOCK</span><span class="p">(</span><span class="n">COUNT_RATE</span><span class="o">=</span><span class="n">nb_ticks_sec</span><span class="p">,</span> <span class="n">COUNT_MAX</span><span class="o">=</span><span class="n">nb_ticks_max</span><span class="p">)</span>
<a name="ln-59"></a>            <span class="k">CALL </span><span class="nb">SYSTEM_CLOCK</span><span class="p">(</span><span class="nb">COUNT</span><span class="o">=</span><span class="n">nb_ticks_initial</span><span class="p">)</span>
<a name="ln-60"></a>            <span class="k">CALL </span><span class="nb">CPU_TIME</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
<a name="ln-61"></a>
<a name="ln-62"></a>        <span class="k">end subroutine </span><span class="n">setup_time</span>
<a name="ln-63"></a>
<a name="ln-64"></a>        <span class="k">subroutine </span><span class="n">destroy_time</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
<a name="ln-65"></a>          <span class="c">!&lt; Deallocate memory and find simulation time.</span>
<a name="ln-66"></a>            <span class="k">implicit none</span>
<a name="ln-67"></a><span class="k">            type</span><span class="p">(</span><span class="n">controltype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">control</span>
<a name="ln-68"></a>            <span class="c">!&lt; Control parameters</span>
<a name="ln-69"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">total_time</span> 
<a name="ln-70"></a>            <span class="c">!&lt; Total time of executation for each block</span>
<a name="ln-71"></a>            <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-72"></a>            <span class="c">!&lt; error variable for mpi communication</span>
<a name="ln-73"></a>            
<a name="ln-74"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;deallocate_misc&#39;</span><span class="p">)</span>
<a name="ln-75"></a>
<a name="ln-76"></a>            <span class="c">!simlulation clock data</span>
<a name="ln-77"></a>            <span class="k">if</span><span class="p">(</span><span class="n">control</span><span class="p">%</span><span class="n">process_id</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s1">&#39;&gt;&gt; TIME &lt;&lt;&#39;</span>
<a name="ln-78"></a>            <span class="k">if</span><span class="p">(</span><span class="n">control</span><span class="p">%</span><span class="n">process_id</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s2">&quot;Simulation Clock : &quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">write_time</span><span class="p">(</span><span class="n">sim_clock</span><span class="p">))</span>
<a name="ln-79"></a>            <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">control</span><span class="p">%</span><span class="n">total_process</span><span class="p">)</span>
<a name="ln-80"></a>            <span class="k">CALL </span><span class="nb">CPU_TIME</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
<a name="ln-81"></a>            <span class="k">CALL </span><span class="nb">SYSTEM_CLOCK</span><span class="p">(</span><span class="nb">COUNT</span><span class="o">=</span><span class="n">nb_ticks_final</span><span class="p">)</span>
<a name="ln-82"></a>
<a name="ln-83"></a>            <span class="n">nb_ticks</span> <span class="o">=</span> <span class="n">nb_ticks_final</span> <span class="o">-</span> <span class="n">nb_ticks_initial</span>
<a name="ln-84"></a>            <span class="k">IF</span> <span class="p">(</span><span class="n">nb_ticks_final</span> <span class="o">&lt;</span> <span class="n">nb_ticks_initial</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-85"></a>            <span class="n">nb_ticks</span> <span class="o">=</span> <span class="n">nb_ticks</span> <span class="o">+</span> <span class="n">nb_ticks_max</span>
<a name="ln-86"></a>            <span class="n">elapsed_time</span>   <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">nb_ticks</span><span class="p">)</span> <span class="o">/</span> <span class="n">nb_ticks_sec</span>
<a name="ln-87"></a>            <span class="n">cpu_time_elapsed</span> <span class="o">=</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span> 
<a name="ln-88"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(A,I0,A)&#39;</span><span class="p">)</span> <span class="s1">&#39;process: &#39;</span><span class="p">,</span><span class="n">control</span><span class="p">%</span><span class="n">process_id</span><span class="p">,&amp;</span>
<a name="ln-89"></a>                                <span class="s2">&quot; &gt; SYSTEM clock &lt;: &quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">write_time</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">))</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-90"></a>                                <span class="s2">&quot; /-\ CPU time &lt;: &quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">write_time</span><span class="p">(</span><span class="n">cpu_time_elapsed</span><span class="p">))</span>
<a name="ln-91"></a>            
<a name="ln-92"></a>            <span class="c">!total time including all blocks</span>
<a name="ln-93"></a>            <span class="k">call </span><span class="n">MPI_GATHER</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE_PRECISION</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-94"></a>            <span class="n">total_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE_PRECISION</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-95"></a>            <span class="k">if</span><span class="p">(</span><span class="n">control</span><span class="p">%</span><span class="n">process_id</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Total SYSTEM clock: &quot;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">(</span><span class="n">write_time</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">total_time</span><span class="p">)))</span>
<a name="ln-96"></a>            <span class="k">call </span><span class="n">MPI_GATHER</span><span class="p">(</span><span class="n">cpu_time_elapsed</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE_PRECISION</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-97"></a>            <span class="n">total_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_DOUBLE_PRECISION</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-98"></a>            <span class="k">if</span><span class="p">(</span><span class="n">control</span><span class="p">%</span><span class="n">process_id</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Total CPU time    : &quot;</span><span class="p">,</span> <span class="nb">trim</span><span class="p">(</span><span class="n">write_time</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">total_time</span><span class="p">)))</span>
<a name="ln-99"></a>
<a name="ln-100"></a>        <span class="k">end subroutine </span><span class="n">destroy_time</span>
<a name="ln-101"></a>
<a name="ln-102"></a>        <span class="k">function </span><span class="n">write_time</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a name="ln-103"></a>          <span class="c">!&lt; Particular format to write time in output log file</span>
<a name="ln-104"></a>          <span class="k">implicit none</span>
<a name="ln-105"></a><span class="k">          </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">time_in_seconds</span>
<a name="ln-106"></a>          <span class="c">!&lt; Time to output</span>
<a name="ln-107"></a>          <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span><span class="kd">::</span> <span class="n">string</span>
<a name="ln-108"></a>          <span class="c">!&lt; Time as string in particlar format</span>
<a name="ln-109"></a>          <span class="k">if</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="o">&gt;</span><span class="mi">86400</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-110"></a><span class="k">            write</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;(f0.16,2x,A)&#39;</span><span class="p">)</span> <span class="n">time_in_seconds</span><span class="o">/</span><span class="mi">8640</span><span class="mf">0.</span><span class="p">,</span><span class="s2">&quot;days&quot;</span>
<a name="ln-111"></a>          <span class="n">elseif</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="o">&gt;</span><span class="mi">3600</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-112"></a><span class="k">            write</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;(f0.16,2x,A)&#39;</span><span class="p">)</span> <span class="n">time_in_seconds</span><span class="o">/</span><span class="mi">360</span><span class="mf">0.</span><span class="p">,</span><span class="s2">&quot;Hr.&quot;</span>
<a name="ln-113"></a>          <span class="n">elseif</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="o">&gt;</span><span class="mi">60</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-114"></a><span class="k">            write</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;(f0.16,2x,A)&#39;</span><span class="p">)</span> <span class="n">time_in_seconds</span><span class="o">/</span><span class="mi">6</span><span class="mf">0.</span><span class="p">,</span><span class="s2">&quot;Min.&quot;</span>
<a name="ln-115"></a>          <span class="n">elseif</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-116"></a><span class="k">            write</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;(f0.16,2x,A)&#39;</span><span class="p">)</span> <span class="n">time_in_seconds</span><span class="p">,</span><span class="s2">&quot;Sec.&quot;</span>
<a name="ln-117"></a>          <span class="k">else</span>
<a name="ln-118"></a><span class="k">            write</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s2">&quot;Not Valid&quot;</span>
<a name="ln-119"></a>          <span class="k">end if</span>
<a name="ln-120"></a><span class="k">        end function </span><span class="n">write_time</span>
<a name="ln-121"></a>
<a name="ln-122"></a>        <span class="k">subroutine </span><span class="n">compute_local_time_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-123"></a>            <span class="c">!&lt; Compute the time step to be used at each cell center</span>
<a name="ln-124"></a>            <span class="c">!&lt;</span>
<a name="ln-125"></a>            <span class="c">!&lt; Local time stepping can be used to get the solution </span>
<a name="ln-126"></a>            <span class="c">!&lt; advance towards steady state faster. If only the steady</span>
<a name="ln-127"></a>            <span class="c">!&lt; state solution is required, i.e., transients are </span>
<a name="ln-128"></a>            <span class="c">!&lt; irrelevant, use local time stepping. </span>
<a name="ln-129"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-130"></a>
<a name="ln-131"></a>            <span class="k">implicit none</span>
<a name="ln-132"></a><span class="k">            </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CFL</span>
<a name="ln-133"></a>            <span class="c">!&lt; CFL number</span>
<a name="ln-134"></a>            <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-135"></a>            <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-136"></a>            <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-137"></a>            <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-138"></a>            <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-139"></a>            <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-140"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-141"></a>            <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-142"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-143"></a>            <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-144"></a>            <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-145"></a>            <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-146"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-147"></a>            <span class="c">!&lt; Store face quantites for I faces </span>
<a name="ln-148"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-149"></a>            <span class="c">!&lt; Store face quantites for J faces </span>
<a name="ln-150"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-151"></a>            <span class="c">!&lt; Store face quantites for K faces </span>
<a name="ln-152"></a>
<a name="ln-153"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lmx1</span><span class="p">,</span> <span class="n">lmx2</span><span class="p">,</span> <span class="n">lmx3</span><span class="p">,</span> <span class="n">lmx4</span><span class="p">,</span> <span class="n">lmx5</span><span class="p">,</span> <span class="n">lmx6</span><span class="p">,</span> <span class="n">lmxsum</span>
<a name="ln-154"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x_sound_speed_avg</span><span class="p">,</span> <span class="n">y_sound_speed_avg</span><span class="p">,</span> <span class="n">z_sound_speed_avg</span>
<a name="ln-155"></a>            <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-156"></a>
<a name="ln-157"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;compute_local_time_step&#39;</span><span class="p">)</span>
<a name="ln-158"></a>
<a name="ln-159"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-160"></a>             <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-161"></a>              <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-162"></a>               <span class="c">! For orientation, refer to the report. The standard i,j,k </span>
<a name="ln-163"></a>               <span class="c">! direction are marked. All orientation notations are w.r.t </span>
<a name="ln-164"></a>               <span class="c">! to the perspective shown in the image.</span>
<a name="ln-165"></a>
<a name="ln-166"></a>               <span class="c">! Faces with lower index</span>
<a name="ln-167"></a>               <span class="n">x_sound_speed_avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">x_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-168"></a>                                                    <span class="n">x_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-169"></a>                                          <span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">x_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-170"></a>                                                    <span class="n">x_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-171"></a>               <span class="n">y_sound_speed_avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">y_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-172"></a>                                                    <span class="n">y_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-173"></a>                                          <span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">y_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-174"></a>                                                    <span class="n">y_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-175"></a>               <span class="n">z_sound_speed_avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">z_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-176"></a>                                                    <span class="n">z_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-177"></a>                                          <span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">z_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-178"></a>                                                    <span class="n">z_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-179"></a>               
<a name="ln-180"></a>               <span class="c">! For left face: i.e., lower index face along xi direction</span>
<a name="ln-181"></a>               <span class="n">lmx1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-182"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-183"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-184"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-185"></a>                    <span class="n">x_sound_speed_avg</span>
<a name="ln-186"></a>               <span class="c">! For front face, i.e., lower index face along eta direction</span>
<a name="ln-187"></a>               <span class="n">lmx2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-188"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-189"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-190"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-191"></a>                    <span class="n">y_sound_speed_avg</span>
<a name="ln-192"></a>               <span class="c">! For bottom face, i.e., lower index face along zeta direction</span>
<a name="ln-193"></a>               <span class="n">lmx3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-194"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-195"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-196"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-197"></a>                    <span class="n">z_sound_speed_avg</span>
<a name="ln-198"></a>
<a name="ln-199"></a>               <span class="c">! Faces with higher index</span>
<a name="ln-200"></a>               <span class="n">x_sound_speed_avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">x_qp_left</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_qp_left</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-201"></a>                                          <span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">x_qp_right</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">x_qp_right</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-202"></a>               <span class="n">y_sound_speed_avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">y_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-203"></a>                                          <span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">y_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-204"></a>               <span class="n">z_sound_speed_avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">z_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">z_qp_left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-205"></a>                                          <span class="nb">sqrt</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">z_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">z_qp_right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-206"></a>               
<a name="ln-207"></a>               <span class="c">! For right face, i.e., higher index face along xi direction</span>
<a name="ln-208"></a>               <span class="n">lmx4</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-209"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>  <span class="c">!x_speed*xnx</span>
<a name="ln-210"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>  <span class="c">!y_speed*xny</span>
<a name="ln-211"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">!z_speed*xnz</span>
<a name="ln-212"></a>                    <span class="n">x_sound_speed_avg</span>
<a name="ln-213"></a>               <span class="c">! For back face, i.e., higher index face along eta direction</span>
<a name="ln-214"></a>               <span class="n">lmx5</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-215"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-216"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-217"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-218"></a>                    <span class="n">y_sound_speed_avg</span>
<a name="ln-219"></a>               <span class="c">! For top face, i.e., higher index face along zeta direction</span>
<a name="ln-220"></a>               <span class="n">lmx6</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-221"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-222"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-223"></a>                    <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="p">))</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-224"></a>                    <span class="n">z_sound_speed_avg</span>
<a name="ln-225"></a>
<a name="ln-226"></a>               <span class="n">lmxsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-227"></a>                        <span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx2</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-228"></a>                        <span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx3</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-229"></a>                        <span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx4</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-230"></a>                        <span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx5</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-231"></a>                        <span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx6</span><span class="p">)</span>
<a name="ln-232"></a>            
<a name="ln-233"></a>               <span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">lmxsum</span>
<a name="ln-234"></a>               <span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">volume</span> <span class="o">*</span> <span class="n">CFL</span>
<a name="ln-235"></a>              <span class="k">end do</span>
<a name="ln-236"></a><span class="k">             end do</span>
<a name="ln-237"></a><span class="k">            end do</span>
<a name="ln-238"></a>
<a name="ln-239"></a><span class="k">            if</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">mu_ref</span><span class="o">/=</span><span class="mf">0.0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-240"></a><span class="k">              call </span><span class="n">add_viscous_time</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-241"></a>            <span class="k">end if</span>
<a name="ln-242"></a><span class="k">            if</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">mu_ref</span><span class="o">/=</span><span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">turbulence</span><span class="p">)</span><span class="o">/=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-243"></a><span class="k">              call </span><span class="n">add_turbulent_time</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-244"></a>            <span class="k">end if</span>
<a name="ln-245"></a>
<a name="ln-246"></a><span class="k">        end subroutine </span><span class="n">compute_local_time_step</span>
<a name="ln-247"></a>
<a name="ln-248"></a>        <span class="k">subroutine </span><span class="n">compute_global_time_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-249"></a>            <span class="c">!&lt; Compute a common time step to be used at all cell centers</span>
<a name="ln-250"></a>            <span class="c">!&lt;</span>
<a name="ln-251"></a>            <span class="c">!&lt; Global time stepping is generally used to get time </span>
<a name="ln-252"></a>            <span class="c">!&lt; accurate solutions; transients can be studied by </span>
<a name="ln-253"></a>            <span class="c">!&lt; employing this strategy.</span>
<a name="ln-254"></a>            <span class="c">!&lt;-----------------------------------------------------------</span>
<a name="ln-255"></a>
<a name="ln-256"></a>            <span class="k">implicit none</span>
<a name="ln-257"></a><span class="k">            </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CFL</span>
<a name="ln-258"></a>            <span class="c">!&lt; CFL number</span>
<a name="ln-259"></a>            <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-260"></a>            <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-261"></a>            <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-262"></a>            <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-263"></a>            <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-264"></a>            <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-265"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-266"></a>            <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-267"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-268"></a>            <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-269"></a>            <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-270"></a>            <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-271"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-272"></a>            <span class="c">!&lt; Store face quantites for I faces </span>
<a name="ln-273"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-274"></a>            <span class="c">!&lt; Store face quantites for J faces </span>
<a name="ln-275"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-276"></a>            <span class="c">!&lt; Store face quantites for K faces </span>
<a name="ln-277"></a>            
<a name="ln-278"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;compute_global_time_step&#39;</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">global_time_step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-281"></a><span class="k">                </span><span class="n">delta_t</span> <span class="o">=</span> <span class="n">scheme</span><span class="p">%</span><span class="n">global_time_step</span>
<a name="ln-282"></a>            <span class="k">else</span>
<a name="ln-283"></a><span class="k">              call </span><span class="n">compute_local_time_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-284"></a>                <span class="c">! The global time step is the minimum of all the local time</span>
<a name="ln-285"></a>                <span class="c">! steps.</span>
<a name="ln-286"></a>                <span class="n">delta_t</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">delta_t</span><span class="p">)</span>
<a name="ln-287"></a>            <span class="k">end if</span>
<a name="ln-288"></a>
<a name="ln-289"></a><span class="k">        end subroutine </span><span class="n">compute_global_time_step</span>
<a name="ln-290"></a>
<a name="ln-291"></a>        <span class="k">subroutine </span><span class="n">compute_time_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-292"></a>            <span class="c">!&lt; Compute the time step to be used</span>
<a name="ln-293"></a>            <span class="c">!&lt;</span>
<a name="ln-294"></a>            <span class="c">!&lt; This calls either compute_global_time_step() or </span>
<a name="ln-295"></a>            <span class="c">!&lt; compute_local_time_step() based on what </span>
<a name="ln-296"></a>            <span class="c">!&lt; time_stepping_method is set to.</span>
<a name="ln-297"></a>            <span class="c">!-----------------------------------------------------------</span>
<a name="ln-298"></a>
<a name="ln-299"></a>            <span class="k">implicit none</span>
<a name="ln-300"></a><span class="k">            </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CFL</span>
<a name="ln-301"></a>            <span class="c">!&lt; CFL number</span>
<a name="ln-302"></a>            <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-303"></a>            <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-304"></a>            <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-305"></a>            <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-306"></a>            <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-307"></a>            <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-308"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-309"></a>            <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-310"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-311"></a>            <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-312"></a>            <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-313"></a>            <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-314"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-315"></a>            <span class="c">!&lt; Store face quantites for I faces </span>
<a name="ln-316"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-317"></a>            <span class="c">!&lt; Store face quantites for J faces </span>
<a name="ln-318"></a>            <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-319"></a>            <span class="c">!&lt; Store face quantites for K faces </span>
<a name="ln-320"></a>            
<a name="ln-321"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;compute_time_step&#39;</span><span class="p">)</span>
<a name="ln-322"></a>
<a name="ln-323"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">time_stepping_method</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-324"></a><span class="k">                call </span><span class="n">compute_global_time_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-325"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">time_stepping_method</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;l&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-326"></a><span class="k">                call </span><span class="n">compute_local_time_step</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-327"></a>            <span class="k">else</span>
<a name="ln-328"></a><span class="k">                print</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;In compute_time_step: value for time_stepping_method (&#39;</span> <span class="o">//</span><span class="n">scheme</span><span class="p">%</span><span class="n">time_stepping_method</span> <span class="o">//</span> <span class="s1">&#39;) not recognized.&#39;</span>
<a name="ln-329"></a>                <span class="n">Fatal_error</span>
<a name="ln-330"></a>            <span class="k">end if</span>
<a name="ln-331"></a>            <span class="c">!update_simulation clock</span>
<a name="ln-332"></a>            <span class="k">call </span><span class="n">update_simulation_clock</span><span class="p">(</span><span class="n">delta_t</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-333"></a>
<a name="ln-334"></a>        <span class="k">end subroutine </span><span class="n">compute_time_step</span>
<a name="ln-335"></a>
<a name="ln-336"></a>
<a name="ln-337"></a>      <span class="k">subroutine </span><span class="n">update_simulation_clock</span><span class="p">(</span><span class="n">delta_t</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-338"></a>          <span class="c">!&lt;  Update the simulation clock</span>
<a name="ln-339"></a>          <span class="c">!&lt; </span>
<a name="ln-340"></a>          <span class="c">!&lt;  It is sometimes useful to know what the simulation time is</span>
<a name="ln-341"></a>          <span class="c">!&lt;  at every iteration so that a comparison with an analytical</span>
<a name="ln-342"></a>          <span class="c">!&lt;  solution is possible. Since, the global timesteps used may</span>
<a name="ln-343"></a>          <span class="c">!&lt;  not be uniform, we need to track this explicitly.</span>
<a name="ln-344"></a>          <span class="c">!&lt; </span>
<a name="ln-345"></a>          <span class="c">!&lt;  Of course, it makes sense to track this only if the time </span>
<a name="ln-346"></a>          <span class="c">!&lt;  stepping is global and not local. If the time stepping is</span>
<a name="ln-347"></a>          <span class="c">!&lt;  local, the simulation clock is set to -1. If it is global</span>
<a name="ln-348"></a>          <span class="c">!&lt;  it is incremented according to the time step found.</span>
<a name="ln-349"></a>          <span class="c">!-----------------------------------------------------------</span>
<a name="ln-350"></a>
<a name="ln-351"></a>          <span class="k">implicit none</span>
<a name="ln-352"></a><span class="k">          type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-353"></a>          <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-354"></a>          <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-355"></a>          <span class="c">!&lt; finite-volume Schemes: time stepping methods</span>
<a name="ln-356"></a>          <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-357"></a>          <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-358"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">time_stepping_method</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;g&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">sim_clock</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-359"></a><span class="k">              </span><span class="n">sim_clock</span> <span class="o">=</span> <span class="n">sim_clock</span> <span class="o">+</span> <span class="nb">minval</span><span class="p">(</span><span class="n">delta_t</span><span class="p">)</span>
<a name="ln-360"></a>          <span class="k">else if</span> <span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">time_stepping_method</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="s1">&#39;l&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-361"></a><span class="k">              </span><span class="n">sim_clock</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-362"></a>          <span class="k">end if</span>
<a name="ln-363"></a>
<a name="ln-364"></a><span class="k">      end subroutine </span><span class="n">update_simulation_clock</span>
<a name="ln-365"></a>
<a name="ln-366"></a>      <span class="k">subroutine </span><span class="n">add_viscous_time</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">CFL</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-367"></a>        <span class="c">!&lt; Addition to local time step due to viscous effects</span>
<a name="ln-368"></a>        <span class="k">implicit none</span>
<a name="ln-369"></a>
<a name="ln-370"></a><span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CFL</span>
<a name="ln-371"></a>        <span class="c">!&lt; CFL number</span>
<a name="ln-372"></a>        <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-373"></a>        <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-374"></a>        <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-375"></a>        <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-376"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-377"></a>        <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-378"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-379"></a>        <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-380"></a>        <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-381"></a>        <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-382"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-383"></a>        <span class="c">!&lt; Store face quantites for I faces </span>
<a name="ln-384"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-385"></a>        <span class="c">!&lt; Store face quantites for J faces </span>
<a name="ln-386"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-387"></a>        <span class="c">!&lt; Store face quantites for K faces </span>
<a name="ln-388"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lmx1</span><span class="p">,</span> <span class="n">lmx2</span><span class="p">,</span> <span class="n">lmx3</span><span class="p">,</span> <span class="n">lmx4</span><span class="p">,</span> <span class="n">lmx5</span><span class="p">,</span> <span class="n">lmx6</span><span class="p">,</span> <span class="n">lmxsum</span>
<a name="ln-389"></a>        <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-390"></a>
<a name="ln-391"></a>        <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;add_viscous_time_step&#39;</span><span class="p">)</span>
<a name="ln-392"></a>
<a name="ln-393"></a>        <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-394"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-395"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-396"></a>
<a name="ln-397"></a>           <span class="c">! Faces with lower index</span>
<a name="ln-398"></a>
<a name="ln-399"></a>           
<a name="ln-400"></a>           <span class="c">! For left face: i.e., lower index face along xi direction</span>
<a name="ln-401"></a>           <span class="n">lmx1</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-402"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-403"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-404"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-405"></a>           <span class="c">! For front face, i.e., lower index face along eta direction</span>
<a name="ln-406"></a>           <span class="n">lmx2</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-407"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-408"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-409"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-410"></a>           <span class="c">! For bottom face, i.e., lower index face along zeta direction</span>
<a name="ln-411"></a>           <span class="n">lmx3</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-412"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-413"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-414"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-415"></a>
<a name="ln-416"></a>           
<a name="ln-417"></a>           <span class="c">! For right face, i.e., higher index face along xi direction</span>
<a name="ln-418"></a>           <span class="n">lmx4</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-419"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-420"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-421"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-422"></a>           <span class="c">! For back face, i.e., higher index face along eta direction</span>
<a name="ln-423"></a>           <span class="n">lmx5</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-424"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-425"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-426"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-427"></a>           <span class="c">! For top face, i.e., higher index face along zeta direction</span>
<a name="ln-428"></a>           <span class="n">lmx6</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-429"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-430"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-431"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-432"></a>
<a name="ln-433"></a>               <span class="n">lmxsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-434"></a>                        <span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx2</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-435"></a>                        <span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx3</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-436"></a>                        <span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx4</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-437"></a>                        <span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx5</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-438"></a>                        <span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx6</span><span class="p">)</span>
<a name="ln-439"></a>
<a name="ln-440"></a>           <span class="n">lmxsum</span> <span class="o">=</span> <span class="n">flow</span><span class="p">%</span><span class="n">gm</span><span class="o">*</span><span class="n">lmxsum</span><span class="o">/</span><span class="n">flow</span><span class="p">%</span><span class="n">Pr</span>
<a name="ln-441"></a>
<a name="ln-442"></a>           <span class="n">lmxsum</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="n">lmxsum</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">CFL</span><span class="o">*</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="o">/</span><span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-443"></a>        
<a name="ln-444"></a>           <span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">CFL</span><span class="o">*</span><span class="p">(</span> <span class="n">lmxsum</span> <span class="o">*</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-445"></a>          <span class="k">end do</span>
<a name="ln-446"></a><span class="k">         end do</span>
<a name="ln-447"></a><span class="k">        end do</span>
<a name="ln-448"></a><span class="k">      end subroutine </span><span class="n">add_viscous_time</span>
<a name="ln-449"></a>
<a name="ln-450"></a>      <span class="k">subroutine </span><span class="n">add_turbulent_time</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span><span class="n">delta_t</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span><span class="n">Ifaces</span><span class="p">,</span><span class="n">Jfaces</span><span class="p">,</span><span class="n">Kfaces</span><span class="p">,</span><span class="n">CFL</span><span class="p">,</span><span class="n">flow</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-451"></a>        <span class="c">!&lt; Addition to local time step due to turbulence </span>
<a name="ln-452"></a>        <span class="k">implicit none</span>
<a name="ln-453"></a><span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">CFL</span>
<a name="ln-454"></a>        <span class="c">!&lt; CFL number</span>
<a name="ln-455"></a>        <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-456"></a>        <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-457"></a>        <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-458"></a>        <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-459"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-460"></a>        <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-461"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delta_t</span>
<a name="ln-462"></a>        <span class="c">!&lt; Local time increment value at each cell center</span>
<a name="ln-463"></a>        <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-464"></a>        <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-465"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-466"></a>        <span class="c">!&lt; Store face quantites for I faces </span>
<a name="ln-467"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-468"></a>        <span class="c">!&lt; Store face quantites for J faces </span>
<a name="ln-469"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-470"></a>        <span class="c">!&lt; Store face quantites for K faces </span>
<a name="ln-471"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lmx1</span><span class="p">,</span> <span class="n">lmx2</span><span class="p">,</span> <span class="n">lmx3</span><span class="p">,</span> <span class="n">lmx4</span><span class="p">,</span> <span class="n">lmx5</span><span class="p">,</span> <span class="n">lmx6</span><span class="p">,</span> <span class="n">lmxsum</span>
<a name="ln-472"></a>        <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-473"></a>
<a name="ln-474"></a>        <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;add_viscous_time_step&#39;</span><span class="p">)</span>
<a name="ln-475"></a>
<a name="ln-476"></a>        <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-477"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-478"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-479"></a>
<a name="ln-480"></a>           <span class="c">! Faces with lower index</span>
<a name="ln-481"></a>
<a name="ln-482"></a>           
<a name="ln-483"></a>           <span class="c">! For left face: i.e., lower index face along xi direction</span>
<a name="ln-484"></a>           <span class="n">lmx1</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-485"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-486"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-487"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-488"></a>           <span class="c">! For front face, i.e., lower index face along eta direction</span>
<a name="ln-489"></a>           <span class="n">lmx2</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-490"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-491"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-492"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-493"></a>           <span class="c">! For bottom face, i.e., lower index face along zeta direction</span>
<a name="ln-494"></a>           <span class="n">lmx3</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-495"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-496"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-497"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-498"></a>
<a name="ln-499"></a>           
<a name="ln-500"></a>           <span class="c">! For right face, i.e., higher index face along xi direction</span>
<a name="ln-501"></a>           <span class="n">lmx4</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-502"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-503"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-504"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-505"></a>           <span class="c">! For back face, i.e., higher index face along eta direction</span>
<a name="ln-506"></a>           <span class="n">lmx5</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-507"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-508"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-509"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-510"></a>           <span class="c">! For top face, i.e., higher index face along zeta direction</span>
<a name="ln-511"></a>           <span class="n">lmx6</span> <span class="o">=</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-512"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-513"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">centery</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-514"></a>                <span class="p">((</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">centerz</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-515"></a>
<a name="ln-516"></a>               <span class="n">lmxsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-517"></a>                        <span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx2</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-518"></a>                        <span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx3</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-519"></a>                        <span class="p">(</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx4</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-520"></a>                        <span class="p">(</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx5</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-521"></a>                        <span class="p">(</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span> <span class="o">*</span> <span class="n">lmx6</span><span class="p">)</span>
<a name="ln-522"></a>
<a name="ln-523"></a>           <span class="n">lmxsum</span> <span class="o">=</span> <span class="n">flow</span><span class="p">%</span><span class="n">gm</span><span class="o">*</span><span class="n">lmxsum</span><span class="o">/</span><span class="n">flow</span><span class="p">%</span><span class="n">tPr</span>
<a name="ln-524"></a>
<a name="ln-525"></a>           <span class="n">lmxsum</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="n">lmxsum</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">CFL</span><span class="o">*</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="o">/</span><span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
<a name="ln-526"></a>        
<a name="ln-527"></a>           <span class="n">delta_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">CFL</span><span class="o">*</span><span class="p">(</span> <span class="n">lmxsum</span> <span class="o">*</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-528"></a>          <span class="k">end do</span>
<a name="ln-529"></a><span class="k">         end do</span>
<a name="ln-530"></a><span class="k">        end do</span>
<a name="ln-531"></a><span class="k">      end subroutine </span><span class="n">add_turbulent_time</span>
<a name="ln-532"></a><span class="k">end module </span><span class="nb">time</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-02-10T20:32:54.471560 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>