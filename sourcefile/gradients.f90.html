<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>gradients.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>gradients.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.8% of total for source files.">442 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/gradients.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">gradients.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/gradients.html">gradients</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/gradients.f90.html#src">gradients.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>Allocate memory to laminar gradients if flow is viscous and
 allocate memory to tubulence gradients base upon the model being used</p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~gradients.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilegradientsf90EfferentGraph" width="190pt" height="74pt"
 viewBox="0.00 0.00 190.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~gradients.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~gradients.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 186,-70 186,4 -4,4"/>
<!-- sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~gradients.f90</title>
<polygon fill="none" stroke="#000000" points="182,-45 107,-45 107,-21 182,-21 182,-45"/>
<text text-anchor="middle" x="144.5" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">gradients.f90</text>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~gradients.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~gradients.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="62.5,-66 8.5,-66 8.5,-42 62.5,-42 62.5,-66"/>
<text text-anchor="middle" x="35.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~gradients.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~gradients.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~gradients.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M106.9884,-40.227C95.8613,-42.3707 83.6846,-44.7167 72.5848,-46.8552"/>
<polygon fill="#ff0000" stroke="#ff0000" points="71.9121,-43.4204 62.7548,-48.7491 73.2364,-50.294 71.9121,-43.4204"/>
</g>
<!-- sourcefile~vartypes.f90 -->
<g id="sourcefile~~gradients.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~vartypes.f90</title>
<g id="a_sourcefile~~gradients.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/vartypes.f90.html" xlink:title="vartypes.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">vartypes.f90</text>
</a>
</g>
</g>
<!-- sourcefile~gradients.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~gradients.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~gradients.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M106.9884,-25.773C98.6672,-24.1698 89.7589,-22.4535 81.153,-20.7955"/>
<polygon fill="#ff0000" stroke="#ff0000" points="81.7241,-17.3413 71.2426,-18.8862 80.3998,-24.2149 81.7241,-17.3413"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~gradients.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilegradientsf90AfferentGraph" width="641pt" height="342pt"
 viewBox="0.00 0.00 641.00 341.73" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~gradients.f90~~AfferentGraph" class="graph" transform="scale(.7914 .7914) rotate(0) translate(4 427.8323)">
<title>sourcefile~~gradients.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-427.8323 806,-427.8323 806,4 -4,4"/>
<!-- sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~gradients.f90</title>
<polygon fill="none" stroke="#000000" points="75,-237.8323 0,-237.8323 0,-213.8323 75,-213.8323 75,-237.8323"/>
<text text-anchor="middle" x="37.5" y="-223.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">gradients.f90</text>
</g>
<!-- sourcefile~write_output_tec_node.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~write_output_tec_node.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/write_output_tec_node.f90.html" xlink:title="write_output_tec_node.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="356,-423.8323 217,-423.8323 217,-399.8323 356,-399.8323 356,-423.8323"/>
<text text-anchor="middle" x="286.5" y="-409.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output_tec_node.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M241.0638,-399.8279C232.9259,-397.1935 224.617,-394.1774 217,-390.8323 183.4312,-376.09 179.4172,-363.9151 146,-348.8323"/>
</g>
<!-- sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~viscosity.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/viscosity.f90.html" xlink:title="viscosity.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="181,-237.8323 111,-237.8323 111,-213.8323 181,-213.8323 181,-237.8323"/>
<text text-anchor="middle" x="146" y="-223.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">viscosity.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~write_output_tec_node.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M230.2762,-399.7348C225.4724,-397.2929 220.9487,-394.3585 217,-390.8323 194.6867,-370.9063 165.9408,-288.174 152.9362,-247.9654"/>
<polygon fill="#ff9900" stroke="#ff9900" points="156.2194,-246.741 149.8428,-238.28 149.5513,-248.8708 156.2194,-246.741"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M110.7732,-225.8323C102.6788,-225.8323 93.9375,-225.8323 85.4083,-225.8323"/>
<polygon fill="#ff0000" stroke="#ff0000" points="85.1673,-222.3324 75.1673,-225.8323 85.1673,-229.3324 85.1673,-222.3324"/>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="712,-185.8323 653,-185.8323 653,-161.8323 712,-161.8323 712,-185.8323"/>
<text text-anchor="middle" x="682.5" y="-171.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M652.7132,-170.314C629.177,-167.1428 595.637,-161.7512 567,-153.8323"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M567,-153.8323C506.5106,-137.1052 534.1935,-75.1372 481,-41.8323 406.1984,5.0016 374.6886,1.5541 286.5,-1.8323"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M286.5,-1.8323C221.5751,-2.1745 204.6563,-13.9971 146,-41.8323"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M146,-41.8323C81.1224,-72.6198 52.3136,-162.1102 42.1284,-203.8797"/>
<polygon fill="#ff0000" stroke="#ff0000" points="38.716,-203.102 39.8805,-213.6327 45.5372,-204.6743 38.716,-203.102"/>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M436.5,-245.8323C353.0812,-272.2807 249.6486,-253.8156 191.4113,-239.0844"/>
<polygon fill="#ff9900" stroke="#ff9900" points="191.9837,-235.6167 181.4243,-236.4819 190.2185,-242.3905 191.9837,-235.6167"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="468.5,-74.8323 404.5,-74.8323 404.5,-50.8323 468.5,-50.8323 468.5,-74.8323"/>
<text text-anchor="middle" x="436.5" y="-60.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M567,-153.8323C521.5561,-141.2657 478.6923,-104.9964 455.1735,-82.2223"/>
<polygon fill="#00ff66" stroke="#00ff66" points="457.5279,-79.6278 447.9635,-75.07 452.598,-84.5974 457.5279,-79.6278"/>
</g>
<!-- sourcefile~viscous.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~viscous.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/viscous.f90.html" xlink:title="viscous.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="319.5,-297.8323 253.5,-297.8323 253.5,-273.8323 319.5,-273.8323 319.5,-297.8323"/>
<text text-anchor="middle" x="286.5" y="-283.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">viscous.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~viscous.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~viscous.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M436.5,-245.8323C400.7229,-257.1757 359.4831,-268.0144 329.3105,-275.5409"/>
<polygon fill="#0066ff" stroke="#0066ff" points="328.3926,-272.1624 319.5262,-277.9623 330.0742,-278.9574 328.3926,-272.1624"/>
</g>
<!-- sourcefile~time.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~time.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node12"><a xlink:href=".././sourcefile/time.f90.html" xlink:title="time.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="313.5,-217.8323 259.5,-217.8323 259.5,-193.8323 313.5,-193.8323 313.5,-217.8323"/>
<text text-anchor="middle" x="286.5" y="-203.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">time.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge31" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M567,-153.8323C498.6029,-134.9185 504.1455,-224.3848 436.5,-245.8323"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M436.5,-245.8323C425.6712,-249.2656 364.045,-230.8271 323.2275,-217.8366"/>
<polygon fill="#ff0000" stroke="#ff0000" points="324.1866,-214.4687 313.5955,-214.7498 322.0502,-221.1348 324.1866,-214.4687"/>
</g>
<!-- sourcefile~dump_solution.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node15" class="node">
<title>sourcefile~dump_solution.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node15"><a xlink:href=".././sourcefile/dump_solution.f90.html" xlink:title="dump_solution.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="617,-282.8323 517,-282.8323 517,-258.8323 617,-258.8323 617,-282.8323"/>
<text text-anchor="middle" x="567" y="-268.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dump_solution.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~dump_solution.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge34" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~dump_solution.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M667.8718,-186.1174C648.0849,-202.735 612.6063,-232.5309 589.4367,-251.9893"/>
<polygon fill="#ff0000" stroke="#ff0000" points="586.9162,-249.5355 581.5094,-258.6469 591.418,-254.8959 586.9162,-249.5355"/>
</g>
<!-- sourcefile~write_output_tec.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~write_output_tec.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/write_output_tec.f90.html" xlink:title="write_output_tec.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="341,-381.8323 232,-381.8323 232,-357.8323 341,-357.8323 341,-381.8323"/>
<text text-anchor="middle" x="286.5" y="-367.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output_tec.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M231.8367,-368.6003C204.9909,-366.2929 172.7508,-360.9062 146,-348.8323"/>
</g>
<!-- sourcefile~write_output_tec.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~write_output_tec.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M231.7458,-357.7326C226.4743,-355.2901 221.4447,-352.3562 217,-348.8323 183.4211,-322.2096 162.7116,-275.0445 152.8739,-247.4996"/>
<polygon fill="#ff9900" stroke="#ff9900" points="156.1708,-246.3233 149.6317,-237.9871 149.545,-248.5816 156.1708,-246.3233"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M419.8446,-50.5999C393.0654,-32.2285 338.1892,.1525 286.5,-1.8323"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M428.1288,-75.1187C414.9514,-93.5081 387.592,-128.0337 356,-146.8323 300.9621,-179.5822 276.1064,-160.1712 217,-184.8323 201.7782,-191.1833 185.7898,-200.185 172.8474,-208.1366"/>
<polygon fill="#ff9900" stroke="#ff9900" points="170.6197,-205.4028 164.0162,-213.6881 174.3451,-211.3292 170.6197,-205.4028"/>
</g>
<!-- sourcefile~plusgs.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~plusgs.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/plusgs.f90.html" xlink:title="plusgs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="317,-53.8323 256,-53.8323 256,-29.8323 317,-29.8323 317,-53.8323"/>
<text text-anchor="middle" x="286.5" y="-39.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">plusgs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~plusgs.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~plusgs.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M404.3212,-58.3273C381.7242,-55.1637 351.3279,-50.9082 327.0694,-47.512"/>
<polygon fill="#00ffff" stroke="#00ffff" points="327.478,-44.0351 317.0893,-46.1148 326.5074,-50.9675 327.478,-44.0351"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~viscous.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~viscous.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M432.52,-74.8975C422.7274,-103.3967 395.3635,-176.2819 356,-226.8323 343.8401,-242.4479 326.977,-256.8855 312.9068,-267.57"/>
<polygon fill="#0066ff" stroke="#0066ff" points="310.5452,-264.9627 304.574,-273.7145 314.6997,-270.5966 310.5452,-264.9627"/>
</g>
<!-- sourcefile~source.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~source.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/source.f90.html" xlink:title="source.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="318,-95.8323 255,-95.8323 255,-71.8323 318,-71.8323 318,-95.8323"/>
<text text-anchor="middle" x="286.5" y="-81.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">source.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~source.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~source.f90</title>
<path fill="none" stroke="#3200ff" stroke-dasharray="5,2" d="M404.3212,-67.3373C382.0255,-70.4587 352.1371,-74.6431 328.043,-78.0163"/>
<polygon fill="#3200ff" stroke="#3200ff" points="327.5288,-74.554 318.1107,-79.4068 328.4994,-81.4864 327.5288,-74.554"/>
</g>
<!-- sourcefile~lusgs.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~lusgs.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node11"><a xlink:href=".././sourcefile/lusgs.f90.html" xlink:title="lusgs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="314,-137.8323 259,-137.8323 259,-113.8323 314,-113.8323 314,-137.8323"/>
<text text-anchor="middle" x="286.5" y="-123.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">lusgs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~lusgs.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge30" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~lusgs.f90</title>
<path fill="none" stroke="#ff0098" stroke-dasharray="5,2" d="M415.8273,-74.994C399.8626,-84.0441 377.0194,-96.2618 356,-104.8323 345.8282,-108.9797 334.5276,-112.7371 324.0456,-115.8892"/>
<polygon fill="#ff0098" stroke="#ff0098" points="322.9358,-112.5669 314.3101,-118.719 324.8896,-119.2887 322.9358,-112.5669"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~time.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge32" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~time.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M431.2553,-74.9152C420.4892,-98.3803 393.6974,-150.3896 356,-179.8323 346.4197,-187.3147 334.4596,-192.8136 323.1757,-196.7746"/>
<polygon fill="#ff0000" stroke="#ff0000" points="321.9658,-193.4868 313.5103,-199.8707 324.1013,-200.1532 321.9658,-193.4868"/>
</g>
<!-- sourcefile~plusgs.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~plusgs.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M255.8025,-34.5682C226.1771,-29.1819 180.8184,-25.3093 146,-41.8323"/>
</g>
<!-- sourcefile~plusgs.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~plusgs.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M255.9842,-45.2356C242.6958,-48.0764 227.7391,-53.285 217,-62.8323 174.5359,-100.5837 156.43,-168.322 149.6082,-203.4037"/>
<polygon fill="#ff9900" stroke="#ff9900" points="146.1057,-203.1042 147.7732,-213.567 152.9944,-204.348 146.1057,-203.1042"/>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M253.3862,-294.0764C241.6703,-297.4509 228.5409,-301.7639 217,-306.8323 183.4312,-321.5746 179.4172,-363.9151 146,-348.8323"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M146,-348.8323C99.5974,-327.8885 65.088,-276.2049 48.4926,-246.9339"/>
<polygon fill="#ff0000" stroke="#ff0000" points="51.4386,-245.027 43.5601,-237.9433 45.3016,-248.394 51.4386,-245.027"/>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M253.3843,-274.1243C241.7883,-269.8455 228.7356,-264.8258 217,-259.8323 204.3977,-254.47 190.7822,-248.096 178.8779,-242.3239"/>
<polygon fill="#ff9900" stroke="#ff9900" points="180.2701,-239.1086 169.7497,-237.8547 177.192,-245.3955 180.2701,-239.1086"/>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M254.7092,-74.2587C213.3613,-61.8169 146.3181,-41.6813 146,-41.8323"/>
</g>
<!-- sourcefile~source.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~source.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M254.7491,-88.2476C241.9986,-91.2666 227.7963,-96.335 217,-104.8323 184.0518,-130.7642 163.3101,-176.5357 153.2573,-203.738"/>
<polygon fill="#ff9900" stroke="#ff9900" points="149.84,-202.9045 149.8154,-213.4994 156.4416,-205.2323 149.84,-202.9045"/>
</g>
<!-- sourcefile~write_output_vtk.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~write_output_vtk.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/write_output_vtk.f90.html" xlink:title="write_output_vtk.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="341,-339.8323 232,-339.8323 232,-315.8323 341,-315.8323 341,-339.8323"/>
<text text-anchor="middle" x="286.5" y="-325.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output_vtk.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M241.4628,-339.9002C206.9948,-348.1485 162.6349,-356.3405 146,-348.8323"/>
</g>
<!-- sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~write_output_vtk.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M234.5723,-315.6976C228.4135,-313.2411 222.4042,-310.3135 217,-306.8323 192.658,-291.152 171.7879,-264.8073 159.0949,-246.4351"/>
<polygon fill="#ff9900" stroke="#ff9900" points="161.8528,-244.2628 153.3844,-237.8958 156.0339,-248.154 161.8528,-244.2628"/>
</g>
<!-- sourcefile~lusgs.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~lusgs.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M258.6676,-120.3451C245.497,-117.0313 229.8737,-112.0266 217,-104.8323 180.1732,-84.2522 184.1134,-23.7457 146,-41.8323"/>
</g>
<!-- sourcefile~lusgs.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~lusgs.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M258.7562,-133.0676C245.4568,-137.2987 229.6986,-143.4756 217,-151.8323 194.7095,-166.5012 174.1836,-189.3578 160.9962,-205.7874"/>
<polygon fill="#ff9900" stroke="#ff9900" points="158.1998,-203.6818 154.7985,-213.7158 163.7148,-207.9929 158.1998,-203.6818"/>
</g>
<!-- sourcefile~time.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~time.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff9900" stroke-dasharray="5,2" d="M259.4102,-209.6885C240.0479,-212.4447 213.5438,-216.2175 191.0265,-219.4228"/>
<polygon fill="#ff9900" stroke="#ff9900" points="190.4081,-215.9755 181.0012,-220.8499 191.3947,-222.9056 190.4081,-215.9755"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node13"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="802,-185.8323 748,-185.8323 748,-161.8323 802,-161.8323 802,-185.8323"/>
<text text-anchor="middle" x="775" y="-171.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M747.7472,-173.8323C739.791,-173.8323 730.9269,-173.8323 722.361,-173.8323"/>
<polygon fill="#cbff00" stroke="#cbff00" points="722.1413,-170.3324 712.1413,-173.8323 722.1413,-177.3324 722.1413,-170.3324"/>
</g>
<!-- sourcefile~write_output.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_node14" class="node">
<title>sourcefile~write_output.f90</title>
<g id="a_sourcefile~~gradients.f90~~AfferentGraph_node14"><a xlink:href=".././sourcefile/write_output.f90.html" xlink:title="write_output.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="481,-360.8323 392,-360.8323 392,-336.8323 481,-336.8323 481,-360.8323"/>
<text text-anchor="middle" x="436.5" y="-346.4323" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_output.f90</text>
</a>
</g>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec_node.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec_node.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M415.8273,-360.994C399.8626,-370.0441 377.0194,-382.2618 356,-390.8323 351.1635,-392.8043 346.0718,-394.6882 340.9342,-396.4607"/>
<polygon fill="#ff0000" stroke="#ff0000" points="339.4496,-393.265 331.0529,-399.7261 341.6461,-399.9115 339.4496,-393.265"/>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_tec.f90</title>
<path fill="none" stroke="#33ff00" stroke-dasharray="5,2" d="M391.9012,-355.0761C379.0451,-356.876 364.7545,-358.8766 350.9504,-360.8092"/>
<polygon fill="#33ff00" stroke="#33ff00" points="350.4304,-357.3478 341.0123,-362.2006 351.401,-364.2802 350.4304,-357.3478"/>
</g>
<!-- sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_vtk.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge29" class="edge">
<title>sourcefile~write_output.f90&#45;&gt;sourcefile~write_output_vtk.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M391.9012,-342.5884C379.0451,-340.7886 364.7545,-338.7879 350.9504,-336.8553"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="351.401,-333.3844 341.0123,-335.464 350.4304,-340.3168 351.401,-333.3844"/>
</g>
<!-- sourcefile~dump_solution.f90&#45;&gt;sourcefile~write_output.f90 -->
<g id="sourcefile~~gradients.f90~~AfferentGraph_edge33" class="edge">
<title>sourcefile~dump_solution.f90&#45;&gt;sourcefile~write_output.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M546.8954,-282.8488C525.1179,-295.8652 490.1809,-316.7472 465.4491,-331.5293"/>
<polygon fill="#0000ff" stroke="#0000ff" points="463.6304,-328.5388 456.8425,-336.6736 467.2218,-334.5473 463.6304,-328.5388"/>
</g>
</g>
</svg>
</div><script>var pansourcefilegradientsf90AfferentGraph = svgPanZoom('#sourcefilegradientsf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/gradients.html">gradients</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/gradients.f90.html#src">gradients.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; Allocate memory to laminar gradients if flow is viscous and</span>
<a name="ln-2"></a>  <span class="c">!&lt; allocate memory to tubulence gradients base upon the model being used</span>
<a name="ln-3"></a><span class="k">module </span><span class="n">gradients</span>
<a name="ln-4"></a>  <span class="c">!&lt; Allocate memory to laminar gradients if flow is viscous and</span>
<a name="ln-5"></a>  <span class="c">!&lt; allocate memory to tubulence gradients base upon the model being used</span>
<a name="ln-6"></a>  <span class="c">!------------------------------------------------------------------</span>
<a name="ln-7"></a>  <span class="c">! 170509  Jatinder Pal Singh Sandhu</span>
<a name="ln-8"></a>  <span class="c">!         - first build</span>
<a name="ln-9"></a>  <span class="c">!-------------------------------------------------------------------</span>
<a name="ln-10"></a><span class="cp">#include &quot;error.h&quot;</span>
<a name="ln-11"></a><span class="cp">#include &quot;debug.h&quot;</span>
<a name="ln-12"></a>  <span class="k">use </span><span class="n">vartypes</span>
<a name="ln-13"></a>  <span class="k">use </span><span class="n">utils</span><span class="p">,</span>        <span class="n">only</span> <span class="p">:</span> <span class="n">alloc</span>
<a name="ln-14"></a>
<a name="ln-15"></a>
<a name="ln-16"></a>  <span class="k">implicit none</span>
<a name="ln-17"></a>  <span class="c">!private</span>
<a name="ln-18"></a>  <span class="c">! gradients</span>
<a name="ln-19"></a>  <span class="kt">integer</span>                                           <span class="kd">::</span> <span class="n">n_grad</span><span class="o">=</span><span class="mi">4</span> 
<a name="ln-20"></a>  <span class="c">!&lt; Number of variable to store gradient for</span>
<a name="ln-21"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span>  <span class="kd">::</span> <span class="n">gradqp_x</span> 
<a name="ln-22"></a>  <span class="c">!&lt; Store gradient of n_grad variables with respect to direction x</span>
<a name="ln-23"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span>  <span class="kd">::</span> <span class="n">gradqp_y</span> 
<a name="ln-24"></a>  <span class="c">!&lt; Store gradient of n_grad variables with respect to direction y</span>
<a name="ln-25"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">target</span>  <span class="kd">::</span> <span class="n">gradqp_z</span> 
<a name="ln-26"></a>  <span class="c">!&lt; Store gradient of n_grad variables with respect to direction z</span>
<a name="ln-27"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradu_x</span>  
<a name="ln-28"></a>  <span class="c">!&lt; Gradient of variable U with respect to direction x</span>
<a name="ln-29"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradu_y</span>  
<a name="ln-30"></a>  <span class="c">!&lt; Gradient of variable U with respect to direction y</span>
<a name="ln-31"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradu_z</span>  
<a name="ln-32"></a>  <span class="c">!&lt; Gradient of variable U with respect to direction z</span>
<a name="ln-33"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradv_x</span>  
<a name="ln-34"></a>  <span class="c">!&lt; Gradient of variable V with respect to direction x</span>
<a name="ln-35"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradv_y</span>  
<a name="ln-36"></a>  <span class="c">!&lt; Gradient of variable V with respect to direction y</span>
<a name="ln-37"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradv_z</span>  
<a name="ln-38"></a>  <span class="c">!&lt; Gradient of variable V with respect to direction z</span>
<a name="ln-39"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradw_x</span>  
<a name="ln-40"></a>  <span class="c">!&lt; Gradient of variable W with respect to direction x</span>
<a name="ln-41"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradw_y</span>  
<a name="ln-42"></a>  <span class="c">!&lt; Gradient of variable W with respect to direction y</span>
<a name="ln-43"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradw_z</span>  
<a name="ln-44"></a>  <span class="c">!&lt; Gradient of variable W with respect to direction z</span>
<a name="ln-45"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradT_x</span>  
<a name="ln-46"></a>  <span class="c">!&lt; Gradient of variable Temperature with respect to direction x</span>
<a name="ln-47"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradT_y</span>  
<a name="ln-48"></a>  <span class="c">!&lt; Gradient of variable Temperature with respect to direction y</span>
<a name="ln-49"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradT_z</span>  
<a name="ln-50"></a>  <span class="c">!&lt; Gradient of variable Temperature with respect to direction z</span>
<a name="ln-51"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtk_x</span> 
<a name="ln-52"></a>  <span class="c">!&lt; Gradient of variable turbulent kinetic energy with respect to direction x</span>
<a name="ln-53"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtk_y</span> 
<a name="ln-54"></a>  <span class="c">!&lt; Gradient of variable turbulent kinetic energy with respect to direction y</span>
<a name="ln-55"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtk_z</span> 
<a name="ln-56"></a>  <span class="c">!&lt; Gradient of variable turbulent kinetic energy with respect to direction z</span>
<a name="ln-57"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtw_x</span> 
<a name="ln-58"></a>  <span class="c">!&lt; Gradient of variable dissipation rate with respect to direction x</span>
<a name="ln-59"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtw_y</span> 
<a name="ln-60"></a>  <span class="c">!&lt; Gradient of variable dissipation rate with respect to direction y</span>
<a name="ln-61"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtw_z</span> 
<a name="ln-62"></a>  <span class="c">!&lt; Gradient of variable dissipation rate with respect to direction z</span>
<a name="ln-63"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtkl_x</span>
<a name="ln-64"></a>  <span class="c">!&lt; Gradient of variable kL with respect to direction x</span>
<a name="ln-65"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtkl_y</span>
<a name="ln-66"></a>  <span class="c">!&lt; Gradient of variable kL with respect to direction y</span>
<a name="ln-67"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtkl_z</span>
<a name="ln-68"></a>  <span class="c">!&lt; Gradient of variable kL with respect to direction z</span>
<a name="ln-69"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradte_x</span> 
<a name="ln-70"></a>  <span class="c">!&lt; Gradient of variable turbulent energy dissiaption with respect to direction x</span>
<a name="ln-71"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradte_y</span> 
<a name="ln-72"></a>  <span class="c">!&lt; Gradient of variable turbulent energy dissiaption with respect to direction y</span>
<a name="ln-73"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradte_z</span> 
<a name="ln-74"></a>  <span class="c">!&lt; Gradient of variable turbulent energy dissiaption with respect to direction z</span>
<a name="ln-75"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtv_x</span> 
<a name="ln-76"></a>  <span class="c">!&lt; Gradient of variable turbulenct visocity(SA mode) with respect to direction x</span>
<a name="ln-77"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtv_y</span> 
<a name="ln-78"></a>  <span class="c">!&lt; Gradient of variable turbulenct visocity(SA mode) with respect to direction y</span>
<a name="ln-79"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtv_z</span> 
<a name="ln-80"></a>  <span class="c">!&lt; Gradient of variable turbulenct visocity(SA mode) with respect to direction z</span>
<a name="ln-81"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtgm_x</span>
<a name="ln-82"></a>  <span class="c">!&lt; Gradient of variable intermittency with respect to direction x</span>
<a name="ln-83"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtgm_y</span>
<a name="ln-84"></a>  <span class="c">!&lt; Gradient of variable intermittency with respect to direction y</span>
<a name="ln-85"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span>                 <span class="k">pointer</span> <span class="kd">::</span> <span class="n">gradtgm_z</span>
<a name="ln-86"></a>  <span class="c">!&lt; Gradient of variable intermittency with respect to direction z</span>
<a name="ln-87"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">R_gas</span>
<a name="ln-88"></a>
<a name="ln-89"></a>  <span class="kt">integer</span> <span class="kd">::</span> <span class="n">imx</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">kmx</span><span class="p">,</span> <span class="n">n_var</span>
<a name="ln-90"></a>
<a name="ln-91"></a>  <span class="k">type</span> <span class="kd">::</span> <span class="n">singlesub</span>
<a name="ln-92"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="n">iu</span>
<a name="ln-93"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">jmin</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">jl</span><span class="p">,</span> <span class="n">ju</span>
<a name="ln-94"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">kl</span><span class="p">,</span> <span class="n">ku</span>
<a name="ln-95"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">sig</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-96"></a>  <span class="k">end type </span><span class="n">singlesub</span>
<a name="ln-97"></a>
<a name="ln-98"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">setup_gradients</span>
<a name="ln-99"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">evaluate_all_gradients</span>
<a name="ln-100"></a>  <span class="c">!public :: destroy_gradients</span>
<a name="ln-101"></a>
<a name="ln-102"></a>  <span class="k">contains</span>
<a name="ln-103"></a>
<a name="ln-104"></a>
<a name="ln-105"></a><span class="k">    subroutine </span><span class="n">setup_gradients</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-106"></a>      <span class="c">!&lt; Memoery allocation to the gradient variables and </span>
<a name="ln-107"></a>      <span class="c">!&lt; setup pointer to the slice to the main gradient variable</span>
<a name="ln-108"></a>      <span class="c">!&lt; based on the various models being used.</span>
<a name="ln-109"></a>
<a name="ln-110"></a>      <span class="k">implicit none</span>
<a name="ln-111"></a><span class="k">      type</span><span class="p">(</span><span class="n">controltype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">control</span>
<a name="ln-112"></a>      <span class="c">!&lt; Control parameters</span>
<a name="ln-113"></a>      <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">)</span> <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-114"></a>      <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-115"></a>      <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">)</span>   <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-116"></a>      <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-117"></a>      <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-118"></a>      <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-119"></a>
<a name="ln-120"></a>      <span class="n">DebugCall</span><span class="p">(</span><span class="s2">&quot;setup_gradients&quot;</span><span class="p">)</span>
<a name="ln-121"></a>
<a name="ln-122"></a>        <span class="n">imx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-123"></a>        <span class="n">jmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-124"></a>        <span class="n">kmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-125"></a>
<a name="ln-126"></a>        <span class="n">n_var</span> <span class="o">=</span> <span class="n">control</span><span class="p">%</span><span class="n">n_var</span>
<a name="ln-127"></a>        <span class="n">R_gas</span> <span class="o">=</span> <span class="n">flow</span><span class="p">%</span><span class="n">R_gas</span>
<a name="ln-128"></a>
<a name="ln-129"></a>      <span class="k">if</span><span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">mu_ref</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-130"></a>
<a name="ln-131"></a><span class="k">        call </span><span class="n">get_n_grad</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span>
<a name="ln-132"></a>        <span class="c">!call allocate_memory()</span>
<a name="ln-133"></a>        <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">gradqp_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_grad</span><span class="p">,</span> <span class="n">AErrMsg</span><span class="p">(</span><span class="s2">&quot;gradqp_x&quot;</span><span class="p">))</span>
<a name="ln-134"></a>        <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">gradqp_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_grad</span><span class="p">,</span> <span class="n">AErrMsg</span><span class="p">(</span><span class="s2">&quot;gradqp_y&quot;</span><span class="p">))</span>
<a name="ln-135"></a>        <span class="k">call </span><span class="n">alloc</span><span class="p">(</span><span class="n">gradqp_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kmx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_grad</span><span class="p">,</span> <span class="n">AErrMsg</span><span class="p">(</span><span class="s2">&quot;gradqp_z&quot;</span><span class="p">))</span>
<a name="ln-136"></a>
<a name="ln-137"></a>        <span class="c">! Linking pointer to laminar gradients</span>
<a name="ln-138"></a>        <span class="c">!call setup_laminar_grad()</span>
<a name="ln-139"></a>        <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;setup_laminar_grad&#39;</span><span class="p">)</span>
<a name="ln-140"></a>        <span class="c">!&lt; Setup Pointer to the main array which stores gradient </span>
<a name="ln-141"></a>        <span class="c">!&lt; all variables with x, y, z</span>
<a name="ln-142"></a>
<a name="ln-143"></a>        <span class="n">gradu_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-144"></a>        <span class="n">gradv_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-145"></a>        <span class="n">gradw_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-146"></a>        <span class="n">gradT_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-147"></a>
<a name="ln-148"></a>        <span class="n">gradu_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-149"></a>        <span class="n">gradv_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-150"></a>        <span class="n">gradw_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-151"></a>        <span class="n">gradT_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-152"></a>
<a name="ln-153"></a>        <span class="n">gradu_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-154"></a>        <span class="n">gradv_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-155"></a>        <span class="n">gradw_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-156"></a>        <span class="n">gradT_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-157"></a>
<a name="ln-158"></a>        <span class="c">! Linking pointer to turbulent gradients</span>
<a name="ln-159"></a>        <span class="k">select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-160"></a>          
<a name="ln-161"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-162"></a>            <span class="c">!do nothing</span>
<a name="ln-163"></a>            <span class="k">continue</span>
<a name="ln-164"></a>
<a name="ln-165"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-166"></a>            <span class="c">!call setup_sa_grad()</span>
<a name="ln-167"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s2">&quot;setup_sa_grad&quot;</span><span class="p">)</span>
<a name="ln-168"></a>            <span class="n">gradtv_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-169"></a>            <span class="n">gradtv_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-170"></a>            <span class="n">gradtv_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-171"></a>
<a name="ln-172"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-173"></a>            <span class="c">!&lt; Setup Pointer to the main array which stores gradient </span>
<a name="ln-174"></a>            <span class="c">!&lt; all variables with x, y, z</span>
<a name="ln-175"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;setup_sst_grad&#39;</span><span class="p">)</span>
<a name="ln-176"></a>
<a name="ln-177"></a>            <span class="n">gradtk_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-178"></a>            <span class="n">gradtw_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-179"></a>
<a name="ln-180"></a>            <span class="n">gradtk_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-181"></a>            <span class="n">gradtw_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-182"></a>
<a name="ln-183"></a>            <span class="n">gradtk_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-184"></a>            <span class="n">gradtw_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-185"></a>
<a name="ln-186"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-187"></a>            <span class="c">!call setup_kkl_grad()</span>
<a name="ln-188"></a>            <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;setup_kkl_grad&#39;</span><span class="p">)</span>
<a name="ln-189"></a>
<a name="ln-190"></a>            <span class="n">gradtk_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-191"></a>            <span class="n">gradtkl_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-192"></a>
<a name="ln-193"></a>            <span class="n">gradtk_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-194"></a>            <span class="n">gradtkl_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-195"></a>
<a name="ln-196"></a>            <span class="n">gradtk_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-197"></a>            <span class="n">gradtkl_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-198"></a>
<a name="ln-199"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-200"></a>            <span class="n">Fatal_error</span>
<a name="ln-201"></a>
<a name="ln-202"></a>        <span class="k">end select</span>
<a name="ln-203"></a>
<a name="ln-204"></a>        <span class="c">!Transition modeling</span>
<a name="ln-205"></a>        <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-206"></a>
<a name="ln-207"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-208"></a>            <span class="c">!call setup_lctm2015_grad()</span>
<a name="ln-209"></a>            <span class="n">gradtgm_x</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_x</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">n_grad</span><span class="p">)</span>
<a name="ln-210"></a>            <span class="n">gradtgm_y</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_y</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">n_grad</span><span class="p">)</span>
<a name="ln-211"></a>            <span class="n">gradtgm_z</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">imx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">jmx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">gradqp_z</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">n_grad</span><span class="p">)</span>
<a name="ln-212"></a>
<a name="ln-213"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;bc&#39;</span><span class="p">)</span>
<a name="ln-214"></a>            <span class="c">!do nothing</span>
<a name="ln-215"></a>            <span class="k">continue</span>
<a name="ln-216"></a>
<a name="ln-217"></a><span class="k">          case </span><span class="n">DEFAULT</span>
<a name="ln-218"></a>            <span class="n">Fatal_error</span>
<a name="ln-219"></a>
<a name="ln-220"></a>        <span class="k">end Select</span>
<a name="ln-221"></a>
<a name="ln-222"></a><span class="k">      end if</span>
<a name="ln-223"></a><span class="k">    end subroutine </span><span class="n">setup_gradients</span>
<a name="ln-224"></a>
<a name="ln-225"></a>
<a name="ln-226"></a>
<a name="ln-227"></a>    <span class="k">subroutine </span><span class="n">get_n_grad</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span>
<a name="ln-228"></a>      <span class="c">!&lt; Set number of variables for which</span>
<a name="ln-229"></a>      <span class="c">!&lt; gradient is required based on the</span>
<a name="ln-230"></a>      <span class="c">!&lt; being used</span>
<a name="ln-231"></a>
<a name="ln-232"></a>      <span class="k">implicit none</span>
<a name="ln-233"></a><span class="k">      type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">)</span> <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-234"></a>      <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-235"></a>
<a name="ln-236"></a>      <span class="n">DebugCall</span><span class="p">(</span><span class="s2">&quot;get_n_grad&quot;</span><span class="p">)</span>
<a name="ln-237"></a>
<a name="ln-238"></a>      <span class="k">select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-239"></a>        
<a name="ln-240"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-241"></a>          <span class="c">!do nothing</span>
<a name="ln-242"></a>          <span class="k">continue</span>
<a name="ln-243"></a>
<a name="ln-244"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-245"></a>          <span class="n">n_grad</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-246"></a>
<a name="ln-247"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-248"></a>          <span class="n">n_grad</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-249"></a>
<a name="ln-250"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-251"></a>          <span class="n">n_grad</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-252"></a>
<a name="ln-253"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-254"></a>          <span class="n">Fatal_error</span>
<a name="ln-255"></a>
<a name="ln-256"></a>      <span class="k">end select</span>
<a name="ln-257"></a>
<a name="ln-258"></a>
<a name="ln-259"></a>      <span class="c">!Transition modeling</span>
<a name="ln-260"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-261"></a>
<a name="ln-262"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-263"></a>          <span class="n">n_grad</span> <span class="o">=</span> <span class="n">n_grad</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-264"></a>
<a name="ln-265"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;bc&#39;</span><span class="p">)</span>
<a name="ln-266"></a>          <span class="n">n_grad</span> <span class="o">=</span> <span class="n">n_grad</span> <span class="o">+</span> <span class="mi">0</span>
<a name="ln-267"></a>
<a name="ln-268"></a>        <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-269"></a>          <span class="n">Fatal_error</span>
<a name="ln-270"></a>
<a name="ln-271"></a>      <span class="k">end Select</span>
<a name="ln-272"></a>
<a name="ln-273"></a><span class="k">    end subroutine </span><span class="n">get_n_grad</span>
<a name="ln-274"></a>
<a name="ln-275"></a>
<a name="ln-276"></a>    <span class="k">subroutine </span><span class="n">evaluate_all_gradients</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-277"></a>      <span class="c">!&lt; Call to all the required gradients and </span>
<a name="ln-278"></a>      <span class="c">!&lt; apply boundary condition for ghost cell</span>
<a name="ln-279"></a>      <span class="c">!&lt; gradients</span>
<a name="ln-280"></a>
<a name="ln-281"></a>      <span class="k">implicit none</span>
<a name="ln-282"></a><span class="k">      type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-283"></a>      <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-284"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">Target</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-285"></a>      <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-286"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Temp</span>
<a name="ln-287"></a>      <span class="c">!&lt; Store Temperature variable at cell center</span>
<a name="ln-288"></a>      <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">)</span> <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-289"></a>      <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-290"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-291"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-292"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-293"></a>      <span class="c">!&lt; Input varaible which stores I faces&#39; area and unit normal</span>
<a name="ln-294"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-295"></a>      <span class="c">!&lt; Input varaible which stores J faces&#39; area and unit normal</span>
<a name="ln-296"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-297"></a>      <span class="c">!&lt; Input varaible which stores K faces&#39; area and unit normal</span>
<a name="ln-298"></a>      <span class="k">type</span><span class="p">(</span><span class="n">boundarytype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>
<a name="ln-299"></a>      <span class="c">!&lt; boundary conditions and fixed values</span>
<a name="ln-300"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">x_speed</span>      
<a name="ln-301"></a>       <span class="c">!&lt; U pointer, point to slice of qp (:,:,:,2) </span>
<a name="ln-302"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">y_speed</span>      
<a name="ln-303"></a>       <span class="c">!&lt; V pointer, point to slice of qp (:,:,:,3) </span>
<a name="ln-304"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">z_speed</span>      
<a name="ln-305"></a>       <span class="c">!&lt; W pointer, point to slice of qp (:,:,:,4)</span>
<a name="ln-306"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">tk</span>   <span class="c">!&lt; TKE/mass</span>
<a name="ln-307"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">tw</span>   <span class="c">!&lt; Omega</span>
<a name="ln-308"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">tv</span>   <span class="c">!&lt; SA visocity</span>
<a name="ln-309"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">tkl</span>  <span class="c">!&lt; KL K-KL method</span>
<a name="ln-310"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">tgm</span>  <span class="c">!&lt; Intermittency of LCTM2015</span>
<a name="ln-311"></a>
<a name="ln-312"></a>      <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;evaluate_all_gradients&#39;</span><span class="p">)</span>
<a name="ln-313"></a>
<a name="ln-314"></a>      <span class="n">x_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-315"></a>      <span class="n">y_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-316"></a>      <span class="n">z_speed</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">4</span><span class="p">)</span>
<a name="ln-317"></a>
<a name="ln-318"></a>      <span class="c">!call compute_gradient_G(gradu_x, qp(:,:,:,2), cells, Ifaces, Jfaces, Kfaces, dims, &#39;x&#39;)</span>
<a name="ln-319"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradu_x</span><span class="p">,</span> <span class="n">x_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-320"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradv_x</span><span class="p">,</span> <span class="n">y_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-321"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradw_x</span><span class="p">,</span> <span class="n">z_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-322"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradT_x</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span>    <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-323"></a>      <span class="c">!call compute_gradient_G(gradu_y, qp(:,:,:,2), cells, Ifaces, Jfaces, Kfaces, dims, &#39;y&#39;)</span>
<a name="ln-324"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradu_y</span><span class="p">,</span> <span class="n">x_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-325"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradv_y</span><span class="p">,</span> <span class="n">y_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-326"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradw_y</span><span class="p">,</span> <span class="n">z_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-327"></a>      <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradT_y</span><span class="p">,</span> <span class="n">Temp</span>   <span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-328"></a>      <span class="k">if</span><span class="p">(</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-329"></a><span class="k">        call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradu_z</span><span class="p">,</span> <span class="n">x_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-330"></a>        <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradv_z</span><span class="p">,</span> <span class="n">y_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-331"></a>        <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradw_z</span><span class="p">,</span> <span class="n">z_speed</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-332"></a>        <span class="c">!call compute_gradient_T(gradT_z         , cells, Ifaces, Jfaces, Kfaces, dims, &#39;z&#39;)</span>
<a name="ln-333"></a>        <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradT_z</span><span class="p">,</span> <span class="n">Temp</span>   <span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-334"></a>      <span class="k">else</span>
<a name="ln-335"></a><span class="k">       </span><span class="n">gradqp_z</span><span class="o">=</span><span class="mf">0.0</span>
<a name="ln-336"></a>      <span class="k">end if</span>
<a name="ln-337"></a>
<a name="ln-338"></a><span class="k">      select case</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-339"></a>
<a name="ln-340"></a>        <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-341"></a>          <span class="c">!do nothing</span>
<a name="ln-342"></a>          <span class="k">continue</span>
<a name="ln-343"></a>
<a name="ln-344"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-345"></a>          <span class="n">tv</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-346"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtv_x</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-347"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtv_y</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-348"></a>          <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-349"></a><span class="k">          call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtv_z</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-350"></a>          <span class="k">end if</span>
<a name="ln-351"></a>
<a name="ln-352"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-353"></a>          <span class="n">tk</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-354"></a>          <span class="n">tw</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">7</span><span class="p">)</span>
<a name="ln-355"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtk_x</span><span class="p">,</span> <span class="n">tk</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-356"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtw_x</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-357"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtk_y</span><span class="p">,</span> <span class="n">tk</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-358"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtw_y</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-359"></a>          <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-360"></a><span class="k">          call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtk_z</span><span class="p">,</span> <span class="n">tk</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-361"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtw_z</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-362"></a>          <span class="k">end if</span>
<a name="ln-363"></a>
<a name="ln-364"></a><span class="k">        case</span> <span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-365"></a>          <span class="n">tk</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-366"></a>          <span class="n">tkl</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">7</span><span class="p">)</span>
<a name="ln-367"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtk_x</span> <span class="p">,</span> <span class="n">tk</span> <span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-368"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtkl_x</span><span class="p">,</span> <span class="n">tkl</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-369"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtk_y</span> <span class="p">,</span> <span class="n">tk</span> <span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-370"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtkl_y</span><span class="p">,</span> <span class="n">tkl</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-371"></a>          <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-372"></a><span class="k">          call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtk_z</span> <span class="p">,</span> <span class="n">tk</span> <span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-373"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtkl_z</span><span class="p">,</span> <span class="n">tkl</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-374"></a>          <span class="k">end if</span>
<a name="ln-375"></a>
<a name="ln-376"></a><span class="k">        case </span><span class="n">DEFAULT</span>
<a name="ln-377"></a>          <span class="n">Fatal_error</span>
<a name="ln-378"></a>
<a name="ln-379"></a>      <span class="k">end select</span>
<a name="ln-380"></a>
<a name="ln-381"></a>
<a name="ln-382"></a><span class="k">      select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-383"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-384"></a>          <span class="n">tgm</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">qp</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">8</span><span class="p">)</span>
<a name="ln-385"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtgm_x</span><span class="p">,</span> <span class="n">tgm</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-386"></a>          <span class="k">call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtgm_y</span><span class="p">,</span> <span class="n">tgm</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-387"></a>          <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-388"></a><span class="k">          call </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">gradtgm_z</span><span class="p">,</span> <span class="n">tgm</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-389"></a>          <span class="k">end if</span>
<a name="ln-390"></a>
<a name="ln-391"></a><span class="k">        case</span><span class="p">(</span><span class="s1">&#39;bc&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-392"></a>          <span class="c">!do nothing</span>
<a name="ln-393"></a>          <span class="k">continue</span>
<a name="ln-394"></a>
<a name="ln-395"></a><span class="k">        case </span><span class="n">DEFAULT</span>
<a name="ln-396"></a>          <span class="n">Fatal_error</span>
<a name="ln-397"></a>
<a name="ln-398"></a>      <span class="k">end Select</span>
<a name="ln-399"></a>
<a name="ln-400"></a><span class="k">      call </span><span class="n">apply_gradient_bc</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-401"></a>
<a name="ln-402"></a>    <span class="k">end subroutine </span><span class="n">evaluate_all_gradients</span>
<a name="ln-403"></a>
<a name="ln-404"></a>
<a name="ln-405"></a>    <span class="k">subroutine </span><span class="n">compute_gradient_G</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span>
<a name="ln-406"></a>      <span class="c">!&lt;  Compute gradient of any input scalar</span>
<a name="ln-407"></a>      <span class="k">implicit none</span>
<a name="ln-408"></a><span class="k">      type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-409"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span> <span class="mi">0</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span>  <span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>  <span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>  <span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">grad</span>
<a name="ln-410"></a>      <span class="c">!&lt; Output variable storing the graident of var</span>
<a name="ln-411"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-412"></a>      <span class="c">!&lt; Input variable of which graident is required</span>
<a name="ln-413"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>                           <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dir</span>
<a name="ln-414"></a>      <span class="c">!&lt; Direction with respect to which gradients are calculated</span>
<a name="ln-415"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-416"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-417"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-418"></a>      <span class="c">!&lt; Input varaible which stores I faces&#39; area and unit normal</span>
<a name="ln-419"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-420"></a>      <span class="c">!&lt; Input varaible which stores J faces&#39; area and unit normal</span>
<a name="ln-421"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-422"></a>      <span class="c">!&lt; Input varaible which stores K faces&#39; area and unit normal</span>
<a name="ln-423"></a>
<a name="ln-424"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-425"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">j</span>
<a name="ln-426"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">k</span>
<a name="ln-427"></a>
<a name="ln-428"></a>      <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;compute_gradient_G&#39;</span><span class="p">)</span>
<a name="ln-429"></a>      <span class="n">grad</span><span class="p">(:,:,:)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-430"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span>
<a name="ln-431"></a>        <span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<a name="ln-432"></a>          <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-433"></a>            <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-434"></a>              <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-435"></a>                <span class="n">grad</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-436"></a>                              <span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-437"></a>                              <span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-438"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">nx</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-439"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">nx</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-440"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nx</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-441"></a>                             <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-442"></a>              <span class="k">end do</span>
<a name="ln-443"></a><span class="k">            end do</span>
<a name="ln-444"></a><span class="k">          end do</span>
<a name="ln-445"></a><span class="k">        case</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a name="ln-446"></a>          <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-447"></a>            <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-448"></a>              <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-449"></a>                <span class="n">grad</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-450"></a>                              <span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-451"></a>                              <span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-452"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">ny</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-453"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">ny</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-454"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">ny</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-455"></a>                             <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-456"></a>              <span class="k">end do</span>
<a name="ln-457"></a><span class="k">            end do</span>
<a name="ln-458"></a><span class="k">          end do</span>
<a name="ln-459"></a><span class="k">        case</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<a name="ln-460"></a>          <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-461"></a>            <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-462"></a>              <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-463"></a>                <span class="n">grad</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-464"></a>                              <span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-465"></a>                              <span class="o">-</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-466"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">nz</span><span class="o">*</span><span class="n">Ifaces</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-467"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">nz</span><span class="o">*</span><span class="n">Jfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span>  <span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-468"></a>                              <span class="o">+</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">var</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">nz</span><span class="o">*</span><span class="n">Kfaces</span><span class="p">(</span><span class="n">i</span>  <span class="p">,</span><span class="n">j</span>  <span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)%</span><span class="n">A</span> <span class="p">&amp;</span>
<a name="ln-469"></a>                             <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">volume</span><span class="p">)</span>
<a name="ln-470"></a>              <span class="k">end do</span>
<a name="ln-471"></a><span class="k">            end do</span>
<a name="ln-472"></a><span class="k">          end do</span>
<a name="ln-473"></a><span class="k">        case </span><span class="n">DEFAULT</span>
<a name="ln-474"></a>          <span class="k">print</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;ERROR: gradient direction error&quot;</span>
<a name="ln-475"></a>          <span class="n">Fatal_error</span>
<a name="ln-476"></a>      <span class="k">end select</span>
<a name="ln-477"></a>
<a name="ln-478"></a><span class="k">      if</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">grad</span><span class="p">)))</span><span class="k">then</span>
<a name="ln-479"></a><span class="k">        </span><span class="n">Fatal_error</span>
<a name="ln-480"></a>      <span class="k">end if</span>
<a name="ln-481"></a>
<a name="ln-482"></a><span class="k">    end subroutine </span><span class="n">compute_gradient_G</span>
<a name="ln-483"></a>
<a name="ln-484"></a>
<a name="ln-485"></a>
<a name="ln-486"></a>    <span class="k">subroutine </span><span class="n">apply_gradient_bc</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-487"></a>      <span class="c">!&lt; Call same subroutine for all the face</span>
<a name="ln-488"></a>      <span class="c">!&lt; Apply/set value of all gradient in the ghost cells</span>
<a name="ln-489"></a>      <span class="c">!&lt; gradqp_G = (qp_I - qp_G)*Area_W*unit_normal_G/(volume_G)</span>
<a name="ln-490"></a>      <span class="c">!&lt; volume_G = volume_I</span>
<a name="ln-491"></a>      <span class="c">!-----------------------------------------------------------</span>
<a name="ln-492"></a>      <span class="k">implicit none</span>
<a name="ln-493"></a><span class="k">      type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-494"></a>      <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-495"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-496"></a>      <span class="c">!&lt; Input variable of which graident is required</span>
<a name="ln-497"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Temp</span>
<a name="ln-498"></a>      <span class="c">!&lt; Intput Temperature variable</span>
<a name="ln-499"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-500"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-501"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-502"></a>      <span class="c">!&lt; Input varaible which stores I faces&#39; area and unit normal</span>
<a name="ln-503"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-504"></a>      <span class="c">!&lt; Input varaible which stores J faces&#39; area and unit normal</span>
<a name="ln-505"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-506"></a>      <span class="c">!&lt; Input varaible which stores K faces&#39; area and unit normal</span>
<a name="ln-507"></a>      <span class="k">type</span><span class="p">(</span><span class="n">boundarytype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc</span>
<a name="ln-508"></a>      <span class="k">type</span><span class="p">(</span><span class="n">singlesub</span><span class="p">)</span> <span class="kd">::</span> <span class="n">domain</span>
<a name="ln-509"></a>
<a name="ln-510"></a>      <span class="n">DebugCall</span><span class="p">(</span><span class="s1">&#39;apply_gradient_bc&#39;</span><span class="p">)</span>
<a name="ln-511"></a>
<a name="ln-512"></a>
<a name="ln-513"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-514"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imax</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-515"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-516"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-517"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-518"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-519"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">il</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-520"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-521"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">sig</span>  <span class="o">=</span> <span class="mi">1</span>
<a name="ln-522"></a>      <span class="k">call </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">imin_id</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">fixed_wall_temperature</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-523"></a>
<a name="ln-524"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imin</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-525"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-526"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-527"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-528"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-529"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-530"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">il</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-531"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-532"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">sig</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-533"></a>      <span class="k">call </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">imax_id</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">fixed_wall_temperature</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-534"></a>
<a name="ln-535"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-536"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-537"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-538"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-539"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-540"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-541"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">il</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-542"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-543"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">sig</span>  <span class="o">=</span> <span class="mi">1</span>
<a name="ln-544"></a>      <span class="k">call </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">jmin_id</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">fixed_wall_temperature</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-545"></a>
<a name="ln-546"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-547"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-548"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-549"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-550"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-551"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-552"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">il</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-553"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-554"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">sig</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-555"></a>      <span class="k">call </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">jmax_id</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">fixed_wall_temperature</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-556"></a>
<a name="ln-557"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-558"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-559"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-560"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-561"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-562"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-563"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">il</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-564"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-565"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">sig</span>  <span class="o">=</span> <span class="mi">1</span>
<a name="ln-566"></a>      <span class="k">call </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">kmin_id</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">fixed_wall_temperature</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-567"></a>
<a name="ln-568"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-569"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">imax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-570"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-571"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-572"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-573"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-574"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">il</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-575"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-576"></a>      <span class="n">domain</span><span class="p">%</span><span class="n">sig</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-577"></a>      <span class="k">call </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">kmax_id</span><span class="p">,</span> <span class="n">bc</span><span class="p">%</span><span class="n">fixed_wall_temperature</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<a name="ln-578"></a>          
<a name="ln-579"></a>    <span class="k">end subroutine </span><span class="n">apply_gradient_bc</span>
<a name="ln-580"></a>
<a name="ln-581"></a>    
<a name="ln-582"></a>
<a name="ln-583"></a>    <span class="k">subroutine </span><span class="n">apply_gradient_bc_face</span><span class="p">(</span><span class="n">qp</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">bc_id</span><span class="p">,</span> <span class="n">fixed_temp</span><span class="p">)</span>
<a name="ln-584"></a>      <span class="c">!&lt; Call same subroutine for all the face</span>
<a name="ln-585"></a>      <span class="c">!&lt; Apply/set value of all gradient in the ghost cells</span>
<a name="ln-586"></a>      <span class="c">!&lt; gradqp_G = (qp_I - qp_G)*Area_W*unit_normal_G/(volume_G)</span>
<a name="ln-587"></a>      <span class="c">!&lt; volume_G = volume_I</span>
<a name="ln-588"></a>      <span class="c">!-----------------------------------------------------------</span>
<a name="ln-589"></a>      <span class="k">implicit none</span>
<a name="ln-590"></a><span class="k">      type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-591"></a>      <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-592"></a>      <span class="k">type</span><span class="p">(</span><span class="n">singlesub</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">domain</span>
<a name="ln-593"></a>      <span class="c">!&lt; flags for direction </span>
<a name="ln-594"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-595"></a>      <span class="c">!&lt; Input variable of which graident is required</span>
<a name="ln-596"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Temp</span>
<a name="ln-597"></a>      <span class="c">!&lt; Intput Temperature variable</span>
<a name="ln-598"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-599"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-600"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">faces</span>
<a name="ln-601"></a>      <span class="c">!&lt; Input varaible which stores any(I,J,K) faces&#39; area and unit normal</span>
<a name="ln-602"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bc_id</span>
<a name="ln-603"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fixed_temp</span>
<a name="ln-604"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n_grad</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp_I</span>
<a name="ln-605"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">n_grad</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp_G</span>
<a name="ln-606"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">T_I</span>
<a name="ln-607"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">T_G</span> 
<a name="ln-608"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">c_x</span>
<a name="ln-609"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">c_y</span>
<a name="ln-610"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">c_z</span>
<a name="ln-611"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span>
<a name="ln-612"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-613"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-614"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-615"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dot</span>
<a name="ln-616"></a>      <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">il</span><span class="p">,</span> <span class="n">jl</span><span class="p">,</span> <span class="n">kl</span>
<a name="ln-617"></a>      <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">iu</span><span class="p">,</span> <span class="n">ju</span><span class="p">,</span> <span class="n">ku</span>
<a name="ln-618"></a>
<a name="ln-619"></a>      <span class="n">il</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">il</span>
<a name="ln-620"></a>      <span class="n">jl</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">jl</span>
<a name="ln-621"></a>      <span class="n">kl</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">kl</span>
<a name="ln-622"></a>      <span class="n">iu</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">iu</span>
<a name="ln-623"></a>      <span class="n">ju</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">ju</span>
<a name="ln-624"></a>      <span class="n">ku</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">ku</span>
<a name="ln-625"></a>
<a name="ln-626"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">kmin</span><span class="p">,</span> <span class="n">domain</span><span class="p">%</span><span class="n">kmax</span>
<a name="ln-627"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">jmin</span><span class="p">,</span> <span class="n">domain</span><span class="p">%</span><span class="n">jmax</span>
<a name="ln-628"></a>          <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">imin</span><span class="p">,</span> <span class="n">domain</span><span class="p">%</span><span class="n">imax</span>
<a name="ln-629"></a>            <span class="n">nx</span>   <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-630"></a>            <span class="n">ny</span>   <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-631"></a>            <span class="n">nz</span>   <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-632"></a>            <span class="n">c_x</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">nx</span><span class="o">/</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">)%</span><span class="n">volume</span>
<a name="ln-633"></a>            <span class="n">c_y</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">ny</span><span class="o">/</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">)%</span><span class="n">volume</span>
<a name="ln-634"></a>            <span class="n">c_z</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span><span class="o">*</span><span class="n">nz</span><span class="o">/</span><span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">)%</span><span class="n">volume</span>
<a name="ln-635"></a>            <span class="n">T_I</span>  <span class="o">=</span> <span class="n">Temp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">)</span>
<a name="ln-636"></a>            <span class="n">T_G</span>  <span class="o">=</span> <span class="n">Temp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">)</span>
<a name="ln-637"></a>            <span class="n">qp_I</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">)</span>
<a name="ln-638"></a>            <span class="n">qp_G</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">)</span>
<a name="ln-639"></a>
<a name="ln-640"></a>            <span class="c">! normal component of gradient</span>
<a name="ln-641"></a>            <span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span><span class="n">qp_I</span> <span class="o">-</span> <span class="n">qp_G</span><span class="p">)</span><span class="o">*</span><span class="n">c_x</span> 
<a name="ln-642"></a>            <span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span><span class="n">qp_I</span> <span class="o">-</span> <span class="n">qp_G</span><span class="p">)</span><span class="o">*</span><span class="n">c_y</span>
<a name="ln-643"></a>            <span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,:)</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span><span class="n">qp_I</span> <span class="o">-</span> <span class="n">qp_G</span><span class="p">)</span><span class="o">*</span><span class="n">c_z</span>
<a name="ln-644"></a>            <span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span> <span class="n">T_I</span> <span class="o">-</span>  <span class="n">T_G</span><span class="p">)</span><span class="o">*</span><span class="n">c_x</span>
<a name="ln-645"></a>            <span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span> <span class="n">T_I</span> <span class="o">-</span>  <span class="n">T_G</span><span class="p">)</span><span class="o">*</span><span class="n">c_y</span>
<a name="ln-646"></a>            <span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">domain</span><span class="p">%</span><span class="n">sig</span><span class="o">*</span><span class="p">(</span> <span class="n">T_I</span> <span class="o">-</span>  <span class="n">T_G</span><span class="p">)</span><span class="o">*</span><span class="n">c_z</span>
<a name="ln-647"></a>            <span class="k">if</span><span class="p">(</span><span class="n">bc_id</span><span class="o">==-</span><span class="mi">5</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">fixed_temp</span><span class="o">&lt;</span><span class="mf">1.</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">fixed_temp</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">))</span><span class="k">then</span>
<a name="ln-648"></a><span class="k">              </span><span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-649"></a>              <span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-650"></a>              <span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-651"></a>
<a name="ln-652"></a>            <span class="k">end if</span>
<a name="ln-653"></a>            <span class="c">!parallel component of gradient</span>
<a name="ln-654"></a>            <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n_grad</span>
<a name="ln-655"></a>              <span class="n">dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span>
<a name="ln-656"></a>              <span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">gradqp_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="n">dot</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span>
<a name="ln-657"></a>              <span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">gradqp_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="n">dot</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>
<a name="ln-658"></a>              <span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">il</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">jl</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">kl</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">gradqp_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">iu</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">ju</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">ku</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="n">dot</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span>
<a name="ln-659"></a>            <span class="k">end do</span>
<a name="ln-660"></a><span class="k">          end do</span>
<a name="ln-661"></a><span class="k">        end do</span>
<a name="ln-662"></a><span class="k">      end do</span>
<a name="ln-663"></a>
<a name="ln-664"></a><span class="k">    end subroutine </span><span class="n">apply_gradient_bc_face</span>
<a name="ln-665"></a><span class="k">end module </span><span class="n">gradients</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-02-10T20:32:54.471560 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>