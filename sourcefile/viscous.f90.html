<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="">
    
    <meta name="author" content="FEST-3D Team" >
    <link rel="icon" href="../favicon.png">

    <title>viscous.f90 &ndash; FEST-3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140495700-1"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
   
     gtag('config', 'UA-140495700-1');
   </script>


  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">FEST-3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Documentation</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>viscous.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 3.3% of total for source files.">510 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/viscous.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">viscous.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/viscous.html">viscous</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/viscous.f90.html#src">viscous.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <p>The viscous module contains the viscous fluxes calculations </p>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~viscous.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileviscousf90EfferentGraph" width="402pt" height="385pt"
 viewBox="0.00 0.00 402.00 385.38" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~viscous.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 381.3802)">
<title>sourcefile~~viscous.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-381.3802 398,-381.3802 398,4 -4,4"/>
<!-- sourcefile~viscous.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~viscous.f90</title>
<polygon fill="none" stroke="#000000" points="394,-191.406 328,-191.406 328,-167.406 394,-167.406 394,-191.406"/>
<text text-anchor="middle" x="361" y="-177.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">viscous.f90</text>
</g>
<!-- sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~global_sa.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/global_sa.f90.html" xlink:title="global_sa.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="184.5,-335.406 108.5,-335.406 108.5,-311.406 184.5,-311.406 184.5,-335.406"/>
<text text-anchor="middle" x="146.5" y="-321.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sa.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~global_sa.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-363.406C242.2662,-368.8152 205.3283,-353.2737 178.1984,-340.0109"/>
<polygon fill="#ff0000" stroke="#ff0000" points="179.5743,-336.786 169.0637,-335.4528 176.4489,-343.0495 179.5743,-336.786"/>
</g>
<!-- sourcefile~vartypes.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~vartypes.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/vartypes.f90.html" xlink:title="vartypes.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-251.406 0,-251.406 0,-227.406 71,-227.406 71,-251.406"/>
<text text-anchor="middle" x="35.5" y="-237.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">vartypes.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-363.406C193.9175,-386.5653 164.3073,-379.5005 107,-344.406 75.403,-325.0562 54.4846,-285.8832 43.8368,-261.2383"/>
<polygon fill="#ff0000" stroke="#ff0000" points="46.9408,-259.5837 39.9011,-251.6658 40.4667,-262.2455 46.9408,-259.5837"/>
</g>
<!-- sourcefile~viscosity.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~viscosity.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/viscosity.f90.html" xlink:title="viscosity.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="292,-191.406 222,-191.406 222,-167.406 292,-167.406 292,-191.406"/>
<text text-anchor="middle" x="257" y="-177.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">viscosity.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~viscosity.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~viscosity.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M327.8078,-179.406C319.6934,-179.406 310.8729,-179.406 302.2995,-179.406"/>
<polygon fill="#ff0000" stroke="#ff0000" points="302.0285,-175.906 292.0284,-179.406 302.0284,-182.906 302.0285,-175.906"/>
</g>
<!-- sourcefile~gradients.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~gradients.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/gradients.f90.html" xlink:title="gradients.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="184,-293.406 109,-293.406 109,-269.406 184,-269.406 184,-293.406"/>
<text text-anchor="middle" x="146.5" y="-279.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">gradients.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M359.311,-191.4682C353.4248,-228.0045 330.0255,-336.5962 257,-363.406"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-363.406C217.9463,-377.7437 220.3545,-325.8695 186,-302.406 184.1241,-301.1247 182.1611,-299.8621 180.1556,-298.6306"/>
<polygon fill="#ff0000" stroke="#ff0000" points="181.6366,-295.4441 171.2275,-293.4692 178.1331,-301.5042 181.6366,-295.4441"/>
</g>
<!-- sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~global_kkl.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/global_kkl.f90.html" xlink:title="global_kkl.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="185.5,-91.406 107.5,-91.406 107.5,-67.406 185.5,-67.406 185.5,-91.406"/>
<text text-anchor="middle" x="146.5" y="-77.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_kkl.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~global_kkl.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-37.406C249.9078,-33.8362 211.0111,-49.9299 181.3532,-63.2184"/>
<polygon fill="#ff0000" stroke="#ff0000" points="179.7681,-60.094 172.1007,-67.4058 182.6543,-66.4713 179.7681,-60.094"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/utils.f90.html" xlink:title="utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="62.5,-151.406 8.5,-151.406 8.5,-127.406 62.5,-127.406 62.5,-151.406"/>
<text text-anchor="middle" x="35.5" y="-137.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M356.5976,-167.2531C345.3378,-138.2434 312.4088,-65.2952 257,-37.406"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-37.406C196.8704,-7.1406 165.3478,17.1662 107,-16.406 69.2465,-38.1286 49.5784,-88.2883 40.9939,-117.4002"/>
<polygon fill="#ff0000" stroke="#ff0000" points="37.6086,-116.5108 38.3197,-127.0818 44.3559,-118.3746 37.6086,-116.5108"/>
</g>
<!-- sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~global_sst.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/global_sst.f90.html" xlink:title="global_sst.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="186,-49.406 107,-49.406 107,-25.406 186,-25.406 186,-49.406"/>
<text text-anchor="middle" x="146.5" y="-35.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">global_sst.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscous.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~viscous.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-37.406C238.5409,-28.1148 216.0509,-26.6429 196.1908,-28.0549"/>
<polygon fill="#ff0000" stroke="#ff0000" points="195.6981,-24.5861 186.0803,-29.03 196.3701,-31.5538 195.6981,-24.5861"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sa.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sa.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M252.5783,-191.708C243.4402,-215.6745 220.4079,-269.1774 186,-302.406 184.9176,-303.4513 183.7727,-304.4587 182.5811,-305.4278"/>
<polygon fill="#48ff00" stroke="#48ff00" points="180.4061,-302.6776 174.2042,-311.2675 184.4092,-308.42 180.4061,-302.6776"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M221.7598,-188.2368C191.3092,-195.9465 146.1581,-207.5678 107,-218.406 98.4842,-220.7629 89.4233,-223.357 80.7141,-225.8938"/>
<polygon fill="#48ff00" stroke="#48ff00" points="79.6904,-222.5466 71.0785,-228.718 81.6593,-229.264 79.6904,-222.5466"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~gradients.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~gradients.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M248.5098,-191.6267C236.2261,-208.6519 212.0932,-239.7392 186,-260.406 184.4475,-261.6356 182.8124,-262.8286 181.1265,-263.9801"/>
<polygon fill="#48ff00" stroke="#48ff00" points="179.0818,-261.1295 172.4214,-269.3691 182.7663,-267.0813 179.0818,-261.1295"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_kkl.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_kkl.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M246.9153,-167.3274C233.7758,-151.9769 209.6746,-125.1096 186,-105.406 182.6634,-102.629 179.0201,-99.89 175.339,-97.2918"/>
<polygon fill="#48ff00" stroke="#48ff00" points="177.0546,-94.2271 166.808,-91.533 173.1381,-100.0289 177.0546,-94.2271"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M241.7144,-167.377C228.0101,-157.4106 206.8982,-144.0066 186,-138.406 148.5229,-128.3623 103.8863,-130.3067 73.0053,-133.7111"/>
<polygon fill="#48ff00" stroke="#48ff00" points="72.1975,-130.2832 62.6902,-134.9589 73.0382,-137.2325 72.1975,-130.2832"/>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sst.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~global_sst.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M252.5251,-167.3065C243.2939,-143.7342 220.1059,-91.1088 186,-58.406 184.9139,-57.3645 183.7659,-56.3604 182.5716,-55.394"/>
<polygon fill="#48ff00" stroke="#48ff00" points="184.393,-52.3976 174.1837,-49.5657 180.3987,-58.1461 184.393,-52.3976"/>
</g>
<!-- sourcefile~copy_bc.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~copy_bc.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/copy_bc.f90.html" xlink:title="copy_bc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="181.5,-251.406 111.5,-251.406 111.5,-227.406 181.5,-227.406 181.5,-251.406"/>
<text text-anchor="middle" x="146.5" y="-237.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">copy_bc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~copy_bc.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~copy_bc.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M234.6387,-191.5478C218.3132,-200.4124 195.9641,-212.5476 177.8563,-222.3799"/>
<polygon fill="#48ff00" stroke="#48ff00" points="175.946,-219.4344 168.8281,-227.2821 179.2863,-225.5861 175.946,-219.4344"/>
</g>
<!-- sourcefile~wall_dist.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~wall_dist.f90</title>
<g id="a_sourcefile~~viscous.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/wall_dist.f90.html" xlink:title="wall_dist.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="182,-171.406 111,-171.406 111,-147.406 182,-147.406 182,-171.406"/>
<text text-anchor="middle" x="146.5" y="-157.006" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">wall_dist.f90</text>
</a>
</g>
</g>
<!-- sourcefile~viscosity.f90&#45;&gt;sourcefile~wall_dist.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~viscosity.f90&#45;&gt;sourcefile~wall_dist.f90</title>
<path fill="none" stroke="#48ff00" stroke-dasharray="5,2" d="M221.7333,-173.0228C212.3578,-171.3259 202.095,-169.4684 192.2475,-167.686"/>
<polygon fill="#48ff00" stroke="#48ff00" points="192.6537,-164.2028 182.1902,-165.8657 191.407,-171.0909 192.6537,-164.2028"/>
</g>
<!-- sourcefile~gradients.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~gradients.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M114.6919,-269.3704C102.8482,-264.8891 89.2325,-259.7372 76.6686,-254.9833"/>
<polygon fill="#00ff91" stroke="#00ff91" points="77.9043,-251.7087 67.3128,-251.4432 75.427,-258.2557 77.9043,-251.7087"/>
</g>
<!-- sourcefile~gradients.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~gradients.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M118.8251,-269.237C114.5924,-266.6807 110.4808,-263.7333 107,-260.406 76.7921,-231.5296 55.0015,-187.1343 43.8859,-160.9087"/>
<polygon fill="#00ff91" stroke="#00ff91" points="47.0618,-159.4283 40.029,-151.5042 40.5853,-162.0844 47.0618,-159.4283"/>
</g>
<!-- sourcefile~copy_bc.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~copy_bc.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M111.3789,-239.406C101.8567,-239.406 91.405,-239.406 81.3847,-239.406"/>
<polygon fill="#ff0000" stroke="#ff0000" points="81.1556,-235.906 71.1556,-239.406 81.1555,-242.906 81.1556,-235.906"/>
</g>
<!-- sourcefile~wall_dist.f90&#45;&gt;sourcefile~vartypes.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~wall_dist.f90&#45;&gt;sourcefile~vartypes.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M127.4461,-171.5916C120.9032,-175.8699 113.5739,-180.7672 107,-185.406 90.6855,-196.9179 72.7558,-210.4615 58.9322,-221.1052"/>
<polygon fill="#00ffff" stroke="#00ffff" points="56.6748,-218.4264 50.9068,-227.3136 60.958,-223.9631 56.6748,-218.4264"/>
</g>
<!-- sourcefile~wall_dist.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~viscous.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~wall_dist.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M110.7679,-152.9677C98.5877,-150.7731 84.9464,-148.3152 72.657,-146.1009"/>
<polygon fill="#00ffff" stroke="#00ffff" points="73.1758,-142.6381 62.7136,-144.3093 71.9345,-149.5272 73.1758,-142.6381"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~viscous.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileviscousf90AfferentGraph" width="359pt" height="52pt"
 viewBox="0.00 0.00 359.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~viscous.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~viscous.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-48 355,-48 355,4 -4,4"/>
<!-- sourcefile~viscous.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~viscous.f90</title>
<polygon fill="none" stroke="#000000" points="66,-44 0,-44 0,-20 66,-20 66,-44"/>
<text text-anchor="middle" x="33" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">viscous.f90</text>
</g>
<!-- sourcefile~solver.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~solver.f90</title>
<g id="a_sourcefile~~viscous.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/solver.f90.html" xlink:title="solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="261,-44 202,-44 202,-20 261,-20 261,-44"/>
<text text-anchor="middle" x="231.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~viscous.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~viscous.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M201.8294,-32.5488C190.6047,-32.7312 177.7137,-32.9106 166,-33 137.5564,-33.2171 130.4437,-33.2061 102,-33 93.7384,-32.9401 84.9208,-32.84 76.4463,-32.7255"/>
<polygon fill="#ff0000" stroke="#ff0000" points="76.389,-29.2244 66.3398,-32.5806 76.2886,-36.2237 76.389,-29.2244"/>
</g>
<!-- sourcefile~update.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~update.f90</title>
<g id="a_sourcefile~~viscous.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/update.f90.html" xlink:title="update.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="166,-24 102,-24 102,0 166,0 166,-24"/>
<text text-anchor="middle" x="134" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update.f90</text>
</a>
</g>
</g>
<!-- sourcefile~solver.f90&#45;&gt;sourcefile~update.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~solver.f90&#45;&gt;sourcefile~update.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M201.9822,-25.9451C193.8447,-24.2758 184.8557,-22.4319 176.1525,-20.6467"/>
<polygon fill="#00ffff" stroke="#00ffff" points="176.6345,-17.1727 166.1352,-18.5918 175.2278,-24.03 176.6345,-17.1727"/>
</g>
<!-- sourcefile~update.f90&#45;&gt;sourcefile~viscous.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~update.f90&#45;&gt;sourcefile~viscous.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M101.7653,-18.3831C93.6324,-19.9936 84.7691,-21.7487 76.193,-23.4469"/>
<polygon fill="#ff0000" stroke="#ff0000" points="75.4479,-20.0264 66.3183,-25.4023 76.8077,-26.8931 75.4479,-20.0264"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~viscous.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="351,-44 297,-44 297,-20 351,-20 351,-44"/>
<text text-anchor="middle" x="324" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~solver.f90 -->
<g id="sourcefile~~viscous.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~solver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M296.7472,-32C288.791,-32 279.9269,-32 271.361,-32"/>
<polygon fill="#ff0000" stroke="#ff0000" points="271.1413,-28.5001 261.1413,-32 271.1413,-35.5001 271.1413,-28.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/viscous.html">viscous</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/viscous.f90.html#src">viscous.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a>  <span class="c">!&lt; The viscous module contains the viscous fluxes calculations </span>
<a name="ln-2"></a><span class="k">module </span><span class="n">viscous</span>
<a name="ln-3"></a>  <span class="c">!&lt; The viscous module contains the viscous fluxes calculations</span>
<a name="ln-4"></a>  <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-5"></a><span class="cp">#include &quot;error.h&quot;</span>
<a name="ln-6"></a>  <span class="k">use </span><span class="n">vartypes</span>
<a name="ln-7"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_x</span>
<a name="ln-8"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_y</span>
<a name="ln-9"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradu_z</span>
<a name="ln-10"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_x</span>
<a name="ln-11"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_y</span>
<a name="ln-12"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradv_z</span>
<a name="ln-13"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_x</span>
<a name="ln-14"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_y</span>
<a name="ln-15"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradw_z</span>
<a name="ln-16"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_x</span>
<a name="ln-17"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_y</span>
<a name="ln-18"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradT_z</span>
<a name="ln-19"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_x</span>
<a name="ln-20"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_y</span>
<a name="ln-21"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtk_z</span>
<a name="ln-22"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_x</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_y</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtw_z</span>
<a name="ln-25"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtkl_x</span>
<a name="ln-26"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtkl_y</span>
<a name="ln-27"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtkl_z</span>
<a name="ln-28"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_x</span>
<a name="ln-29"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_y</span>
<a name="ln-30"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtv_z</span>
<a name="ln-31"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtgm_x</span>
<a name="ln-32"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtgm_y</span>
<a name="ln-33"></a>  <span class="k">use </span><span class="n">gradients</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gradtgm_z</span>
<a name="ln-34"></a>  <span class="k">use </span><span class="n">viscosity</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu</span>
<a name="ln-35"></a>  <span class="k">use </span><span class="n">viscosity</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mu_t</span>
<a name="ln-36"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sst_F1</span>
<a name="ln-37"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k1</span>
<a name="ln-38"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k2</span>
<a name="ln-39"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w1</span>
<a name="ln-40"></a>  <span class="k">use </span><span class="n">global_sst</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_w2</span>
<a name="ln-41"></a>  <span class="k">use </span><span class="n">global_kkl</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_k</span>
<a name="ln-42"></a>  <span class="k">use </span><span class="n">global_kkl</span> <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_phi</span>
<a name="ln-43"></a>  <span class="k">use </span><span class="n">global_sa</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sigma_sa</span>
<a name="ln-44"></a>  <span class="k">use </span><span class="n">global_sa</span>  <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cb2</span>
<a name="ln-45"></a>  <span class="k">use </span><span class="n">utils</span>      <span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">alloc</span>
<a name="ln-46"></a>  <span class="k">implicit none</span>
<a name="ln-47"></a><span class="k">  private</span>
<a name="ln-48"></a>
<a name="ln-49"></a><span class="k">  </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">imx</span><span class="p">,</span> <span class="n">jmx</span><span class="p">,</span> <span class="n">kmx</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="k">public</span> <span class="kd">::</span> <span class="n">compute_viscous_fluxes</span>
<a name="ln-52"></a>
<a name="ln-53"></a>  <span class="k">contains</span>
<a name="ln-54"></a>
<a name="ln-55"></a><span class="k">    subroutine </span><span class="n">compute_viscous_fluxes</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-56"></a>      <span class="c">!&lt; Call to all viscous flux subroutine based on </span>
<a name="ln-57"></a>      <span class="c">!&lt; the drection and turbulence/transition model being</span>
<a name="ln-58"></a>      <span class="c">!&lt; used</span>
<a name="ln-59"></a>
<a name="ln-60"></a>        <span class="k">implicit none</span>
<a name="ln-61"></a><span class="k">        type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-62"></a>        <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-63"></a>        <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-64"></a>        <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-65"></a>        <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-66"></a>        <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-67"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-68"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">H</span>
<a name="ln-69"></a>        <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-70"></a>        <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-71"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ifaces</span>
<a name="ln-72"></a>        <span class="c">!&lt; Store face quantites for I faces </span>
<a name="ln-73"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Jfaces</span>
<a name="ln-74"></a>        <span class="c">!&lt; Store face quantites for J faces </span>
<a name="ln-75"></a>        <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Kfaces</span>
<a name="ln-76"></a>        <span class="c">!&lt; Store face quantites for K faces </span>
<a name="ln-77"></a>        <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flagsi</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">)</span>
<a name="ln-78"></a>        <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flagsj</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">)</span>
<a name="ln-79"></a>        <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flagsk</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span>
<a name="ln-80"></a>
<a name="ln-81"></a>        <span class="n">imx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span>
<a name="ln-82"></a>        <span class="n">jmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span>
<a name="ln-83"></a>        <span class="n">kmx</span> <span class="o">=</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span>
<a name="ln-84"></a>
<a name="ln-85"></a>        <span class="k">call </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">flagsi</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-86"></a>        <span class="k">call </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">flagsj</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-87"></a>        <span class="k">call </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">flagsk</span><span class="p">,</span><span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-88"></a>        
<a name="ln-89"></a>        <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">turbulence</span><span class="p">))</span>
<a name="ln-90"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-91"></a>            <span class="c">!do nothing</span>
<a name="ln-92"></a>            <span class="k">continue</span>
<a name="ln-93"></a>
<a name="ln-94"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;saBC&#39;</span><span class="p">)</span>
<a name="ln-95"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">flagsi</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-96"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">flagsj</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-97"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">flagsk</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-98"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;sst&#39;</span><span class="p">,</span> <span class="s1">&#39;sst2003&#39;</span><span class="p">)</span>
<a name="ln-99"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span>  <span class="n">Ifaces</span><span class="p">,</span> <span class="n">flagsi</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-100"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span>  <span class="n">Jfaces</span><span class="p">,</span> <span class="n">flagsj</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-101"></a>            <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-102"></a><span class="k">              continue</span>
<a name="ln-103"></a><span class="k">            else</span>
<a name="ln-104"></a><span class="k">              call </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">flagsk</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-105"></a>            <span class="k">end if</span>
<a name="ln-106"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;kkl&#39;</span><span class="p">)</span>
<a name="ln-107"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">flagsi</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-108"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">flagsj</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-109"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">flagsk</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-110"></a>          <span class="k">case </span><span class="n">DEFAULT</span>
<a name="ln-111"></a>            <span class="n">Fatal_error</span>
<a name="ln-112"></a>        <span class="k">end select</span>
<a name="ln-113"></a>
<a name="ln-114"></a>
<a name="ln-115"></a><span class="k">        select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">transition</span><span class="p">))</span>
<a name="ln-116"></a>          <span class="k">case</span><span class="p">(</span><span class="s1">&#39;lctm2015&#39;</span><span class="p">)</span>
<a name="ln-117"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Ifaces</span><span class="p">,</span> <span class="n">flagsi</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-118"></a>            <span class="k">call </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Jfaces</span><span class="p">,</span> <span class="n">flagsj</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-119"></a>            <span class="k">if</span><span class="p">(</span><span class="n">kmx</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-120"></a><span class="k">              continue</span>
<a name="ln-121"></a><span class="k">            else</span>
<a name="ln-122"></a><span class="k">              call </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span><span class="n">cells</span><span class="p">,</span> <span class="n">Kfaces</span><span class="p">,</span> <span class="n">flagsk</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-123"></a>            <span class="k">end if</span>
<a name="ln-124"></a><span class="k">          case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">)</span>
<a name="ln-125"></a>            <span class="c">!do nothing</span>
<a name="ln-126"></a>            <span class="k">continue</span>
<a name="ln-127"></a><span class="k">          case </span><span class="n">DEFAULT</span>
<a name="ln-128"></a>            <span class="n">Fatal_error</span>
<a name="ln-129"></a>        <span class="k">end select</span>
<a name="ln-130"></a>
<a name="ln-131"></a>
<a name="ln-132"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-133"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-134"></a>            <span class="k">end if</span>
<a name="ln-135"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">F</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-136"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-137"></a>            <span class="k">end if</span>
<a name="ln-138"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-139"></a><span class="k">              </span><span class="n">Fatal_error</span>
<a name="ln-140"></a>            <span class="k">end if</span>
<a name="ln-141"></a>
<a name="ln-142"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes</span>
<a name="ln-143"></a>
<a name="ln-144"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_laminar</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-145"></a>      <span class="c">!&lt; Compute viscous fluxes for first five Navier-Stokes equation</span>
<a name="ln-146"></a>      <span class="k">implicit none</span>
<a name="ln-147"></a><span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> 
<a name="ln-148"></a>      <span class="c">!&lt; Flux array</span>
<a name="ln-149"></a>      <span class="k">type</span><span class="p">(</span><span class="n">schemetype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scheme</span>
<a name="ln-150"></a>      <span class="c">!&lt; finite-volume Schemes</span>
<a name="ln-151"></a>      <span class="k">type</span><span class="p">(</span><span class="n">flowtype</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flow</span>
<a name="ln-152"></a>      <span class="c">!&lt; Information about fluid flow: freestream-speed, ref-viscosity,etc.</span>
<a name="ln-153"></a>      <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-154"></a>      <span class="c">!&lt; Extent of the domain:imx,jmx,kmx</span>
<a name="ln-155"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flags</span>
<a name="ln-156"></a>      <span class="c">!&lt; flags for direction switch</span>
<a name="ln-157"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-158"></a>     <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-159"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-160"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-161"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">faces</span>
<a name="ln-162"></a>      <span class="c">!&lt; Face quantities: area and unit normal</span>
<a name="ln-163"></a>      <span class="c">! local variables</span>
<a name="ln-164"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dudx</span><span class="p">,</span> <span class="n">dudy</span><span class="p">,</span> <span class="n">dudz</span>
<a name="ln-165"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dvdx</span><span class="p">,</span> <span class="n">dvdy</span><span class="p">,</span> <span class="n">dvdz</span>
<a name="ln-166"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dwdx</span><span class="p">,</span> <span class="n">dwdy</span><span class="p">,</span> <span class="n">dwdz</span>
<a name="ln-167"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dTdx</span><span class="p">,</span> <span class="n">dTdy</span><span class="p">,</span> <span class="n">dTdz</span>
<a name="ln-168"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-169"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-170"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">T_RE</span>
<a name="ln-171"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">T_LE</span>
<a name="ln-172"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">K_heat</span><span class="p">,</span> <span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span>
<a name="ln-173"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-174"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-175"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">total_mu</span>
<a name="ln-176"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-177"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-178"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-179"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delu</span>
<a name="ln-180"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delv</span>
<a name="ln-181"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delw</span>
<a name="ln-182"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delT</span>
<a name="ln-183"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_xx</span>
<a name="ln-184"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_xy</span>
<a name="ln-185"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_xz</span>
<a name="ln-186"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_yx</span>
<a name="ln-187"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_yy</span>
<a name="ln-188"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_yz</span>
<a name="ln-189"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_zx</span>
<a name="ln-190"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_zy</span>
<a name="ln-191"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_zz</span>
<a name="ln-192"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-193"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-194"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-195"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-196"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uface</span>
<a name="ln-197"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vface</span>
<a name="ln-198"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wface</span>
<a name="ln-199"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-200"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-201"></a>
<a name="ln-202"></a>      <span class="n">ii</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-203"></a>      <span class="n">jj</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-204"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-205"></a>
<a name="ln-206"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-207"></a>      <span class="c">! Calculating the fluxes at the faces</span>
<a name="ln-208"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-209"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-210"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-211"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-212"></a>
<a name="ln-213"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-214"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-215"></a>          <span class="n">dudx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-216"></a>          <span class="n">dudy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-217"></a>          <span class="n">dudz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradu_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-218"></a>          <span class="n">dvdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-219"></a>          <span class="n">dvdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-220"></a>          <span class="n">dvdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-221"></a>          <span class="n">dwdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-222"></a>          <span class="n">dwdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-223"></a>          <span class="n">dwdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-224"></a>          <span class="n">dTdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradT_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradT_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-225"></a>          <span class="n">dTdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradT_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradT_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-226"></a>          <span class="n">dTdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradT_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradT_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-227"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-228"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-229"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerx</span>
<a name="ln-230"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centery</span>
<a name="ln-231"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerz</span>
<a name="ln-232"></a>
<a name="ln-233"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-234"></a>
<a name="ln-235"></a>          <span class="c">! Finding the temperature of left and right element to the face i,j,k</span>
<a name="ln-236"></a>          <span class="n">T_LE</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">flow</span><span class="p">%</span><span class="n">R_gas</span><span class="p">)</span>
<a name="ln-237"></a>          <span class="n">T_RE</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">flow</span><span class="p">%</span><span class="n">R_gas</span><span class="p">)</span>
<a name="ln-238"></a>
<a name="ln-239"></a>          <span class="c">! difference in state across face</span>
<a name="ln-240"></a>          <span class="n">delu</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c">!x_speed</span>
<a name="ln-241"></a>          <span class="n">delv</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c">!y_speed</span>
<a name="ln-242"></a>          <span class="n">delw</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c">!z_speed</span>
<a name="ln-243"></a>          <span class="n">delT</span> <span class="o">=</span> <span class="n">T_RE</span> <span class="o">-</span> <span class="n">T_LE</span>
<a name="ln-244"></a>
<a name="ln-245"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-246"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-247"></a>
<a name="ln-248"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delu</span> <span class="o">-</span> <span class="p">(</span><span class="n">dudx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dudy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dudz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-249"></a>          <span class="n">dudx</span>        <span class="o">=</span>  <span class="n">dudx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-250"></a>          <span class="n">dudy</span>        <span class="o">=</span>  <span class="n">dudy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-251"></a>          <span class="n">dudz</span>        <span class="o">=</span>  <span class="n">dudz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-252"></a>
<a name="ln-253"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delv</span> <span class="o">-</span> <span class="p">(</span><span class="n">dvdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dvdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dvdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-254"></a>          <span class="n">dvdx</span>        <span class="o">=</span>  <span class="n">dvdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-255"></a>          <span class="n">dvdy</span>        <span class="o">=</span>  <span class="n">dvdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-256"></a>          <span class="n">dvdz</span>        <span class="o">=</span>  <span class="n">dvdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-257"></a>
<a name="ln-258"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delw</span> <span class="o">-</span> <span class="p">(</span><span class="n">dwdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dwdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dwdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-259"></a>          <span class="n">dwdx</span>        <span class="o">=</span> <span class="n">dwdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-260"></a>          <span class="n">dwdy</span>        <span class="o">=</span> <span class="n">dwdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-261"></a>          <span class="n">dwdz</span>        <span class="o">=</span> <span class="n">dwdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-262"></a>
<a name="ln-263"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">delT</span> <span class="o">-</span> <span class="p">(</span><span class="n">dTdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dTdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dTdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-264"></a>          <span class="n">dTdx</span>        <span class="o">=</span> <span class="n">dTdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-265"></a>          <span class="n">dTdy</span>        <span class="o">=</span> <span class="n">dTdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-266"></a>          <span class="n">dTdz</span>        <span class="o">=</span> <span class="n">dTdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-267"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-268"></a>
<a name="ln-269"></a>          <span class="n">mu_f</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<a name="ln-270"></a>          <span class="k">if</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">scheme</span><span class="p">%</span><span class="n">turbulence</span><span class="p">)</span><span class="o">/=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-271"></a><span class="k">            </span><span class="n">mut_f</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-272"></a>          <span class="k">else</span>
<a name="ln-273"></a><span class="k">            </span><span class="n">mut_f</span> <span class="o">=</span> <span class="mf">0.0</span> 
<a name="ln-274"></a>          <span class="k">end if</span>
<a name="ln-275"></a>
<a name="ln-276"></a>          <span class="c">! effective viscosity</span>
<a name="ln-277"></a>          <span class="n">total_mu</span> <span class="o">=</span> <span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span>
<a name="ln-278"></a>
<a name="ln-279"></a>          <span class="c">! Using lambda = -2 * mu / 3</span>
<a name="ln-280"></a>          <span class="c">! diagonal terms of stress tensor</span>
<a name="ln-281"></a>          <span class="n">Tau_xx</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dudx</span> <span class="o">-</span> <span class="p">((</span><span class="n">dudx</span> <span class="o">+</span> <span class="n">dvdy</span> <span class="o">+</span> <span class="n">dwdz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span> 
<a name="ln-282"></a>          <span class="n">Tau_yy</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dvdy</span> <span class="o">-</span> <span class="p">((</span><span class="n">dudx</span> <span class="o">+</span> <span class="n">dvdy</span> <span class="o">+</span> <span class="n">dwdz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span> 
<a name="ln-283"></a>          <span class="n">Tau_zz</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwdz</span> <span class="o">-</span> <span class="p">((</span><span class="n">dudx</span> <span class="o">+</span> <span class="n">dvdy</span> <span class="o">+</span> <span class="n">dwdz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span> 
<a name="ln-284"></a>          <span class="c">! off diagonal symmetrical part of stress tensor</span>
<a name="ln-285"></a>          <span class="n">Tau_xy</span> <span class="o">=</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dvdx</span> <span class="o">+</span> <span class="n">dudy</span><span class="p">)</span>
<a name="ln-286"></a>          <span class="n">Tau_xz</span> <span class="o">=</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwdx</span> <span class="o">+</span> <span class="n">dudz</span><span class="p">)</span>
<a name="ln-287"></a>          <span class="n">Tau_yz</span> <span class="o">=</span> <span class="n">total_mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">dwdy</span> <span class="o">+</span> <span class="n">dvdz</span><span class="p">)</span>
<a name="ln-288"></a>          <span class="n">Tau_yx</span> <span class="o">=</span> <span class="n">Tau_xy</span>
<a name="ln-289"></a>          <span class="n">Tau_zx</span> <span class="o">=</span> <span class="n">Tau_xz</span>
<a name="ln-290"></a>          <span class="n">Tau_zy</span> <span class="o">=</span> <span class="n">Tau_yz</span>
<a name="ln-291"></a>
<a name="ln-292"></a>          <span class="c">! Pr: Prandtl Number and tPr: Turbulent Prandtl number</span>
<a name="ln-293"></a>          <span class="c">! Qx, Qy, Qz: Conduction fluxes</span>
<a name="ln-294"></a>          <span class="n">K_heat</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_f</span><span class="o">/</span><span class="n">flow</span><span class="p">%</span><span class="n">Pr</span> <span class="o">+</span> <span class="n">mut_f</span><span class="o">/</span><span class="n">flow</span><span class="p">%</span><span class="n">tPr</span><span class="p">)</span><span class="o">*</span> <span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">*</span> <span class="n">flow</span><span class="p">%</span><span class="n">R_gas</span> <span class="o">/</span> <span class="p">(</span><span class="n">flow</span><span class="p">%</span><span class="n">gm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-295"></a>          <span class="n">Qx</span> <span class="o">=</span> <span class="n">K_heat</span><span class="o">*</span><span class="n">dTdx</span>
<a name="ln-296"></a>          <span class="n">Qy</span> <span class="o">=</span> <span class="n">K_heat</span><span class="o">*</span><span class="n">dTdy</span>
<a name="ln-297"></a>          <span class="n">Qz</span> <span class="o">=</span> <span class="n">K_heat</span><span class="o">*</span><span class="n">dTdz</span>
<a name="ln-298"></a>
<a name="ln-299"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-300"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-301"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-302"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-303"></a>          <span class="n">area</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-304"></a>          <span class="n">uface</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<a name="ln-305"></a>          <span class="n">vface</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a name="ln-306"></a>          <span class="n">wface</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a name="ln-307"></a>
<a name="ln-308"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-309"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">Tau_xx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">Tau_xy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">Tau_xz</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
<a name="ln-310"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">Tau_yx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">Tau_yy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">Tau_yz</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
<a name="ln-311"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">Tau_zx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">Tau_zy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">Tau_zz</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
<a name="ln-312"></a>         
<a name="ln-313"></a>          <span class="c">! Energy flux</span>
<a name="ln-314"></a>          <span class="c">! (TijVj + Qi)ni</span>
<a name="ln-315"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span> <span class="o">*</span> <span class="p">(</span> <span class="p">&amp;</span>
<a name="ln-316"></a>                          <span class="p">((</span><span class="n">Tau_xx</span><span class="o">*</span><span class="n">uface</span> <span class="o">+</span> <span class="n">Tau_xy</span><span class="o">*</span><span class="n">vface</span> <span class="o">+</span> <span class="n">Tau_xz</span><span class="o">*</span><span class="n">wface</span> <span class="o">+</span> <span class="n">Qx</span><span class="p">)</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-317"></a>                          <span class="p">((</span><span class="n">Tau_yx</span><span class="o">*</span><span class="n">uface</span> <span class="o">+</span> <span class="n">Tau_yy</span><span class="o">*</span><span class="n">vface</span> <span class="o">+</span> <span class="n">Tau_yz</span><span class="o">*</span><span class="n">wface</span> <span class="o">+</span> <span class="n">Qy</span><span class="p">)</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-318"></a>                          <span class="p">((</span><span class="n">Tau_zx</span><span class="o">*</span><span class="n">uface</span> <span class="o">+</span> <span class="n">Tau_zy</span><span class="o">*</span><span class="n">vface</span> <span class="o">+</span> <span class="n">Tau_zz</span><span class="o">*</span><span class="n">wface</span> <span class="o">+</span> <span class="n">Qz</span><span class="p">)</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<a name="ln-319"></a>          
<a name="ln-320"></a>         
<a name="ln-321"></a>        <span class="k">end do</span>
<a name="ln-322"></a><span class="k">       end do</span>
<a name="ln-323"></a><span class="k">      end do</span>
<a name="ln-324"></a>
<a name="ln-325"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_laminar</span>
<a name="ln-326"></a>
<a name="ln-327"></a>
<a name="ln-328"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_sst</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-329"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to SST turbulence model</span>
<a name="ln-330"></a>      <span class="k">implicit none</span>
<a name="ln-331"></a><span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> 
<a name="ln-332"></a>      <span class="c">!&lt; flux array</span>
<a name="ln-333"></a>      <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-334"></a>      <span class="c">!&lt; Extent of the domain: imx,jmx,kmx</span>
<a name="ln-335"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flags</span>
<a name="ln-336"></a>      <span class="c">!&lt; flags for direction swithc</span>
<a name="ln-337"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-338"></a>     <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-339"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-340"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-341"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">faces</span>
<a name="ln-342"></a>      <span class="c">!&lt; quantities on the face</span>
<a name="ln-343"></a>      <span class="c">! local variables</span>
<a name="ln-344"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tkface</span>
<a name="ln-345"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-346"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-347"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-348"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-349"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-350"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">total_mu</span>
<a name="ln-351"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-352"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-353"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-354"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltk</span>
<a name="ln-355"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltw</span>
<a name="ln-356"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_xx</span>
<a name="ln-357"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_yy</span>
<a name="ln-358"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_zz</span>
<a name="ln-359"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-360"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-361"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-362"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-363"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-364"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-365"></a>      <span class="c">!--- sst variable requirement ---!</span>
<a name="ln-366"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtkdx</span><span class="p">,</span> <span class="n">dtkdy</span><span class="p">,</span> <span class="n">dtkdz</span><span class="p">,</span> <span class="n">dtwdx</span><span class="p">,</span> <span class="n">dtwdy</span><span class="p">,</span> <span class="n">dtwdz</span>
<a name="ln-367"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">F1</span>
<a name="ln-368"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">sigma_kf</span>
<a name="ln-369"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">sigma_wf</span>
<a name="ln-370"></a>
<a name="ln-371"></a>      <span class="n">ii</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-372"></a>      <span class="n">jj</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-373"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-374"></a>
<a name="ln-375"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-376"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-377"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-378"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-379"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-380"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-381"></a>
<a name="ln-382"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-383"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-384"></a>          <span class="n">dtkdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-385"></a>          <span class="n">dtkdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-386"></a>          <span class="n">dtkdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-387"></a>          <span class="n">dtwdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtw_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-388"></a>          <span class="n">dtwdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtw_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-389"></a>          <span class="n">dtwdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtw_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-390"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-391"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-392"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerx</span>
<a name="ln-393"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centery</span>
<a name="ln-394"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerz</span>
<a name="ln-395"></a>
<a name="ln-396"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-397"></a>
<a name="ln-398"></a>          <span class="c">! difference in state across face</span>
<a name="ln-399"></a>          <span class="n">deltk</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="c">!TKE</span>
<a name="ln-400"></a>          <span class="n">deltw</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="c">!Omega</span>
<a name="ln-401"></a>
<a name="ln-402"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-403"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-404"></a>
<a name="ln-405"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltk</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-406"></a>          <span class="n">dtkdx</span>       <span class="o">=</span>  <span class="n">dtkdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-407"></a>          <span class="n">dtkdy</span>       <span class="o">=</span>  <span class="n">dtkdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-408"></a>          <span class="n">dtkdz</span>       <span class="o">=</span>  <span class="n">dtkdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-409"></a>
<a name="ln-410"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltw</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtwdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtwdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtwdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-411"></a>          <span class="n">dtwdx</span>       <span class="o">=</span>  <span class="n">dtwdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-412"></a>          <span class="n">dtwdy</span>       <span class="o">=</span>  <span class="n">dtwdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-413"></a>          <span class="n">dtwdz</span>       <span class="o">=</span>  <span class="n">dtwdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-414"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-415"></a>
<a name="ln-416"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span>  <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span>   <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-417"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-418"></a>          <span class="n">F1</span>       <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">sst_F1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-419"></a>          <span class="n">sigma_kf</span> <span class="o">=</span> <span class="n">sigma_k1</span><span class="o">*</span><span class="n">F1</span> <span class="o">+</span> <span class="n">sigma_k2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-420"></a>          <span class="n">sigma_wf</span> <span class="o">=</span> <span class="n">sigma_w1</span><span class="o">*</span><span class="n">F1</span> <span class="o">+</span> <span class="n">sigma_w2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">F1</span><span class="p">)</span>
<a name="ln-421"></a>
<a name="ln-422"></a>          <span class="n">total_mu</span> <span class="o">=</span> <span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span>
<a name="ln-423"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c">!Density</span>
<a name="ln-424"></a>          <span class="n">tkface</span>   <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="c">!TKE</span>
<a name="ln-425"></a>          <span class="c">! k in reynolds stress</span>
<a name="ln-426"></a>          <span class="n">Tau_xx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rhoface</span><span class="o">*</span><span class="n">tkface</span><span class="o">/</span><span class="mf">3.0</span>
<a name="ln-427"></a>          <span class="n">Tau_yy</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-428"></a>          <span class="n">Tau_zz</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-429"></a>
<a name="ln-430"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-431"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-432"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-433"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-434"></a>          <span class="n">area</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-435"></a>
<a name="ln-436"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-437"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_xx</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-438"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_yy</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-439"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_zz</span> <span class="o">*</span> <span class="n">nz</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-440"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_kf</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-441"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_kf</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-442"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_wf</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtwdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtwdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtwdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-443"></a>         
<a name="ln-444"></a>        <span class="k">end do</span>
<a name="ln-445"></a><span class="k">       end do</span>
<a name="ln-446"></a><span class="k">      end do</span>
<a name="ln-447"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_sst</span>
<a name="ln-448"></a>
<a name="ln-449"></a>
<a name="ln-450"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_kkl</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-451"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to k-kL turbulence model</span>
<a name="ln-452"></a>      <span class="k">implicit none</span>
<a name="ln-453"></a><span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> 
<a name="ln-454"></a>      <span class="c">!&lt; Flux array</span>
<a name="ln-455"></a>      <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-456"></a>      <span class="c">!&lt; Extent of the domain: imx,jmx,kmx</span>
<a name="ln-457"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flags</span>
<a name="ln-458"></a>      <span class="c">!&lt; flags for directions switch</span>
<a name="ln-459"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-460"></a>     <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-461"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-462"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-463"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">faces</span>
<a name="ln-464"></a>      <span class="c">!&lt; Face quantities: area and unit normal</span>
<a name="ln-465"></a>      <span class="c">! local variables</span>
<a name="ln-466"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tkface</span>
<a name="ln-467"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-468"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-469"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-470"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-471"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-472"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">total_mu</span>
<a name="ln-473"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-474"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-475"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-476"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltk</span>
<a name="ln-477"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltkl</span>
<a name="ln-478"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_xx</span>
<a name="ln-479"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_yy</span>
<a name="ln-480"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Tau_zz</span>
<a name="ln-481"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-482"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-483"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-484"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-485"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-486"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-487"></a>      <span class="c">!--- kkl variable requirement  ---!</span>
<a name="ln-488"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtkdx</span><span class="p">,</span> <span class="n">dtkdy</span><span class="p">,</span> <span class="n">dtkdz</span>
<a name="ln-489"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtkldx</span><span class="p">,</span> <span class="n">dtkldy</span><span class="p">,</span> <span class="n">dtkldz</span>
<a name="ln-490"></a>
<a name="ln-491"></a>
<a name="ln-492"></a>      <span class="n">ii</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-493"></a>      <span class="n">jj</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-494"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-495"></a>
<a name="ln-496"></a>
<a name="ln-497"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-498"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-499"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-500"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-501"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-502"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-503"></a>
<a name="ln-504"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-505"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-506"></a>          <span class="n">dtkdx</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-507"></a>          <span class="n">dtkdy</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-508"></a>          <span class="n">dtkdz</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtk_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-509"></a>          <span class="n">dtkldx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtkl_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtkl_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-510"></a>          <span class="n">dtkldy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtkl_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtkl_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-511"></a>          <span class="n">dtkldz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtkl_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtkl_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-512"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-513"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-514"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerx</span>
<a name="ln-515"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centery</span>
<a name="ln-516"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerz</span>
<a name="ln-517"></a>
<a name="ln-518"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-519"></a>
<a name="ln-520"></a>          <span class="c">! difference in state across face</span>
<a name="ln-521"></a>          <span class="n">deltk</span>  <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>   <span class="c">!TKE</span>
<a name="ln-522"></a>          <span class="n">deltkl</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>   <span class="c">!Kl</span>
<a name="ln-523"></a>
<a name="ln-524"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-525"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-526"></a>
<a name="ln-527"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltk</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-528"></a>          <span class="n">dtkdx</span>       <span class="o">=</span>  <span class="n">dtkdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-529"></a>          <span class="n">dtkdy</span>       <span class="o">=</span>  <span class="n">dtkdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-530"></a>          <span class="n">dtkdz</span>       <span class="o">=</span>  <span class="n">dtkdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-531"></a>
<a name="ln-532"></a>          <span class="n">normal_comp</span>  <span class="o">=</span> <span class="p">(</span><span class="n">deltkl</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtkldx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtkldy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtkldz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-533"></a>          <span class="n">dtkldx</span>       <span class="o">=</span>  <span class="n">dtkldx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-534"></a>          <span class="n">dtkldy</span>       <span class="o">=</span>  <span class="n">dtkldy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-535"></a>          <span class="n">dtkldz</span>       <span class="o">=</span>  <span class="n">dtkldz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-536"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-537"></a>
<a name="ln-538"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span>  <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span>  <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-539"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-540"></a>
<a name="ln-541"></a>          <span class="n">total_mu</span> <span class="o">=</span> <span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span>
<a name="ln-542"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-543"></a>          <span class="n">tkface</span>   <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a name="ln-544"></a>          <span class="c">! k in reynolds stress</span>
<a name="ln-545"></a>          <span class="n">Tau_xx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rhoface</span><span class="o">*</span><span class="n">tkface</span><span class="o">/</span><span class="mf">3.0</span>
<a name="ln-546"></a>          <span class="n">Tau_yy</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-547"></a>          <span class="n">Tau_zz</span> <span class="o">=</span> <span class="n">Tau_xx</span>
<a name="ln-548"></a>
<a name="ln-549"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-550"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-551"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-552"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-553"></a>          <span class="n">area</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-554"></a>
<a name="ln-555"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-556"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_xx</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-557"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_yy</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-558"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tau_zz</span> <span class="o">*</span> <span class="n">nz</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span>
<a name="ln-559"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_k</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-560"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_k</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-561"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">sigma_phi</span><span class="o">*</span><span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtkldx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtkldy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtkldz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-562"></a>         
<a name="ln-563"></a>        <span class="k">end do</span>
<a name="ln-564"></a><span class="k">       end do</span>
<a name="ln-565"></a><span class="k">      end do</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_kkl</span>
<a name="ln-568"></a>
<a name="ln-569"></a>
<a name="ln-570"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_sa</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
<a name="ln-571"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to SA turbulence model</span>
<a name="ln-572"></a>      <span class="k">implicit none</span>
<a name="ln-573"></a><span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> 
<a name="ln-574"></a>      <span class="c">!&lt; Flux array</span>
<a name="ln-575"></a>      <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-576"></a>      <span class="c">!&lt; Extent of the domain: imx,jmx,kmx</span>
<a name="ln-577"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flags</span>
<a name="ln-578"></a>      <span class="c">!&lt; flags for direction switch</span>
<a name="ln-579"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-580"></a>      <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-581"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-582"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-583"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">faces</span>
<a name="ln-584"></a>      <span class="c">!&lt; Face quantities: area and unit normal</span>
<a name="ln-585"></a>      <span class="c">! local variables</span>
<a name="ln-586"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-587"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-588"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-589"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-590"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-591"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-592"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-593"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-594"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltv</span>
<a name="ln-595"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-596"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-597"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-598"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-599"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-600"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-601"></a>      <span class="c">!--- sa variable requirement ---!</span>
<a name="ln-602"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtvdx</span><span class="p">,</span> <span class="n">dtvdy</span><span class="p">,</span> <span class="n">dtvdz</span>
<a name="ln-603"></a>
<a name="ln-604"></a>      <span class="n">ii</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-605"></a>      <span class="n">jj</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-606"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-607"></a>
<a name="ln-608"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-609"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-610"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-611"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-612"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-613"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-614"></a>
<a name="ln-615"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-616"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-617"></a>          <span class="n">dtvdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtv_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-618"></a>          <span class="n">dtvdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtv_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-619"></a>          <span class="n">dtvdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtv_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-620"></a>
<a name="ln-621"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-622"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-623"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerx</span>
<a name="ln-624"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centery</span>
<a name="ln-625"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerz</span>
<a name="ln-626"></a>
<a name="ln-627"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-628"></a>
<a name="ln-629"></a>          <span class="c">! difference in state across face</span>
<a name="ln-630"></a>          <span class="n">deltv</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-631"></a>
<a name="ln-632"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-633"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-634"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltv</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtvdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtvdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtvdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-635"></a>          <span class="n">dtvdx</span>       <span class="o">=</span>  <span class="n">dtvdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-636"></a>          <span class="n">dtvdy</span>       <span class="o">=</span>  <span class="n">dtvdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-637"></a>          <span class="n">dtvdz</span>       <span class="o">=</span>  <span class="n">dtvdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-638"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-639"></a>
<a name="ln-640"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-641"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-642"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">rhoface</span>
<a name="ln-643"></a>
<a name="ln-644"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-645"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-646"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-647"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-648"></a>          <span class="n">area</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-649"></a>
<a name="ln-650"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-651"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtvdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtvdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtvdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span><span class="o">/</span><span class="n">sigma_sa</span>
<a name="ln-652"></a>         
<a name="ln-653"></a>        <span class="k">end do</span>
<a name="ln-654"></a><span class="k">       end do</span>
<a name="ln-655"></a><span class="k">      end do</span>
<a name="ln-656"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_sa</span>
<a name="ln-657"></a>
<a name="ln-658"></a>
<a name="ln-659"></a>    <span class="k">subroutine </span><span class="n">compute_viscous_fluxes_lctm2015</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span><span class="n">dims</span><span class="p">)</span>
<a name="ln-660"></a>      <span class="c">!&lt; Compute viscous fluxes for additianal equations due to LCTM2015 transition model</span>
<a name="ln-661"></a>      <span class="k">implicit none</span>
<a name="ln-662"></a><span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">F</span> 
<a name="ln-663"></a>      <span class="c">!&lt; Flux array</span>
<a name="ln-664"></a>      <span class="k">type</span><span class="p">(</span><span class="n">extent</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dims</span>
<a name="ln-665"></a>      <span class="c">!&lt; Extent of the doamin:imx,jmx,kmx</span>
<a name="ln-666"></a>      <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flags</span>
<a name="ln-667"></a>      <span class="c">!&lt;flags for direction switch</span>
<a name="ln-668"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qp</span>
<a name="ln-669"></a>      <span class="c">!&lt; Store primitive variable at cell center</span>
<a name="ln-670"></a>      <span class="k">type</span><span class="p">(</span><span class="n">celltype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cells</span>
<a name="ln-671"></a>      <span class="c">!&lt; Input cell quantities: volume</span>
<a name="ln-672"></a>      <span class="k">type</span><span class="p">(</span><span class="n">facetype</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">imx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">jmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">dims</span><span class="p">%</span><span class="n">kmx</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">faces</span>
<a name="ln-673"></a>      <span class="c">!&lt; Face quantities: area and unit normal</span>
<a name="ln-674"></a>      <span class="c">! local variables</span>
<a name="ln-675"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rhoface</span>
<a name="ln-676"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">normal_comp</span>
<a name="ln-677"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_LR</span>
<a name="ln-678"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mu_f</span>
<a name="ln-679"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mut_f</span>
<a name="ln-680"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delx</span>
<a name="ln-681"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dely</span>
<a name="ln-682"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">delz</span>
<a name="ln-683"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">deltgm</span>
<a name="ln-684"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nx</span>
<a name="ln-685"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ny</span>
<a name="ln-686"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nz</span>
<a name="ln-687"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">area</span>
<a name="ln-688"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-689"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span>
<a name="ln-690"></a>      <span class="c">!--- sa variable requirement ---!</span>
<a name="ln-691"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtgmdx</span><span class="p">,</span> <span class="n">dtgmdy</span><span class="p">,</span> <span class="n">dtgmdz</span>
<a name="ln-692"></a>
<a name="ln-693"></a>      <span class="n">ii</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-694"></a>      <span class="n">jj</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-695"></a>      <span class="n">kk</span> <span class="o">=</span> <span class="n">flags</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-696"></a>
<a name="ln-697"></a>
<a name="ln-698"></a>      <span class="c">!---------------------------------------------------------------------</span>
<a name="ln-699"></a>      <span class="c">! Calculating the turbulent viscous fluxes at the faces</span>
<a name="ln-700"></a>      <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-701"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">kmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">kk</span>
<a name="ln-702"></a>       <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">jmx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">jj</span>
<a name="ln-703"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">imx</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ii</span>
<a name="ln-704"></a>
<a name="ln-705"></a>          <span class="c">!--- FACE Gradients ---!</span>
<a name="ln-706"></a>          <span class="c">! Gradients at face as average of gradients at cell centres</span>
<a name="ln-707"></a>          <span class="n">dtgmdx</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtgm_x</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtgm_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-708"></a>          <span class="n">dtgmdy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtgm_y</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtgm_y</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-709"></a>          <span class="n">dtgmdz</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradtgm_z</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">gradtgm_z</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-710"></a>
<a name="ln-711"></a>          <span class="c">!--- For ODD-EVEN coupling error ---!</span>
<a name="ln-712"></a>          <span class="c">! distance between cell center of adjacent cell for the i,j,k face</span>
<a name="ln-713"></a>          <span class="n">delx</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerx</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerx</span>
<a name="ln-714"></a>          <span class="n">dely</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centery</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centery</span>
<a name="ln-715"></a>          <span class="n">delz</span> <span class="o">=</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)%</span><span class="n">centerz</span> <span class="o">-</span> <span class="n">cells</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)%</span><span class="n">centerz</span>
<a name="ln-716"></a>
<a name="ln-717"></a>          <span class="n">d_LR</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">delx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dely</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">delz</span><span class="o">*</span><span class="n">delz</span><span class="p">)</span>
<a name="ln-718"></a>
<a name="ln-719"></a>          <span class="c">! difference in state across face</span>
<a name="ln-720"></a>          <span class="n">deltgm</span> <span class="o">=</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a name="ln-721"></a>
<a name="ln-722"></a>          <span class="c">!normal_comp   = ( delta(phi) - (grad(phi).dot.delR) )/magnitudeR</span>
<a name="ln-723"></a>          <span class="c">!new grad(phi) =  grad(phi) + correction(normal_comp.dot.delR/magnitudeR)</span>
<a name="ln-724"></a>          <span class="n">normal_comp</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltgm</span> <span class="o">-</span> <span class="p">(</span><span class="n">dtgmdx</span><span class="o">*</span><span class="n">delx</span> <span class="o">+</span> <span class="n">dtgmdy</span><span class="o">*</span><span class="n">dely</span> <span class="o">+</span> <span class="n">dtgmdz</span><span class="o">*</span><span class="n">delz</span><span class="p">))</span><span class="o">/</span><span class="n">d_LR</span>
<a name="ln-725"></a>          <span class="n">dtgmdx</span>       <span class="o">=</span>  <span class="n">dtgmdx</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-726"></a>          <span class="n">dtgmdy</span>       <span class="o">=</span>  <span class="n">dtgmdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">dely</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-727"></a>          <span class="n">dtgmdz</span>       <span class="o">=</span>  <span class="n">dtgmdz</span> <span class="o">+</span> <span class="p">(</span><span class="n">normal_comp</span> <span class="o">*</span> <span class="n">delz</span> <span class="o">/</span> <span class="n">d_LR</span><span class="p">)</span>
<a name="ln-728"></a>          <span class="c">!--- end of ODD-EVEN coupling correction ---!</span>
<a name="ln-729"></a>
<a name="ln-730"></a>          <span class="n">rhoface</span>  <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">qp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-731"></a>          <span class="n">mu_f</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-732"></a>          <span class="n">mut_f</span>    <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="n">kk</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu_t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-733"></a>
<a name="ln-734"></a>          <span class="c">! calling some element from memory and keep them handy for calculation</span>
<a name="ln-735"></a>          <span class="n">nx</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nx</span>
<a name="ln-736"></a>          <span class="n">ny</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">ny</span>
<a name="ln-737"></a>          <span class="n">nz</span>    <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">nz</span>
<a name="ln-738"></a>          <span class="n">area</span>  <span class="o">=</span> <span class="n">faces</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)%</span><span class="n">A</span>
<a name="ln-739"></a>
<a name="ln-740"></a>          <span class="c">! adding viscous fluxes to stored convective flux</span>
<a name="ln-741"></a>          <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">)</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dims</span><span class="p">%</span><span class="n">n_var</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">area</span><span class="o">*</span><span class="p">((</span><span class="n">mu_f</span> <span class="o">+</span> <span class="n">mut_f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dtgmdx</span><span class="o">*</span><span class="n">nx</span> <span class="o">+</span> <span class="n">dtgmdy</span><span class="o">*</span><span class="n">ny</span> <span class="o">+</span> <span class="n">dtgmdz</span><span class="o">*</span><span class="n">nz</span><span class="p">)))</span>
<a name="ln-742"></a>         
<a name="ln-743"></a>        <span class="k">end do</span>
<a name="ln-744"></a><span class="k">       end do</span>
<a name="ln-745"></a><span class="k">      end do</span>
<a name="ln-746"></a><span class="k">    end subroutine </span><span class="n">compute_viscous_fluxes_lctm2015</span>
<a name="ln-747"></a>
<a name="ln-748"></a>
<a name="ln-749"></a><span class="k">end module </span><span class="n">viscous</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-02-10T20:32:54.471560 
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> FEST-3D was developed by FEST-3D Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>